---
slug: '/release/v2.9'
title: 'v2.9'
sidebar_position: -2
hide_title: true
keywords: []
description: ''
unlist: true
---




# 主要内容

本次版本变更内容较多，以下为本次版本的主要内容，详细的`Change Log`请参考：
[https://github.com/gogf/gf/releases/tag/v2.9.0](https://github.com/gogf/gf/releases/tag/v2.9.0)

完整的代码变更请参考：[https://github.com/gogf/gf/compare/v2.8.0...v2.9.0](https://github.com/gogf/gf/compare/v2.8.0...v2.9.0)


## 兼容提示

## 组件改进
2. `net/ghttp`
    - 新增常用中间件`MiddlewareGzip`支持，用于使用`gzip`算法压缩返回结果：https:// 应当整理提供的中间件文档。
    - 去掉规范路由注册时对`api`定义时输入输出数据结构的`*Req/*Res`命名规则限制。
    - 修复跨域返回`Header`中自动从`Referer`生成`Origin`逻辑不严谨的问题。
    - 修复`BuildParams`方法构建请求参数时针对`json omitempty`标签失效问题。
    - 修复`Logger`设置为`nil`时会引发的空指针`panic`问题。

2. `net/client`
    - 在全局的服务注册发现组件开启时，该组件创建的`HTTP Client`对象不再默认启用服务发现功能，需要手动开启。

1. `database/gdb`
    - 新增分库分表特性：https://
    - 新增事务传播特性以及隔离级别、只读模式支持：https://
    - 新增`WhereExists/WhereNotExists`方法支持：https://
    - 新增对`unix socket`数据库链接配置的支持。
    - 修复在`OnDuplicate`方法中使用`gdb.Counter`类型失效问题：https://
    - 修复当用户增加`Select Hook`并修改返回结构后，部分场景下导致`Count/Value/Array`查询结构异常问题。
    - 修复在使用`with`特性时，数据结构中`embedded struct`的元数据标签中的`orm`标签失效问题。

3. `net/goai`
    - 支持`OpenAPIv3.1`协议。
    - 新增返回数据结构扩展能力：https://
    - 新增自动识别数据校验规则`min/max/length/min-length/max-length/between`为`OpenAPIv3`中对应的校验数据结构。
    - 修复参数数据结构中`embedded struct`数据结构无法扩展为参数结构的问题。

4. `errors/gerror`
    - 新增`As`方法支持：https://

4. `utils/gvalid`
    - 修复`enums`参数使用指针时`enums`校验失效的问题。

4. `os/glog`
    - 日志默认时间打印格式调整为更严谨的`2006-01-02T15:04:05.000Z07:00`。

4. `os/gsession`
    - 新增`RegenerateId/MustRegenerateId`方法支持，用以手动重新生成`Session ID`：https://


4. `os/gview`
    - 修复个别场景下从资源管理器中读取模板文件失败的问题。

5. `os/gcmd`
    - 命令行参数默认值支持输出到命令帮助界面：https://

5. `net/gipv4`
    - 改进`ip`地址和`uint32`相互转换实现逻辑。

5. `util/gconv`
    - 改进`Scan`方法，增加`Scan`到基础数据类型的转换支持：https://
    
6. `test/gtest`
    - 改进`AssertNI/AssertIN`方法，增加`map`类型支持：https://

## 社区组件
1. `drivers/pgsql`
    - 增加对`pgsql`数组字段类型`varchar[]/text[]`的转换支持，自动转换为Go`[]string`类型。
    - 改进数组类型转换性能。

2. `contrib/config/polaris`
    - 新增更多的数据格式内容支持，支持`yaml/toml/json/xml/ini/properties`等格式。

2. `contrib/registry/consul`
    - 新增`consul`服务注册发现组件支持：https://

3. `contrib/registry/etcd`
    - 新增重试机制，解决`lease`租约过期时的重续问题。
    - 删除默认的`AutoSyncInterval`配置项，解决个别场景下由该默认配置引发的`etcd`阻塞问题。

4. `contrib/config/nacos`
    - 新增`OnChange`回调配置支持。

5. `contrib/metric/otelmetric`
    - 新增`WithExemplarFilter`选项支持。

## 开发工具
1. 改进`gf init`命令，初始化项目的模板内容发生了改变。
2. 改进`gf up`命令，在终端中展示更优雅的`cli`文件下载界面效果。
3. 改进`gf gen ctrl`命令，`api`中定义的注释将会自动同步到生成的控制器代码中。
4. 改进`gf gen dao`命令：
    - 新增分表选项参数`shardingPattern/sp`，用于定义分表规则，生成支持分库的`dao`代码：https://
    - 改进代码生成模板，支持`Golang Template`语法。
5. 改进`gf gen enums`命令：
    - 修改默认读取的接口数据结构定义目录为`api`
    - 修改默认生成代码文件路径为`internal/packed/packed_enums.go`
3. 改进`gf gen genpbentity`命令：
    - 增加`TypeMapping`和`FieldMapping`特性支持：https://
    - 增加`TablesEx`支持，用于生成`proto`文件时可以忽略指定的表。
    - 增加`GoPackage`选项用于指定生成`proto`文件中的`go_package`配置项。
3. 修复`gf build`命令在打印环境变量时不准确的问题，应当打印编译文件时，修改环境变量后，真实使用的环境变量。
3. 修复`gf gen pb`命令在部分场景下使用`-a`选项时，多次执行命令后，自定义标签重复添加的问题。


## 功能修复
1. 修复`os/gcache`组件中`Remove`方法返回的数据类型与旧版本不兼容的问题。
2. 修复`database/gdb`组件中`tinyint(1)/int(1)`类型识别为`bool`类型与旧版本不兼容的问题。
3. 修复`database/gdb`组件中`Order("id", "dasc")`语句与旧版本不兼容的问题。
4. 修复`registry/zookeeper`组件中带有额外后缀`-`的服务名称路径监听错误。
5. 修复`cmd/gf`组件中`make`命令在项目模板中生成的`Makefile`文件中的命令不正确的问题。
