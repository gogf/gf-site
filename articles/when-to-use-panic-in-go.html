<!doctype html><html lang=zh-Hans dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-community/社区投稿/Go语言中何时使用panic是合适的" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>何时使用panic？深入理解Go错误处理的最佳实践 | GoFrame官网 - 类似PHP-Laravel,Java-SpringBoot的Go语言开发框架</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://goframe.org/articles/when-to-use-panic-in-go><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true property=og:locale:alternate content=en_US><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="何时使用panic？深入理解Go错误处理的最佳实践 | GoFrame官网 - 类似PHP-Laravel,Java-SpringBoot的Go语言开发框架"><meta data-rh=true name=description content=深入探讨Go语言中何时应该使用panic而非返回错误，通过实例分析了预期错误与代码缺陷的区别，以及在安全检查、配置加载等场景中的最佳错误处理策略。><meta data-rh=true property=og:description content=深入探讨Go语言中何时应该使用panic而非返回错误，通过实例分析了预期错误与代码缺陷的区别，以及在安全检查、配置加载等场景中的最佳错误处理策略。><meta data-rh=true name=keywords content=GoFrame,panic,recover,错误处理,代码缺陷,预期错误,Go最佳实践,安全检查><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://goframe.org/articles/when-to-use-panic-in-go><link data-rh=true rel=alternate href=https://goframe.org/articles/when-to-use-panic-in-go hreflang=zh-Hans><link data-rh=true rel=alternate href=https://goframe.org/en/articles/when-to-use-panic-in-go hreflang=en-US><link data-rh=true rel=alternate href=https://goframe.org/articles/when-to-use-panic-in-go hreflang=x-default><link data-rh=true rel=preconnect href=https://ZQUL8VI47R-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="GoFrame官网 - 类似PHP-Laravel,Java-SpringBoot的Go语言开发框架" href=/opensearch.xml><script src=https://hm.baidu.com/hm.js?38f38a0626fd7805722db06243cd0fa7 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/assets/css/styles.51139f28.css><script src=/assets/js/runtime~main.cc14d276.js defer></script><script src=/assets/js/main.3dde16bc.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo2.png alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/logo2.png alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" sidebarid=quickSidebar href=/quick/install>快速开始</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/docs/core>开发手册</a><div class="navbar__item dropdown dropdown--hoverable"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button sidebarid=courseSidebar href=/course>社区教程</a><ul class=dropdown__menu><li><a class=dropdown__link sidebarid=courseSidebar href=/course/bilibili-video>视频入门教程</a><li><a class=dropdown__link sidebarid=courseStarBookSidebar href=/course/starbook>入门实战教程-星辰英语本</a><li><a class=dropdown__link sidebarid=courseProximaBookSidebar href=/course/proxima-book>微服务实战教程-比邻英语本</a></ul></div><a class="navbar__item navbar__link" href=/examples/grpc>代码示例</a><a class="navbar__item navbar__link" href=/showcase>案例展示</a><a class="navbar__item navbar__link" href=/release/note>发布记录</a><a class="navbar__item navbar__link" sidebarid=communitySidebar href=/share/group>开源社区</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/articles/when-to-use-panic-in-go>2.9.x(Latest)</a><ul class=dropdown__menu><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/articles/when-to-use-panic-in-go>2.9.x(Latest)</a><li><a class=dropdown__link href=/2.8.x/docs/cli>2.8.x</a><li><a class=dropdown__link href=/2.7.x/docs/design>2.7.x</a><li><a class=dropdown__link href=/2.6.x/项目开发>2.6.x</a><li><a class=dropdown__link href=/2.5.x/项目开发>2.5.x</a><li><a class=dropdown__link href=/2.4.x/开发工具>2.4.x</a><li><a class=dropdown__link href=/2.3.x/开发工具>2.3.x</a><li><a class=dropdown__link href=/2.2.x/开发工具>2.2.x</a><li><a class=dropdown__link href=/2.1.x/开发工具>2.1.x</a><li><a class=dropdown__link href=/2.0.x/开发工具>2.0.x</a><li><a class=dropdown__link href=/1.16.x/开发工具>1.16.x</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>简体中文</a><ul class=dropdown__menu><li><a href=/articles/when-to-use-panic-in-go rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=zh-Hans>简体中文</a><li><a href=/en/articles/when-to-use-panic-in-go rel="noopener noreferrer" class=dropdown__link lang=en-US>English</a></ul></div><a href=https://github.com/gogf/gf target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>搜索</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/share>社区交流</a><button aria-label="展开侧边栏分类 '社区交流'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/articles>社区投稿</a><button aria-label="折叠侧边栏分类 '社区投稿'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/articles/framework-comparison-goframe-beego-iris-gin>Golang框架选型比较: goframe, beego, iris和gin</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/articles/database-transaction-practice>Go事务处理最佳实践：保证数据一致性的正确方法</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/articles/use-error-code-gracefully-in-golang>Go开发中如何优雅地使用错误码</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/articles/when-to-use-panic-in-go>何时使用panic？深入理解Go错误处理的最佳实践</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/articles/techempower-web-benchmarks-r23>TechEmpower Web Benchmarks最新性能评测</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/articles/rbac-permission-authentication-in-go>为Go应用增加完整的权限认证能力</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/articles/go-sse-implementation-guide>打造高性能实时通信：Go语言SSE实现指南</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/articles/go-ecommerce-database-sharding-millions>突破性能瓶颈：Go语言实现电商系统千万级数据分库分表实战</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/supportus>支持我们</a><button aria-label="展开侧边栏分类 '支持我们'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=页面路径><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/articles><span itemprop=name>社区投稿</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>何时使用panic？深入理解Go错误处理的最佳实践</span><meta itemprop=position content=2></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：2.9.x(Latest)</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=panic与返回错误的对比>panic与返回错误的对比<a href=#panic与返回错误的对比 class=hash-link aria-label=panic与返回错误的对比的直接链接 title=panic与返回错误的对比的直接链接>​</a></h2>
<p>我们先来看一个简单的例子。假设我们要创建一个<code>timeIn</code>函数，这个函数接收一个时区名称，然后返回该时区的当前时间。</p>
<p>在<code>Go</code>语言中，当<code>timeIn</code>函数遇到错误时，标准的做法是将错误返回给调用者，让调用者自己决定如何处理。代码如下：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>package</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"fmt"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"os"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"time"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>timeIn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">zone </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Time</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>error</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    loc</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>LoadLocation</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">zone</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Time</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err  </span><span class="token comment" style=color:#8292a2;font-style:italic>// 返回time.LoadLocation()产生的任何错误</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Now</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>In</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">loc</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>main</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    tz </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Asia/Shang"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    t</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>timeIn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">tz</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Error:"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        os</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Exit</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Current time in"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> tz</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"is"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> t</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ go run main.go</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">Error: unknown </span><span class="token function" style=color:#e6db74>time</span><span class="token plain"> zone Asia/Shang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token builtin class-name" style=color:#e6db74>exit</span><span class="token plain"> status </span><span class="token number" style=color:#ae81ff>1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>当然，你也可以选择另一种方式：在<code>timeIn</code>函数内部使用<code>panic</code>来处理错误，而不是将错误返回给调用者。代码可以这样写：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>package</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"fmt"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token string" style=color:#a6e22e>"time"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>timeIn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">zone </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Time </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    loc</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>LoadLocation</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">zone</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>panic</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token comment" style=color:#8292a2;font-style:italic>// 以错误为参数调用panic()</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> time</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Now</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>In</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">loc</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>main</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    tz </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"Asia/Shang"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    t </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>timeIn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">tz</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Println</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Current time in"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> tz</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"is"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> t</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">$ go run main.go</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">panic: unknown </span><span class="token function" style=color:#e6db74>time</span><span class="token plain"> zone Asia/Shang</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">goroutine </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">running</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token plain">:</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">main.timeIn</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain">0x4c2c7e?, 0x7d40fe626108?</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    /tmp/main.go:11 +0xc5</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">main.main</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    /tmp/main.go:20 +0x2b</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token builtin class-name" style=color:#e6db74>exit</span><span class="token plain"> status </span><span class="token number" style=color:#ae81ff>2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>当在<code>Go</code>代码中使用<code>panic</code>时，会发生以下四个步骤：</p>
<ol>
<li><strong>立即停止当前函数</strong>：函数中<code>panic</code>语句后面的代码将不会被执行。</li>
<li><strong>执行所有的<code>defer</code>函数</strong>：按照“后进先出”的顺序，执行当前协程中所有的<code>defer</code>语句。</li>
<li><strong>打印错误信息</strong>：在控制台输出“panic:”字样，后面跟着传给<code>panic</code>的错误信息，并显示当前协程的调用堆栈。</li>
<li><strong>终止程序</strong>：使用退出码<code>2</code>结束程序的运行。</li>
</ol>
<p>不过，有一种方法可以阻止程序终止：在<code>defer</code>函数中使用<code>recover</code>函数来捕获和处理<code>panic</code>。这样只会执行到第<code>2</code>步，第<code>3</code>和第<code>4</code>步不会发生。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=为什么panic被认为是不好的>为什么panic被认为是不好的？<a href=#为什么panic被认为是不好的 class=hash-link aria-label=为什么panic被认为是不好的？的直接链接 title=为什么panic被认为是不好的？的直接链接>​</a></h2>
<p><code>panic</code>本身并不是一个坏东西。实际上，它提供了一些有用的功能，比如执行所有的<code>defer</code>函数、打印详细的堆栈信息等。</p>
<p>但在大多数情况下，返回错误是一种更好的选择。原因在于：</p>
<p>当使用<code>panic</code>时，程序会按照固定的流程执行（停止函数、执行<code>defer</code>、打印错误、终止程序），但你无法控制这个过程。</p>
<p>而当函数返回错误时，调用者有完全的自由决定如何处理这个错误。例如，调用者可以：</p>
<ul>
<li>将错误记录到日志</li>
<li>将错误信息显示给用户</li>
<li>重新尝试调用该函数</li>
<li>忽略这个错误</li>
<li>将错误传递给更上层的调用者</li>
</ul>
<p>这种灵活性让程序能够更优雅地处理各种错误情况。</p>
<p>返回错误还有其他好处：</p>
<ul>
<li><strong>更丰富的上下文信息</strong>：在将错误向上传递到调用栈时，你可以选择"包装"它们，以在每一步提供额外的上下文信息。这些额外的上下文可以使错误更具信息性和实用性，并可能比仅依赖于<code>panic</code>的堆栈跟踪更容易调试。</li>
<li><strong>更易于测试</strong>：对于返回错误的函数，编写单元测试更容易。虽然在测试期间验证函数是否按预期触发<code>panic</code>并非不可能，但这比仅检查错误返回值更尴尬且不那么清晰。</li>
<li><strong>更好的库设计</strong>：如果你要创建供他人导入和使用的包，返回错误而不是触发<code>panic</code>是更优雅的做法。记住：<code>panic</code>会终止正在运行的应用程序（当前<code>goroutine</code>），这可能不是使用你的包的人所期望的。最好返回一个错误，并让调用者决定下一步做什么。如果他们愿意，他们可以根据返回的错误主动调用<code>panic</code>。</li>
<li><strong>符合Go语言惯例</strong>：最后，这就是<code>Go</code>的方式。错误通常是被返回的 - <code>Go</code>标准库是这么做的，也是其他<code>Go</code>开发者期望的标准做法。通过坚持这一惯例，你的代码更加可预测，也更容易被其他人理解。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=什么时候panic是合适的>什么时候panic是合适的？<a href=#什么时候panic是合适的 class=hash-link aria-label=什么时候panic是合适的？的直接链接 title=什么时候panic是合适的？的直接链接>​</a></h2>
<p>要回答这个问题，我们需要区分两种不同类型的错误：“预期错误”和“代码缺陷”。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=预期错误>预期错误<a href=#预期错误 class=hash-link aria-label=预�期错误的直接链接 title=预期错误的直接链接>​</a></h3>
<p><strong>预期错误</strong>是指那些在正常运行中可能会发生的错误。比如：</p>
<ul>
<li>数据库连接失败</li>
<li>网络资源不可用</li>
<li>文件权限不足</li>
<li>操作超时</li>
<li>用户输入不符合要求</li>
</ul>
<p>这些错误并不意味着你的程序有问题，而是由外部因素引起的。因为这些错误是可以预见的，所以应该通过返回错误的方式来处理它们，而不是使用<code>panic</code>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=代码缺陷>代码缺陷<a href=#代码缺陷 class=hash-link aria-label=代码缺陷的直接链接 title=代码缺陷的直接链接>​</a></h3>
<p><strong>代码缺陷</strong>是指那些“本不应该发生”的错误。这些错误通常由以下原因导致：</p>
<ul>
<li>开发者编写的代码有错误</li>
<li>程序逻辑存在缺陷</li>
<li>以不正确的方式使用某个函数或特性</li>
</ul>
<p>这类错误应该在开发或测试阶段就被发现和解决，而不应该出现在生产环境中。</p>
<p>当遇到代码缺陷时，意味着程序已经处于一种意外的、不可预测的状态。在这种情况下，使用<code>panic</code>可能是一种合适的选择。</p>
<p>尽管我们前面提到了返回错误的各种好处，但在某些特定情况下，使用<code>panic</code>可能是更好的选择。</p>
<p>使用<code>panic</code>可能合适的两种主要情况：</p>
<ol>
<li>
<p><strong>错误无法恢复时</strong>：当遇到的错误使程序无法安全地继续运行，且没有合理的方法来处理这种情况。</p>
</li>
<li>
<p><strong>错误处理会导致代码过于复杂时</strong>：如果为了处理某些很少发生的错误情况，需要在整个代码库中添加大量的错误处理代码，这可能会使代码变得非常复杂且难以维护。尤其是当这些错误在正常情况下不应该发生时。</p>
</li>
</ol>
<p><code>Go</code>标准库中有许多使用<code>panic</code>的例子，这些例子很好地展示了何时使用<code>panic</code>是合适的：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=go标准库中的panic例子>Go标准库中的panic例子<a href=#go标准库中的panic例子 class=hash-link aria-label=Go标准库中的panic例子的直接链接 title=Go标准库中的panic例子的直接链接>​</a></h3>
<ul>
<li>当数字除以<code>0</code>时</li>
<li>当访问数组或切片的越界元素时</li>
<li>当尝试使用<code>nil</code>指针时</li>
<li>当尝试向<code>nil</code>的map中写入数据时</li>
<li>当解锁一个未锁定的互斥锁时</li>
<li>当向已关闭的通道发送数据时</li>
<li>当在同一个<code>flag.FlagSet</code>中定义两个相同名称的标志时</li>
<li>当给<code>http.ResponseWriter.WriteHeader()</code>传递一个无效的HTTP状态码（小于<code>100</code>或大于<code>999</code>）时</li>
<li>当<code>sync.WaitGroup</code>的计数器变为负数时</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=这些例子的共同点>这些例子的共同点<a href=#这些例子的共同点 class=hash-link aria-label=这些例子的共同点的直接链接 title=这些例子的共同点的直接链接>​</a></h3>
<p>仔细观察这些例子，我们可以发现它们有两个重要的共同点：</p>
<ol>
<li>
<p><strong>它们都是代码缺陷</strong>：这些情况都表明代码中存在逻辑错误或使用不当。在正常的程序中，这些情况应该在开发或测试阶段就被发现和解决。</p>
</li>
<li>
<p><strong>如果使用错误返回会导致代码过于复杂</strong>：想象一下，如果每次除法运算、每次访问数组元素、每次使用<code>map</code>时都要检查错误，代码将变得多么复杂和臃肿。</p>
</li>
</ol>
<p>所以，在这些情况下使用<code>panic</code>是合理的选择，因为它们要么是无法恢复的错误，要么是使用错误返回会导致代码过于复杂的情况。</p>
<p>当然，判断什么程度的错误处理复杂性是“难以接受的”，这个标准因人而异，也依赖于具体项目的特点。这并没有一个绝对的标准答案。</p>
<p>除了上面提到的情况外，还有两种常见的场景也适合使用<code>panic</code>：</p>
<ol>
<li>
<p><strong>作为最后的安全防线</strong>：有时候我们会在代码中添加一些安全检查，来防止那些“绝对不应该发生”的情况。如果这些检查失败并触发<code>panic</code>，这通常意味着程序中存在严重的<code>bug</code>或逻辑错误。</p>
</li>
<li>
<p><strong>当程序无法继续时</strong>：在某些情况下，错误可能会使程序处于一种无法继续运行的状态，而且没有其他合适的错误处理方式。在这种情况下，使用<code>panic</code>可能是唯一的选择。</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=实际案例分析>实际案例分析<a href=#实际案例分析 class=hash-link aria-label=实际案例分析的直接链接 title=实际案例分析的直接链接>​</a></h2>
<p>到目前为止，我们已经讨论了使用<code>panic</code>的理论原则。现在，让我们通过一些实际的代码案例来看看这些原则如何应用。</p>
<p>需要强调的是，<code>panic</code>应该被谨慎使用，只有在真正适合的情况下才使用它。在我的实际工作经验中，大约有一半的项目完全不使用<code>panic</code>，即使使用，也只在少数几个关键位置。</p>
<p>下面是我在实际项目中遇到的几个使用<code>panic</code>的案例，这些案例可以帮助我们更好地理解何时使用<code>panic</code>是合适的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=例子一web应用中的上下文检查>例子一：Web应用中的上下文检查<a href=#例子一web应用中的上下文检查 class=hash-link aria-label=例子一：Web应用中的上下文检查的�直接链接 title=例子一：Web应用中的上下文检查的直接链接>​</a></h3>
<p>这个例子来自一个Web应用，其中我们需要从请求的上下文中获取用户信息：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> contextKey </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>const</span><span class="token plain"> userContextKey </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>contextKey</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"user"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>contextGetUser</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">r </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">http</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Request</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> user</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">User </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    user</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> ok </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> r</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Context</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Value</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">userContextKey</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">user</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">User</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">ok </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>panic</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"missing user value in request context"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> user</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个函数的设计基于一个重要的前提：<strong>只有当我们确定上下文中存在用户信息时，才会调用这个函数</strong>。所以，如果用户信息不存在，这意味着我们的代码中存在严重的逻辑错误。</p>
<p>当然，我们也可以让<code>contextGetUser</code>函数返回一个错误，而不是使用<code>panic</code>。这样调用者可以处理这个错误，比如记录日志并返回一个500错误给用户。</p>
<p>但是，考虑到这个函数在程序中被频繁调用，如果每次调用都要处理这个在正常情况下不应该发生的错误，会导致代码中充斥大量的错误处理逻辑。因此，在这种情况下使用<code>panic</code>是合适的选择。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=例子二环境变量配置加载>例子二：环境变量配置加载<a href=#例子二环境变量配置加载 class=hash-link aria-label=例子二：环境变量配置加载的直接链接 title=例子二：环境变量配置加载的直接链接>​</a></h3>
<p>这个例子展示了在程序启动时处理配置的情况：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getEnvInt</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">key </span><span class="token builtin" style=color:#e6db74>string</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> defaultValue </span><span class="token builtin" style=color:#e6db74>int</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>int</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    value</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> exists </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> os</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>LookupEnv</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">key</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">exists </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> defaultValue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    intValue</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> strconv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Atoi</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">value</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>panic</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> intValue</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这个<code>getEnvInt</code>函数的作用是从环境变量中读取值并将其转换为整数。如果环境变量不存在，它会返回默认值；但如果环境变量存在但不能转换为整数，它会触发<code>panic</code>。</p>
<p>一开始看，这似乎不符合使用<code>panic</code>的原则。毕竟，环境变量的值无法转换为整数是一种完全可能发生的情况，应该属于“预期错误”。</p>
<p>但这个函数的使用场景很特殊：它只在程序启动时用来加载基本配置，如：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">httpPort </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>getEnvInt</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"HTTP_PORT"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> </span><span class="token number" style=color:#ae81ff>3939</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>在这个阶段，程序的其他部分（包括日志系统）还没有初始化完成。如果配置加载失败，程序就无法正常运行，而且没有合适的方式来处理这个错误（比如记录日志）。</p>
<p>在这种情况下，使用<code>panic</code>是合理的，因为：</p>
<ol>
<li>程序无法在没有正确配置的情况下继续运行</li>
<li>在这个早期阶段，没有其他更好的错误处理机制</li>
</ol>
<p>当然，我们也可以让<code>getEnvInt</code>函数返回错误，然后由调用者决定是否触发<code>panic</code>。但这会增加额外的错误处理代码，而最终结果可能还是一样的。因此，直接在<code>getEnvInt</code>函数内触发<code>panic</code>是一种更简洁的方式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=例子三sql注入防护>例子三：SQL注入防护<a href=#例子三sql注入防护 class=hash-link aria-label=例子三：SQL注入防护的直接链接 title=例子三：SQL注入防护的直接链接>​</a></h3>
<p>这个例子展示了如何使用<code>panic</code>作为安全防护机制：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>var</span><span class="token plain"> safeChars </span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain"> regexp</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MustCompile</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"^[a-z0-9_]+$"</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>type</span><span class="token plain"> SortValues </span><span class="token keyword" style=color:#66d9ef>struct</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Column    </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    Ascending </span><span class="token builtin" style=color:#e6db74>bool</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sv </span><span class="token operator" style=color:#66d9ef>*</span><span class="token plain">SortValues</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>OrderBySQL</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token builtin" style=color:#e6db74>string</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>!</span><span class="token plain">safeChars</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>MatchString</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">sv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Column</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token function" style=color:#e6db74>panic</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"unsafe sort column: "</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>+</span><span class="token plain"> sv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Column</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> sv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Ascending </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sprintf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"ORDER BY %s ASC"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> sv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Column</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>return</span><span class="token plain"> fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Sprintf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"ORDER BY %s DESC"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> sv</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">Column</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>这段代码的背景是：我们需要根据用户的输入来生成<code>SQL</code>查询语句，其中包含动态的<code>ORDER BY</code>部分。</p>
<p>这里有一个安全问题：<code>SQL</code>不支持在<code>ORDER BY</code>子句中使用参数占位符（如<code>?</code>或<code>:param</code>），所以我们必须直接将列名插入到<code>SQL</code>字符串中。这就带来了<code>SQL</code>注入的风险。</p>
<p>正常情况下，在调用<code>OrderBySQL</code>方法之前，应该已经有其他代码验证了<code>Column</code>字段的值是否在允许的列名白名单中。但如果由于程序中的<code>bug</code>或开发者的疑忌，这个验证步骤被遗漏了，就可能导致<code>SQL</code>注入攻击。</p>
<p>因此，我们在<code>OrderBySQL</code>方法中添加了一个额外的安全检查，确保<code>Column</code>字段只包含安全的字符（小写字母、数字和下划线）。如果检测到不安全的字符，就触发<code>panic</code>。</p>
<p>这种情况下使用<code>panic</code>而不是返回错误的原因是：</p>
<ol>
<li>这个检查是一个“最后的防线”，在正常情况下不应该失败</li>
<li>如果这个检查失败，意味着程序中存在严重的安全漏洞</li>
<li>在这种情况下，立即停止程序比继续运行并可能导致数据库被破坏要安全得多</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=总结>总结<a href=#总结 class=hash-link aria-label=总结的直接链接 title=总结的直接链接>​</a></h2>
<p>通过以上的讨论和实例，我们可以得出以下结论：</p>
<p>在<code>Go</code>语言编程中，大多数情况下应该选择返回错误，而不是使用<code>panic</code>。这符合<code>Go</code>的设计哲学和最佳实践。</p>
<p>但在以下几种特定情况下，使用<code>panic</code>可能是合适的选择：</p>
<ol>
<li>
<p><strong>错误无法恢复时</strong>：当程序遇到的错误使其无法安全地继续运行时。</p>
</li>
<li>
<p><strong>错误处理会导致代码过于复杂时</strong>：当为了处理非常罕见的错误情况而需要添加大量额外的错误处理代码时。</p>
</li>
<li>
<p><strong>作为安全防护机制</strong>：在代码中添加安全检查，防止那些绝对不应该发生的情况。</p>
</li>
<li>
<p><strong>当没有更好的错误处理方式时</strong>：如程序启动时的配置加载错误。</p>
</li>
</ol>
<p>最重要的是，要记住<code>panic</code>会导致程序终止运行（除非被<code>recover</code>捕获），因此应该谨慎使用，只在真正适合的情况下才使用它。</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/gogf/gf-site/blob/main/docs/community/社区投稿/Go语言中何时使用panic是合适的.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>最后<!-- -->由 <b>John</b> <!-- -->于 <b><time datetime=2025-04-08T05:18:12.000Z itemprop=dateModified>2025年4月8日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href=/articles/use-error-code-gracefully-in-golang><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>Go开发中如何优雅地使用错误码</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/articles/techempower-web-benchmarks-r23><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>TechEmpower Web Benchmarks最新性能评测</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#panic与返回错误的对比 class="table-of-contents__link toc-highlight">panic与返回错误的对比</a><li><a href=#为什么panic被认为是不好的 class="table-of-contents__link toc-highlight">为什么panic被认为是不好的？</a><li><a href=#什么时候panic是合适的 class="table-of-contents__link toc-highlight">什么时候panic是合适的？</a><ul><li><a href=#预期错误 class="table-of-contents__link toc-highlight">预期错误</a><li><a href=#代码缺陷 class="table-of-contents__link toc-highlight">代码缺陷</a><li><a href=#go标准库中的panic例子 class="table-of-contents__link toc-highlight">Go标准库中的panic例子</a><li><a href=#这些例子的共同点 class="table-of-contents__link toc-highlight">这些例子的共同点</a></ul><li><a href=#实际案例分析 class="table-of-contents__link toc-highlight">实际案例分析</a><ul><li><a href=#例子一web应用中的上下文检查 class="table-of-contents__link toc-highlight">例子一：Web应用中的上下文检查</a><li><a href=#例子二环境变量配置加载 class="table-of-contents__link toc-highlight">例子二：环境变量配置加载</a><li><a href=#例子三sql注入防护 class="table-of-contents__link toc-highlight">例子三：SQL注入防护</a></ul><li><a href=#总结 class="table-of-contents__link toc-highlight">总结</a></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>微信关注我们</div><ul class="footer__items clean-list"><li class=footer__item><img src=/img/wechat.jpg width=110></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright 2025 GoFrame OpenSource Team</div></div></div></footer></div>