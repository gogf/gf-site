"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["46956"],{139723:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,contentTitle:()=>c,default:()=>u,assets:()=>a,toc:()=>l,frontMatter:()=>s});var t=JSON.parse('{"id":"docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66/\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4F7F\u7528","title":"\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4F7F\u7528","description":"\u5728GoFrame\u6846\u67B6\u4E2D\u4F7F\u7528gmetric\u7EC4\u4EF6\u8FDB\u884C\u76D1\u63A7\u6307\u6807\u7684\u5F00\u53D1\u3002\u901A\u8FC7\u5F15\u5165otelmetric\u7EC4\u4EF6\uFF0C\u53EF\u4EE5\u5229\u7528OpenTelemetry\u5B9E\u73B0\u6846\u67B6\u7684\u76D1\u63A7\u6307\u6807\u63A5\u53E3\u3002\u6587\u7AE0\u8BE6\u7EC6\u63CF\u8FF0\u4E86\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\u7684\u521B\u5EFA\u3001\u5404\u79CD\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u4F7F\u7528\u53CA\u521D\u59CB\u5316\u65B9\u6CD5\uFF0C\u5E76\u901A\u8FC7\u4EE3\u7801\u793A\u4F8B\u5C55\u793A\u4E86\u5982\u4F55\u8BFB\u53D6\u548C\u64CD\u4F5C\u6307\u6807\u6570\u636E\u3002","source":"@site/docs/docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66/\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4F7F\u7528.md","sourceDirName":"docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66","slug":"/docs/obs/metrics-example","permalink":"/docs/obs/metrics-example","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66/\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4F7F\u7528.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1731511511000,"sidebarPosition":1,"frontMatter":{"slug":"/docs/obs/metrics-example","title":"\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4F7F\u7528","sidebar_position":1,"hide_title":true,"keywords":["GoFrame","\u76D1\u63A7\u6307\u6807","otelmetric","OpenTelemetry","\u6307\u6807\u7BA1\u7406","Counter","MetricOption","gmetric","\u6570\u636E\u8BFB\u53D6","\u6307\u6807\u5B9E\u73B0"],"description":"\u5728GoFrame\u6846\u67B6\u4E2D\u4F7F\u7528gmetric\u7EC4\u4EF6\u8FDB\u884C\u76D1\u63A7\u6307\u6807\u7684\u5F00\u53D1\u3002\u901A\u8FC7\u5F15\u5165otelmetric\u7EC4\u4EF6\uFF0C\u53EF\u4EE5\u5229\u7528OpenTelemetry\u5B9E\u73B0\u6846\u67B6\u7684\u76D1\u63A7\u6307\u6807\u63A5\u53E3\u3002\u6587\u7AE0\u8BE6\u7EC6\u63CF\u8FF0\u4E86\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\u7684\u521B\u5EFA\u3001\u5404\u79CD\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u4F7F\u7528\u53CA\u521D\u59CB\u5316\u65B9\u6CD5\uFF0C\u5E76\u901A\u8FC7\u4EE3\u7801\u793A\u4F8B\u5C55\u793A\u4E86\u5982\u4F55\u8BFB\u53D6\u548C\u64CD\u4F5C\u6307\u6807\u6570\u636E\u3002"},"sidebar":"mainSidebar","previous":{"title":"\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4ECB\u7ECD","permalink":"/docs/obs/metrics-intro"},"next":{"title":"\u76D1\u63A7\u544A\u8B66-\u540C\u6B65\u6307\u6807","permalink":"/docs/obs/metrics-sync"}}'),i=r("785893"),o=r("250065");let s={slug:"/docs/obs/metrics-example",title:"\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4F7F\u7528",sidebar_position:1,hide_title:!0,keywords:["GoFrame","\u76D1\u63A7\u6307\u6807","otelmetric","OpenTelemetry","\u6307\u6807\u7BA1\u7406","Counter","MetricOption","gmetric","\u6570\u636E\u8BFB\u53D6","\u6307\u6807\u5B9E\u73B0"],description:"\u5728GoFrame\u6846\u67B6\u4E2D\u4F7F\u7528gmetric\u7EC4\u4EF6\u8FDB\u884C\u76D1\u63A7\u6307\u6807\u7684\u5F00\u53D1\u3002\u901A\u8FC7\u5F15\u5165otelmetric\u7EC4\u4EF6\uFF0C\u53EF\u4EE5\u5229\u7528OpenTelemetry\u5B9E\u73B0\u6846\u67B6\u7684\u76D1\u63A7\u6307\u6807\u63A5\u53E3\u3002\u6587\u7AE0\u8BE6\u7EC6\u63CF\u8FF0\u4E86\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\u7684\u521B\u5EFA\u3001\u5404\u79CD\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u4F7F\u7528\u53CA\u521D\u59CB\u5316\u65B9\u6CD5\uFF0C\u5E76\u901A\u8FC7\u4EE3\u7801\u793A\u4F8B\u5C55\u793A\u4E86\u5982\u4F55\u8BFB\u53D6\u548C\u64CD\u4F5C\u6307\u6807\u6570\u636E\u3002"},c=void 0,a={},l=[{value:"\u57FA\u672C\u4ECB\u7ECD",id:"\u57FA\u672C\u4ECB\u7ECD",level:2},{value:"\u6307\u6807\u7BA1\u7406\u7EC4\u4EF6\u7684\u521B\u5EFA",id:"\u6307\u6807\u7BA1\u7406\u7EC4\u4EF6\u7684\u521B\u5EFA",level:2},{value:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u521B\u5EFA",id:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u521B\u5EFA",level:2},{value:"\u521D\u59CB\u5316\u76D1\u63A7\u6307\u6807\u5B9E\u73B0",id:"\u521D\u59CB\u5316\u76D1\u63A7\u6307\u6807\u5B9E\u73B0",level:2},{value:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u4F7F\u7528",id:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u4F7F\u7528",level:2},{value:"\u76D1\u63A7\u6307\u6807\u7684\u6570\u636E\u8BFB\u53D6",id:"\u76D1\u63A7\u6307\u6807\u7684\u6570\u636E\u8BFB\u53D6",level:2}];function d(e){let n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"\u57FA\u672C\u4ECB\u7ECD",children:"\u57FA\u672C\u4ECB\u7ECD"}),"\n",(0,i.jsxs)(n.p,{children:["\u76D1\u63A7\u6307\u6807\u7684\u4EE3\u7801\u5F00\u53D1\u76F4\u63A5\u4F7F\u7528\u6846\u67B6\u4E3B\u5E93\u7684 ",(0,i.jsx)(n.code,{children:"gmetric"})," \u7EC4\u4EF6\u5373\u53EF\uFF0C\u4F46\u7531\u4E8E ",(0,i.jsx)(n.code,{children:"gmetric"})," \u7EC4\u4EF6\u5B9E\u9645\u4E0A\u53EA\u662F\u5B9A\u4E49\u4E86\u76D1\u63A7\u6307\u6807\u7684\u76F8\u5173\u63A5\u53E3\uFF0C\u5E76\u4E14\u9ED8\u8BA4\u63D0\u4F9B\u7684 ",(0,i.jsx)(n.code,{children:"NoopPerformer"}),"\uFF0C\u9ED8\u8BA4\u76D1\u63A7\u6307\u6807\u7279\u6027\u662F\u5173\u95ED\u7684\u3002\u56E0\u6B64\u9700\u8981\u5F15\u5165\u5177\u4F53\u7684\u63A5\u53E3\u5B9E\u73B0\u7EC4\u4EF6\u624D\u80FD\u771F\u6B63\u5F00\u542F\u76D1\u63A7\u6307\u6807\u7279\u6027\u3002\u6846\u67B6\u793E\u533A\u63D0\u4F9B\u4E86\u793E\u533A\u7EC4\u4EF6 ",(0,i.jsx)(n.code,{children:"github.com/gogf/gf/contrib/metric/otelmetric/v2"}),"\uFF0C\u4F7F\u7528\u4E86 ",(0,i.jsx)(n.code,{children:"OpenTelemetry"})," \u5B9E\u73B0\u6846\u67B6\u7684\u76D1\u63A7\u6307\u6807\u63A5\u53E3\uFF0C\u5F15\u5165\u8BE5\u793E\u533A\u7EC4\u4EF6\u5E76\u4E14\u6267\u884C\u76D1\u63A7\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\u521B\u5EFA\u5373\u53EF\u5F00\u542F\u76D1\u63A7\u6307\u6807\u7279\u6027\u3002 ",(0,i.jsx)(n.code,{children:"otelmetric"})," \u7EC4\u4EF6\u6E90\u7801\u5730\u5740\uFF1A ",(0,i.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/metric/otelmetric",children:"https://github.com/gogf/gf/tree/master/contrib/metric/otelmetric"})]}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u7B80\u5355\u7684\u76D1\u63A7\u6307\u6807\u5B9E\u73B0\u793A\u4F8B\u6765\u4ECB\u7ECD\u4E00\u4E0B\u76D1\u63A7\u6307\u6807\u7EC4\u4EF6\u7684\u57FA\u672C\u4F7F\u7528\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "go.opentelemetry.io/otel/sdk/metric"\n    "go.opentelemetry.io/otel/sdk/metric/metricdata"\n\n    "github.com/gogf/gf/contrib/metric/otelmetric/v2"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n    "github.com/gogf/gf/v2/os/gmetric"\n)\n\nvar (\n    meter = gmetric.GetGlobalProvider().Meter(gmetric.MeterOption{\n        Instrument:        "github.com/gogf/gf/example/metric/basic",\n        InstrumentVersion: "v1.0",\n    })\n    counter = meter.MustCounter(\n        "goframe.metric.demo.counter",\n        gmetric.MetricOption{\n            Help: "This is a simple demo for Counter usage",\n            Unit: "bytes",\n        },\n    )\n)\n\nfunc main() {\n    var (\n        ctx    = gctx.New()\n        reader = metric.NewManualReader()\n    )\n\n    provider := otelmetric.MustProvider(otelmetric.WithReader(reader))\n    provider.SetAsGlobal()\n    defer provider.Shutdown(ctx)\n\n    counter.Inc(ctx)\n    counter.Add(ctx, 10)\n\n    var (\n        rm  = metricdata.ResourceMetrics{}\n        err = reader.Collect(ctx, &rm)\n    )\n    if err != nil {\n        g.Log().Fatal(ctx, err)\n    }\n    g.DumpJson(rm)\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6307\u6807\u7BA1\u7406\u7EC4\u4EF6\u7684\u521B\u5EFA",children:"\u6307\u6807\u7BA1\u7406\u7EC4\u4EF6\u7684\u521B\u5EFA"}),"\n",(0,i.jsxs)(n.p,{children:["\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"gmetric.GetGlobalProvider()"})," \u65B9\u6CD5\u53EF\u4EE5\u83B7\u53D6\u5168\u5C40\u7684\u76D1\u63A7 ",(0,i.jsx)(n.strong,{children:"\u6307\u6807\u7BA1\u7406\u5BF9\u8C61"}),"\uFF0C ",(0,i.jsx)(n.strong,{children:"\u8BE5\u5BF9\u8C61\u662F\u4E00\u4E2A\u5355\u4F8B\u8BBE\u8BA1\uFF0C\u5168\u5C40\u53EA\u80FD\u6709\u4E00\u4E2A"}),"\u3002\u5E76\u901A\u8FC7\u8BE5\u5BF9\u8C61\u7684 ",(0,i.jsx)(n.code,{children:"Meter"})," \u65B9\u6CD5\u53EF\u4EE5\u521B\u5EFA/\u83B7\u53D6\u5BF9\u5E94\u7684 ",(0,i.jsx)(n.strong,{children:"\u7EC4\u4EF6\u5BF9\u8C61"}),"\u3002\u7EC4\u4EF6\u5BF9\u8C61\u7528\u4E8E\u7BA1\u7406\u8BE5\u7EC4\u4EF6\u4E0B\u6240\u6709\u7684\u76D1\u63A7\u6307\u6807\u3002\u5728\u521B\u5EFA\u7EC4\u4EF6\u5BF9\u8C61\u65F6\u901A\u5E38\u9700\u8981\u5B9A\u4E49\u7EC4\u4EF6\uFF08 ",(0,i.jsx)(n.code,{children:"Instrument"}),"\uFF09\u7684\u540D\u79F0\u4EE5\u53CA\u7248\u672C\uFF08\u867D\u7136\u4E5F\u53EF\u4EE5\u4E3A\u7A7A\uFF0C\u4F46\u4E3A\u4E86\u65B9\u4FBF\u540E\u7EED\u7EF4\u62A4\u5EFA\u8BAE\u90FD\u8BBE\u7F6E\u4E0A\uFF09\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'meter = gmetric.GetGlobalProvider().Meter(gmetric.MeterOption{\n    Instrument:        "github.com/gogf/gf/example/metric/basic",\n    InstrumentVersion: "v1.0",\n})\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u5176\u4E2D\u7684 ",(0,i.jsx)(n.code,{children:"gmeter.MeterOption"})," \u6570\u636E\u7ED3\u6784\u5982\u4E0B\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// MeterOption holds the creation option for a Meter.\ntype MeterOption struct {\n    // Instrument is the instrumentation name to bind this Metric to a global MeterProvider.\n    // This is an optional configuration for a metric.\n    Instrument string\n\n    // InstrumentVersion is the instrumentation version to bind this Metric to a global MeterProvider.\n    // This is an optional configuration for a metric.\n    InstrumentVersion string\n\n    // Attributes holds the constant key-value pair description metadata for all metrics of Meter.\n    // This is an optional configuration for a meter.\n    Attributes Attributes\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u521B\u5EFA",children:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u521B\u5EFA"}),"\n",(0,i.jsxs)(n.p,{children:["\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"Meter"})," \u63A5\u53E3\u5BF9\u8C61\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728\u8BE5\u7EC4\u4EF6\u4E0B\u521B\u5EFA\u5BF9\u5E94\u7684\u5404\u79CD\u6307\u6807\u3002\u6307\u6807\u6709\u5404\u79CD\u6570\u636E\u7C7B\u578B\uFF0C\u56E0\u6B64 ",(0,i.jsx)(n.code,{children:"Meter"})," \u63A5\u53E3\u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// Meter hold the functions for kinds of Metric creating.\ntype Meter interface {\n    // Counter creates and returns a new Counter.\n    Counter(name string, option MetricOption) (Counter, error)\n\n    // UpDownCounter creates and returns a new UpDownCounter.\n    UpDownCounter(name string, option MetricOption) (UpDownCounter, error)\n\n    // Histogram creates and returns a new Histogram.\n    Histogram(name string, option MetricOption) (Histogram, error)\n\n    // ObservableCounter creates and returns a new ObservableCounter.\n    ObservableCounter(name string, option MetricOption) (ObservableCounter, error)\n\n    // ObservableUpDownCounter creates and returns a new ObservableUpDownCounter.\n    ObservableUpDownCounter(name string, option MetricOption) (ObservableUpDownCounter, error)\n\n    // ObservableGauge creates and returns a new ObservableGauge.\n    ObservableGauge(name string, option MetricOption) (ObservableGauge, error)\n\n    // MustCounter creates and returns a new Counter.\n    // It panics if any error occurs.\n    MustCounter(name string, option MetricOption) Counter\n\n    // MustUpDownCounter creates and returns a new UpDownCounter.\n    // It panics if any error occurs.\n    MustUpDownCounter(name string, option MetricOption) UpDownCounter\n\n    // MustHistogram creates and returns a new Histogram.\n    // It panics if any error occurs.\n    MustHistogram(name string, option MetricOption) Histogram\n\n    // MustObservableCounter creates and returns a new ObservableCounter.\n    // It panics if any error occurs.\n    MustObservableCounter(name string, option MetricOption) ObservableCounter\n\n    // MustObservableUpDownCounter creates and returns a new ObservableUpDownCounter.\n    // It panics if any error occurs.\n    MustObservableUpDownCounter(name string, option MetricOption) ObservableUpDownCounter\n\n    // MustObservableGauge creates and returns a new ObservableGauge.\n    // It panics if any error occurs.\n    MustObservableGauge(name string, option MetricOption) ObservableGauge\n\n    // RegisterCallback registers callback on certain metrics.\n    // A callback is bound to certain component and version, it is called when the associated metrics are read.\n    // Multiple callbacks on the same component and version will be called by their registered sequence.\n    RegisterCallback(callback Callback, canBeCallbackMetrics ...ObservableMetric) error\n\n    // MustRegisterCallback performs as RegisterCallback, but it panics if any error occurs.\n    MustRegisterCallback(callback Callback, canBeCallbackMetrics ...ObservableMetric)\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4EE5\u672C\u793A\u4F8B\u4EE3\u7801\u4E2D\u4F7F\u7528\u7684 ",(0,i.jsx)(n.code,{children:"meter.MustCounter"})," \u65B9\u6CD5\u6765\u4ECB\u7ECD\uFF0C\u8BE5\u65B9\u6CD5\u662F\u521B\u5EFA\u4E00\u4E2A ",(0,i.jsx)(n.code,{children:"Counter"})," \u540C\u6B65\u6307\u6807\uFF0C\u540C\u65F6\u7531\u4E8E\u6211\u4EEC\u5077\u61D2\u8FD9\u4E2A\u4F7F\u7528\u4E86 ",(0,i.jsx)(n.code,{children:"Must*"})," \u65B9\u6CD5\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5982\u679C\u521B\u5EFA\u6307\u6807\u5931\u8D25\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u65B9\u6CD5\u4F1A ",(0,i.jsx)(n.code,{children:"panic"})," \u62A5\u9519\u3002\u5728\u521B\u5EFA\u6307\u6807\u5BF9\u8C61\u65F6\uFF0C\u6307\u6807\u540D\u79F0 ",(0,i.jsx)(n.code,{children:"name"})," \u662F\u5FC5\u987B\u53C2\u6570\uFF0C\u53E6\u5916\u7684 ",(0,i.jsx)(n.code,{children:"MetricOption"})," \u662F\u53EF\u9009\u9879\u53C2\u6570\uFF0C\u7528\u4E8E\u8FDB\u4E00\u6B65\u63CF\u8FF0\u6307\u6807\u4FE1\u606F\u3002 ",(0,i.jsx)(n.code,{children:"MetricOption"})," \u7684\u6570\u636E\u7ED3\u6784\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// MetricOption holds the basic options for creating a metric.\ntype MetricOption struct {\n    // Help provides information about this Histogram.\n    // This is an optional configuration for a metric.\n    Help string\n\n    // Unit is the unit for metric value.\n    // This is an optional configuration for a metric.\n    Unit string\n\n    // Attributes holds the constant key-value pair description metadata for this metric.\n    // This is an optional configuration for a metric.\n    Attributes Attributes\n\n    // Buckets defines the buckets into which observations are counted.\n    // For Histogram metric only.\n    // A histogram metric uses default buckets if no explicit buckets configured.\n    Buckets []float64\n\n    // Callback function for metric, which is called when metric value changes.\n    // For observable metric only.\n    // If an observable metric has either Callback attribute nor global callback configured, it does nothing.\n    Callback MetricCallback\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u521D\u59CB\u5316\u76D1\u63A7\u6307\u6807\u5B9E\u73B0",children:"\u521D\u59CB\u5316\u76D1\u63A7\u6307\u6807\u5B9E\u73B0"}),"\n",(0,i.jsxs)(n.p,{children:["\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"otelmetric.MustProvider"})," \u521B\u5EFA\u65B9\u6CD5\u5373\u53EF\u521B\u5EFA\u5E76\u521D\u59CB\u5316\u76D1\u63A7\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"provider := otelmetric.MustProvider(otelmetric.WithReader(reader))\nprovider.SetAsGlobal()\ndefer provider.Shutdown(ctx)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u524D\u9762\u6211\u4EEC\u6709\u4ECB\u7ECD\u5230\uFF0C ",(0,i.jsx)(n.code,{children:"GlobalProvider"})," \u5176\u5B9E\u662F\u4E00\u4E2A\u5355\u4F8B\u7684\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\uFF0C\u56E0\u6B64\u8FD9\u91CC\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"provider.SetAsGlobal"})," \u65B9\u6CD5\u8C03\u7528\u53EF\u4EE5\u5C06\u8BE5\u5BF9\u8C61\u8BBE\u7F6E\u4E3A\u5168\u5C40\u7684\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\uFF0C\u4FBF\u4E8E\u540E\u7EED\u7684\u6307\u6807\u521B\u5EFA\u5747\u57FA\u4E8E\u8BE5\u5BF9\u8C61\u521B\u5EFA\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u4EEC\u5728 ",(0,i.jsx)(n.code,{children:"main"})," \u51FD\u6570\u4E2D\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"defer provider.ShutDown"})," \u65B9\u6CD5\u8C03\u7528\u4FBF\u4E8E\u5728\u7A0B\u5E8F\u7ED3\u675F\u65F6\u4F18\u96C5\u7ED3\u675F\u6307\u6807\u7BA1\u7406\u5BF9\u8C61\uFF0C\u4F8B\u5982\u5BF9\u8C61\u4E2D\u7684\u6307\u6807\u7F13\u5B58\u53CA\u65F6\u8F93\u51FA\u5230\u76EE\u6807\u7AEF\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u4F7F\u7528",children:"\u76D1\u63A7\u6307\u6807\u5BF9\u8C61\u7684\u4F7F\u7528"}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0D\u540C\u7684\u6307\u6807\u5BF9\u8C61\u6709\u4E0D\u540C\u7684\u64CD\u4F5C\u65B9\u6CD5\u7528\u4E8E\u5B9E\u73B0\u6307\u6807\u6570\u503C\u7684\u53D8\u5316\u3002\u4EE5\u793A\u4F8B\u4E2D\u7684 ",(0,i.jsx)(n.code,{children:"Counter"})," \u6307\u6807\u7C7B\u578B\u4E3A\u4F8B\uFF0C\u5176\u63A5\u53E3\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// Counter is a Metric that represents a single numerical value that can ever\n// goes up.\ntype Counter interface {\n    Metric\n    CounterPerformer\n}\n\n// CounterPerformer performs operations for Counter metric.\ntype CounterPerformer interface {\n    // Inc increments the counter by 1. Use Add to increment it by arbitrary\n    // non-negative values.\n    Inc(ctx context.Context, option ...Option)\n\n    // Add adds the given value to the counter. It panics if the value is < 0.\n    Add(ctx context.Context, increment float64, option ...Option)\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u53EF\u4EE5\u770B\u5230\uFF0C ",(0,i.jsx)(n.code,{children:"Counter"})," \u6307\u6807\u4E3B\u8981\u53EF\u4EE5\u6267\u884C ",(0,i.jsx)(n.code,{children:"Inc"})," \u53CA ",(0,i.jsx)(n.code,{children:"Add"})," \u4E24\u4E2A\u64CD\u4F5C\u65B9\u6CD5\u3002\u5176\u4E2D\u8FD8\u6709\u4E00\u4E2A ",(0,i.jsx)(n.code,{children:"Metric"})," \u7684\u63A5\u53E3\uFF0C\u6240\u6709\u7684\u6307\u6807\u5747\u5B9E\u73B0\u4E86\u8BE5\u63A5\u53E3\u7528\u4E8E\u83B7\u53D6\u5F53\u524D\u6307\u6807\u7684\u57FA\u7840\u4FE1\u606F\uFF0C\u5176\u63A5\u53E3\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// Metric models a single sample value with its metadata being exported.\ntype Metric interface {\n    // Info returns the basic information of a Metric.\n    Info() MetricInfo\n}\n\n// MetricInfo exports information of the Metric.\ntype MetricInfo interface {\n    Key() string                // Key returns the unique string key of the metric.\n    Name() string               // Name returns the name of the metric.\n    Help() string               // Help returns the help description of the metric.\n    Unit() string               // Unit returns the unit name of the metric.\n    Type() MetricType           // Type returns the type of the metric.\n    Attributes() Attributes     // Attributes returns the constant attribute slice of the metric.\n    Instrument() InstrumentInfo // InstrumentInfo returns the instrument info of the metric.\n}\n\n// InstrumentInfo exports the instrument information of a metric.\ntype InstrumentInfo interface {\n    Name() string    // Name returns the instrument name of the metric.\n    Version() string // Version returns the instrument version of the metric.\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u76D1\u63A7\u6307\u6807\u7684\u6570\u636E\u8BFB\u53D6",children:"\u76D1\u63A7\u6307\u6807\u7684\u6570\u636E\u8BFB\u53D6"}),"\n",(0,i.jsxs)(n.p,{children:["\u901A\u8FC7\u4E0A\u4E00\u7AE0\u8282\u4ECB\u7ECD\u7684 ",(0,i.jsx)(n.code,{children:"OpenTelemetry"})," \u7EC4\u4EF6\u5173\u7CFB\u6211\u4EEC\u77E5\u9053\uFF0C\u5982\u679C\u60F3\u8981\u4F7F\u7528\u6307\u6807\u5FC5\u987B\u8981\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"MetricReader"}),"\uFF0C\u56E0\u6B64\u5728\u8BE5\u793A\u4F8B\u4EE3\u7801\u4E2D\u6211\u4EEC\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"OpenTelemetry"})," \u5B98\u65B9\u793E\u533A\u5F00\u6E90\u7EC4\u4EF6\u4E2D\u6700\u5E38\u7528\u7684 ",(0,i.jsx)(n.code,{children:"ManualReader"})," \u6765\u7B80\u5355\u5B9E\u73B0\u6307\u6807\u6570\u636E\u8BFB\u53D6\uFF0C ",(0,i.jsx)(n.code,{children:"ManualReader"})," \u662F ",(0,i.jsx)(n.code,{children:"OpenTelemetry"})," \u5B98\u65B9\u793E\u533A\u63D0\u4F9B\u7684\u5B9E\u73B0\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"reader = metric.NewManualReader()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5E76\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"WithReader"})," \u65B9\u6CD5\u914D\u7F6E\u5230 ",(0,i.jsx)(n.code,{children:"Provider"})," \u4E2D\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"provider := otelmetric.MustProvider(otelmetric.WithReader(reader))\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u968F\u540E\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"Collect"})," \u65B9\u6CD5\u53EF\u4EE5\u83B7\u53D6\u5F53\u524D\u6240\u6709\u7684\u6307\u6807\u6570\u636E\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"var (\n    rm  = metricdata.ResourceMetrics{}\n    err = reader.Collect(ctx, &rm)\n)\nif err != nil {\n    g.Log().Fatal(ctx, err)\n}\ng.DumpJson(rm)\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6267\u884C\u540E\uFF0C\u7EC8\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'...\n    "ScopeMetrics": [\n        {\n            "Scope": {\n                "Name": "github.com/gogf/gf/example/metric/basic",\n                "Version": "v1.0",\n                "SchemaURL": ""\n            },\n            "Metrics": [\n                {\n                    "Name": "goframe.metric.demo.counter",\n                    "Description": "This is a simple demo for Counter usage",\n                    "Unit": "bytes",\n                    "Data": {\n                        "DataPoints": [\n                            {\n                                "Attributes": [],\n                                "StartTime": "2024-03-25T10:13:19.326977+08:00",\n                                "Time": "2024-03-25T10:13:19.327144+08:00",\n                                "Value": 11\n                            }\n                        ],\n                        "Temporality": "CumulativeTemporality",\n                        "IsMonotonic": true\n                    }\n                }\n            ]\n        },\n...\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4E3A\u4E86\u7B80\u5316\u793A\u4F8B\u4ECB\u7ECD\uFF0C\u6211\u4EEC\u5728\u8FD9\u91CC\u7701\u7565\u4E86\u4E00\u4E9B\u8F93\u51FA\u5185\u5BB9\uFF0C\u66F4\u8BE6\u7EC6\u7684\u6307\u6807\u53CA\u8F93\u51FA\u4ECB\u7ECD\u8BF7\u53C2\u8003\u540E\u7EED\u7AE0\u8282\u3002"})]})}function u(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return c},a:function(){return s}});var t=r(667294);let i={},o=t.createContext(i);function s(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);