"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["10881"],{984163:function(e,n,r){r.r(n),r.d(n,{metadata:()=>c,contentTitle:()=>s,default:()=>g,assets:()=>a,toc:()=>d,frontMatter:()=>l});var c=JSON.parse('{"id":"\u5FAE\u670D\u52A1\u5F00\u53D1/\u811A\u624B\u67B6\u6A21\u5757","title":"\u811A\u624B\u67B6\u6A21\u5757","description":"GoFrame \u6846\u67B6\u5305\u542B\u591A\u4E2A\u5FAE\u670D\u52A1\u7EC4\u4EF6\uFF0C\u5E76\u63D0\u4F9B\u4E86\u6613\u7528\u7684 GRPC \u811A\u624B\u67B6\u6A21\u5757\u548C\u5DE5\u5177\u3002\u811A\u624B\u67B6\u7531 grpcx \u793E\u533A\u5305\u5B9E\u73B0\uFF1A https://github.com/gogf/gf/tree/master/contrib/rpc/grpcx \u5305\u542B\u591A\u4E2A\u6A21\u5757\u3002","source":"@site/versioned_docs/version-2.3.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u811A\u624B\u67B6\u6A21\u5757.md","sourceDirName":"\u5FAE\u670D\u52A1\u5F00\u53D1","slug":"/\u5FAE\u670D\u52A1\u5F00\u53D1/\u811A\u624B\u67B6\u6A21\u5757","permalink":"/2.3.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u811A\u624B\u67B6\u6A21\u5757","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-2.3.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u811A\u624B\u67B6\u6A21\u5757.md","tags":[],"version":"2.3.x","lastUpdatedBy":"John","lastUpdatedAt":1730365530000,"sidebarPosition":2,"frontMatter":{"title":"\u811A\u624B\u67B6\u6A21\u5757","sidebar_position":2,"hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"\u5DE5\u7A0B\u7BA1\u7406","permalink":"/2.3.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u5DE5\u7A0B\u7BA1\u7406"},"next":{"title":"\u670D\u52A1\u7AEF\u914D\u7F6E","permalink":"/2.3.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u7AEF\u914D\u7F6E"}}'),o=r("785893"),t=r("250065");let l={title:"\u811A\u624B\u67B6\u6A21\u5757",sidebar_position:2,hide_title:!0},s=void 0,a={},d=[{value:"\u670D\u52A1\u7AEF- <code>Server</code>",id:"\u670D\u52A1\u7AEF--server",level:2},{value:"\u5BA2\u6237\u7AEF- <code>Client</code>",id:"\u5BA2\u6237\u7AEF--client",level:2},{value:"\u4E0A\u4E0B\u6587- <code>Ctx</code>",id:"\u4E0A\u4E0B\u6587--ctx",level:2},{value:"\u8D1F\u8F7D\u5747\u8861- <code>Balancer</code>",id:"\u8D1F\u8F7D\u5747\u8861--balancer",level:2},{value:"\u6CE8\u518C\u53D1\u73B0- <code>Resolver</code>",id:"\u6CE8\u518C\u53D1\u73B0--resolver",level:2}];function i(e){let n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"GoFrame"})," \u6846\u67B6\u5305\u542B\u591A\u4E2A\u5FAE\u670D\u52A1\u7EC4\u4EF6\uFF0C\u5E76\u63D0\u4F9B\u4E86\u6613\u7528\u7684 ",(0,o.jsx)(n.code,{children:"GRPC"})," \u811A\u624B\u67B6\u6A21\u5757\u548C\u5DE5\u5177\u3002\u811A\u624B\u67B6\u7531 ",(0,o.jsx)(n.code,{children:"grpcx"})," \u793E\u533A\u5305\u5B9E\u73B0\uFF1A ",(0,o.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/rpc/grpcx",children:"https://github.com/gogf/gf/tree/master/contrib/rpc/grpcx"})," \u5305\u542B\u591A\u4E2A\u6A21\u5757\u3002"]}),"\n",(0,o.jsxs)(n.h2,{id:"\u670D\u52A1\u7AEF--server",children:["\u670D\u52A1\u7AEF- ",(0,o.jsx)(n.code,{children:"Server"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u670D\u52A1\u7AEF\u7531 ",(0,o.jsx)(n.code,{children:"grpcx.Server"})," \u6A21\u5757\u7EF4\u62A4\uFF0C\u7528\u4E8E\u5B9E\u73B0\u670D\u52A1\u7AEF\u5BF9\u8C61\u7684\u521B\u5EFA\u4E0E\u7EF4\u62A4\u3002\u4F7F\u7528\u793A\u4F8B\uFF1A ",(0,o.jsx)(n.a,{href:"https://github.com/gogf/gf/blob/master/example/rpc/grpcx/basic/server/main.go",children:"https://github.com/gogf/gf/blob/master/example/rpc/grpcx/basic/server/main.go"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u670D\u52A1\u7AEF\u7684\u521B\u5EFA\u5F80\u5F80\u7ED3\u5408\u914D\u7F6E\u6587\u4EF6\u4E00\u8D77\u4F7F\u7528\uFF0C\u5173\u4E8E\u670D\u52A1\u7AEF\u914D\u7F6E\u6587\u4EF6\u7684\u4ECB\u7ECD\u8BF7\u53C2\u8003\u7AE0\u8282\uFF1A ",(0,o.jsx)(n.a,{href:"/2.3.x/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE",children:"\u670D\u52A1\u7AEF\u914D\u7F6E"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/basic/controller"\n)\n\nfunc main() {\n    s := grpcx.Server.New()\n    controller.Register(s)\n    s.Run()\n}\n'})}),"\n",(0,o.jsxs)(n.h2,{id:"\u5BA2\u6237\u7AEF--client",children:["\u5BA2\u6237\u7AEF- ",(0,o.jsx)(n.code,{children:"Client"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u5BA2\u6237\u7AEF\u7531 ",(0,o.jsx)(n.code,{children:"grpcx.Client"})," \u6A21\u5757\u7EF4\u62A4\uFF0C\u7528\u4E8E\u5B9E\u73B0\u5BA2\u6237\u7AEF\u5BF9\u8C61\u7684\u521B\u5EFA\u4E0E\u7EF4\u62A4\u3002\u4F7F\u7528\u793A\u4F8B\uFF1A ",(0,o.jsx)(n.a,{href:"https://github.com/gogf/gf/blob/master/example/rpc/grpcx/basic/client/main.go",children:"https://github.com/gogf/gf/blob/master/example/rpc/grpcx/basic/client/main.go"})]}),"\n",(0,o.jsx)(n.p,{children:"\u9700\u8981\u6CE8\u610F\uFF0C\u670D\u52A1\u95F4\u7684\u8BBF\u95EE\u9700\u8981\u4F7F\u7528\u670D\u52A1\u540D\u79F0\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/basic/protobuf"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    var (\n        ctx    = gctx.New()\n        conn   = grpcx.Client.MustNewGrpcClientConn("demo")\n        client = protobuf.NewGreeterClient(conn)\n    )\n    res, err := client.SayHello(ctx, &protobuf.HelloRequest{Name: "World"})\n    if err != nil {\n        g.Log().Error(ctx, err)\n        return\n    }\n    g.Log().Debug(ctx, "Response:", res.Message)\n}\n'})}),"\n",(0,o.jsxs)(n.h2,{id:"\u4E0A\u4E0B\u6587--ctx",children:["\u4E0A\u4E0B\u6587- ",(0,o.jsx)(n.code,{children:"Ctx"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u4E0A\u4E0B\u6587\u7531 ",(0,o.jsx)(n.code,{children:"grpcx.Ctx"})," \u6A21\u5757\u7EF4\u62A4\uFF0C\u7528\u4E8E\u5B9E\u73B0\u5BA2\u6237\u7AEF\u4E0E\u670D\u52A1\u7AEF\u4E4B\u95F4\u3001\u670D\u52A1\u4E0E\u670D\u52A1\u4E4B\u95F4\u7684\u81EA\u5B9A\u4E49\u6570\u636E\u4F20\u9012\u3002\u5305\u542B\u4EE5\u4E0B\u5E38\u7528\u65B9\u6CD5\uFF1A"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func (c Ctx) NewIncoming(ctx context.Context, data ...g.Map) context.Context\nfunc (c Ctx) NewOutgoing(ctx context.Context, data ...g.Map) context.Context\nfunc (c Ctx) IncomingToOutgoing(ctx context.Context, keys ...string) context.Context\nfunc (c Ctx) IncomingMap(ctx context.Context) *gmap.Map\nfunc (c Ctx) OutgoingMap(ctx context.Context) *gmap.Map\nfunc (c Ctx) SetIncoming(ctx context.Context, data g.Map) context.Context\nfunc (c Ctx) SetOutgoing(ctx context.Context, data g.Map) context.Context\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5176\u4E2D\u7684 ",(0,o.jsx)(n.code,{children:"Outgoing"})," \u7528\u5728\u5BA2\u6237\u7AEF\uFF0C\u8868\u793A\u5C06\u8981\u4F20\u9012\u7ED9\u670D\u52A1\u7AEF\u7684\u81EA\u5B9A\u4E49\u6570\u636E\uFF0C\u4E00\u822C\u662F\u7531 ",(0,o.jsx)(n.code,{children:"Key-Value"})," \u952E\u503C\u5BF9\u7EC4\u6210\u7684 ",(0,o.jsx)(n.code,{children:"Map"})," \u6570\u636E\u683C\u5F0F\uFF1B ",(0,o.jsx)(n.code,{children:"Incoming"})," \u4F7F\u7528\u5728\u670D\u52A1\u7AEF\uFF0C\u8868\u793A\u670D\u52A1\u7AEF\u63A5\u6536\u5230\u7684\u5BA2\u6237\u7AEF\u63D0\u4EA4\u6570\u636E\u3002\u5176\u4E2D\u6846\u67B6\u76F8\u5173\u7684\u4E00\u4E9B\u5185\u5D4C\u4FE1\u606F\u4E5F\u5199\u5165\u5230 ",(0,o.jsx)(n.code,{children:"Incoming"})," \u952E\u503C\u5BF9\u4E2D\uFF0C\u4F8B\u5982\uFF0C\u94FE\u8DEF\u8DDF\u8E2A\u4FE1\u606F\u3001\u5BA2\u6237\u7AEF\u7248\u672C\u4FE1\u606F\u7B49\u3002\u4F7F\u7528\u793A\u4F8B\uFF1A"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"server.go"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/ctx/controller"\n)\n\nfunc main() {\n    s := grpcx.Server.New()\n    controller.Register(s)\n    s.Run()\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"controller.go"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package controller\n\nimport (\n    "context"\n\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/ctx/protobuf"\n    "github.com/gogf/gf/v2/frame/g"\n)\n\ntype Controller struct {\n    protobuf.UnimplementedGreeterServer\n}\n\nfunc Register(s *grpcx.GrpcServer) {\n    protobuf.RegisterGreeterServer(s.Server, &Controller{})\n}\n\n// SayHello implements helloworld.GreeterServer\nfunc (s *Controller) SayHello(ctx context.Context, in *protobuf.HelloRequest) (*protobuf.HelloReply, error) {\n    m := grpcx.Ctx.IncomingMap(ctx)\n    g.Log().Infof(ctx, `incoming data: %v`, m.Map())\n    return &protobuf.HelloReply{Message: "Hello " + in.GetName()}, nil\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"client.go"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/ctx/protobuf"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    var (\n        conn   = grpcx.Client.MustNewGrpcClientConn("demo")\n        client = protobuf.NewGreeterClient(conn)\n        ctx    = grpcx.Ctx.NewOutgoing(gctx.New(), g.Map{\n            "UserId":   "1000",\n            "UserName": "john",\n        })\n    )\n    g.Log().Infof(ctx, `outgoing data: %v`, grpcx.Ctx.OutgoingMap(ctx).Map())\n    res, err := client.SayHello(ctx, &protobuf.HelloRequest{Name: "World"})\n    if err != nil {\n        g.Log().Error(ctx, err)\n        return\n    }\n    g.Log().Debug(ctx, "Response:", res.Message)\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u6267\u884C\u540E\uFF0C\u670D\u52A1\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 19:28:45.331 [DEBU] set default registry using file registry as no custom registry set\n2023-03-15 19:28:45.331 [DEBU] service register: &{Head: Deployment: Namespace: Name:demo Version: Endpoints:10.35.12.81:51707 Metadata:map[protocol:grpc]}\n2023-03-15 19:28:45.332 [INFO] pid[83753]: grpc server started listening on [:51707]\n2023-03-15 19:28:54.093 [INFO] {d049db1a39944c1711bd9f37d58a88f9} incoming data: map[:authority:service/default/default/demo/latest/ content-type:application/grpc traceparent:00-d049db1a39944c1711bd9f37d58a88f9-adbd2ba657ffea45-01 user-agent:grpc-go/1.49.0 userid:1000 username:john]\n2023-03-15 19:28:54.093 {d049db1a39944c1711bd9f37d58a88f9} /protobuf.Greeter/SayHello, 0.049ms, name:"World", message:"Hello World"\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u5BA2\u6237\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ go run client.go\n2023-03-15 19:28:54.087 [INFO] {d049db1a39944c1711bd9f37d58a88f9} outgoing data: map[userid:1000 username:john]\n2023-03-15 19:28:54.089 [DEBU] client conn updated with addresses [{"Addr":"10.35.12.81:51707","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null}]\n2023-03-15 19:28:54.093 [DEBU] {d049db1a39944c1711bd9f37d58a88f9} Response: Hello World\n'})}),"\n",(0,o.jsxs)(n.h2,{id:"\u8D1F\u8F7D\u5747\u8861--balancer",children:["\u8D1F\u8F7D\u5747\u8861- ",(0,o.jsx)(n.code,{children:"Balancer"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u8D1F\u8F7D\u5747\u8861\u7531 ",(0,o.jsx)(n.code,{children:"grpcx.Balancer"})," \u6A21\u5757\u7EF4\u62A4\uFF0C\u7528\u4E8E\u5B9E\u73B0\u5F53\u670D\u52A1\u7AEF\u5B58\u5728\u591A\u4E2A\u8BBF\u95EE\u5730\u5740\u65F6\uFF0C\u5BA2\u6237\u7AEF\u6839\u636E\u4F55\u79CD\u7B56\u7565\u8FDB\u884C\u8BF7\u6C42\u3002\u5F53\u5BA2\u6237\u7AEF\u672A\u8BBE\u7F6E\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\u65F6\uFF0C\u9ED8\u8BA4\u4F7F\u7528\u8F6E\u8BAD\u7B56\u7565\u3002\u5173\u4E8E\u8D1F\u8F7D\u5747\u8861\u7684\u8BE6\u7EC6\u4ECB\u7ECD\u8BF7\u53C2\u8003\u7AE0\u8282\uFF1A ",(0,o.jsx)(n.a,{href:"/2.3.x/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91/%E6%9C%8D%E5%8A%A1%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1",children:"\u670D\u52A1\u8D1F\u8F7D\u5747\u8861"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u6211\u4EEC\u8FD9\u91CC\u4F7F\u7528 ",(0,o.jsx)(n.strong,{children:"\u968F\u673A\u7B56\u7565"})," \u6765\u505A\u793A\u4F8B\uFF0C\u968F\u673A\u7684\u7B56\u7565\u5C06\u4F1A\u4F7F\u5F97\u5404\u4E2A\u670D\u52A1\u7AEF\u63A5\u6536\u5230\u7684\u8BF7\u6C42\u6570\u6BD4\u8F83\u968F\u673A\u3002"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"server.go"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/balancer/controller"\n)\n\nfunc main() {\n    s := grpcx.Server.New()\n    controller.Register(s)\n    s.Run()\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"client.go"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/balancer/protobuf"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    var (\n        ctx    context.Context\n        conn   = grpcx.Client.MustNewGrpcClientConn("demo", grpcx.Balancer.WithRandom())\n        client = protobuf.NewGreeterClient(conn)\n    )\n    for i := 0; i < 10; i++ {\n        ctx = gctx.New()\n        res, err := client.SayHello(ctx, &protobuf.HelloRequest{Name: "World"})\n        if err != nil {\n            g.Log().Error(ctx, err)\n            return\n        }\n        g.Log().Debug(ctx, "Response:", res.Message)\n    }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u5176\u4E2D\u7684 ",(0,o.jsx)(n.code,{children:"grpcx.Balancer.WithRandom()"})," \u8868\u793A\u4F7F\u7528\u968F\u673A\u7684\u8BF7\u6C42\u7B56\u7565\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u542F\u52A8\u4E24\u4E2A ",(0,o.jsx)(n.code,{children:"server.go"})," \u670D\u52A1\u7AEF\uFF0C\u968F\u540E\u8FD0\u884C ",(0,o.jsx)(n.code,{children:"client.go"})," \u5BA2\u6237\u7AEF\uFF0C\u67E5\u770B\u670D\u52A1\u7AEF\u7684\u8BF7\u6C42\u65E5\u5FD7\uFF1A"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"server1"})," \u7EC8\u7AEF\u8F93\u51FA\uFF1A"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 19:50:44.801 [DEBU] set default registry using file registry as no custom registry set\n2023-03-15 19:50:44.802 [DEBU] service register: &{Head: Deployment: Namespace: Name:demo Version: Endpoints:10.35.12.81:53962 Metadata:map[protocol:grpc]}\n2023-03-15 19:50:44.802 [INFO] pid[89290]: grpc server started listening on [:53962]\n2023-03-15 19:50:57.282 {7025612f6d954c17c5f335051bf10899} /protobuf.Greeter/SayHello, 0.003ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.283 {60567c2f6d954c17c7f335052ce05185} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.285 {f8d09b2f6d954c17ccf33505dff1a4ea} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.287 {f0fab02f6d954c17cdf33505438b2c80} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"server2"})," \u7EC8\u7AEF\u8F93\u51FA\uFF1A"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 19:50:51.720 [DEBU] set default registry using file registry as no custom registry set\n2023-03-15 19:50:51.721 [DEBU] service register: &{Head: Deployment: Namespace: Name:demo Version: Endpoints:10.35.12.81:53973 Metadata:map[protocol:grpc]}\n2023-03-15 19:50:51.722 [INFO] pid[89351]: grpc server started listening on [:53973]\n2023-03-15 19:50:57.280 {b89a0d2f6d954c17c4f33505a046817c} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.282 {28bf732f6d954c17c6f33505adedff5f} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.283 {9876832f6d954c17c8f3350580ed535b} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.284 {684e8b2f6d954c17c9f33505d56e4b05} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.284 {c045912f6d954c17caf3350599006197} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.284 {500a972f6d954c17cbf33505252b0e01} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u5BA2\u6237\u7AEF\u7EC8\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ go run client.go\n2023-03-15 19:50:57.278 [DEBU] client conn updated with addresses [{"Addr":"10.35.12.81:53962","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null},{"Addr":"10.35.12.81:53973","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null}]\n2023-03-15 19:50:57.281 [DEBU] {b89a0d2f6d954c17c4f33505a046817c} Response: Hello World\n2023-03-15 19:50:57.282 [DEBU] {7025612f6d954c17c5f335051bf10899} Response: Hello World\n2023-03-15 19:50:57.282 [DEBU] {28bf732f6d954c17c6f33505adedff5f} Response: Hello World\n2023-03-15 19:50:57.283 [DEBU] {60567c2f6d954c17c7f335052ce05185} Response: Hello World\n2023-03-15 19:50:57.283 [DEBU] {9876832f6d954c17c8f3350580ed535b} Response: Hello World\n2023-03-15 19:50:57.284 [DEBU] {684e8b2f6d954c17c9f33505d56e4b05} Response: Hello World\n2023-03-15 19:50:57.284 [DEBU] {c045912f6d954c17caf3350599006197} Response: Hello World\n2023-03-15 19:50:57.285 [DEBU] {500a972f6d954c17cbf33505252b0e01} Response: Hello World\n2023-03-15 19:50:57.286 [DEBU] {f8d09b2f6d954c17ccf33505dff1a4ea} Response: Hello World\n2023-03-15 19:50:57.287 [DEBU] {f0fab02f6d954c17cdf33505438b2c80} Response: Hello World\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u53EF\u4EE5\u770B\u5230\uFF0C\u5BA2\u6237\u7AEF\u53D1\u9001\u4E86 ",(0,o.jsx)(n.code,{children:"10"})," \u6B21\u8BF7\u6C42\uFF0C\u4E24\u4E2A\u670D\u52A1\u7AEF\u5206\u522B\u63A5\u6536\u5230\u4E86 ",(0,o.jsx)(n.code,{children:"4"})," \u6B21\u548C ",(0,o.jsx)(n.code,{children:"6"})," \u6B21\u8BF7\u6C42\uFF0C\u8BF7\u6C42\u7684\u8D1F\u8F7D\u6BD4\u8F83\u968F\u673A\u3002"]}),"\n",(0,o.jsxs)(n.h2,{id:"\u6CE8\u518C\u53D1\u73B0--resolver",children:["\u6CE8\u518C\u53D1\u73B0- ",(0,o.jsx)(n.code,{children:"Resolver"})]}),"\n",(0,o.jsxs)(n.p,{children:["\u6CE8\u518C\u53D1\u73B0\u7531 ",(0,o.jsx)(n.code,{children:"grpcx.Resolver"})," \u6A21\u5757\u7EF4\u62A4\uFF0C\u8BE5\u6A21\u5757\u7528\u4E8E ",(0,o.jsx)(n.code,{children:"GRPC"})," \u89E3\u6790\u670D\u52A1\u540D\u79F0\u3002 ",(0,o.jsx)(n.code,{children:"grpcx"})," \u7EC4\u4EF6\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4F7F\u7528\u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u5B9E\u73B0\u6CE8\u518C\u53D1\u73B0\uFF0C\u4EC5\u7528\u4E8E\u6D4B\u8BD5\u4F7F\u7528\u3002\u5982\u679C\u662F\u751F\u4EA7\u73AF\u5883\uFF0C\u5219\u9700\u8981\u4F7F\u7528\u5176\u4ED6\u7684\u6CE8\u518C\u53D1\u73B0\u7EC4\u4EF6\u3002\u4E00\u4E2A\u7B80\u5355\u793A\u4F8B\uFF1A"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"server.go"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/resolver/controller"\n)\n\nfunc main() {\n    grpcx.Resolver.Register(etcd.New("127.0.0.1:2379"))\n\n    s := grpcx.Server.New()\n    controller.Register(s)\n    s.Run()\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u5176\u4E2D\u7684 ",(0,o.jsx)(n.code,{children:'grpcx.Resolver.Register(etcd.New("127.0.0.1:2379")) '})," \u7528\u4E8E\u8BBE\u7F6E\u670D\u52A1\u6CE8\u518C\u53D1\u73B0\u7684\u7EC4\u4EF6\u4E3A ",(0,o.jsx)(n.code,{children:"etcd"}),"\uFF0C\u4EC5\u652F\u6301 ",(0,o.jsx)(n.code,{children:"GRPC"})," \u534F\u8BAE\u3002"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"client.go"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/resolver/protobuf"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    grpcx.Resolver.Register(etcd.New("127.0.0.1:2379"))\n\n    var (\n        ctx    = gctx.New()\n        conn   = grpcx.Client.MustNewGrpcClientConn("demo")\n        client = protobuf.NewGreeterClient(conn)\n    )\n    res, err := client.SayHello(ctx, &protobuf.HelloRequest{Name: "World"})\n    if err != nil {\n        g.Log().Error(ctx, err)\n        return\n    }\n    g.Log().Debug(ctx, "Response:", res.Message)\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u542F\u52A8 ",(0,o.jsx)(n.code,{children:"etcd"}),"\uFF1A"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ etcd\n{"level":"info","ts":"2023-03-15T20:02:50.966+0800","caller":"etcdmain/etcd.go:73","msg":"Running: ","args":["etcd"]}\n{"level":"info","ts":"2023-03-15T20:02:50.967+0800","caller":"etcdmain/etcd.go:100","msg":"failed to detect default host","error":"default host not supported on darwin_amd64"}\n{"level":"warn","ts":"2023-03-15T20:02:50.967+0800","caller":"etcdmain/etcd.go:105","msg":"\'data-dir\' was empty; using default","data-dir":"default.etcd"}\n{"level":"info","ts":"2023-03-15T20:02:50.967+0800","caller":"etcdmain/etcd.go:116","msg":"server has been already initialized","data-dir":"default.etcd","dir-type":"member"}\n{"level":"info","ts":"2023-03-15T20:02:50.967+0800","caller":"embed/etcd.go:124","msg":"configuring peer listeners","listen-peer-urls":["http://localhost:2380"]}\n{"level":"info","ts":"2023-03-15T20:02:50.968+0800","caller":"embed/etcd.go:132","msg":"configuring client listeners","listen-client-urls":["http://localhost:2379"]}\n...\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u8FD0\u884C ",(0,o.jsx)(n.code,{children:"server.go"}),"\uFF1A"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 20:02:19.472 [DEBU] service register: &{Head: Deployment: Namespace: Name:demo Version: Endpoints:10.35.12.81:55066 Metadata:map[protocol:grpc]}\n2023-03-15 20:02:19.516 [DEBU] etcd put success with key "/service/default/default/demo/latest/10.35.12.81:55066", value "{"protocol":"grpc"}", lease "7587869265929863945"\n2023-03-15 20:02:19.516 [INFO] pid[92040]: grpc server started listening on [:55066]\n2023-03-15 20:02:29.310 {88c4c04e0e964c17dddec53b1adb54f7} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u8FD0\u884C ",(0,o.jsx)(n.code,{children:"client.go"}),"\uFF1A"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ go run client.go\n2023-03-15 20:02:29.297 [DEBU] Watch key "/service/default/default/demo/latest/"\n2023-03-15 20:02:29.307 [DEBU] client conn updated with addresses [{"Addr":"10.35.12.81:55066","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null}]\n2023-03-15 20:02:29.308 [DEBU] client conn updated with addresses [{"Addr":"10.35.12.81:55066","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null}]\n2023-03-15 20:02:29.310 [DEBU] {88c4c04e0e964c17dddec53b1adb54f7} Response: Hello World\n'})})]})}function g(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return s},a:function(){return l}});var c=r(667294);let o={},t=c.createContext(o);function l(e){let n=c.useContext(t);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),c.createElement(t.Provider,{value:n},e.children)}}}]);