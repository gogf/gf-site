"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["40159"],{183526:function(n,e,t){t.r(e),t.d(e,{metadata:()=>r,contentTitle:()=>i,default:()=>g,assets:()=>d,toc:()=>a,frontMatter:()=>o});var r=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u9AD8\u7EA7\u7279\u6027/ORM\u9AD8\u7EA7\u7279\u6027-SQL\u6355\u83B7","title":"ORM\u9AD8\u7EA7\u7279\u6027-SQL\u6355\u83B7","description":"GoFrame\u6846\u67B6\u4E2DORM\u7684\u9AD8\u7EA7\u7279\u6027\uFF0C\u4E3B\u8981\u5173\u6CE8SQL\u6355\u83B7\u548C\u8F6C\u6362\u529F\u80FD\u3002\u901A\u8FC7CatchSQL\u548CToSQL\u65B9\u6CD5\uFF0C\u80FD\u591F\u5728\u6267\u884CSQL\u8BED\u53E5\u524D\u6355\u83B7\u6216\u9884\u4F30SQL\u64CD\u4F5C\uFF0C\u5E76\u914D\u5408\u4E0A\u4E0B\u6587\u5BF9\u8C61\u5B9E\u73B0\u64CD\u4F5C\u8BB0\u5F55\u4E0E\u8C03\u8BD5\u3002\u8FD9\u4E9B\u529F\u80FD\u6709\u52A9\u4E8E\u5F00\u53D1\u8005\u9AD8\u6548\u8C03\u8BD5\u548C\u6D4B\u8BD5\u6570\u636E\u5E93\u64CD\u4F5C\u3002","source":"@site/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u9AD8\u7EA7\u7279\u6027/ORM\u9AD8\u7EA7\u7279\u6027-SQL\u6355\u83B7.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u9AD8\u7EA7\u7279\u6027","slug":"/docs/core/gdb-senior-catch-sql","permalink":"/docs/core/gdb-senior-catch-sql","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u9AD8\u7EA7\u7279\u6027/ORM\u9AD8\u7EA7\u7279\u6027-SQL\u6355\u83B7.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1731320041000,"sidebarPosition":1,"frontMatter":{"slug":"/docs/core/gdb-senior-catch-sql","title":"ORM\u9AD8\u7EA7\u7279\u6027-SQL\u6355\u83B7","sidebar_position":1,"hide_title":true,"keywords":["GoFrame","CatchSQL","ToSQL","SQL\u6355\u83B7","SQL\u8F6C\u6362","ORM\u7279\u6027","Go\u8BED\u8A00","\u6570\u636E\u5E93\u64CD\u4F5C","SQL\u8C03\u8BD5","\u4E0A\u4E0B\u6587\u5BF9\u8C61"],"description":"GoFrame\u6846\u67B6\u4E2DORM\u7684\u9AD8\u7EA7\u7279\u6027\uFF0C\u4E3B\u8981\u5173\u6CE8SQL\u6355\u83B7\u548C\u8F6C\u6362\u529F\u80FD\u3002\u901A\u8FC7CatchSQL\u548CToSQL\u65B9\u6CD5\uFF0C\u80FD\u591F\u5728\u6267\u884CSQL\u8BED\u53E5\u524D\u6355\u83B7\u6216\u9884\u4F30SQL\u64CD\u4F5C\uFF0C\u5E76\u914D\u5408\u4E0A\u4E0B\u6587\u5BF9\u8C61\u5B9E\u73B0\u64CD\u4F5C\u8BB0\u5F55\u4E0E\u8C03\u8BD5\u3002\u8FD9\u4E9B\u529F\u80FD\u6709\u52A9\u4E8E\u5F00\u53D1\u8005\u9AD8\u6548\u8C03\u8BD5\u548C\u6D4B\u8BD5\u6570\u636E\u5E93\u64CD\u4F5C\u3002"},"sidebar":"mainSidebar","previous":{"title":"ORM\u9AD8\u7EA7\u7279\u6027-RawSQL","permalink":"/docs/core/gdb-senior-raw-sql"},"next":{"title":"ORM\u9AD8\u7EA7\u7279\u6027-\u8C03\u8BD5\u6A21\u5F0F","permalink":"/docs/core/gdb-senior-debugging"}}'),s=t("785893"),c=t("250065");let o={slug:"/docs/core/gdb-senior-catch-sql",title:"ORM\u9AD8\u7EA7\u7279\u6027-SQL\u6355\u83B7",sidebar_position:1,hide_title:!0,keywords:["GoFrame","CatchSQL","ToSQL","SQL\u6355\u83B7","SQL\u8F6C\u6362","ORM\u7279\u6027","Go\u8BED\u8A00","\u6570\u636E\u5E93\u64CD\u4F5C","SQL\u8C03\u8BD5","\u4E0A\u4E0B\u6587\u5BF9\u8C61"],description:"GoFrame\u6846\u67B6\u4E2DORM\u7684\u9AD8\u7EA7\u7279\u6027\uFF0C\u4E3B\u8981\u5173\u6CE8SQL\u6355\u83B7\u548C\u8F6C\u6362\u529F\u80FD\u3002\u901A\u8FC7CatchSQL\u548CToSQL\u65B9\u6CD5\uFF0C\u80FD\u591F\u5728\u6267\u884CSQL\u8BED\u53E5\u524D\u6355\u83B7\u6216\u9884\u4F30SQL\u64CD\u4F5C\uFF0C\u5E76\u914D\u5408\u4E0A\u4E0B\u6587\u5BF9\u8C61\u5B9E\u73B0\u64CD\u4F5C\u8BB0\u5F55\u4E0E\u8C03\u8BD5\u3002\u8FD9\u4E9B\u529F\u80FD\u6709\u52A9\u4E8E\u5F00\u53D1\u8005\u9AD8\u6548\u8C03\u8BD5\u548C\u6D4B\u8BD5\u6570\u636E\u5E93\u64CD\u4F5C\u3002"},i=void 0,d={},a=[{value:"<code>CatchSQL</code>",id:"catchsql",level:2},{value:"<code>ToSQL</code>",id:"tosql",level:2}];function l(n){let e={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,c.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.admonition,{type:"warning",children:(0,s.jsxs)(e.p,{children:["\u9700\u8981\u6CE8\u610F\uFF0C\u6846\u67B6SQL\u6355\u83B7\u7684\u539F\u7406\u662F\uFF0C\u4EFB\u4F55SQL\u64CD\u4F5C\u751F\u6210\u7684 ",(0,s.jsx)(e.strong,{children:"SQL\u8BED\u53E5\u6A21\u677F"})," \u52A0\u4E0A ",(0,s.jsx)(e.strong,{children:"SQL\u6267\u884C\u53C2\u6570"}),"\uFF0C\u5728\u88AB\u63D0\u4EA4\u7ED9\u5E95\u5C42\u6570\u636E\u5E93\u5F15\u64CE\u524D\u4F1A\u88AB\u6846\u67B6\u62E6\u622A\uFF0C\u5E76\u901A\u8FC7\u6846\u67B6\u7EC4\u4EF6\u81EA\u52A8\u683C\u5F0F\u5316\u751F\u6210\u53EF\u4F9B\u4EBA\u5DE5\u9605\u8BFB\u7684\u5B57\u7B26\u4E32\uFF0C ",(0,s.jsx)(e.strong,{children:"\u4EC5\u4F9B\u53C2\u8003\u548C\u8C03\u8BD5"}),"\uFF0C\u5E76\u4E0D\u662F\u5B8C\u6574\u63D0\u4EA4\u7ED9\u5E95\u5C42\u6570\u636E\u5E93\u5F15\u64CE\u7684SQL\u8BED\u53E5\u3002\u6355\u83B7\u7684SQL\u8BED\u53E5\u548CORM\u7EC4\u4EF6\u5F00\u542F\u8C03\u8BD5\u6A21\u5F0F\u540E\u8F93\u51FA\u7684SQL\u8BED\u53E5\u662F\u76F8\u540C\u7684\uFF0C\u5B83\u4EEC\u90FD\u7531\u76F8\u540C\u7EC4\u4EF6\u751F\u6210\u3002"]})}),"\n",(0,s.jsx)(e.h2,{id:"catchsql",children:(0,s.jsx)(e.code,{children:"CatchSQL"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 ",(0,s.jsx)(e.code,{children:"gdb.CatchSQL"})," \u65B9\u6CD5\u6765\u6355\u83B7\u6307\u5B9A\u8303\u56F4\u5185\u6267\u884C\u7684 ",(0,s.jsx)(e.code,{children:"SQL"})," \u5217\u8868\u3002\u8BE5\u65B9\u6CD5\u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"// CatchSQL catches and returns all sql statements that are EXECUTED in given closure function.\n// Be caution that, all the following sql statements should use the context object passing by function `f`.\nfunc CatchSQL(ctx context.Context, f func(ctx context.Context) error) (sqlArray []string, err error)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u53EF\u4EE5\u770B\u5230\uFF0C\u8BE5\u65B9\u6CD5\u901A\u8FC7\u4E00\u4E2A\u95ED\u5305\u51FD\u6570\u6765\u6267\u884C ",(0,s.jsx)(e.code,{children:"SQL"})," \u8BED\u53E5\uFF0C\u5728\u95ED\u5305\u51FD\u6570\u6267\u884C\u7684\u6240\u6709 ",(0,s.jsx)(e.code,{children:"SQL"})," \u64CD\u4F5C\u90FD\u5C06\u88AB\u8BB0\u5F55\u5E76\u4F5C\u4E3A ",(0,s.jsx)(e.code,{children:"[]string"})," \u7C7B\u578B\u3002\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u95ED\u5305\u4E2D\u6267\u884C\u7684 ",(0,s.jsx)(e.code,{children:"SQL"})," \u64CD\u4F5C\u90FD\u5E94\u5F53\u4F20\u9012 ",(0,s.jsx)(e.code,{children:"ctx"})," \u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u5426\u5219 ",(0,s.jsx)(e.code,{children:"SQL"})," \u64CD\u4F5C\u5BF9\u5E94\u7684\u8BED\u53E5\u65E0\u6CD5\u8BB0\u5F55\u3002\u4F7F\u7528\u793A\u4F8B\uFF1A"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"user.sql"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `user` (\n    `id`          int(10) unsigned NOT NULL AUTO_INCREMENT,\n    `passport`    varchar(45) NULL,\n    `password`    char(32) NULL,\n    `nickname`    varchar(45) NULL,\n    `create_time` timestamp(6) NULL,\n    PRIMARY KEY (id)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"main.go"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n\n    _ "github.com/gogf/gf/contrib/drivers/mysql/v2"\n    "github.com/gogf/gf/v2/database/gdb"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n    "github.com/gogf/gf/v2/os/gtime"\n)\n\ntype User struct {\n    Id         int\n    Passport   string\n    Password   string\n    Nickname   string\n    CreateTime *gtime.Time\n}\n\nfunc initUser(ctx context.Context) error {\n    _, err := g.Model("user").Ctx(ctx).Data(User{\n        Id:       1,\n        Passport: "john",\n        Password: "12345678",\n        Nickname: "John",\n    }).Insert()\n    return err\n}\n\nfunc main() {\n    var ctx = gctx.New()\n    sqlArray, err := gdb.CatchSQL(ctx, func(ctx context.Context) error {\n        return initUser(ctx)\n    })\n    if err != nil {\n        panic(err)\n    }\n    g.Dump(sqlArray)\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u6267\u884C\u540E\uFF0C\u7EC8\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"[\n    \"SHOW FULL COLUMNS FROM `user`\",\n    \"INSERT INTO `user`(`id`,`passport`,`password`,`nickname`,`created_at`,`updated_at`) VALUES(1,'john','12345678','John','2023-12-19 21:43:57','2023-12-19 21:43:57') \",\n]\n"})}),"\n",(0,s.jsx)(e.h2,{id:"tosql",children:(0,s.jsx)(e.code,{children:"ToSQL"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 ",(0,s.jsx)(e.code,{children:"gdb.ToSQL"})," \u6765\u5C06\u7ED9\u5B9A\u7684 ",(0,s.jsx)(e.code,{children:"SQL"})," \u64CD\u4F5C\u8F6C\u6362\u4E3A ",(0,s.jsx)(e.code,{children:"SQL"})," \u8BED\u53E5\uFF0C\u5E76\u4E0D\u771F\u6B63\u63D0\u4EA4\u6267\u884C\u3002\u8BE5\u65B9\u6CD5\u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"// ToSQL formats and returns the last one of sql statements in given closure function\n// WITHOUT TRULY EXECUTING IT.\n// Be caution that, all the following sql statements should use the context object passing by function `f`.\nfunc ToSQL(ctx context.Context, f func(ctx context.Context) error) (sql string, err error)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u53EF\u4EE5\u770B\u5230\uFF0C\u8BE5\u65B9\u6CD5\u901A\u8FC7\u4E00\u4E2A\u95ED\u5305\u51FD\u6570\u6765\u9884\u4F30 ",(0,s.jsx)(e.code,{children:"SQL"})," \u8BED\u53E5\uFF0C\u5728\u95ED\u5305\u51FD\u6570\u4E2D\u7684\u6240\u6709 ",(0,s.jsx)(e.code,{children:"SQL"})," \u64CD\u4F5C\u90FD\u5C06\u88AB\u9884\u4F30\uFF0C\u4F46\u53EA\u4F1A\u8FD4\u56DE\u6700\u540E\u4E00\u6761 ",(0,s.jsx)(e.code,{children:"SQL"})," \u8BED\u53E5\u4F5C\u4E3A ",(0,s.jsx)(e.code,{children:"string"})," \u7C7B\u578B\u8FD4\u56DE\u3002\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u95ED\u5305\u4E2D\u7684 ",(0,s.jsx)(e.code,{children:"SQL"})," \u64CD\u4F5C\u90FD\u5E94\u5F53\u4F20\u9012 ",(0,s.jsx)(e.code,{children:"ctx"})," \u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u5426\u5219 ",(0,s.jsx)(e.code,{children:"SQL"})," \u64CD\u4F5C\u5BF9\u5E94\u7684\u8BED\u53E5\u65E0\u6CD5\u8BB0\u5F55\u3002\u4F7F\u7528\u793A\u4F8B\uFF1A"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"user.sql"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `user` (\n    `id`          int(10) unsigned NOT NULL AUTO_INCREMENT,\n    `passport`    varchar(45) NULL,\n    `password`    char(32) NULL,\n    `nickname`    varchar(45) NULL,\n    `create_time` timestamp(6) NULL,\n    PRIMARY KEY (id)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"main.go"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n\n    _ "github.com/gogf/gf/contrib/drivers/mysql/v2"\n    "github.com/gogf/gf/v2/database/gdb"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n    "github.com/gogf/gf/v2/os/gtime"\n)\n\ntype User struct {\n    Id         int\n    Passport   string\n    Password   string\n    Nickname   string\n    CreateTime *gtime.Time\n}\n\nfunc initUser(ctx context.Context) error {\n    _, err := g.Model("user").Ctx(ctx).Data(User{\n        Id:       1,\n        Passport: "john",\n        Password: "12345678",\n        Nickname: "John",\n    }).Insert()\n    return err\n}\n\nfunc main() {\n    var ctx = gctx.New()\n    sql, err := gdb.ToSQL(ctx, func(ctx context.Context) error {\n        return initUser(ctx)\n    })\n    if err != nil {\n        panic(err)\n    }\n    g.Dump(sql)\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u6267\u884C\u540E\uFF0C\u7EC8\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\"INSERT INTO `user`(`id`,`passport`,`password`,`nickname`,`created_at`,`updated_at`) VALUES(1,'john','12345678','John','2023-12-19 21:49:21','2023-12-19 21:49:21') \"\n"})})]})}function g(n={}){let{wrapper:e}={...(0,c.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},250065:function(n,e,t){t.d(e,{Z:function(){return i},a:function(){return o}});var r=t(667294);let s={},c=r.createContext(s);function o(n){let e=r.useContext(c);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),r.createElement(c.Provider,{value:e},n.children)}}}]);