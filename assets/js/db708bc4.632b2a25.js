"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["7289"],{721588:function(n,e,s){s.r(e),s.d(e,{metadata:()=>i,contentTitle:()=>t,default:()=>g,assets:()=>d,toc:()=>c,frontMatter:()=>o});var i=JSON.parse('{"id":"\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gproc -\u8FDB\u7A0B\u7BA1\u7406\u901A\u4FE1/gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C","title":"gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C","description":"\u57FA\u672C\u4ECB\u7ECD","source":"@site/versioned_docs/version-1.16.x/\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gproc -\u8FDB\u7A0B\u7BA1\u7406\u901A\u4FE1/gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C.md","sourceDirName":"\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gproc -\u8FDB\u7A0B\u7BA1\u7406\u901A\u4FE1","slug":"/\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gproc -\u8FDB\u7A0B\u7BA1\u7406\u901A\u4FE1/gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C","permalink":"/1.16.x/\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gproc -\u8FDB\u7A0B\u7BA1\u7406\u901A\u4FE1/gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-1.16.x/\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gproc -\u8FDB\u7A0B\u7BA1\u7406\u901A\u4FE1/gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C.md","tags":[],"version":"1.16.x","lastUpdatedBy":"John","lastUpdatedAt":1730365530000,"sidebarPosition":2,"frontMatter":{"title":"gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C","sidebar_position":2,"hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"gproc-\u8FDB\u7A0B\u901A\u4FE1","permalink":"/1.16.x/\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gproc -\u8FDB\u7A0B\u7BA1\u7406\u901A\u4FE1/gproc-\u8FDB\u7A0B\u901A\u4FE1"},"next":{"title":"gview (\u6A21\u677F\u5F15\u64CE\u6A21\u5757)","permalink":"/1.16.x/\u6A21\u5757\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/gview -\u6A21\u677F\u5F15\u64CE\u6A21\u5757"}}'),r=s("785893"),l=s("250065");let o={title:"gproc-\u4FE1\u53F7\u6CE8\u518C\u76D1\u542C",sidebar_position:2,hide_title:!0},t=void 0,d={},c=[{value:"\u57FA\u672C\u4ECB\u7ECD",id:"\u57FA\u672C\u4ECB\u7ECD",level:2},{value:"\u793A\u4F8B1\uFF0C\u4F7F\u7528\u6807\u51C6\u5E93\u4FE1\u53F7\u76D1\u542C",id:"\u793A\u4F8B1\u4F7F\u7528\u6807\u51C6\u5E93\u4FE1\u53F7\u76D1\u542C",level:2},{value:"\u793A\u4F8B2\uFF0C\u4F7F\u7528 <code>gproc</code> \u4FE1\u53F7\u76D1\u542C",id:"\u793A\u4F8B2\u4F7F\u7528-gproc-\u4FE1\u53F7\u76D1\u542C",level:2}];function a(n){let e={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"\u57FA\u672C\u4ECB\u7ECD",children:"\u57FA\u672C\u4ECB\u7ECD"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"gproc"})," \u7EC4\u4EF6\u63D0\u4F9B\u4E86\u7EDF\u4E00\u7684\u4FE1\u53F7\u76D1\u542C\u548C\u56DE\u8C03\u5904\u7406\u529F\u80FD\uFF0C\u76EE\u7684\u662F\u89E3\u51B3\u5728\u7A0B\u5E8F\u4E2D\u591A\u4E2A\u4E0D\u540C\u7EC4\u4EF6\u5197\u4F59\u7684\u4FE1\u53F7\u5904\u7406\u903B\u8F91\uFF0C\u4EE5\u53CA\u63A5\u6536\u9000\u51FA\u4FE1\u53F7\u540E\u65E0\u6CD5\u5E73\u6ED1\u6790\u6784\u7684\u75DB\u70B9\u3002\u5728\u6CA1\u6709\u7EDF\u4E00\u9000\u51FA\u4FE1\u53F7\u76D1\u542C\u7684\u7EC4\u4EF6\u4E0B\uFF0C\u5F53\u591A\u4E2A\u7EC4\u4EF6\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"goroutine"})," \u5F02\u6B65\u76D1\u542C\u4FE1\u53F7\uFF0C\u4E3B ",(0,r.jsx)(e.code,{children:"goroutine"})," \u63A5\u6536\u5230\u9000\u51FA\u4FE1\u53F7\u5F80\u5F80\u4F1A\u76F4\u63A5\u9000\u51FA\uFF0C\u6216\u8005\u7B49\u5F85\u4E00\u6BB5\u65E0\u6CD5\u9884\u6D4B\u7684\u65F6\u95F4\u9000\u51FA\uFF0C\u9020\u6210\u7A0B\u5E8F\u5176\u5B9E\u65E0\u6CD5\u5E73\u6ED1\u9000\u51FA\uFF0C\u53EF\u80FD\u5F15\u8D77\u4E00\u4E9B\u4E0D\u53EF\u9884\u6599\u7684\u95EE\u9898\u3002 ",(0,r.jsx)(e.code,{children:"gproc"})," \u901A\u8FC7\u7EDF\u4E00\u7684\u4FE1\u53F7\u6CE8\u518C\u548C\u56DE\u8C03\u5904\u7406\uFF0C\u4F7F\u5F97\u5404\u4E2A\u7EC4\u4EF6\u80FD\u591F\u6709\u6548\u5730\u63A5\u6536\u5230\u9000\u51FA\u4FE1\u53F7\u5E76\u505A\u76F8\u5E94\u6790\u6784\u5904\u7406\uFF0C\u4F7F\u5F97\u7A0B\u5E8F\u7684\u4FE1\u53F7\u5904\u7406\u903B\u8F91\u66F4\u52A0\u4E25\u8C28\u3002"]}),"\n",(0,r.jsx)(e.p,{children:"\u76F8\u5173\u65B9\u6CD5\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// AddSigHandler adds custom signal handler for custom one or more signals.\nfunc AddSigHandler(handler SigHandler, signals ...os.Signal)\n\n// AddSigHandlerShutdown adds custom signal handler for shutdown signals:\n// syscall.SIGINT,\n// syscall.SIGQUIT,\n// syscall.SIGKILL,\n// syscall.SIGTERM,\n// syscall.SIGABRT.\nfunc AddSigHandlerShutdown(handler ...SigHandler)\n\n// Listen blocks and does signal listening and handling.\nfunc Listen()\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u7B80\u8981\u4ECB\u7ECD\uFF1A"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"AddSigHanlder"})," \u65B9\u6CD5\u7528\u4E8E\u6DFB\u52A0\u5BF9\u6307\u5B9A\u4FE1\u53F7\u7684\u76D1\u542C\u548C\u5BF9\u5E94\u56DE\u8C03\u51FD\u6570\u6CE8\u518C\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"AddSigHandlerShutdown"})," \u65B9\u6CD5\u7528\u4E8E\u6DFB\u52A0\u5BF9\u5E38\u89C1\u8FDB\u7A0B\u9000\u51FA\u4FE1\u53F7\u7684\u76D1\u542C\u548C\u5BF9\u5E94\u56DE\u8C03\u51FD\u6570\u6CE8\u518C\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"Listen"})," \u65B9\u6CD5\u7528\u4E8E\u963B\u585E\u76D1\u542C\u4FE1\u53F7\u5E76\u81EA\u52A8\u6267\u884C\u56DE\u8C03\u51FD\u6570\u8C03\u7528\u3002"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u6211\u4EEC\u6765\u770B\u4E24\u4E2A\u793A\u4F8B\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u793A\u4F8B1\u4F7F\u7528\u6807\u51C6\u5E93\u4FE1\u53F7\u76D1\u542C",children:"\u793A\u4F8B1\uFF0C\u4F7F\u7528\u6807\u51C6\u5E93\u4FE1\u53F7\u76D1\u542C"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "os"\n    "os/signal"\n    "syscall"\n    "time"\n)\n\nfunc signalHandlerForMQ() {\n    var (\n        sig          os.Signal\n        receivedChan = make(chan os.Signal)\n    )\n    signal.Notify(\n        receivedChan,\n        syscall.SIGINT,\n        syscall.SIGQUIT,\n        syscall.SIGKILL,\n        syscall.SIGTERM,\n        syscall.SIGABRT,\n    )\n    for {\n        sig = <-receivedChan\n        fmt.Println("MQ is shutting down due to signal:", sig.String())\n        time.Sleep(time.Second)\n        fmt.Println("MQ is shut down smoothly")\n        return\n    }\n}\n\nfunc main() {\n    fmt.Println("Process start, pid:", os.Getpid())\n    go signalHandlerForMQ()\n\n    var (\n        sig          os.Signal\n        receivedChan = make(chan os.Signal)\n    )\n    signal.Notify(\n        receivedChan,\n        syscall.SIGINT,\n        syscall.SIGQUIT,\n        syscall.SIGKILL,\n        syscall.SIGTERM,\n        syscall.SIGABRT,\n    )\n    for {\n        sig = <-receivedChan\n        fmt.Println("MainProcess is shutting down due to signal:", sig.String())\n        return\n    }\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u4EEC\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"go run"})," \u547D\u4EE4\u6765\u6267\u884C\u4E00\u4E0B\uFF0C\u968F\u540E\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"Ctrl+C"})," \u5FEB\u6377\u952E\u9000\u51FA\uFF08 ",(0,r.jsx)(e.code,{children:"Mac"})," \u7528\u6237\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"Command+C"}),"\uFF09\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ go run signal_handler.go\nProcess start, pid: 21928\n^CMainProcess is shutting down due to signal: interrupt\nMQ is shutting down due to signal: interrupt\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u53EF\u4EE5\u770B\u5230\uFF0C\u597D\u53EF\u60DC\uFF0C\u90A3\u4E2A ",(0,r.jsx)(e.code,{children:"MQ"})," \u7684 ",(0,r.jsx)(e.code,{children:"goroutine"})," \u8FD8\u6CA1\u5B8C\u5168\u9000\u51FA\u8FDB\u7A0B\u5373\u88AB\u5F3A\u884C\u5173\u95ED\u3002"]}),"\n",(0,r.jsxs)(e.h2,{id:"\u793A\u4F8B2\u4F7F\u7528-gproc-\u4FE1\u53F7\u76D1\u542C",children:["\u793A\u4F8B2\uFF0C\u4F7F\u7528 ",(0,r.jsx)(e.code,{children:"gproc"})," \u4FE1\u53F7\u76D1\u542C"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "github.com/gogf/gf/os/gproc"\n    "os"\n    "time"\n)\n\nfunc signalHandlerForMQ(sig os.Signal) {\n    fmt.Println("MQ is shutting down due to signal:", sig.String())\n    time.Sleep(time.Second)\n    fmt.Println("MQ is shut down smoothly")\n}\n\nfunc signalHandlerForMain(sig os.Signal) {\n    fmt.Println("MainProcess is shutting down due to signal:", sig.String())\n}\n\nfunc main() {\n    fmt.Println("Process start, pid:", os.Getpid())\n    gproc.AddSigHandlerShutdown(\n        signalHandlerForMQ,\n        signalHandlerForMain,\n    )\n    gproc.Listen()\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u4EEC\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"go run"})," \u547D\u4EE4\u6765\u6267\u884C\u4E00\u4E0B\uFF0C\u968F\u540E\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"Ctrl+C"})," \u5FEB\u6377\u952E\u9000\u51FA\uFF08 ",(0,r.jsx)(e.code,{children:"Mac"})," \u7528\u6237\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"Command+C"}),"\uFF09\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ go run signal_handler_gproc.go\nProcess start, pid: 22876\n^CMQ is shutting down due to signal: interrupt\nMainProcess is shutting down due to signal: interrupt\nMQ is shut down smoothly\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u770B\u5230\u5DEE\u522B\u4E86\u5427\uFF0C\u6240\u6709\u7684\u4FE1\u53F7\u76D1\u542C\u51FD\u6570\u90FD\u6B63\u5E38\u7ED3\u675F\u540E\uFF0C\u968F\u540E\u8FDB\u7A0B\u9000\u51FA\u3002"})]})}function g(n={}){let{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},250065:function(n,e,s){s.d(e,{Z:function(){return t},a:function(){return o}});var i=s(667294);let r={},l=i.createContext(r);function o(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);