"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["42871"],{808397:function(e,n,r){r.r(n),r.d(n,{metadata:()=>d,contentTitle:()=>t,default:()=>g,assets:()=>s,toc:()=>a,frontMatter:()=>o});var d=JSON.parse('{"id":"\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u8D1F\u8F7D\u5747\u8861","title":"\u670D\u52A1\u8D1F\u8F7D\u5747\u8861","description":"\u57FA\u672C\u4ECB\u7ECD","source":"@site/versioned_docs/version-2.5.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u8D1F\u8F7D\u5747\u8861.md","sourceDirName":"\u5FAE\u670D\u52A1\u5F00\u53D1","slug":"/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u8D1F\u8F7D\u5747\u8861","permalink":"/2.5.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u8D1F\u8F7D\u5747\u8861","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-2.5.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u8D1F\u8F7D\u5747\u8861.md","tags":[],"version":"2.5.x","lastUpdatedBy":"John","lastUpdatedAt":1730365530000,"sidebarPosition":6,"frontMatter":{"title":"\u670D\u52A1\u8D1F\u8F7D\u5747\u8861","sidebar_position":6,"hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"\u670D\u52A1\u6CE8\u518C\u53D1\u73B0","permalink":"/2.5.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u6CE8\u518C\u53D1\u73B0"},"next":{"title":"\u670D\u52A1\u914D\u7F6E\u7BA1\u7406","permalink":"/2.5.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u914D\u7F6E\u7BA1\u7406"}}'),c=r("785893"),l=r("250065");let o={title:"\u670D\u52A1\u8D1F\u8F7D\u5747\u8861",sidebar_position:6,hide_title:!0},t=void 0,s={},a=[{value:"\u57FA\u672C\u4ECB\u7ECD",id:"\u57FA\u672C\u4ECB\u7ECD",level:2},{value:"\u7B56\u7565\u5217\u8868",id:"\u7B56\u7565\u5217\u8868",level:2},{value:"\u4F7F\u7528\u793A\u4F8B",id:"\u4F7F\u7528\u793A\u4F8B",level:2},{value:"<code>HTTP</code>",id:"http",level:3},{value:"<code>GRPC</code>",id:"grpc",level:3}];function i(e){let n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h2,{id:"\u57FA\u672C\u4ECB\u7ECD",children:"\u57FA\u672C\u4ECB\u7ECD"}),"\n",(0,c.jsxs)(n.p,{children:["\u8D1F\u8F7D\u5747\u8861\u7EC4\u4EF6\u4F7F\u7528\u5728\u5BA2\u6237\u7AEF\u4E2D\u3002 ",(0,c.jsx)(n.code,{children:"GoFrame"})," \u6846\u67B6\u63D0\u4F9B\u4E86\u89E3\u8026\u5316\u8BBE\u8BA1\u7684\u3001\u7075\u6D3B\u6027\u9AD8\u3001\u6269\u5C55\u6027\u5F3A\u7684\u8D1F\u8F7D\u5747\u8861\u7EC4\u4EF6\uFF0C\u7531 ",(0,c.jsx)(n.code,{children:"gsel"})," \u7EC4\u4EF6\u7BA1\u7406\uFF0C\u8BE5\u7EC4\u4EF6\u5B9A\u4E49\u4E86\u8D1F\u8F7D\u5747\u8861\u7684\u63A5\u53E3\uFF0C\u5E76\u63D0\u4F9B\u4E86\u591A\u79CD\u5185\u7F6E\u7684\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\u5B9E\u73B0\u3002\u5F00\u53D1\u8005\u4E5F\u53EF\u4EE5\u6839\u636E\u63A5\u53E3\u5B9E\u73B0\u81EA\u5B9A\u4E49\u7684\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\u3002"]}),"\n",(0,c.jsx)(n.h2,{id:"\u7B56\u7565\u5217\u8868",children:"\u7B56\u7565\u5217\u8868"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"gsel"})," \u7EC4\u4EF6\u63D0\u4F9B\u4E86\u591A\u79CD\u5E38\u7528\u7684\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\uFF0C\u4F9B\u5F00\u53D1\u8005\u9009\u62E9\u4F7F\u7528\uFF1A"]}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u7B56\u7565\u540D\u79F0"}),(0,c.jsx)(n.th,{children:"\u7B56\u7565\u63CF\u8FF0"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"LeastConnection"})}),(0,c.jsx)(n.td,{children:"\u6700\u5C0F\u8FDE\u63A5\u6570\u3002"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Random"})}),(0,c.jsx)(n.td,{children:"\u968F\u673A\u8BBF\u95EE\u3002"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"RoundRobin"})}),(0,c.jsx)(n.td,{children:"\u8F6E\u8BAD\u8BBF\u95EE\u3002"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Weight"})}),(0,c.jsxs)(n.td,{children:["\u6743\u91CD\u8BBF\u95EE\u3002\u670D\u52A1\u6CE8\u518C\u65F6\u9700\u8981\u8BBE\u7F6E ",(0,c.jsx)(n.code,{children:"Weight"})," \u53C2\u6570\u3002"]})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"\u4F7F\u7528\u793A\u4F8B",children:"\u4F7F\u7528\u793A\u4F8B"}),"\n",(0,c.jsx)(n.h3,{id:"http",children:(0,c.jsx)(n.code,{children:"HTTP"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"server.go"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/net/ghttp"\n    "github.com/gogf/gf/v2/net/gsvc"\n)\n\nfunc main() {\n    gsvc.SetRegistry(etcd.New(`127.0.0.1:2379`))\n\n    s := g.Server(`hello.svc`)\n    s.BindHandler("/", func(r *ghttp.Request) {\n        g.Log().Info(r.Context(), `request received`)\n        r.Response.Write(`Hello world`)\n    })\n    s.Run()\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"client.go"})}),"\n",(0,c.jsxs)(n.p,{children:["\u8FD9\u91CC\u4F7F\u7528 ",(0,c.jsx)(n.code,{children:"gsel.SetBuilder(gsel.NewBuilderRoundRobin())"})," \u8BBE\u7F6E\u5168\u5C40\u7684\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\u4E3A\u8F6E\u8BAD\u8BBF\u95EE\u7B56\u7565\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/net/gsel"\n    "github.com/gogf/gf/v2/net/gsvc"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    gsvc.SetRegistry(etcd.New(`127.0.0.1:2379`))\n    gsel.SetBuilder(gsel.NewBuilderRoundRobin())\n\n    for i := 0; i < 10; i++ {\n        ctx := gctx.New()\n        res := g.Client().GetContent(ctx, `http://hello.svc/`)\n        g.Log().Info(ctx, res)\n    }\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u5206\u522B\u542F\u52A8\u4E24\u4E2A\u670D\u52A1\u7AEF\uFF0C\u5E76\u6267\u884C\u5BA2\u6237\u7AEF\u3002"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"server1"})," \u7EC8\u7AEF\u8F93\u51FA\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 21:24:08.413 [INFO] pid[10219]: http server started listening on [:63956]\n2023-03-15 21:24:08.413 [INFO] openapi specification is disabled\n2023-03-15 21:24:08.413 [DEBU] service register: &{Head: Deployment: Namespace: Name:hello.svc Version: Endpoints:10.35.12.81:63956 Metadata:map[insecure:true protocol:http]}\n2023-03-15 21:24:08.455 [DEBU] etcd put success with key "/service/default/default/hello.svc/latest/10.35.12.81:63956", value "{"insecure":true,"protocol":"http"}", lease "7587869265945813020"\n\n   SERVER   | DOMAIN  | ADDRESS | METHOD | ROUTE |                             HANDLER                             |    MIDDLEWARE\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n  hello.svc | default | :63956  | ALL    | /     | main.main.func1                                                 |\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n  hello.svc | default | :63956  | ALL    | /*    | github.com/gogf/gf/v2/net/ghttp.internalMiddlewareServerTracing | GLOBAL MIDDLEWARE\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n\n2023-03-15 21:24:18.357 [INFO] {e05b6049859a4c17d1de5d62eafa5a5f} request received\n2023-03-15 21:24:18.358 [INFO] {785e9349859a4c17d3de5d62049e5b51} request received\n2023-03-15 21:24:18.360 [INFO] {7076ab49859a4c17d5de5d62aaa64c85} request received\n2023-03-15 21:24:18.360 [INFO] {205fb849859a4c17d7de5d62cb2590f4} request received\n2023-03-15 21:24:18.361 [INFO] {885fc349859a4c17d9de5d6235937e31} request received\n'})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"server2"})," \u7EC8\u7AEF\u8F93\u51FA\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 21:24:10.769 [INFO] pid[10242]: http server started listening on [:63964]\n2023-03-15 21:24:10.770 [INFO] openapi specification is disabled\n2023-03-15 21:24:10.770 [DEBU] service register: &{Head: Deployment: Namespace: Name:hello.svc Version: Endpoints:10.35.12.81:63964 Metadata:map[insecure:true protocol:http]}\n2023-03-15 21:24:10.812 [DEBU] etcd put success with key "/service/default/default/hello.svc/latest/10.35.12.81:63964", value "{"insecure":true,"protocol":"http"}", lease "7587869265945813023"\n\n   SERVER   | DOMAIN  | ADDRESS | METHOD | ROUTE |                             HANDLER                             |    MIDDLEWARE\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n  hello.svc | default | :63964  | ALL    | /     | main.main.func1                                                 |\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n  hello.svc | default | :63964  | ALL    | /*    | github.com/gogf/gf/v2/net/ghttp.internalMiddlewareServerTracing | GLOBAL MIDDLEWARE\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n\n2023-03-15 21:24:18.357 [INFO] {602d8749859a4c17d2de5d62d515e464} request received\n2023-03-15 21:24:18.359 [INFO] {e0ed9b49859a4c17d4de5d628284ae62} request received\n2023-03-15 21:24:18.360 [INFO] {e0e0b249859a4c17d6de5d62beda3001} request received\n2023-03-15 21:24:18.361 [INFO] {7087bd49859a4c17d8de5d62f892e8aa} request received\n2023-03-15 21:24:18.361 [INFO] {e8aec849859a4c17dade5d6247101836} request received\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u5BA2\u6237\u7AEF\u7EC8\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"$ go run client.go\n2023-03-15 21:24:18.357 [INFO] {e05b6049859a4c17d1de5d62eafa5a5f} Hello world\n2023-03-15 21:24:18.358 [INFO] {602d8749859a4c17d2de5d62d515e464} Hello world\n2023-03-15 21:24:18.358 [INFO] {785e9349859a4c17d3de5d62049e5b51} Hello world\n2023-03-15 21:24:18.359 [INFO] {e0ed9b49859a4c17d4de5d628284ae62} Hello world\n2023-03-15 21:24:18.360 [INFO] {7076ab49859a4c17d5de5d62aaa64c85} Hello world\n2023-03-15 21:24:18.360 [INFO] {e0e0b249859a4c17d6de5d62beda3001} Hello world\n2023-03-15 21:24:18.360 [INFO] {205fb849859a4c17d7de5d62cb2590f4} Hello world\n2023-03-15 21:24:18.361 [INFO] {7087bd49859a4c17d8de5d62f892e8aa} Hello world\n2023-03-15 21:24:18.361 [INFO] {885fc349859a4c17d9de5d6235937e31} Hello world\n2023-03-15 21:24:18.361 [INFO] {e8aec849859a4c17dade5d6247101836} Hello world\n"})}),"\n",(0,c.jsx)(n.h3,{id:"grpc",children:(0,c.jsx)(n.code,{children:"GRPC"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"server.go"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/balancer/controller"\n)\n\nfunc main() {\n    s := grpcx.Server.New()\n    controller.Register(s)\n    s.Run()\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"client.go"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/rpc/grpcx/balancer/protobuf"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    var (\n        ctx    context.Context\n        conn   = grpcx.Client.MustNewGrpcClientConn("demo", grpcx.Balancer.WithRandom())\n        client = protobuf.NewGreeterClient(conn)\n    )\n    for i := 0; i < 10; i++ {\n        ctx = gctx.New()\n        res, err := client.SayHello(ctx, &protobuf.HelloRequest{Name: "World"})\n        if err != nil {\n            g.Log().Error(ctx, err)\n            return\n        }\n        g.Log().Debug(ctx, "Response:", res.Message)\n    }\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["\u5176\u4E2D\u7684 ",(0,c.jsx)(n.code,{children:"grpcx.Balancer.WithRandom()"})," \u8868\u793A\u4F7F\u7528\u968F\u673A\u7684\u8BF7\u6C42\u7B56\u7565\u3002\u542F\u52A8\u4E24\u4E2A ",(0,c.jsx)(n.code,{children:"server.go"})," \u670D\u52A1\u7AEF\uFF0C\u968F\u540E\u8FD0\u884C ",(0,c.jsx)(n.code,{children:"client.go"})," \u5BA2\u6237\u7AEF\uFF0C\u67E5\u770B\u670D\u52A1\u7AEF\u7684\u8BF7\u6C42\u65E5\u5FD7\uFF1A"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"server1"})," \u7EC8\u7AEF\u8F93\u51FA\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 19:50:44.801 [DEBU] set default registry using file registry as no custom registry set\n2023-03-15 19:50:44.802 [DEBU] service register: &{Head: Deployment: Namespace: Name:demo Version: Endpoints:10.35.12.81:53962 Metadata:map[protocol:grpc]}\n2023-03-15 19:50:44.802 [INFO] pid[89290]: grpc server started listening on [:53962]\n2023-03-15 19:50:57.282 {7025612f6d954c17c5f335051bf10899} /protobuf.Greeter/SayHello, 0.003ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.283 {60567c2f6d954c17c7f335052ce05185} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.285 {f8d09b2f6d954c17ccf33505dff1a4ea} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.287 {f0fab02f6d954c17cdf33505438b2c80} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n'})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"server2"})," \u7EC8\u7AEF\u8F93\u51FA\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 19:50:51.720 [DEBU] set default registry using file registry as no custom registry set\n2023-03-15 19:50:51.721 [DEBU] service register: &{Head: Deployment: Namespace: Name:demo Version: Endpoints:10.35.12.81:53973 Metadata:map[protocol:grpc]}\n2023-03-15 19:50:51.722 [INFO] pid[89351]: grpc server started listening on [:53973]\n2023-03-15 19:50:57.280 {b89a0d2f6d954c17c4f33505a046817c} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.282 {28bf732f6d954c17c6f33505adedff5f} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.283 {9876832f6d954c17c8f3350580ed535b} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.284 {684e8b2f6d954c17c9f33505d56e4b05} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.284 {c045912f6d954c17caf3350599006197} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n2023-03-15 19:50:57.284 {500a972f6d954c17cbf33505252b0e01} /protobuf.Greeter/SayHello, 0.001ms, name:"World", message:"Hello World"\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u5BA2\u6237\u7AEF\u7EC8\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run client.go\n2023-03-15 19:50:57.278 [DEBU] client conn updated with addresses [{"Addr":"10.35.12.81:53962","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null},{"Addr":"10.35.12.81:53973","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null}]\n2023-03-15 19:50:57.281 [DEBU] {b89a0d2f6d954c17c4f33505a046817c} Response: Hello World\n2023-03-15 19:50:57.282 [DEBU] {7025612f6d954c17c5f335051bf10899} Response: Hello World\n2023-03-15 19:50:57.282 [DEBU] {28bf732f6d954c17c6f33505adedff5f} Response: Hello World\n2023-03-15 19:50:57.283 [DEBU] {60567c2f6d954c17c7f335052ce05185} Response: Hello World\n2023-03-15 19:50:57.283 [DEBU] {9876832f6d954c17c8f3350580ed535b} Response: Hello World\n2023-03-15 19:50:57.284 [DEBU] {684e8b2f6d954c17c9f33505d56e4b05} Response: Hello World\n2023-03-15 19:50:57.284 [DEBU] {c045912f6d954c17caf3350599006197} Response: Hello World\n2023-03-15 19:50:57.285 [DEBU] {500a972f6d954c17cbf33505252b0e01} Response: Hello World\n2023-03-15 19:50:57.286 [DEBU] {f8d09b2f6d954c17ccf33505dff1a4ea} Response: Hello World\n2023-03-15 19:50:57.287 [DEBU] {f0fab02f6d954c17cdf33505438b2c80} Response: Hello World\n'})})]})}function g(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(i,{...e})}):i(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return t},a:function(){return o}});var d=r(667294);let c={},l=d.createContext(c);function o(e){let n=d.useContext(l);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),d.createElement(l.Provider,{value:n},e.children)}}}]);