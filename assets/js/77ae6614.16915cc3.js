"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["7444"],{50414:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,contentTitle:()=>o,default:()=>a,assets:()=>d,toc:()=>l,frontMatter:()=>i});var t=JSON.parse('{"id":"\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u6CE8\u518C\u53D1\u73B0","title":"\u670D\u52A1\u6CE8\u518C\u53D1\u73B0","description":"\u57FA\u672C\u4ECB\u7ECD","source":"@site/versioned_docs/version-2.4.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u6CE8\u518C\u53D1\u73B0.md","sourceDirName":"\u5FAE\u670D\u52A1\u5F00\u53D1","slug":"/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u6CE8\u518C\u53D1\u73B0","permalink":"/2.4.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u6CE8\u518C\u53D1\u73B0","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-2.4.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u6CE8\u518C\u53D1\u73B0.md","tags":[],"version":"2.4.x","lastUpdatedBy":"John","lastUpdatedAt":1730365530000,"sidebarPosition":5,"frontMatter":{"title":"\u670D\u52A1\u6CE8\u518C\u53D1\u73B0","sidebar_position":5,"hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"\u62E6\u622A\u5668\u7EC4\u4EF6","permalink":"/2.4.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u62E6\u622A\u5668\u7EC4\u4EF6"},"next":{"title":"\u670D\u52A1\u8D1F\u8F7D\u5747\u8861","permalink":"/2.4.x/\u5FAE\u670D\u52A1\u5F00\u53D1/\u670D\u52A1\u8D1F\u8F7D\u5747\u8861"}}'),c=r("785893"),s=r("250065");let i={title:"\u670D\u52A1\u6CE8\u518C\u53D1\u73B0",sidebar_position:5,hide_title:!0},o=void 0,d={},l=[{value:"\u57FA\u672C\u4ECB\u7ECD",id:"\u57FA\u672C\u4ECB\u7ECD",level:2},{value:"\u7EC4\u4EF6\u542F\u7528",id:"\u7EC4\u4EF6\u542F\u7528",level:2},{value:"\u5E38\u7528\u7EC4\u4EF6",id:"\u5E38\u7528\u7EC4\u4EF6",level:2},{value:"\u4F7F\u7528\u793A\u4F8B",id:"\u4F7F\u7528\u793A\u4F8B",level:2},{value:"<code>HTTP</code>",id:"http",level:3},{value:"<code>GRPC</code>",id:"grpc",level:3}];function g(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h2,{id:"\u57FA\u672C\u4ECB\u7ECD",children:"\u57FA\u672C\u4ECB\u7ECD"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"GoFrame"})," \u6846\u67B6\u63D0\u4F9B\u4E86\u670D\u52A1\u6CE8\u518C\u53D1\u73B0\u7EC4\u4EF6\uFF0C\u7531 ",(0,c.jsx)(n.code,{children:"gsvc"})," \u7EC4\u4EF6\u7BA1\u7406\uFF0C\u8BE5\u7EC4\u4EF6\u4E3B\u8981\u5B9A\u4E49\u4E86\u6CE8\u518C\u53D1\u73B0\u7684\u63A5\u53E3\uFF0C\u5177\u4F53\u7684\u5B9E\u73B0\u7531\u793E\u533A\u7EC4\u4EF6\u63D0\u4F9B\uFF1A ",(0,c.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/registry",children:"https://github.com/gogf/gf/tree/master/contrib/registry"})," \u3002\u76EE\u524D\u793E\u533A\u7EC4\u4EF6\u63D0\u4F9B\u4E86\u591A\u79CD\u6CE8\u518C\u53D1\u73B0\u7684\u5B9E\u73B0\uFF0C\u5982 ",(0,c.jsx)(n.code,{children:"etcd, zookeeper, polaris"})," \u7B49\uFF0C\u5F00\u53D1\u8005\u6839\u636E\u9700\u8981\u63D2\u62D4\u4F7F\u7528\uFF0C\u4E5F\u53EF\u4EE5\u6839\u636E ",(0,c.jsx)(n.code,{children:"gsvc"})," \u7EC4\u4EF6\u7684\u63A5\u53E3\u5B9A\u4E49\u5B9E\u73B0\u81EA\u5DF1\u7684\u6CE8\u518C\u53D1\u73B0\u7EC4\u4EF6\u3002"]}),"\n",(0,c.jsx)(n.h2,{id:"\u7EC4\u4EF6\u542F\u7528",children:"\u7EC4\u4EF6\u542F\u7528"}),"\n",(0,c.jsxs)(n.p,{children:["\u6CE8\u518C\u53D1\u73B0\u7EC4\u4EF6\u53EA\u6709\u5728\u5F15\u5165\u5177\u4F53\u7684\u63A5\u53E3\u5B9E\u73B0\u65F6\u624D\u4F1A\u542F\u7528\u3002\u4F8B\u5982\uFF0C\u4F7F\u7528 ",(0,c.jsx)(n.code,{children:"etcd"})," \u5B9E\u73B0\u6CE8\u518C\u53D1\u73B0\u7684\u4F7F\u7528\u65B9\u5F0F\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/v2/net/gsvc"\n)\n\nfunc main() {\n    gsvc.SetRegistry(etcd.New(`127.0.0.1:2379`))\n\n    // ...\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"\u5E38\u7528\u7EC4\u4EF6",children:"\u5E38\u7528\u7EC4\u4EF6"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u7EC4\u4EF6\u540D\u79F0"}),(0,c.jsx)(n.th,{children:"\u6587\u6863\u8BF4\u660E"}),(0,c.jsx)(n.th,{children:"\u5907\u6CE8"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"file"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/registry/file",children:"https://github.com/gogf/gf/tree/master/contrib/registry/file"})}),(0,c.jsx)(n.td,{children:"\u4EC5\u7528\u4E8E\u5355\u673A\u6D4B\u8BD5"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"etcd"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/registry/etcd",children:"https://github.com/gogf/gf/tree/master/contrib/registry/etcd"})}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"polaris"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/registry/polaris",children:"https://github.com/gogf/gf/tree/master/contrib/registry/polaris"})}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"zookeeper"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/registry/zookeeper",children:"https://github.com/gogf/gf/tree/master/contrib/registry/zookeeper"})}),(0,c.jsx)(n.td,{})]})]})]}),"\n",(0,c.jsxs)(n.p,{children:["\u66F4\u591A\u7EC4\u4EF6\uFF0C\u8BF7\u53C2\u8003\uFF1A ",(0,c.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/registry",children:"https://github.com/gogf/gf/tree/master/contrib/registry"})]}),"\n",(0,c.jsx)(n.h2,{id:"\u4F7F\u7528\u793A\u4F8B",children:"\u4F7F\u7528\u793A\u4F8B"}),"\n",(0,c.jsx)(n.h3,{id:"http",children:(0,c.jsx)(n.code,{children:"HTTP"})}),"\n",(0,c.jsxs)(n.p,{children:["\u53EF\u4EE5\u4F7F\u7528 ",(0,c.jsx)(n.code,{children:"gsvc.SetRegistry(etcd.New(`127.0.0.1:2379`))"})," \u6765\u8BBE\u7F6E\u4F7F\u7528 ",(0,c.jsx)(n.code,{children:"etcd"})," \u7684\u6CE8\u518C\u53D1\u73B0\u3002\u5176\u4E2D\u7684 ",(0,c.jsx)(n.code,{children:"etcd.New"})," \u8868\u793A\u901A\u8FC7\u793E\u533A\u7EC4\u4EF6\u521B\u5EFA\u4E00\u4E2A ",(0,c.jsx)(n.code,{children:"gsvc.Registry"})," \u7684\u63A5\u53E3\u5B9E\u73B0\u5BF9\u8C61\uFF0C\u5E76\u901A\u8FC7 ",(0,c.jsx)(n.code,{children:"gsvc.SetRegistry"})," \u65B9\u6CD5\u8BBE\u7F6E\u5168\u5C40\u9ED8\u8BA4\u7684\u6CE8\u518C\u53D1\u73B0\u63A5\u53E3\u5B9E\u73B0\u5BF9\u8C61\u3002"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"server.go"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/net/ghttp"\n    "github.com/gogf/gf/v2/net/gsvc"\n)\n\nfunc main() {\n    gsvc.SetRegistry(etcd.New(`127.0.0.1:2379`))\n\n    s := g.Server(`hello.svc`)\n    s.BindHandler("/", func(r *ghttp.Request) {\n        g.Log().Info(r.Context(), `request received`)\n        r.Response.Write(`Hello world`)\n    })\n    s.Run()\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"client.go"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/net/gsvc"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    gsvc.SetRegistry(etcd.New(`127.0.0.1:2379`))\n    ctx := gctx.New()\n    res := g.Client().GetContent(ctx, `http://hello.svc/`)\n    g.Log().Info(ctx, res)\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u6267\u884C\u540E\uFF0C\u670D\u52A1\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 20:55:56.256 [INFO] pid[3358]: http server started listening on [:60700]\n2023-03-15 20:55:56.256 [INFO] openapi specification is disabled\n2023-03-15 20:55:56.256 [DEBU] service register: &{Head: Deployment: Namespace: Name:hello.svc Version: Endpoints:10.35.12.81:60700 Metadata:map[insecure:true protocol:http]}\n2023-03-15 20:55:56.297 [DEBU] etcd put success with key "/service/default/default/hello.svc/latest/10.35.12.81:60700", value "{"insecure":true,"protocol":"http"}", lease "7587869265945813002"\n\n   SERVER   | DOMAIN  | ADDRESS | METHOD | ROUTE |                             HANDLER                             |    MIDDLEWARE\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n  hello.svc | default | :60700  | ALL    | /     | main.main.func1                                                 |\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n  hello.svc | default | :60700  | ALL    | /*    | github.com/gogf/gf/v2/net/ghttp.internalMiddlewareServerTracing | GLOBAL MIDDLEWARE\n------------|---------|---------|--------|-------|-----------------------------------------------------------------|--------------------\n\n2023-03-15 20:56:45.739 [INFO] {880eaa8104994c17ffb384495cd4c613} request received\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u5BA2\u6237\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"$ go run client.go\n2023-03-15 20:56:45.739 [INFO] {880eaa8104994c17ffb384495cd4c613} Hello world\n"})}),"\n",(0,c.jsx)(n.h3,{id:"grpc",children:(0,c.jsx)(n.code,{children:"GRPC"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5982\u679C\u662F ",(0,c.jsx)(n.code,{children:"GRPC"})," \u534F\u8BAE\uFF0C\u5FC5\u987B\u4F7F\u7528 ",(0,c.jsx)(n.code,{children:"grpcx.Resolver"})," \u7684 ",(0,c.jsx)(n.code,{children:"grpcx"})," \u6A21\u5757\u6765\u8BBE\u7F6E\u670D\u52A1\u6CE8\u518C\u53D1\u73B0\u7EC4\u4EF6\u3002 ",(0,c.jsx)(n.code,{children:"Server"})," \u7AEF\u672A\u5728 ",(0,c.jsx)(n.code,{children:"config.yaml"})," \u4E2D\u8BBE\u7F6E ",(0,c.jsx)(n.code,{children:"grpc.name"})," \u503C\u65F6\uFF0C\u9ED8\u8BA4\u503C\u662F ",(0,c.jsx)(n.code,{children:"default"}),"\u3002"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"server.go"})}),"\n",(0,c.jsxs)(n.p,{children:["\u4EE3\u7801\u4E2D\u7684 ",(0,c.jsx)(n.code,{children:"etcd.New"})," \u8868\u793A\u901A\u8FC7\u793E\u533A\u7EC4\u4EF6\u521B\u5EFA\u4E00\u4E2A ",(0,c.jsx)(n.code,{children:"gsvc.Registry"})," \u7684\u63A5\u53E3\u5B9E\u73B0\u5BF9\u8C61\uFF0C\u5E76\u901A\u8FC7 ",(0,c.jsx)(n.code,{children:"grpcx.Resolver.Register"})," \u8BBE\u7F6E\u5168\u5C40\u7684 ",(0,c.jsx)(n.code,{children:"grpc"})," \u6CE8\u518C\u53D1\u73B0\u63A5\u53E3\u5B9E\u73B0\u5BF9\u8C61\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/registry/etcd/grpc/controller"\n)\n\nfunc main() {\n    grpcx.Resolver.Register(etcd.New("127.0.0.1:2379"))\n\n    s := grpcx.Server.New()\n    controller.Register(s)\n    s.Run()\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"config.yaml"}),"\n",(0,c.jsx)(n.p,{children:"\u670D\u52A1\u7AEF\u9ED8\u8BA4\u7684\u914D\u7F6E\u6587\u4EF6\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'grpc:\n  name:             "demo"  # \u670D\u52A1\u540D\u79F0\n  address:          ":8000" # \u81EA\u5B9A\u4E49\u670D\u52A1\u76D1\u542C\u5730\u5740\n  logPath:          "./log" # \u65E5\u5FD7\u5B58\u50A8\u76EE\u5F55\u8DEF\u5F84\n  logStdout:        true    # \u65E5\u5FD7\u662F\u5426\u8F93\u51FA\u5230\u7EC8\u7AEF\n  errorLogEnabled:  true    # \u662F\u5426\u5F00\u542F\u9519\u8BEF\u65E5\u5FD7\u8BB0\u5F55\n  accessLogEnabled: true    # \u662F\u5426\u5F00\u542F\u8BBF\u95EE\u65E5\u5FD7\u8BB0\u5F55\n  errorStack:       true    # \u5F53\u4EA7\u751F\u9519\u8BEF\u65F6\uFF0C\u662F\u5426\u8BB0\u5F55\u9519\u8BEF\u5806\u6808\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"client.go"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/contrib/registry/etcd/v2"\n    "github.com/gogf/gf/contrib/rpc/grpcx/v2"\n    "github.com/gogf/gf/example/registry/etcd/grpc/protobuf"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    grpcx.Resolver.Register(etcd.New("127.0.0.1:2379"))\n\n    var (\n        ctx    = gctx.New()\n        conn   = grpcx.Client.MustNewGrpcClientConn("demo")\n        client = protobuf.NewGreeterClient(conn)\n    )\n    res, err := client.SayHello(ctx, &protobuf.HelloRequest{Name: "World"})\n    if err != nil {\n        g.Log().Error(ctx, err)\n        return\n    }\n    g.Log().Debug(ctx, "Response:", res.Message)\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u6267\u884C\u540E\uFF0C\u670D\u52A1\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run server.go\n2023-03-15 21:06:57.204 [DEBU] service register: &{Head: Deployment: Namespace: Name:demo Version: Endpoints:10.35.12.81:61978 Metadata:map[protocol:grpc]}\n2023-03-15 21:06:57.257 [DEBU] etcd put success with key "/service/default/default/demo/latest/10.35.12.81:61978", value "{"protocol":"grpc"}", lease "7587869265945813015"\n2023-03-15 21:06:57.257 [INFO] pid[5786]: grpc server started listening on [:61978]\n2023-03-15 21:07:04.955 {08f0aead94994c1731591d2b653ddc18} /protobuf.Greeter/SayHello, 0.002ms, name:"World", message:"Hello World"\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u5BA2\u6237\u7AEF\u8F93\u51FA\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'$ go run client.go\n2023-03-15 21:07:04.950 [DEBU] Watch key "/service/default/default/demo/latest/"\n2023-03-15 21:07:04.952 [DEBU] client conn updated with addresses [{"Addr":"10.35.12.81:61978","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null}]\n2023-03-15 21:07:04.953 [DEBU] client conn updated with addresses [{"Addr":"10.35.12.81:61978","ServerName":"demo","Attributes":{},"BalancerAttributes":null,"Type":0,"Metadata":null}]\n2023-03-15 21:07:04.955 [DEBU] {08f0aead94994c1731591d2b653ddc18} Response: Hello World\n'})})]})}function a(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(g,{...e})}):g(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return o},a:function(){return i}});var t=r(667294);let c={},s=t.createContext(c);function i(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);