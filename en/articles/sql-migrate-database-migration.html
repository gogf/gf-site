<!doctype html><html lang=en-US dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-community/社区投稿/SQL Migrate数据库迁移与版本管理：管理数据库结构变更的有效方法" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>SQL Migrate Database Migration and Version Management: Effective Methods for Managing Database Structure Changes | GoFrame - A powerful framework for faster, easier, and more efficient project development</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://goframe.org/en/articles/sql-migrate-database-migration><meta data-rh=true property=og:locale content=en_US><meta data-rh=true property=og:locale:alternate content=zh_Hans><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="SQL Migrate Database Migration and Version Management: Effective Methods for Managing Database Structure Changes | GoFrame - A powerful framework for faster, easier, and more efficient project development"><meta data-rh=true name=description content="This article comprehensively analyzes key technologies for database migration and version management, from manual SQL scripts to professional tools like golang-migrate, and provides practical best practices and production environment security audit solutions to help teams achieve controllable, traceable database change management."><meta data-rh=true property=og:description content="This article comprehensively analyzes key technologies for database migration and version management, from manual SQL scripts to professional tools like golang-migrate, and provides practical best practices and production environment security audit solutions to help teams achieve controllable, traceable database change management."><meta data-rh=true name=keywords content="database migration,version management,golang-migrate,SQL audit,GoFrame,continuous integration,multi-environment deployment,database version control,team collaboration,safe changes"><link data-rh=true rel=icon href=/en/img/favicon.ico><link data-rh=true rel=canonical href=https://goframe.org/en/articles/sql-migrate-database-migration><link data-rh=true rel=alternate href=https://goframe.org/articles/sql-migrate-database-migration hreflang=zh-Hans><link data-rh=true rel=alternate href=https://goframe.org/en/articles/sql-migrate-database-migration hreflang=en-US><link data-rh=true rel=alternate href=https://goframe.org/articles/sql-migrate-database-migration hreflang=x-default><link data-rh=true rel=preconnect href=https://ZQUL8VI47R-dsn.algolia.net crossorigin><link rel=search type=application/opensearchdescription+xml title="GoFrame - A powerful framework for faster, easier, and more efficient project development" href=/en/opensearch.xml><script src=https://hm.baidu.com/hm.js?38f38a0626fd7805722db06243cd0fa7 async></script><script src=https://cdn.wwads.cn/js/makemoney.js async></script><link rel=stylesheet href=/en/assets/css/styles.6c91788d.css><script src=/en/assets/js/runtime~main.ca8b0693.js defer></script><script src=/en/assets/js/main.659ae798.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/en/><div class=navbar__logo><img src=/en/img/logo2.png alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/logo2.png alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" sidebarid=quickSidebar href=/en/quick/install>Quick Start</a><a class="navbar__item navbar__link" sidebarid=mainSidebar href=/en/docs/core>Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button sidebarid=courseSidebar href=/en/course>Courses</a><ul class=dropdown__menu><li><a class=dropdown__link sidebarid=courseSidebar href=/en/course/bilibili-video>Video Tutorial(Chinese)</a><li><a class=dropdown__link sidebarid=courseStarBookSidebar href=/en/course/starbook>Practical Tutorial - Star English Book</a><li><a class=dropdown__link sidebarid=courseProximaBookSidebar href=/en/course/proxima-book>Microservice Tutorial - Proxima Book</a></ul></div><a class="navbar__item navbar__link" href=/en/examples/grpc>Examples</a><a class="navbar__item navbar__link" href=/en/showcase>Show Case</a><a class="navbar__item navbar__link" href=/en/release/note>Release</a><a class="navbar__item navbar__link" sidebarid=communitySidebar href=/en/share/group>Community</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/en/articles/sql-migrate-database-migration>2.8.x(Latest)</a><ul class=dropdown__menu><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/en/articles/sql-migrate-database-migration>2.8.x(Latest)</a><li><a class=dropdown__link href=/en/2.8.x/docs/cli>2.8.x</a><li><a class=dropdown__link href=/en/2.7.x/docs/design>2.7.x</a><li><a class=dropdown__link href=/en/2.6.x/项目开发>2.6.x</a><li><a class=dropdown__link href=/en/2.5.x/项目开发>2.5.x</a><li><a class=dropdown__link href=/en/2.4.x/开发工具>2.4.x</a><li><a class=dropdown__link href=/en/2.3.x/开发工具>2.3.x</a><li><a class=dropdown__link href=/en/2.2.x/开发工具>2.2.x</a><li><a class=dropdown__link href=/en/2.1.x/开发工具>2.1.x</a><li><a class=dropdown__link href=/en/2.0.x/开发工具>2.0.x</a><li><a class=dropdown__link href=/en/1.16.x/开发工具>1.16.x</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/articles/sql-migrate-database-migration rel="noopener noreferrer" class=dropdown__link lang=zh-Hans>简体中文</a><li><a href=/en/articles/sql-migrate-database-migration rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en-US>English</a></ul></div><a href=https://github.com/gogf/gf target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/share>Community Exchange</a><button aria-label="Expand sidebar category 'Community Exchange'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/supportus>Support Us</a><button aria-label="Expand sidebar category 'Support Us'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/en/articles>Community Articles</a><button aria-label="Collapse sidebar category 'Community Articles'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/framework-comparison-goframe-beego-iris-gin>Golang Framework Comparison: GoFrame, Beego, Iris and Gin</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/database-transaction-practice>Go Transaction Processing Best Practices: The Right Way to Ensure Data Consistency</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/use-error-code-gracefully-in-golang>How to Use Error Codes Gracefully in Go Development</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/when-to-use-panic-in-go>When to Use Panic? Deep Dive into Go Error Handling Best Practices</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/en/articles/sql-migrate-database-migration>SQL Migrate Database Migration and Version Management: Effective Methods for Managing Database Structure Changes</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/techempower-web-benchmarks-r23>TechEmpower Web Benchmarks Latest Performance Evaluation</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/rbac-permission-authentication-in-goframe>Implementing Complete Permission Authentication in Go Applications</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/go-sse-implementation-guide>Building High-Performance Real-Time Communication: Go Language SSE Implementation Guide</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/articles/database-sharding-in-go>Database Sharding in Go: A Practical E-commerce Case Study</a></ul></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/en/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/en/articles><span itemprop=name>Community Articles</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>SQL Migrate Database Migration and Version Management: Effective Methods for Managing Database Structure Changes</span><meta itemprop=position content=2></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.8.x(Latest)</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-business-scenarios-and-necessity-of-database-migration-and-version-management>1. Business Scenarios and Necessity of Database Migration and Version Management<a href=#1-business-scenarios-and-necessity-of-database-migration-and-version-management class=hash-link aria-label="Direct link to 1. Business Scenarios and Necessity of Database Migration and Version Management" title="Direct link to 1. Business Scenarios and Necessity of Database Migration and Version Management">​</a></h2>
<p>In modern software development, database structure changes are common and inevitable. As businesses evolve and requirements change, we often need to modify databases in various ways, such as adding new tables, modifying fields, creating indexes, etc. Without an effective management mechanism, these changes may lead to the following problems:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=11-common-business-scenarios>1.1 Common Business Scenarios<a href=#11-common-business-scenarios class=hash-link aria-label="Direct link to 1.1 Common Business Scenarios" title="Direct link to 1.1 Common Business Scenarios">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=111-multi-environment-deployment-consistency>1.1.1 Multi-environment Deployment Consistency<a href=#111-multi-environment-deployment-consistency class=hash-link aria-label="Direct link to 1.1.1 Multi-environment Deployment Consistency" title="Direct link to 1.1.1 Multi-environment Deployment Consistency">​</a></h4>
<p>Ensuring database structure consistency across development, testing, pre-production, and production environments is a huge challenge. Without version management, inconsistencies can easily occur between environments, causing applications to malfunction in certain environments.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">Development environment → Testing environment → Pre</span><span class="token operator" style=color:#66d9ef>-</span><span class="token plain">production environment → Production environment</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=112-team-collaboration-conflicts>1.1.2 Team Collaboration Conflicts<a href=#112-team-collaboration-conflicts class=hash-link aria-label="Direct link to 1.1.2 Team Collaboration Conflicts" title="Direct link to 1.1.2 Team Collaboration Conflicts">​</a></h4>
<p>In multi-developer projects, different developers may modify the database simultaneously. Without unified change management, conflicts or overwriting of others' modifications can easily occur.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=113-version-rollback-requirements>1.1.3 Version Rollback Requirements<a href=#113-version-rollback-requirements class=hash-link aria-label="Direct link to 1.1.3 Version Rollback Requirements" title="Direct link to 1.1.3 Version Rollback Requirements">​</a></h4>
<p>When a new version has serious issues and needs to be rolled back, the absence of a corresponding database rollback mechanism may cause mismatches between database structure and application code, leading to more problems.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=114-database-evolution-in-microservice-architecture>1.1.4 Database Evolution in Microservice Architecture<a href=#114-database-evolution-in-microservice-architecture class=hash-link aria-label="Direct link to 1.1.4 Database Evolution in Microservice Architecture" title="Direct link to 1.1.4 Database Evolution in Microservice Architecture">​</a></h4>
<p>In microservice architecture, different services may have independent databases or share certain databases. Managing database changes and dependencies among these services becomes more complex.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=12-necessity-of-database-migration-management>1.2 Necessity of Database Migration Management<a href=#12-necessity-of-database-migration-management class=hash-link aria-label="Direct link to 1.2 Necessity of Database Migration Management" title="Direct link to 1.2 Necessity of Database Migration Management">​</a></h3>
<ul>
<li><strong>Traceability</strong>: Record the history of all database changes, knowing when, by whom, and why specific changes were made</li>
<li><strong>Repeatability</strong>: Ensure the same changes can be executed in the same way across different environments</li>
<li><strong>Reliability</strong>: Reduce human errors, especially in complex production environments</li>
<li><strong>Collaboration Efficiency</strong>: Improve team collaboration efficiency, reduce conflicts and communication costs</li>
<li><strong>CI/CD Support</strong>: Support automated CI/CD processes, enabling automated deployment of database changes</li>
</ul>
<p>Having understood the importance and business scenarios of database migration and version management, we will now explore several common implementation methods, from the most basic manual execution to professional migration tools. Each method has its applicable scenarios, advantages, and disadvantages.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-common-methods-for-database-migration-and-version-management>2. Common Methods for Database Migration and Version Management<a href=#2-common-methods-for-database-migration-and-version-management class=hash-link aria-label="Direct link to 2. Common Methods for Database Migration and Version Management" title="Direct link to 2. Common Methods for Database Migration and Version Management">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=21-manual-execution-of-sql-scripts>2.1 Manual Execution of SQL Scripts<a href=#21-manual-execution-of-sql-scripts class=hash-link aria-label="Direct link to 2.1 Manual Execution of SQL Scripts" title="Direct link to 2.1 Manual Execution of SQL Scripts">​</a></h3>
<p>The most primitive way is to manually write SQL scripts and execute them in various environments.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- Example of manually executed SQL script</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>ALTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> users </span><span class="token keyword" style=color:#66d9ef>ADD</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COLUMN</span><span class="token plain"> last_login_time </span><span class="token keyword" style=color:#66d9ef>DATETIME</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Last login time'</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INDEX</span><span class="token plain"> idx_user_login </span><span class="token keyword" style=color:#66d9ef>ON</span><span class="token plain"> users</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">last_login_time</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=211-advantages>2.1.1 Advantages<a href=#211-advantages class=hash-link aria-label="Direct link to 2.1.1 Advantages" title="Direct link to 2.1.1 Advantages">​</a></h4>
<ul>
<li><strong>Simple and Direct</strong>: No additional tools or frameworks needed, can be executed directly using a database client</li>
<li><strong>High Flexibility</strong>: Can execute any complex SQL statements without tool limitations</li>
<li><strong>No Learning Cost</strong>: Team members don't need to learn new tools</li>
<li><strong>Suitable for Small Projects</strong>: For small-scale projects with few changes, this method is simple and effective enough</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=212-disadvantages>2.1.2 Disadvantages<a href=#212-disadvantages class=hash-link aria-label="Direct link to 2.1.2 Disadvantages" title="Direct link to 2.1.2 Disadvantages">​</a></h4>
<ul>
<li><strong>Lack of Version Control</strong>: Unable to track which scripts have been executed and which haven't</li>
<li><strong>Difficult to Manage Execution Order</strong>: Relies on manual maintenance of execution order, prone to errors</li>
<li><strong>Prone to Human Error</strong>: Manual execution can easily lead to omission or repeated execution of certain scripts</li>
<li><strong>Difficult to Track Change History</strong>: Unable to know when, by whom, and which changes were executed</li>
<li><strong>Difficult to Rollback</strong>: No automated rollback mechanism, requiring manual writing and execution of rollback scripts</li>
<li><strong>Poor Multi-environment Consistency</strong>: Different environments may execute different scripts or in different orders, leading to inconsistencies</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=22-version-based-sql-script-management>2.2 Version-based SQL Script Management<a href=#22-version-based-sql-script-management class=hash-link aria-label="Direct link to 2.2 Version-based SQL Script Management" title="Direct link to 2.2 Version-based SQL Script Management">​</a></h3>
<p>This method names SQL scripts by version number and executes them in order, usually accompanied by a version record table to track executed scripts.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token operator" style=color:#66d9ef>/</span><span class="token plain">migrations</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  ├── V1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">0__create_users_table</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  ├── V1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>0</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">1__add_email_column</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  ├── V1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">0__create_orders_table</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  └── V1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">1__add_order_status</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Example of version record table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">schema_version</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">version</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>50</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">description</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>200</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">installed_on</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TIMESTAMP</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CURRENT_TIMESTAMP</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">success</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>BOOLEAN</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">version</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=221-advantages>2.2.1 Advantages<a href=#221-advantages class=hash-link aria-label="Direct link to 2.2.1 Advantages" title="Direct link to 2.2.1 Advantages">​</a></h4>
<ul>
<li><strong>Version Control</strong>: Through version numbers and version record tables, you can clearly know which version the current database is at</li>
<li><strong>Clear Execution Order</strong>: Scripts are executed in version number order, avoiding order errors</li>
<li><strong>Avoid Repeated Execution</strong>: Version record tables can prevent the same script from being executed multiple times</li>
<li><strong>Traceability</strong>: Can record the execution time and status of each change</li>
<li><strong>Still Keeps It Simple</strong>: Improved compared to completely manual methods, but implementation is still relatively simple</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=222-disadvantages>2.2.2 Disadvantages<a href=#222-disadvantages class=hash-link aria-label="Direct link to 2.2.2 Disadvantages" title="Direct link to 2.2.2 Disadvantages">​</a></h4>
<ul>
<li><strong>Still Requires Manual Management</strong>: Need to manually maintain version numbers and execute scripts</li>
<li><strong>Limited Rollback Support</strong>: Usually requires additional writing of rollback scripts, and the rollback process may not be automated enough</li>
<li><strong>Lack of Automated Tool Support</strong>: Need to develop scripts to execute and manage migrations</li>
<li><strong>Limited Support for Complex Changes</strong>: For complex changes requiring data migration, additional processing logic may be needed</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=23-orm-framework-built-in-migration-features>2.3 ORM Framework Built-in Migration Features<a href=#23-orm-framework-built-in-migration-features class=hash-link aria-label="Direct link to 2.3 ORM Framework Built-in Migration Features" title="Direct link to 2.3 ORM Framework Built-in Migration Features">​</a></h3>
<p>Many modern <code>ORM</code> frameworks provide built-in migration features, such as <code>Django</code>'s <code>Migrations</code>, <code>Laravel</code>'s <code>Migrations</code>, etc. These tools typically support:</p>
<ul>
<li>Automatic generation of migration scripts</li>
<li>Detection of model changes</li>
<li>Applying/rolling back migrations</li>
<li>Migration status queries</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=231-advantages>2.3.1 Advantages<a href=#231-advantages class=hash-link aria-label="Direct link to 2.3.1 Advantages" title="Direct link to 2.3.1 Advantages">​</a></h4>
<ul>
<li><strong>Seamless Integration with Framework</strong>: As part of the framework, consistent user experience, low learning cost</li>
<li><strong>Automatic Generation of Migration Scripts</strong>: Automatically generate migration scripts based on model changes, reducing manual SQL writing workload</li>
<li><strong>Bidirectional Migration</strong>: Support for upgrade and rollback operations</li>
<li><strong>Dependency Management</strong>: Able to handle dependencies between migration scripts</li>
<li><strong>Data Migration Support</strong>: In addition to structural changes, also supports data migration operations</li>
<li><strong>Good Development Experience</strong>: Closely integrated with the development process, improving development efficiency</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=232-disadvantages>2.3.2 Disadvantages<a href=#232-disadvantages class=hash-link aria-label="Direct link to 2.3.2 Disadvantages" title="Direct link to 2.3.2 Disadvantages">​</a></h4>
<ul>
<li><strong>Framework Binding</strong>: Bound to a specific framework, not easy to use across frameworks</li>
<li><strong>Auto-generated SQL May Not Be Optimized</strong>: Automatically generated SQL may not be as efficient as handwritten SQL</li>
<li><strong>Learning Specific Syntax</strong>: Need to learn framework-specific migration syntax and commands</li>
<li><strong>Limited Support for Complex Scenarios</strong>: Some complex database operations may not be possible through the framework's migration features</li>
<li><strong>Black Box Operation</strong>: Developers may not be clear about the actual SQL statements executed underneath</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=233-considerations>2.3.3 Considerations<a href=#233-considerations class=hash-link aria-label="Direct link to 2.3.3 Considerations" title="Direct link to 2.3.3 Considerations">​</a></h4>
<p>Migration features built into ORM frameworks may not consider data safety in automatically generated migration scripts, potentially leading to data loss in sensitive <code>DDL</code> operations such as field modifications and table restructuring. When used in production environments, there are several situations that could potentially cause data loss, mainly including:</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2331-data-truncation-due-to-field-type-modification>2.3.3.1 Data Truncation Due to Field Type Modification<a href=#2331-data-truncation-due-to-field-type-modification class=hash-link aria-label="Direct link to 2.3.3.1 Data Truncation Due to Field Type Modification" title="Direct link to 2.3.3.1 Data Truncation Due to Field Type Modification">​</a></h5>
<p>When modifying a field type from a larger type to a smaller type, data truncation may occur.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- For example, changing VARCHAR(255) to VARCHAR(50)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- The automatically generated migration might directly execute:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>ALTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>MODIFY</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COLUMN</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">description</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>50</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- This will cause data exceeding 50 characters to be truncated</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2332-data-loss-due-to-table-restructuring>2.3.3.2 Data Loss Due to Table Restructuring<a href=#2332-data-loss-due-to-table-restructuring class=hash-link aria-label="Direct link to 2.3.3.2 Data Loss Due to Table Restructuring" title="Direct link to 2.3.3.2 Data Loss Due to Table Restructuring">​</a></h5>
<p>When model changes are significant, some ORM framework migration features might choose to delete the old table and create a new one, rather than performing <code>ALTER TABLE</code> operations.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- The automatically generated migration might execute:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>DROP</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- This will cause all data in the original table to be lost</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2333-data-loss-due-to-field-deletion>2.3.3.3 Data Loss Due to Field Deletion<a href=#2333-data-loss-due-to-field-deletion class=hash-link aria-label="Direct link to 2.3.3.3 Data Loss Due to Field Deletion" title="Direct link to 2.3.3.3 Data Loss Due to Field Deletion">​</a></h5>
<p>When a field is removed from the model, automatically generated migration scripts typically directly delete that field without considering data backup first.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- When removing the email field from the model, the automatically generated migration might be:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>ALTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DROP</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COLUMN</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">email</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- This will cause all users' email information to be permanently lost</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2334-data-conflicts-due-to-adding-unique-constraints>2.3.3.4 Data Conflicts Due to Adding Unique Constraints<a href=#2334-data-conflicts-due-to-adding-unique-constraints class=hash-link aria-label="Direct link to 2.3.3.4 Data Conflicts Due to Adding Unique Constraints" title="Direct link to 2.3.3.4 Data Conflicts Due to Adding Unique Constraints">​</a></h5>
<p>When adding a unique constraint to existing data, if duplicate values exist in the data, the migration will fail or cause data loss.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- Adding a unique index to an existing table:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>ALTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>ADD</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>UNIQUE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INDEX</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">idx_email</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">email</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- If duplicate emails exist in the table, this operation will fail</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2335-improper-handling-of-foreign-key-relationships>2.3.3.5 Improper Handling of Foreign Key Relationships<a href=#2335-improper-handling-of-foreign-key-relationships class=hash-link aria-label="Direct link to 2.3.3.5 Improper Handling of Foreign Key Relationships" title="Direct link to 2.3.3.5 Improper Handling of Foreign Key Relationships">​</a></h5>
<p>When deleting or modifying tables or fields with foreign key relationships, if foreign key relationships are not properly handled, it may cause data consistency issues.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- Deleting a referenced main table:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>DROP</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">categories</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- If there is a product table referencing the category table, it may cause foreign key constraint errors or data inconsistencies</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=2336-irreversibility-of-rollback-operations>2.3.3.6 Irreversibility of Rollback Operations<a href=#2336-irreversibility-of-rollback-operations class=hash-link aria-label="Direct link to 2.3.3.6 Irreversibility of Rollback Operations" title="Direct link to 2.3.3.6 Irreversibility of Rollback Operations">​</a></h5>
<p>Some data changes are irreversible, even with rollback scripts, original data cannot be recovered.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic>-- If a data truncation operation is performed:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>ALTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>MODIFY</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COLUMN</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">description</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>50</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- The rollback script might be:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>ALTER</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>MODIFY</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COLUMN</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">description</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>255</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic>-- But the truncated data has already been lost and cannot be recovered through rollback</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=234-applicable-scenarios>2.3.4 Applicable Scenarios<a href=#234-applicable-scenarios class=hash-link aria-label="Direct link to 2.3.4 Applicable Scenarios" title="Direct link to 2.3.4 Applicable Scenarios">​</a></h4>
<p>This method is mainly suitable for the following scenarios:</p>
<ul>
<li><strong>Non-rigorous Personal Projects</strong>: Projects where data is not sensitive and deviations are acceptable</li>
<li><strong>Small Team Projects</strong>: Teams where all members use the same framework and data volume is small</li>
<li><strong>Prototype Development Stage</strong>: In the early stages of a project requiring rapid iteration</li>
<li><strong>Internal Tools or Test Environments</strong>: Environments where data can tolerate loss or rebuilding</li>
</ul>
<blockquote>
<p>Note: For enterprise-level production environments, critical business systems, or data-sensitive projects, the automatic migration features of ORM frameworks should be used with caution. In these scenarios, it is recommended to use professional database migration tools or handwritten migration scripts, with manual review.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=24-professional-database-migration-tools>2.4 Professional Database Migration Tools<a href=#24-professional-database-migration-tools class=hash-link aria-label="Direct link to 2.4 Professional Database Migration Tools" title="Direct link to 2.4 Professional Database Migration Tools">​</a></h3>
<p>Specialized database migration tools provide more powerful features:</p>
<ul>
<li><strong>Flyway</strong>: Popular database migration tool in the <code>Java</code> ecosystem</li>
<li><strong>Liquibase</strong>: Open-source database change management tool supporting multiple databases</li>
<li><strong>Alembic</strong>: Database migration tool for <code>Python SQLAlchemy</code></li>
<li><strong>golang-migrate</strong>: Database migration tool for <code>Go</code> language</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=241-advantages>2.4.1 Advantages<a href=#241-advantages class=hash-link aria-label="Direct link to 2.4.1 Advantages" title="Direct link to 2.4.1 Advantages">​</a></h4>
<ul>
<li><strong>Independent of Application Framework</strong>: Can be used with applications in any language or framework</li>
<li><strong>Multi-database Support</strong>: Usually supports multiple database systems</li>
<li><strong>Powerful Version Control</strong>: Provides comprehensive version management and migration history recording</li>
<li><strong>Command Line and API Support</strong>: Can be used both via command line and API integration into applications</li>
<li><strong>CI/CD Friendly</strong>: Easy to integrate into continuous integration and continuous deployment processes</li>
<li><strong>Community Support</strong>: Mature tools usually have active communities and rich documentation</li>
<li><strong>Enterprise-level Features</strong>: Some tools provide advanced features such as baseline versions, conditional migrations, multi-environment configurations, etc.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=242-disadvantages>2.4.2 Disadvantages<a href=#242-disadvantages class=hash-link aria-label="Direct link to 2.4.2 Disadvantages" title="Direct link to 2.4.2 Disadvantages">​</a></h4>
<ul>
<li><strong>Additional Dependencies</strong>: Introduces new tool dependencies</li>
<li><strong>Learning Cost</strong>: Need to learn how to use specific tools and best practices</li>
<li><strong>Additional Work for Application Integration</strong>: Need to write code to integrate tools with applications</li>
<li><strong>Potential Performance Overhead</strong>: Some tools may bring additional performance overhead when executing migrations</li>
<li><strong>Configuration Complexity</strong>: Advanced features may require complex configuration</li>
</ul>
<p>After understanding the advantages and disadvantages of various database migration methods, we can choose the most suitable solution based on the actual needs of the project. For most modern application development, especially projects requiring team collaboration and multi-environment deployment, we recommend the following database migration and version management methods.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-recommended-database-migration-and-version-management-methods>3. Recommended Database Migration and Version Management Methods<a href=#3-recommended-database-migration-and-version-management-methods class=hash-link aria-label="Direct link to 3. Recommended Database Migration and Version Management Methods" title="Direct link to 3. Recommended Database Migration and Version Management Methods">​</a></h2>
<p>Based on practical project experience, the following are recommended database migration and version management methods.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=31-sql-migration-version-management-tools>3.1 SQL Migration Version Management Tools<a href=#31-sql-migration-version-management-tools class=hash-link aria-label="Direct link to 3.1 SQL Migration Version Management Tools" title="Direct link to 3.1 SQL Migration Version Management Tools">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=311-common-sql-version-management-tools>3.1.1 Common SQL Version Management Tools<a href=#311-common-sql-version-management-tools class=hash-link aria-label="Direct link to 3.1.1 Common SQL Version Management Tools" title="Direct link to 3.1.1 Common SQL Version Management Tools">​</a></h4>
<p>It is recommended that database migration tools be as independent as possible from development languages and frameworks, so that the same migration solution can be used in different projects. The following are several common SQL migration version management tools that are independent of development languages.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3111-flyway>3.1.1.1 Flyway<a href=#3111-flyway class=hash-link aria-label="Direct link to 3.1.1.1 Flyway" title="Direct link to 3.1.1.1 Flyway">​</a></h5>
<p><a href=https://flywaydb.org/ target=_blank rel="noopener noreferrer">Flyway</a> is an open-source database migration tool with the following features:</p>
<ul>
<li><strong>Multi-platform Support</strong>: Provides command-line tools, <code>Java API</code>, <code>Maven</code> plugins, <code>Gradle</code> plugins, and other usage methods</li>
<li><strong>Multi-database Support</strong>: <code>Oracle</code>, <code>SQL Server</code>, <code>DB2</code>, <code>MySQL</code>, <code>PostgreSQL</code>, and many other databases</li>
<li><strong>Versioned Management</strong>: Uses version numbers to manage each migration script</li>
<li><strong>Security</strong>: Prevents applied migration scripts from being modified</li>
<li><strong>Commercial and Community Versions</strong>: Provides free community version and more comprehensive commercial version</li>
</ul>
<p>Naming convention example:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">V1__Create_person_table</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">V2__Add_people</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">V3__Add_nickname_column</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3112-liquibase>3.1.1.2 Liquibase<a href=#3112-liquibase class=hash-link aria-label="Direct link to 3.1.1.2 Liquibase" title="Direct link to 3.1.1.2 Liquibase">​</a></h5>
<p><a href=https://www.liquibase.org/ target=_blank rel="noopener noreferrer">Liquibase</a> is an open-source database schema change management tool with the following features:</p>
<ul>
<li><strong>Multi-format Support</strong>: Can write change scripts using XML, YAML, JSON, or SQL</li>
<li><strong>Multi-database Support</strong>: Supports more than 20 different databases</li>
<li><strong>Changesets</strong>: Manages changes using "Changesets"</li>
<li><strong>Context Awareness</strong>: Can execute different changes based on different environments</li>
<li><strong>Rollback Support</strong>: Supports automatic generation of rollback scripts</li>
</ul>
<p>Liquibase changeset example (XML format):</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token tag punctuation" style=color:#f8f8f2>&lt;</span><span class="token tag" style=color:#f92672>changeSet</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">id</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>1</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">author</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>bob</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;</span><span class="token tag" style=color:#f92672>createTable</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">tableName</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>department</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;</span><span class="token tag" style=color:#f92672>column</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">name</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>id</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">type</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>int</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;</span><span class="token tag" style=color:#f92672>constraints</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">primaryKey</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>true</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">nullable</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>false</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag punctuation" style=color:#f8f8f2>/></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;/</span><span class="token tag" style=color:#f92672>column</span><span class="token tag punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;</span><span class="token tag" style=color:#f92672>column</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">name</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>name</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">type</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>varchar(50)</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;</span><span class="token tag" style=color:#f92672>constraints</span><span class="token tag" style=color:#f92672> </span><span class="token tag attr-name" style="color:#a6e22e !important">nullable</span><span class="token tag attr-value punctuation attr-equals" style=color:#f8f8f2>=</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag attr-value" style=color:#f92672>false</span><span class="token tag attr-value punctuation" style=color:#f8f8f2>"</span><span class="token tag punctuation" style=color:#f8f8f2>/></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;/</span><span class="token tag" style=color:#f92672>column</span><span class="token tag punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token tag punctuation" style=color:#f8f8f2>&lt;/</span><span class="token tag" style=color:#f92672>createTable</span><span class="token tag punctuation" style=color:#f8f8f2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token tag punctuation" style=color:#f8f8f2>&lt;/</span><span class="token tag" style=color:#f92672>changeSet</span><span class="token tag punctuation" style=color:#f8f8f2>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3113-alembic>3.1.1.3 Alembic<a href=#3113-alembic class=hash-link aria-label="Direct link to 3.1.1.3 Alembic" title="Direct link to 3.1.1.3 Alembic">​</a></h5>
<p><a href=https://alembic.sqlalchemy.org/ target=_blank rel="noopener noreferrer">Alembic</a> is a lightweight database migration tool. Although it is designed for Python's SQLAlchemy ORM, its migration scripts are pure SQL files that can be used in any project:</p>
<ul>
<li><strong>Versioned Migration</strong>: Supports forward and backward database migrations</li>
<li><strong>Automatic Generation of Migration Scripts</strong>: Can automatically generate migration scripts based on model changes</li>
<li><strong>Branch Support</strong>: Supports branch and merge migrations</li>
<li><strong>Multi-database Support</strong>: Supports all databases supported by SQLAlchemy</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3114-golang-migrate>3.1.1.4 golang-migrate<a href=#3114-golang-migrate class=hash-link aria-label="Direct link to 3.1.1.4 golang-migrate" title="Direct link to 3.1.1.4 golang-migrate">​</a></h5>
<p><a href=https://github.com/golang-migrate/migrate target=_blank rel="noopener noreferrer">golang-migrate</a> is a powerful database migration tool. Its biggest feature is that it is independent of any development language or framework and can be used in any project, whether developed in <code>Go</code>, <code>Java</code>, <code>Python</code>, <code>PHP</code>, or other languages.</p>
<p>It supports multiple database systems, including:</p>
<ul>
<li><code>MySQL</code></li>
<li><code>PostgreSQL</code></li>
<li><code>SQLite</code></li>
<li><code>MongoDB</code></li>
<li><code>Microsoft SQL Server</code></li>
<li><code>CockroachDB</code></li>
<li><code>Clickhouse</code></li>
<li>And many other databases</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=312-golang-migrate-solution>3.1.2 golang-migrate Solution<a href=#312-golang-migrate-solution class=hash-link aria-label="Direct link to 3.1.2 golang-migrate Solution" title="Direct link to 3.1.2 golang-migrate Solution">​</a></h4>
<p>Among the tools introduced above, <code>golang-migrate</code> stands out due to its language independence, simplicity, and powerful features. It not only supports multiple database systems but also provides both command-line and programmatic API usage methods, making it very suitable for the needs of modern development teams.</p>
<p>Below we will detail a complete migration version management solution using the <code>golang-migrate</code> tool, covering every aspect from installation and configuration to actual use.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=313-installing-golang-migrate>3.1.3 Installing golang-migrate<a href=#313-installing-golang-migrate class=hash-link aria-label="Direct link to 3.1.3 Installing golang-migrate" title="Direct link to 3.1.3 Installing golang-migrate">​</a></h4>
<p><code>golang-migrate</code> provides multiple installation methods, you can choose the one that best suits your environment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># MacOS installation using Homebrew</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">brew </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> golang-migrate</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Linux installation using curl</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>curl</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-L</span><span class="token plain"> https://github.com/golang-migrate/migrate/releases/download/v4.16.2/migrate.linux-amd64.tar.gz </span><span class="token operator" style=color:#66d9ef>|</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>tar</span><span class="token plain"> xvz</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#e6db74>sudo</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>mv</span><span class="token plain"> migrate /usr/local/bin/</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Windows can download executable files from the official GitHub repository</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Or install using scoop</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">scoop </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> migrate</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># If you use Go language, you can also install via go install</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">go </span><span class="token function" style=color:#e6db74>install</span><span class="token plain"> </span><span class="token parameter variable" style=color:#f8f8f2>-tags</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'mysql'</span><span class="token plain"> github.com/golang-migrate/migrate/v4/cmd/migrate@latest</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=314-directory-design-and-naming-conventions>3.1.4 Directory Design and Naming Conventions<a href=#314-directory-design-and-naming-conventions class=hash-link aria-label="Direct link to 3.1.4 Directory Design and Naming Conventions" title="Direct link to 3.1.4 Directory Design and Naming Conventions">​</a></h4>
<blockquote>
<p>Even if not relying on the <code>golang-migrate</code> tool to manage SQL migration scripts, the following directory design and naming conventions are equally suitable for manually managing SQL migration scripts.</p>
</blockquote>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3141-directory-structure-design>3.1.4.1 Directory Structure Design<a href=#3141-directory-structure-design class=hash-link aria-label="Direct link to 3.1.4.1 Directory Structure Design" title="Direct link to 3.1.4.1 Directory Structure Design">​</a></h5>
<p>When using <code>golang-migrate</code> for database migration, the following directory structure is recommended:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token operator" style=color:#66d9ef>/</span><span class="token plain">project root</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  └── manifest</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      └── sql                # SQL version management directory</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          ├── mysql          # MySQL migration scripts</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          │   ├── </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">version prefix</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">description</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          │   ├── </span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">version prefix</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token boolean" style=color:#ae81ff>_</span><span class="token punctuation" style=color:#f8f8f2>[</span><span class="token plain">description</span><span class="token punctuation" style=color:#f8f8f2>]</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">down</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          │   ├── </span><span class="token operator" style=color:#66d9ef>...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          │   └── </span><span class="token operator" style=color:#66d9ef>...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          └── postgres       # PostgreSQL migration scripts </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> needed</span><span class="token punctuation" style=color:#f8f8f2>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This directory structure has the following advantages:</p>
<ul>
<li><strong>Centralized Management</strong>: All SQL version management files are centralized in the <code>manifest/sql</code> directory, making them easy to manage and find</li>
<li><strong>Multi-database Support</strong>: Organized by database type, supporting the use of multiple databases in the same project</li>
<li><strong>Clear Version History</strong>: The evolution history of the database structure can be visually seen through file names</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3142-meaning-of-up-and-down-in-migration-scripts>3.1.4.2 Meaning of up and down in Migration Scripts<a href=#3142-meaning-of-up-and-down-in-migration-scripts class=hash-link aria-label="Direct link to 3.1.4.2 Meaning of up and down in Migration Scripts" title="Direct link to 3.1.4.2 Meaning of up and down in Migration Scripts">​</a></h5>
<p>Each migration version contains two files:</p>
<ul>
<li>
<p><strong>up file</strong> (e.g., <code>v0.1.0_create_users_table.up.sql</code>): Contains upgrade operations, i.e., changes that need to be executed when applying a new version, such as creating tables, adding fields, creating indexes, etc.</p>
</li>
<li>
<p><strong>down file</strong> (e.g., <code>v0.1.0_create_users_table.down.sql</code>): Contains rollback operations, i.e., operations to be performed when rolling back to a previous version, such as deleting tables, deleting fields, deleting indexes, etc. The <code>down</code> file should be the inverse operation of the <code>up</code> file, ensuring that changes can be fully rolled back.</p>
</li>
</ul>
<p>For example, for a migration that creates a user table:</p>
<p><code>v0.1.0_create_users_table.up.sql</code> (upgrade script):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>BIGINT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>UNSIGNED</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>AUTO_INCREMENT</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>50</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Username'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">email</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>100</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Email'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">created_at</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DATETIME</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CURRENT_TIMESTAMP</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>UNIQUE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INDEX</span><span class="token plain"> idx_username </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">username</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>UNIQUE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>INDEX</span><span class="token plain"> idx_email </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">email</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>ENGINE</span><span class="token operator" style=color:#66d9ef>=</span><span class="token keyword" style=color:#66d9ef>InnoDB</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CHARSET</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>'Users table'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><code>v0.1.0_create_users_table.down.sql</code> (rollback script):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>DROP</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>IF</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token identifier">users</span><span class="token identifier punctuation" style=color:#f8f8f2>`</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>In <code>golang-migrate</code>, you can create only an <code>up</code> file without creating a <code>down</code> file, but this will have the following impacts:</p>
<ol>
<li>
<p><strong>Unable to Roll Back That Version</strong>: When executing the <code>migrate down</code> command, if there is no corresponding <code>down</code> file, the tool will not be able to perform the rollback operation and will return an error.</p>
</li>
<li>
<p><strong>Version Control Limitations</strong>: If you need to roll back to an earlier version, you must skip versions without <code>down</code> files, possibly requiring the use of the <code>force</code> command to forcibly set the version number.</p>
</li>
<li>
<p><strong>Difficult to Handle Emergency Situations</strong>: In a production environment, if you need to urgently roll back a problematic change, the absence of a <code>down</code> file will greatly increase the difficulty of handling.</p>
</li>
<li>
<p><strong>Incomplete Documentation</strong>: The <code>down</code> file is also a form of documentation, recording how to undo changes. Without it, the documentation for database changes will be incomplete.</p>
</li>
</ol>
<p>Therefore, even if in some cases you think rollback is not needed, it is strongly recommended to always create corresponding <code>down</code> files to ensure the completeness and flexibility of version control. In some cases, you may need to add special processing logic to the <code>down</code> file, such as backing up data before deleting a table.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3143-migration-script-naming-conventions>3.1.4.3 Migration Script Naming Conventions<a href=#3143-migration-script-naming-conventions class=hash-link aria-label="Direct link to 3.1.4.3 Migration Script Naming Conventions" title="Direct link to 3.1.4.3 Migration Script Naming Conventions">​</a></h5>
<p><code>golang-migrate</code> supports multiple script file naming conventions, with two commonly used naming methods:</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=31431-numeric-sequence-naming-method>3.1.4.3.1 Numeric Sequence Naming Method<a href=#31431-numeric-sequence-naming-method class=hash-link aria-label="Direct link to 3.1.4.3.1 Numeric Sequence Naming Method" title="Direct link to 3.1.4.3.1 Numeric Sequence Naming Method">​</a></h6>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">000001_create_users_table</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">000001_create_users_table</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">down</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">000002_add_user_fields</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">000002_add_user_fields</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">down</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This method uses numeric sequences as prefixes, such as <code>000001</code>, <code>000002</code>, etc. Its advantages are:</p>
<ul>
<li>Simple and intuitive, executed in numerical order</li>
<li>Easy to generate automatically, using the <code>migrate create -seq</code> command to automatically generate incremental sequence numbers</li>
<li>Suitable for frequently released projects, sequence numbers won't be quickly exhausted</li>
</ul>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=31432-semantic-versioning-naming-method>3.1.4.3.2 Semantic Versioning Naming Method<a href=#31432-semantic-versioning-naming-method class=hash-link aria-label="Direct link to 3.1.4.3.2 Semantic Versioning Naming Method" title="Direct link to 3.1.4.3.2 Semantic Versioning Naming Method">​</a></h6>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token plain">v0</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">0_create_users_table</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">v0</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>1</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">0_create_users_table</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">down</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">v0</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">0_add_user_fields</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">up</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">v0</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token number" style=color:#ae81ff>2</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">0_add_user_fields</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">down</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">sql</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This method uses semantic version numbers as prefixes, such as <code>v0.1.0</code>, <code>v0.2.0</code>, etc. Its advantages are:</p>
<ul>
<li>Easier to understand the purpose of files and their relationship with application versions</li>
<li>Can visually reflect major version changes, such as changes from <code>v1.0.0</code> to <code>v2.0.0</code></li>
<li>Suitable for projects bound to application versions, such as projects where each application version release has corresponding database changes</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=315-creating-migration-scripts>3.1.5 Creating Migration Scripts<a href=#315-creating-migration-scripts class=hash-link aria-label="Direct link to 3.1.5 Creating Migration Scripts" title="Direct link to 3.1.5 Creating Migration Scripts">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3151-automatically-creating-migration-files>3.1.5.1 Automatically Creating Migration Files<a href=#3151-automatically-creating-migration-files class=hash-link aria-label="Direct link to 3.1.5.1 Automatically Creating Migration Files" title="Direct link to 3.1.5.1 Automatically Creating Migration Files">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># Create new migration scripts</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">migrate create </span><span class="token parameter variable" style=color:#f8f8f2>-ext</span><span class="token plain"> sql </span><span class="token parameter variable" style=color:#f8f8f2>-dir</span><span class="token plain"> migrations/mysql </span><span class="token parameter variable" style=color:#f8f8f2>-seq</span><span class="token plain"> add_login_history_table</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This will create two files:</p>
<ul>
<li><code>migrations/mysql/000003_add_login_history_table.up.sql</code> (upgrade script)</li>
<li><code>migrations/mysql/000003_add_login_history_table.down.sql</code> (rollback script)</li>
</ul>
<p>Then manually add the SQL upgrade and rollback script content to the corresponding files.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3152-manually-creating-migration-files>3.1.5.2 Manually Creating Migration Files<a href=#3152-manually-creating-migration-files class=hash-link aria-label="Direct link to 3.1.5.2 Manually Creating Migration Files" title="Direct link to 3.1.5.2 Manually Creating Migration Files">​</a></h5>
<p>Although <code>golang-migrate</code> provides convenient command-line tools to create migration files, you can also create migration files manually. The steps for manual creation are as follows:</p>
<ol>
<li>Determine the version number and naming convention (such as <code>v0.1.0</code> or <code>000001</code>)</li>
<li>Create corresponding <code>up</code> and <code>down</code> files, named according to the convention</li>
<li>Write the upgrade and rollback SQL scripts</li>
</ol>
<blockquote>
<p>Note: Regardless of which naming method you choose, it's important to maintain consistency within the project. The <code>golang-migrate</code> tool will determine the execution order based on the dictionary order of the file name prefixes, so the naming convention must ensure the correct execution order.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=316-writing-migration-scripts>3.1.6 Writing Migration Scripts<a href=#316-writing-migration-scripts class=hash-link aria-label="Direct link to 3.1.6 Writing Migration Scripts" title="Direct link to 3.1.6 Writing Migration Scripts">​</a></h4>
<p>Upgrade script (<code>000003_add_login_history_table.up.sql</code>):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> login_history </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    id </span><span class="token keyword" style=color:#66d9ef>BIGINT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>UNSIGNED</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>AUTO_INCREMENT</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    user_id </span><span class="token keyword" style=color:#66d9ef>BIGINT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>UNSIGNED</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'User ID'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    login_time </span><span class="token keyword" style=color:#66d9ef>DATETIME</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Login time'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    ip </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>50</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Login IP'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    device </span><span class="token keyword" style=color:#66d9ef>VARCHAR</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token number" style=color:#ae81ff>200</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'Login device'</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    created_at </span><span class="token keyword" style=color:#66d9ef>DATETIME</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CURRENT_TIMESTAMP</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">id</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>INDEX</span><span class="token plain"> idx_user_id </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">user_id</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#66d9ef>INDEX</span><span class="token plain"> idx_login_time </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain">login_time</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>ENGINE</span><span class="token operator" style=color:#66d9ef>=</span><span class="token keyword" style=color:#66d9ef>InnoDB</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>CHARSET</span><span class="token operator" style=color:#66d9ef>=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style=color:#66d9ef>COMMENT</span><span class="token operator" style=color:#66d9ef>=</span><span class="token string" style=color:#a6e22e>'User login history'</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Rollback script (<code>000003_add_login_history_table.down.sql</code>):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>DROP</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>TABLE</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>IF</span><span class="token plain"> </span><span class="token keyword" style=color:#66d9ef>EXISTS</span><span class="token plain"> login_history</span><span class="token punctuation" style=color:#f8f8f2>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=317-command-line-usage>3.1.7 Command Line Usage<a href=#317-command-line-usage class=hash-link aria-label="Direct link to 3.1.7 Command Line Usage" title="Direct link to 3.1.7 Command Line Usage">​</a></h4>
<p><code>golang-migrate</code> provides a simple and easy-to-use command-line tool that can be used in any project, independent of specific programming languages or frameworks:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#8292a2;font-style:italic># Create new migration scripts</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">migrate create </span><span class="token parameter variable" style=color:#f8f8f2>-ext</span><span class="token plain"> sql </span><span class="token parameter variable" style=color:#f8f8f2>-dir</span><span class="token plain"> migrations/mysql </span><span class="token parameter variable" style=color:#f8f8f2>-seq</span><span class="token plain"> create_users_table</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Execute upgrade migration</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">migrate </span><span class="token parameter variable" style=color:#f8f8f2>-path</span><span class="token plain"> migrations/mysql </span><span class="token parameter variable" style=color:#f8f8f2>-database</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"mysql://user:password@tcp(localhost:3306)/dbname?multiStatements=true"</span><span class="token plain"> up</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Roll back the most recent migration</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">migrate </span><span class="token parameter variable" style=color:#f8f8f2>-path</span><span class="token plain"> migrations/mysql </span><span class="token parameter variable" style=color:#f8f8f2>-database</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"mysql://user:password@tcp(localhost:3306)/dbname?multiStatements=true"</span><span class="token plain"> down </span><span class="token number" style=color:#ae81ff>1</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Roll back to a specific version</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">migrate </span><span class="token parameter variable" style=color:#f8f8f2>-path</span><span class="token plain"> migrations/mysql </span><span class="token parameter variable" style=color:#f8f8f2>-database</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"mysql://user:password@tcp(localhost:3306)/dbname?multiStatements=true"</span><span class="token plain"> goto </span><span class="token number" style=color:#ae81ff>20230101120000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># Force set version (used after migration errors)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">migrate </span><span class="token parameter variable" style=color:#f8f8f2>-path</span><span class="token plain"> migrations/mysql </span><span class="token parameter variable" style=color:#f8f8f2>-database</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"mysql://user:password@tcp(localhost:3306)/dbname?multiStatements=true"</span><span class="token plain"> force </span><span class="token number" style=color:#ae81ff>20230101120000</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#8292a2;font-style:italic># View current version</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">migrate </span><span class="token parameter variable" style=color:#f8f8f2>-path</span><span class="token plain"> migrations/mysql </span><span class="token parameter variable" style=color:#f8f8f2>-database</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"mysql://user:password@tcp(localhost:3306)/dbname?multiStatements=true"</span><span class="token plain"> version</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>For more usage methods, please refer to the <code>golang-migrate</code> project official website.</p>
</blockquote>
<p>This command-line usage can be integrated into any project's build or deployment scripts, such as <code>Makefile</code>, <code>shell</code> scripts, <code>CI/CD</code> processes, etc.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=318-programmatic-usage-in-go-projects>3.1.8 Programmatic Usage in Go Projects<a href=#318-programmatic-usage-in-go-projects class=hash-link aria-label="Direct link to 3.1.8 Programmatic Usage in Go Projects" title="Direct link to 3.1.8 Programmatic Usage in Go Projects">​</a></h4>
<p>For <code>Go</code> language projects, <code>golang-migrate</code> also provides a library that can be directly imported and used in code, making it possible to automatically execute migrations when the application starts:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-go codeBlock_bY9V thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_e6Vv><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#66d9ef>package</span><span class="token plain"> main</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token string" style=color:#a6e22e>"fmt"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token string" style=color:#a6e22e>"log"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token string" style=color:#a6e22e>"github.com/golang-migrate/migrate/v4"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// Import required database drivers</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token boolean" style=color:#ae81ff>_</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"github.com/golang-migrate/migrate/v4/database/mysql"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// Import migration file source</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token boolean" style=color:#ae81ff>_</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>"github.com/golang-migrate/migrate/v4/source/file"</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#66d9ef>func</span><span class="token plain"> </span><span class="token function" style=color:#e6db74>main</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// Create migrate instance</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	m</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> migrate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>New</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">		</span><span class="token string" style=color:#a6e22e>"file://./migrations/mysql"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">		</span><span class="token string" style=color:#a6e22e>"mysql://user:password@tcp(localhost:3306)/dbname?multiStatements=true"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">		log</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Fatalf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Failed to create migrate instance: %v"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// Execute all upgrade migrations</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> m</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Up</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token punctuation" style=color:#f8f8f2>;</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> migrate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ErrNoChange </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">		log</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Fatalf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Failed to execute migration: %v"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// Get current version</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	version</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dirty</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>:=</span><span class="token plain"> m</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Version</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token keyword" style=color:#66d9ef>if</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> </span><span class="token boolean" style=color:#ae81ff>nil</span><span class="token plain"> </span><span class="token operator" style=color:#66d9ef>&&</span><span class="token plain"> err </span><span class="token operator" style=color:#66d9ef>!=</span><span class="token plain"> migrate</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token plain">ErrNilVersion </span><span class="token punctuation" style=color:#f8f8f2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">		log</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Fatalf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Failed to get version: %v"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> err</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token punctuation" style=color:#f8f8f2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	fmt</span><span class="token punctuation" style=color:#f8f8f2>.</span><span class="token function" style=color:#e6db74>Printf</span><span class="token punctuation" style=color:#f8f8f2>(</span><span class="token string" style=color:#a6e22e>"Current database version: %d, Is in dirty state: %t\n"</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> version</span><span class="token punctuation" style=color:#f8f8f2>,</span><span class="token plain"> dirty</span><span class="token punctuation" style=color:#f8f8f2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">	</span><span class="token comment" style=color:#8292a2;font-style:italic>// Other application initialization code...</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#f8f8f2>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This method has the advantage of binding migrations to the application's lifecycle, ensuring that the database structure is always up-to-date when the application starts. However, this method is only applicable to <code>Go</code> projects; for projects in other languages, the command-line method is still needed.</p>
<blockquote>
<p>Note: Regardless of which method is used, <code>golang-migrate</code> maintains its language and framework independence. Even when used in <code>Go</code> projects via the <code>import</code> method, its migration files and version management mechanism remain universal and can be used by projects in other languages or command-line tools.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=32-sql-statement-execution-audit-tools>3.2 SQL Statement Execution Audit Tools<a href=#32-sql-statement-execution-audit-tools class=hash-link aria-label="Direct link to 3.2 SQL Statement Execution Audit Tools" title="Direct link to 3.2 SQL Statement Execution Audit Tools">​</a></h3>
<p>In production environment database change management, code developers usually do not have permission to directly execute SQL statements in the production environment. At this point, SQL submission, review, and execution tools are needed to standardize the release process. These tools can be used in conjunction with SQL migration tools to form a complete database change management process.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=321-necessity-of-sql-audit-tools>3.2.1 Necessity of SQL Audit Tools<a href=#321-necessity-of-sql-audit-tools class=hash-link aria-label="Direct link to 3.2.1 Necessity of SQL Audit Tools" title="Direct link to 3.2.1 Necessity of SQL Audit Tools">​</a></h4>
<ol>
<li><strong>Security</strong>: Prevent risky SQL statements from being directly executed in the production environment</li>
<li><strong>Standardization</strong>: Enforce team SQL writing standards to ensure code quality</li>
<li><strong>Auditability</strong>: Record the reviewer, executor, and execution time of all SQL changes</li>
<li><strong>Separation of Duties</strong>: Implement separation of responsibilities between developers, reviewers, and executors</li>
<li><strong>Performance Optimization</strong>: Discover and optimize inefficient SQL statements before execution</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=322-common-sql-audit-tools>3.2.2 Common SQL Audit Tools<a href=#322-common-sql-audit-tools class=hash-link aria-label="Direct link to 3.2.2 Common SQL Audit Tools" title="Direct link to 3.2.2 Common SQL Audit Tools">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3221-archery>3.2.2.1 Archery<a href=#3221-archery class=hash-link aria-label="Direct link to 3.2.2.1 Archery" title="Direct link to 3.2.2.1 Archery">​</a></h5>
<p><img decoding=async loading=lazy alt="alt text" src=/en/assets/images/image-2-cb07e11c253726314e975ba3fd1fb7c2.png width=2764 height=1378 class=img_ev3q></p>
<p><a href=https://github.com/hhyo/Archery target=_blank rel="noopener noreferrer">Archery</a> is an open-source SQL audit and SQL management tool maintained by domestic developers with the following features:</p>
<ul>
<li>Support for multiple databases: MySQL, Oracle, SQLServer, PostgreSQL, MongoDB, Redis, etc.</li>
<li>Comprehensive SQL audit functionality: Support for using Inception, SOAR, SQLAdvisor, and other audit engines</li>
<li>Work order process: Implement a complete submission-review-execution process</li>
<li>Permission management: Fine-grained permission control system</li>
<li>Database monitoring: Integrated monitoring of database instances, slow queries, etc.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3222-bytebase>3.2.2.2 Bytebase<a href=#3222-bytebase class=hash-link aria-label="Direct link to 3.2.2.2 Bytebase" title="Direct link to 3.2.2.2 Bytebase">​</a></h5>
<p><img decoding=async loading=lazy alt="alt text" src=/en/assets/images/image-9b453e6d4c94f39059ad4bbca3c5f4f4.png width=2952 height=1356 class=img_ev3q></p>
<p><a href=https://github.com/bytebase/bytebase target=_blank rel="noopener noreferrer">Bytebase</a> is a modern database DevOps and change management tool with features including:</p>
<ul>
<li>Intuitive Web UI: Provides a GitHub-like interface experience</li>
<li>GitOps integration: Can integrate with Git repositories to implement version control of database changes</li>
<li>SQL audit: Built-in multiple SQL audit rules</li>
<li>Environment management: Support for management of multiple environments such as development, testing, production, etc.</li>
<li>Visual database schema management</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=3223-yearning>3.2.2.3 Yearning<a href=#3223-yearning class=hash-link aria-label="Direct link to 3.2.2.3 Yearning" title="Direct link to 3.2.2.3 Yearning">​</a></h5>
<p><img decoding=async loading=lazy alt="alt text" src=/en/assets/images/image-1-a702138bcc9c72e42467e3f8f88dc8a4.png width=3560 height=1750 class=img_ev3q></p>
<p><a href=https://github.com/cookieY/Yearning target=_blank rel="noopener noreferrer">Yearning</a> is a domestic MySQL audit platform with the following features:</p>
<ul>
<li>Lightweight: Simple deployment, low resource consumption</li>
<li>Comprehensive audit process: Support for multi-person review, review comments, etc.</li>
<li>Built-in audit rules: Contains common SQL audit rules</li>
<li>Permission management: Fine-grained permission control</li>
<li>Support for scheduled tasks and batch execution</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=323-integration-with-sql-migration-tools>3.2.3 Integration with SQL Migration Tools<a href=#323-integration-with-sql-migration-tools class=hash-link aria-label="Direct link to 3.2.3 Integration with SQL Migration Tools" title="Direct link to 3.2.3 Integration with SQL Migration Tools">​</a></h4>
<p>Combining SQL audit tools with SQL migration tools can implement a complete database change management process:</p>
<ol>
<li>
<p><strong>Development Phase</strong>: Developers use SQL migration tools (such as <code>golang-migrate</code>) to write change scripts</p>
</li>
<li>
<p><strong>Code Review</strong>: Ensure the quality of migration scripts through code review</p>
</li>
<li>
<p><strong>Submit for Review</strong>: Submit migration scripts to the SQL audit platform (such as <code>Archery</code>, <code>Bytebase</code>)</p>
</li>
<li>
<p><strong>Automatic Audit</strong>: SQL audit platform automatically checks if SQL statements comply with standards</p>
</li>
<li>
<p><strong>Manual Review</strong>: DBA or senior developers review the changes</p>
</li>
<li>
<p><strong>Execute Changes</strong>: After review approval, authorized personnel execute the changes</p>
</li>
<li>
<p><strong>Record and Track</strong>: All change operations are recorded and can be tracked</p>
</li>
</ol>
<p>This integration method combines the version control capabilities of SQL migration tools with the security guarantee capabilities of SQL audit tools, particularly suitable for strict enterprise-level production environments.</p>
<p>Regardless of which migration tool is chosen, a series of best practices need to be followed to ensure the safety, reliability, and maintainability of database changes. Below are our summarized best practice recommendations for database migration and version management.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=4-best-practice-recommendations>4. Best Practice Recommendations<a href=#4-best-practice-recommendations class=hash-link aria-label="Direct link to 4. Best Practice Recommendations" title="Direct link to 4. Best Practice Recommendations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=41-migration-script-naming-conventions>4.1 Migration Script Naming Conventions<a href=#41-migration-script-naming-conventions class=hash-link aria-label="Direct link to 4.1 Migration Script Naming Conventions" title="Direct link to 4.1 Migration Script Naming Conventions">​</a></h3>
<ul>
<li>Use sequence number prefixes to ensure execution order</li>
<li>Use descriptive names to explain the content of changes</li>
<li>Distinguish between <code>up</code> (upgrade) and <code>down</code> (rollback) scripts</li>
<li>Standardize naming conventions within the team to ensure consistency</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=42-migration-content-standards>4.2 Migration Content Standards<a href=#42-migration-content-standards class=hash-link aria-label="Direct link to 4.2 Migration Content Standards" title="Direct link to 4.2 Migration Content Standards">​</a></h3>
<ul>
<li>Each migration should be atomic, focusing on one change</li>
<li>Ensure each migration has a corresponding rollback script</li>
<li>Avoid including large amounts of data operations in migrations; data migration should be separate from structural changes</li>
<li>For structural changes to large tables, consider using online DDL tools</li>
<li>Add comments in migration scripts explaining the purpose and impact of changes</li>
<li>Avoid using database-specific features to ensure portability</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=43-environment-management>4.3 Environment Management<a href=#43-environment-management class=hash-link aria-label="Direct link to 4.3 Environment Management" title="Direct link to 4.3 Environment Management">​</a></h3>
<ul>
<li>Development environments can be frequently reset and re-migrated</li>
<li>Test environments should simulate the migration process of production environments</li>
<li>Database backups must be made before production environment migrations</li>
<li>Consider using blue-green deployment or canary release strategies for production environment migrations</li>
<li>Establish environment-specific migration configurations, such as development, testing, pre-production, and production environments</li>
<li>Before executing migrations in the production environment, conduct complete testing in the pre-production environment</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=5-conclusion>5. Conclusion<a href=#5-conclusion class=hash-link aria-label="Direct link to 5. Conclusion" title="Direct link to 5. Conclusion">​</a></h2>
<p>Database migration and version management are indispensable parts of modern software development. By adopting appropriate migration strategies and tools, team collaboration efficiency can be significantly improved, problems caused by environmental differences can be reduced, and continuous integration and continuous deployment processes can be supported.</p>
<p>This article introduced multiple database migration management methods, from manual SQL script management to professional migration tools, and particularly recommended the <code>golang-migrate</code> tool as a language-independent universal solution. At the same time, we also introduced the importance of SQL audit tools in production environments and how to combine them with migration tools.</p>
<p>For projects using the <code>Go</code> language, it is recommended to use the <code>golang-migrate</code> tool for database migration management, which provides powerful version control features, supports upgrade and rollback operations, and can be seamlessly integrated into existing projects. Its command-line tools and programmatic API allow it to flexibly adapt to different project requirements and development processes.</p>
<p>Regardless of which migration tool is chosen, the key is to establish a standardized process and best practices to ensure that database changes are traceable, repeatable, and reliable, thereby supporting rapid iteration and development of the business. As the project scale grows and complexity increases, a sound database migration strategy will become a key factor in maintaining system stability and maintainability.</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href="https://github.com/gogf/gf-site/blob/main/docs/community/社区投稿/SQL Migrate数据库迁移与版本管理：管理数据库结构变更的有效方法.md" target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-05-05T04:05:25.000Z itemprop=dateModified>May 5, 2025</time></b> by <b>John</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/en/articles/when-to-use-panic-in-go><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>When to Use Panic? Deep Dive into Go Error Handling Best Practices</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/en/articles/techempower-web-benchmarks-r23><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>TechEmpower Web Benchmarks Latest Performance Evaluation</div></a></nav><div class=docusaurus-mt-lg></div></div></div><div class="col col--3"><div class=tocContainer_PXzm><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-business-scenarios-and-necessity-of-database-migration-and-version-management class="table-of-contents__link toc-highlight">1. Business Scenarios and Necessity of Database Migration and Version Management</a><ul><li><a href=#11-common-business-scenarios class="table-of-contents__link toc-highlight">1.1 Common Business Scenarios</a><li><a href=#12-necessity-of-database-migration-management class="table-of-contents__link toc-highlight">1.2 Necessity of Database Migration Management</a></ul><li><a href=#2-common-methods-for-database-migration-and-version-management class="table-of-contents__link toc-highlight">2. Common Methods for Database Migration and Version Management</a><ul><li><a href=#21-manual-execution-of-sql-scripts class="table-of-contents__link toc-highlight">2.1 Manual Execution of SQL Scripts</a><li><a href=#22-version-based-sql-script-management class="table-of-contents__link toc-highlight">2.2 Version-based SQL Script Management</a><li><a href=#23-orm-framework-built-in-migration-features class="table-of-contents__link toc-highlight">2.3 ORM Framework Built-in Migration Features</a><li><a href=#24-professional-database-migration-tools class="table-of-contents__link toc-highlight">2.4 Professional Database Migration Tools</a></ul><li><a href=#3-recommended-database-migration-and-version-management-methods class="table-of-contents__link toc-highlight">3. Recommended Database Migration and Version Management Methods</a><ul><li><a href=#31-sql-migration-version-management-tools class="table-of-contents__link toc-highlight">3.1 SQL Migration Version Management Tools</a><li><a href=#32-sql-statement-execution-audit-tools class="table-of-contents__link toc-highlight">3.2 SQL Statement Execution Audit Tools</a></ul><li><a href=#4-best-practice-recommendations class="table-of-contents__link toc-highlight">4. Best Practice Recommendations</a><ul><li><a href=#41-migration-script-naming-conventions class="table-of-contents__link toc-highlight">4.1 Migration Script Naming Conventions</a><li><a href=#42-migration-content-standards class="table-of-contents__link toc-highlight">4.2 Migration Content Standards</a><li><a href=#43-environment-management class="table-of-contents__link toc-highlight">4.3 Environment Management</a></ul><li><a href=#5-conclusion class="table-of-contents__link toc-highlight">5. Conclusion</a></ul></div><div class=tocAdBanner_imxD></div></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Follow Us On WeChat</div><ul class="footer__items clean-list"><li class=footer__item><img src=/img/wechat.jpg width=110></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright ©2024 GoFrame OpenSource Team</div></div></div></footer></div>