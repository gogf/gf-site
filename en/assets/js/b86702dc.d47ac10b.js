"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["51939"],{546649:function(e,n,t){t.r(n),t.d(n,{metadata:()=>a,contentTitle:()=>i,default:()=>u,assets:()=>s,toc:()=>c,frontMatter:()=>o});var a=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C/ORM\u94FE\u5F0F\u64CD\u4F5C-\u66F4\u65B0\u5220\u9664","title":"ORM Model - Update/Delete","description":"Performing ORM chaining operations for data update and delete in the GoFrame framework. Emphasizes the importance of using the Update and Delete methods with Where conditions. Additionally, explores the feature of using Counter parameters to increase or decrease field values, and using the Increment and Decrement methods for field operations. It also explains techniques for embedding native SQL statements and implementing soft delete to ensure flexibility and security in data processing.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C/ORM\u94FE\u5F0F\u64CD\u4F5C-\u66F4\u65B0\u5220\u9664.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C","slug":"/docs/core/gdb-chaining-update-delete","permalink":"/en/docs/core/gdb-chaining-update-delete","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C/ORM\u94FE\u5F0F\u64CD\u4F5C-\u66F4\u65B0\u5220\u9664.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732541616000,"sidebarPosition":2,"frontMatter":{"slug":"/docs/core/gdb-chaining-update-delete","title":"ORM Model - Update/Delete","sidebar_position":2,"hide_title":true,"keywords":["GoFrame","GoFrame framework","ORM chaining operations","data update","data delete","Counter feature","increment operation","decrement operation","RawSQL","soft delete"],"description":"Performing ORM chaining operations for data update and delete in the GoFrame framework. Emphasizes the importance of using the Update and Delete methods with Where conditions. Additionally, explores the feature of using Counter parameters to increase or decrease field values, and using the Increment and Decrement methods for field operations. It also explains techniques for embedding native SQL statements and implementing soft delete to ensure flexibility and security in data processing."},"sidebar":"mainSidebar","previous":{"title":"ORM Model - Insert/Save","permalink":"/en/docs/core/gdb-chaining-insert-save"},"next":{"title":"ORM Model - Query","permalink":"/en/docs/core/gdb-chaining-query"}}'),d=t("785893"),r=t("250065");let o={slug:"/docs/core/gdb-chaining-update-delete",title:"ORM Model - Update/Delete",sidebar_position:2,hide_title:!0,keywords:["GoFrame","GoFrame framework","ORM chaining operations","data update","data delete","Counter feature","increment operation","decrement operation","RawSQL","soft delete"],description:"Performing ORM chaining operations for data update and delete in the GoFrame framework. Emphasizes the importance of using the Update and Delete methods with Where conditions. Additionally, explores the feature of using Counter parameters to increase or decrease field values, and using the Increment and Decrement methods for field operations. It also explains techniques for embedding native SQL statements and implementing soft delete to ensure flexibility and security in data processing."},i=void 0,s={},c=[{value:"<code>Update</code> Method",id:"update-method",level:2},{value:"<code>Counter</code> Update Feature",id:"counter-update-feature",level:2},{value:"<code>Increment/Decrement</code>",id:"incrementdecrement",level:2},{value:"<code>RawSQL</code> Statement Embedding",id:"rawsql-statement-embedding",level:2},{value:"<code>Delete</code> Method",id:"delete-method",level:2},{value:"Soft Delete Feature",id:"soft-delete-feature",level:2}];function l(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.admonition,{type:"warning",children:(0,d.jsxs)(n.p,{children:["For security assurance and to prevent mistakes, the ",(0,d.jsx)(n.code,{children:"Update"})," and ",(0,d.jsx)(n.code,{children:"Delete"})," methods must have ",(0,d.jsx)(n.code,{children:"Where"})," conditions to be executed; otherwise, an error will return with a message like: ",(0,d.jsx)(n.code,{children:"there should be WHERE condition statement for XXX operation"}),". ",(0,d.jsx)(n.code,{children:"goframe"})," is an enterprise-grade framework with rigorous module design and detailed handling of engineering practices."]})}),"\n",(0,d.jsxs)(n.h2,{id:"update-method",children:[(0,d.jsx)(n.code,{children:"Update"})," Method"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Update"})," is used for data updates and often needs to be used in conjunction with ",(0,d.jsx)(n.code,{children:"Data"})," and ",(0,d.jsx)(n.code,{children:"Where"})," methods. The ",(0,d.jsx)(n.code,{children:"Data"})," method specifies the data to be updated, while the ",(0,d.jsx)(n.code,{children:"Where"})," method specifies the condition range for the update. The ",(0,d.jsx)(n.code,{children:"Update"})," method also supports directly passing data and condition parameters."]}),"\n",(0,d.jsx)(n.p,{children:"Example usage:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// UPDATE `user` SET `name`=\'john guo\' WHERE name=\'john\'\ng.Model("user").Data(g.Map{"name" : "john guo"}).Where("name", "john").Update()\ng.Model("user").Data("name=\'john guo\'").Where("name", "john").Update()\n\n// UPDATE `user` SET `status`=1 WHERE `status`=0 ORDER BY `login_time` asc LIMIT 10\ng.Model("user").Data("status", 1).Order("login_time asc").Where("status", 0).Limit(10).Update()\n\n// UPDATE `user` SET `status`=1 WHERE 1\ng.Model("user").Data("status=1").Where(1).Update()\ng.Model("user").Data("status", 1).Where(1).Update()\ng.Model("user").Data(g.Map{"status" : 1}).Where(1).Update()\n'})}),"\n",(0,d.jsxs)(n.p,{children:["You can also directly pass ",(0,d.jsx)(n.code,{children:"data"})," and ",(0,d.jsx)(n.code,{children:"where"})," parameters to the ",(0,d.jsx)(n.code,{children:"Update"})," method:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// UPDATE `user` SET `name`=\'john guo\' WHERE name=\'john\'\ng.Model("user").Update(g.Map{"name" : "john guo"}, "name", "john")\ng.Model("user").Update("name=\'john guo\'", "name", "john")\n\n// UPDATE `user` SET `status`=1 WHERE 1\ng.Model("user").Update("status=1", 1)\ng.Model("user").Update(g.Map{"status" : 1}, 1)\n'})}),"\n",(0,d.jsxs)(n.h2,{id:"counter-update-feature",children:[(0,d.jsx)(n.code,{children:"Counter"})," Update Feature"]}),"\n",(0,d.jsxs)(n.p,{children:["You can use the ",(0,d.jsx)(n.code,{children:"Counter"})," type parameter to numerically operate on specific fields, such as increasing and decreasing."]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Counter"})," data structure definition:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:"// Counter is the type for update count.\ntype Counter struct {\n    Field string\n    Value float64\n}\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Example using ",(0,d.jsx)(n.code,{children:"Counter"})," for field increment:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'updateData := g.Map{\n    "views": &gdb.Counter{\n        Field: "views",\n        Value: 1,\n    },\n}\n// UPDATE `article` SET `views`=`views`+1 WHERE `id`=1\nresult, err := db.Update("article", updateData, "id", 1)\n'})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Counter"})," can also be used for incrementing by a non-own field, for example:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'updateData := g.Map{\n    "views": &gdb.Counter{\n        Field: "clicks",\n        Value: 1,\n    },\n}\n// UPDATE `article` SET `views`=`clicks`+1 WHERE `id`=1\nresult, err := db.Update("article", updateData, "id", 1)\n'})}),"\n",(0,d.jsx)(n.h2,{id:"incrementdecrement",children:(0,d.jsx)(n.code,{children:"Increment/Decrement"})}),"\n",(0,d.jsxs)(n.p,{children:["We can use the ",(0,d.jsx)(n.code,{children:"Increment"})," and ",(0,d.jsx)(n.code,{children:"Decrement"})," methods to perform commonly used operations for incrementing/decrementing specified fields. The definitions for the two methods are as follows:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:"// Increment increments a column's value by a given amount.\nfunc (m *Model) Increment(column string, amount float64) (sql.Result, error)\n\n// Decrement decrements a column's value by a given amount.\nfunc (m *Model) Decrement(column string, amount float64) (sql.Result, error)\n"})}),"\n",(0,d.jsx)(n.p,{children:"Example usage:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// UPDATE `article` SET `views`=`views`+10000 WHERE `id`=1\ng.Model("article").Where("id", 1).Increment("views", 10000)\n// UPDATE `article` SET `views`=`views`-10000 WHERE `id`=1\ng.Model("article").Where("id", 1).Decrement("views", 10000)\n'})}),"\n",(0,d.jsxs)(n.h2,{id:"rawsql-statement-embedding",children:[(0,d.jsx)(n.code,{children:"RawSQL"})," Statement Embedding"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"gdb.Raw"})," is a string type, and the parameter of this type will be directly embedded as an ",(0,d.jsx)(n.code,{children:"SQL"})," fragment into the SQL statement submitted to the underlying layer. It will not be automatically converted to a string parameter type, nor treated as a pre-processing parameter. For more detailed introduction, please refer to the chapter: ",(0,d.jsx)(n.a,{href:"/en/docs/core/gdb-senior-raw-sql",children:"ORM Senior - RawSQL"}),". For example:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// UPDATE `user` SET login_count=\'login_count+1\',update_time=\'now()\' WHERE id=1\ng.Model("user").Data(g.Map{\n    "login_count": "login_count+1",\n    "update_time": "now()",\n}).Where("id", 1).Update()\n// Execution error: Error Code: 1136. Column count doesn\'t match value count at row 1\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Revised with ",(0,d.jsx)(n.code,{children:"gdb.Raw"}),":"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// UPDATE `user` SET login_count=login_count+1,update_time=now() WHERE id=1\ng.Model("user").Data(g.Map{\n    "login_count": gdb.Raw("login_count+1"),\n    "update_time": gdb.Raw("now()"),\n}).Where("id", 1).Update()\n'})}),"\n",(0,d.jsxs)(n.h2,{id:"delete-method",children:[(0,d.jsx)(n.code,{children:"Delete"})," Method"]}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"Delete"})," method is used for data deletion."]}),"\n",(0,d.jsx)(n.p,{children:"Example usage:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// DELETE FROM `user` WHERE uid=10\ng.Model("user").Where("uid", 10).Delete()\n// DELETE FROM `user` ORDER BY `login_time` asc LIMIT 10\ng.Model("user").Order("login_time asc").Limit(10).Delete()\n'})}),"\n",(0,d.jsxs)(n.p,{children:["You can also directly pass ",(0,d.jsx)(n.code,{children:"where"})," parameters to the ",(0,d.jsx)(n.code,{children:"Delete"})," method:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'// DELETE FROM `user` WHERE `uid`=10\ng.Model("user").Delete("uid", 10)\n// DELETE FROM `user` WHERE `score`<60\ng.Model("user").Delete("score < ", 60)\n'})}),"\n",(0,d.jsx)(n.h2,{id:"soft-delete-feature",children:"Soft Delete Feature"}),"\n",(0,d.jsxs)(n.p,{children:["For soft delete feature details, please refer to the chapter: ",(0,d.jsx)(n.a,{href:"/en/docs/core/gdb-chaining-soft-time",children:"ORM Model - Time Fields"})]})]})}function u(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return i},a:function(){return o}});var a=t(667294);let d={},r=a.createContext(d);function o(e){let n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);