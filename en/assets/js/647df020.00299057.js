"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["71214"],{573686:function(e,t,n){n.r(t),n.d(t,{metadata:()=>o,contentTitle:()=>i,default:()=>u,assets:()=>a,toc:()=>l,frontMatter:()=>c});var o=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u4E0A\u4E0B\u6587\u53D8\u91CF","title":"ORM - Context","description":"How to support custom context variables through ORM in the GoFrame framework to achieve asynchronous IO control, trace, nested transactions, etc. With the Ctx method, developers can easily pass custom context variables to achieve more complex request control and tracing. The article provides specific examples and recommendations for request timeout control and model context operations.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u4E0A\u4E0B\u6587\u53D8\u91CF.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM","slug":"/docs/core/gdb-context","permalink":"/en/docs/core/gdb-context","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u4E0A\u4E0B\u6587\u53D8\u91CF.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732541616000,"sidebarPosition":9,"frontMatter":{"slug":"/docs/core/gdb-context","title":"ORM - Context","sidebar_position":9,"hide_title":true,"keywords":["GoFrame","GoFrame Framework","ORM Context Variables","Asynchronous IO Control","Trace","Context Variables","Request Timeout","Nested Transactions","Model Context Operations","ORM Transaction Handling"],"description":"How to support custom context variables through ORM in the GoFrame framework to achieve asynchronous IO control, trace, nested transactions, etc. With the Ctx method, developers can easily pass custom context variables to achieve more complex request control and tracing. The article provides specific examples and recommendations for request timeout control and model context operations."},"sidebar":"mainSidebar","previous":{"title":"ORM Interface - Driver","permalink":"/en/docs/core/gdb-interface-driver"},"next":{"title":"ORM - Best Practices","permalink":"/en/docs/core/gdb-practice"}}'),r=n("785893"),s=n("250065");let c={slug:"/docs/core/gdb-context",title:"ORM - Context",sidebar_position:9,hide_title:!0,keywords:["GoFrame","GoFrame Framework","ORM Context Variables","Asynchronous IO Control","Trace","Context Variables","Request Timeout","Nested Transactions","Model Context Operations","ORM Transaction Handling"],description:"How to support custom context variables through ORM in the GoFrame framework to achieve asynchronous IO control, trace, nested transactions, etc. With the Ctx method, developers can easily pass custom context variables to achieve more complex request control and tracing. The article provides specific examples and recommendations for request timeout control and model context operations."},i=void 0,a={},l=[{value:"Request Timeout Control",id:"request-timeout-control",level:2},{value:"Trace Information",id:"trace-information",level:2},{value:"Model Context Operations",id:"model-context-operations",level:2},{value:"Nested Transaction Support",id:"nested-transaction-support",level:2}];function d(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"ORM"})," supports passing custom ",(0,r.jsx)(t.code,{children:"context"})," variables for asynchronous ",(0,r.jsx)(t.code,{children:"IO"})," control, context information transmission (especially transmission of trace information), and nested transaction support."]}),"\n",(0,r.jsxs)(t.p,{children:["We can pass custom context variables to an ",(0,r.jsx)(t.code,{children:"ORM"})," object using the ",(0,r.jsx)(t.code,{children:"Ctx"})," method. The ",(0,r.jsx)(t.code,{children:"Ctx"})," method is essentially a chainable operation, and the context passed in is only effective for the current ",(0,r.jsx)(t.code,{children:"DB"})," interface object. The method is defined as follows:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"func Ctx(ctx context.Context) DB\n"})}),"\n",(0,r.jsx)(t.h2,{id:"request-timeout-control",children:"Request Timeout Control"}),"\n",(0,r.jsx)(t.p,{children:"Let's look at an example of controlling the request timeout duration using context variables."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'ctx, cancel := context.WithTimeout(context.Background(), time.Second)\ndefer cancel()\n_, err := db.Ctx(ctx).Query("SELECT SLEEP(10)")\nfmt.Println(err)\n'})}),"\n",(0,r.jsxs)(t.p,{children:["In this example, executing ",(0,r.jsx)(t.code,{children:"sleep 10"})," seconds will inevitably cause a timeout. After execution, the output is:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:"context deadline exceeded, SELECT SLEEP(10)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"trace-information",children:"Trace Information"}),"\n",(0,r.jsxs)(t.p,{children:["Context variables can also pass trace information, and when combined with the logging component, can print trace information to logs (only when ",(0,r.jsx)(t.code,{children:"ORM"})," logging is enabled). Please refer to the trace topic chapter: ",(0,r.jsx)(t.a,{href:"/en/docs/obs/tracing",children:"Service Tracing"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"model-context-operations",children:"Model Context Operations"}),"\n",(0,r.jsxs)(t.p,{children:["Model objects also support context variable passing, using the ",(0,r.jsx)(t.code,{children:"Ctx"})," method as well. Let's look at a simple example by modifying the example from the second section using model operations."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n)\n\nfunc main() {\n    _, err := g.DB().Model("user").Ctx(gctx.New()).All()\n    if err != nil {\n        panic(err)\n    }\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"After execution, the terminal output is:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:"2020-12-28 23:46:56.349 [DEBU] {38d45cbf2743db16f1062074f7473e5c} [  5 ms] [default] [rows:0  ] SHOW FULL COLUMNS FROM `user`\n2020-12-28 23:46:56.354 [DEBU] {38d45cbf2743db16f1062074f7473e5c} [  5 ms] [default] [rows:100] SELECT * FROM `user`\n"})}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"SHOW FULL COLUMNS FROM "}),"user`` query is used by the ",(0,r.jsx)(t.code,{children:"ORM"})," component to fetch data table fields, which queries each table only once before execution and caches the results in memory."]})}),"\n",(0,r.jsx)(t.h2,{id:"nested-transaction-support",children:"Nested Transaction Support"}),"\n",(0,r.jsxs)(t.p,{children:["Support for nested transactions relies on hierarchical passing of ",(0,r.jsx)(t.code,{children:"Context"})," variables. For details, please refer to the chapter: ",(0,r.jsx)(t.a,{href:"/en/docs/core/gdb-transaction",children:"ORM - Transaction"}),"."]})]})}function u(e={}){let{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return i},a:function(){return c}});var o=n(667294);let r={},s=o.createContext(r);function c(e){let t=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);