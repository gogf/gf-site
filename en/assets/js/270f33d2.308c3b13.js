"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["35558"],{247534:function(e,n,i){i.r(n),i.d(n,{metadata:()=>t,contentTitle:()=>c,default:()=>h,assets:()=>l,toc:()=>s,frontMatter:()=>a});var t=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406/\u914D\u7F6E\u7BA1\u7406-\u6587\u4EF6\u914D\u7F6E","title":"Configuration - File","description":"The gcfg component in the GoFrame framework supports multiple configuration file formats such as JSON, XML, YAML, etc., and offers flexible directory configuration and hierarchical access capabilities. It uses an interface-based design, allowing configuration items to be dynamically modified through environment variables and command line parameters. The unique caching mechanism and auto-detect update feature ensure configuration efficiency and real-time capability, making it an ideal choice for configuration management.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406/\u914D\u7F6E\u7BA1\u7406-\u6587\u4EF6\u914D\u7F6E.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406","slug":"/docs/core/gcfg-file","permalink":"/en/docs/core/gcfg-file","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406/\u914D\u7F6E\u7BA1\u7406-\u6587\u4EF6\u914D\u7F6E.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732541616000,"sidebarPosition":1,"frontMatter":{"slug":"/docs/core/gcfg-file","title":"Configuration - File","sidebar_position":1,"hide_title":true,"keywords":["GoFrame","GoFrame framework","gcfg","configuration management","file configuration","auto detect update","directory configuration","multi-format support","hierarchical access","caching mechanism"],"description":"The gcfg component in the GoFrame framework supports multiple configuration file formats such as JSON, XML, YAML, etc., and offers flexible directory configuration and hierarchical access capabilities. It uses an interface-based design, allowing configuration items to be dynamically modified through environment variables and command line parameters. The unique caching mechanism and auto-detect update feature ensure configuration efficiency and real-time capability, making it an ideal choice for configuration management."},"sidebar":"mainSidebar","previous":{"title":"Configuration - Object","permalink":"/en/docs/core/gcfg-cfg"},"next":{"title":"Configuration - Methods","permalink":"/en/docs/core/gcfg-funcs"}}'),o=i("785893"),r=i("250065");let a={slug:"/docs/core/gcfg-file",title:"Configuration - File",sidebar_position:1,hide_title:!0,keywords:["GoFrame","GoFrame framework","gcfg","configuration management","file configuration","auto detect update","directory configuration","multi-format support","hierarchical access","caching mechanism"],description:"The gcfg component in the GoFrame framework supports multiple configuration file formats such as JSON, XML, YAML, etc., and offers flexible directory configuration and hierarchical access capabilities. It uses an interface-based design, allowing configuration items to be dynamically modified through environment variables and command line parameters. The unique caching mechanism and auto-detect update feature ensure configuration efficiency and real-time capability, making it an ideal choice for configuration management."},c=void 0,l={},s=[{value:"Configuration File",id:"configuration-file",level:2},{value:"Default Configuration File",id:"default-configuration-file",level:3},{value:"Default File Modification",id:"default-file-modification",level:3},{value:"Configuration Directory",id:"configuration-directory",level:2},{value:"Directory Configuration Method",id:"directory-configuration-method",level:3},{value:"Default Directory Configuration",id:"default-directory-configuration",level:3},{value:"Default Directory Modification",id:"default-directory-modification",level:3},{value:"Content Configuration",id:"content-configuration",level:2},{value:"Hierarchical Access",id:"hierarchical-access",level:2},{value:"Precautions",id:"precautions",level:2},{value:"Detecting Updates",id:"detecting-updates",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"gcfg"})," component uses an interface-based design, with the default implementation based on the file system. Supported data file formats include: ",(0,o.jsx)(n.code,{children:"JSON/XML/YAML(YML)/TOML/INI/PROPERTIES"}),". Developers can flexibly choose their familiar configuration file format for configuration management."]}),"\n",(0,o.jsx)(n.h2,{id:"configuration-file",children:"Configuration File"}),"\n",(0,o.jsx)(n.h3,{id:"default-configuration-file",children:"Default Configuration File"}),"\n",(0,o.jsxs)(n.p,{children:["We recommend using a singleton way to obtain the configuration object. The singleton object will automatically search configuration files according to the file suffix ",(0,o.jsx)(n.code,{children:"toml/yaml/yml/json/ini/xml/properties"}),". By default, it will automatically search and cache configuration files like ",(0,o.jsx)(n.code,{children:"config.toml/yaml/yml/json/ini/xml/properties"}),". When a configuration file is modified externally, it will automatically refresh the cache."]}),"\n",(0,o.jsxs)(n.p,{children:["If you want to customize the file format, you can modify the default configuration file name through the ",(0,o.jsx)(n.code,{children:"SetFileName"})," method (e.g., ",(0,o.jsx)(n.code,{children:"default.yaml"}),", ",(0,o.jsx)(n.code,{children:"default.json"}),", ",(0,o.jsx)(n.code,{children:"default.xml"}),", etc.). For example, we can read the database ",(0,o.jsx)(n.code,{children:"database"})," configuration item from the ",(0,o.jsx)(n.code,{children:"default.yaml"})," file in the following way."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// Set the default configuration file to default.yaml\ng.Cfg().GetAdapter().(*gcfg.AdapterFile).SetFileName("default.yaml")\n\n// Subsequent reads will fetch the content from default.yaml\ng.Cfg().Get(ctx, "database")\n'})}),"\n",(0,o.jsx)(n.h3,{id:"default-file-modification",children:"Default File Modification"}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"The file can be a specific file name or a complete absolute file path."})}),"\n",(0,o.jsx)(n.p,{children:"We can modify the default file name in multiple ways:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Modify through the configuration management method ",(0,o.jsx)(n.code,{children:"SetFileName"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Modify the command line startup parameter - ",(0,o.jsx)(n.code,{children:"gf.gcfg.file"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Modify the specified environment variable - ",(0,o.jsx)(n.code,{children:"GF_GCFG_FILE"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If our executable file is ",(0,o.jsx)(n.code,{children:"main"}),", we can modify the configuration manager's configuration file directory (on ",(0,o.jsx)(n.code,{children:"Linux"}),") in the following way:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Through Singleton Pattern"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'g.Cfg().GetAdapter().(*gcfg.AdapterFile).SetFileName("default.yaml")\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Through Command Line Startup Parameter"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"    ./main --gf.gcfg.file=config.prod.toml\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Through Environment Variable (commonly used in containers)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Modify the environment variable at startup:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"  GF_GCFG_FILE=config.prod.toml; ./main\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Use the ",(0,o.jsx)(n.code,{children:"genv"})," module to modify environment variables:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'  genv.Set("GF_GCFG_FILE", "config.prod.toml")\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"configuration-directory",children:"Configuration Directory"}),"\n",(0,o.jsx)(n.h3,{id:"directory-configuration-method",children:"Directory Configuration Method"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"gcfg"})," configuration manager supports a very flexible multi-directory automatic search function. You can modify the directory management directory to a ",(0,o.jsx)(n.strong,{children:"unique"})," directory address using ",(0,o.jsx)(n.code,{children:"SetPath"}),". Meanwhile, we recommend adding multiple search directories through the ",(0,o.jsx)(n.code,{children:"AddPath"})," method. The configuration manager will automatically search in the order of the added directories by priority. It will stop when a matching file path is found. If no configuration file is found in all search directories, it will return a failure."]}),"\n",(0,o.jsx)(n.h3,{id:"default-directory-configuration",children:"Default Directory Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["When the ",(0,o.jsx)(n.code,{children:"gcfg"})," configuration manager initializes, it automatically adds the following configuration file search directories:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["The current working directory and its ",(0,o.jsx)(n.code,{children:"config"}),", ",(0,o.jsx)(n.code,{children:"manifest/config"})," directories"]}),": For example, when the current working directory is ",(0,o.jsx)(n.code,{children:"/home/www"}),", it will add:","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/home/www"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/home/www/config"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/home/www/manifest/config"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["The directory where the current executable file is located and its ",(0,o.jsx)(n.code,{children:"config"}),", ",(0,o.jsx)(n.code,{children:"manifest/config"})," directories"]}),": For example, when the binary file is located at ",(0,o.jsx)(n.code,{children:"/tmp"}),", it will add:","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/tmp"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/tmp/config"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/tmp/manifest/config"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["The directory where the current ",(0,o.jsx)(n.code,{children:"main"})," source code package is located and its ",(0,o.jsx)(n.code,{children:"config"}),", ",(0,o.jsx)(n.code,{children:"manifest/config"})," directories"]})," (valid for source code development environment only): For example, when the ",(0,o.jsx)(n.code,{children:"main"})," package is located at ",(0,o.jsx)(n.code,{children:"/home/john/workspace/gf-app"}),", it will add:","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/home/john/workspace/gf-app"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/home/john/workspace/gf-app/config"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"/home/john/workspace/gf-app/manifest/config"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"default-directory-modification",children:"Default Directory Modification"}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"Note that the parameter modified here must be a directory, not a file path."})}),"\n",(0,o.jsx)(n.p,{children:"We can modify the configuration file search directory of the configuration manager in the following way. The configuration management object will only perform configuration file searches in the specified directory:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Manually modify it through the configuration manager's ",(0,o.jsx)(n.code,{children:"SetPath"})," method;"]}),"\n",(0,o.jsxs)(n.li,{children:["Modify the command line startup parameter - ",(0,o.jsx)(n.code,{children:"gf.gcfg.path"}),";"]}),"\n",(0,o.jsxs)(n.li,{children:["Modify the specified environment variable - ",(0,o.jsx)(n.code,{children:"GF_GCFG_PATH"}),";"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If our executable file is ",(0,o.jsx)(n.code,{children:"main"}),", we can modify the configuration manager's configuration file directory (under Linux) in the following way:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Through Singleton Pattern"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'g.Cfg().GetAdapter().(*gcfg.AdapterFile).SetPath("/opt/config")\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Through Command Line Startup Parameter"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"    ./main --gf.gcfg.path=/opt/config/\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Through Environment Variable (commonly used in containers)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Modify the environment variable at startup:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"  GF_GCFG_PATH=/opt/config/; ./main\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Use the ",(0,o.jsx)(n.code,{children:"genv"})," module to modify environment variables:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'  genv.Set("GF_GCFG_PATH", "/opt/config")\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"content-configuration",children:"Content Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"gcfg"})," package also supports direct content configuration rather than reading configuration files, which is commonly used for dynamically modifying configuration content internally in programs. Implement global configuration through the package configuration methods below:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func (c *AdapterFile) SetContent(content string, file ...string)\nfunc (c *AdapterFile) GetContent(file ...string) string\nfunc (c *AdapterFile) RemoveContent(file ...string)\nfunc (c *AdapterFile) ClearContent()\n"})}),"\n",(0,o.jsxs)(n.p,{children:["It is important to note that this configuration takes effect globally and has a higher priority than reading from configuration files. Therefore, if we configure the content of ",(0,o.jsx)(n.code,{children:"config.toml"})," through ",(0,o.jsx)(n.code,{children:'SetContent("v = 1", "config.toml")'})," and a ",(0,o.jsx)(n.code,{children:"config.toml"})," file also exists, only the content configured by ",(0,o.jsx)(n.code,{children:"SetContent"})," will be used, and the file content will be ignored."]}),"\n",(0,o.jsx)(n.h2,{id:"hierarchical-access",children:"Hierarchical Access"}),"\n",(0,o.jsxs)(n.p,{children:["With the default file system interface implementation, the ",(0,o.jsx)(n.code,{children:"gcfg"})," component supports accessing configuration data by hierarchy. Hierarchical access is specified by the English ",(0,o.jsx)(n.code,{children:"."})," by default, where the ",(0,o.jsx)(n.code,{children:"pattern"})," parameter is consistent with the ",(0,o.jsx)(n.code,{children:"pattern"})," parameter of ",(0,o.jsx)(n.a,{href:"/en/docs/components/encoding-gjson",children:"General Codec"}),". For example, the following configuration (",(0,o.jsx)(n.code,{children:"config.yaml"}),"):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'server:\n  address:    ":8199"\n  serverRoot: "resource/public"\n\ndatabase:\n  default:\n    link:   "mysql:root:12345678@tcp(127.0.0.1:3306)/focus"\n    debug:  true\n'})}),"\n",(0,o.jsx)(n.p,{children:"For example, hierarchical reading of the above configuration file content:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// :8199\ng.Cfg().Get(ctx, "server.address")\n\n// true\ng.Cfg().Get(ctx, "database.default.debug")\n'})}),"\n",(0,o.jsx)(n.h2,{id:"precautions",children:"Precautions"}),"\n",(0,o.jsxs)(n.p,{children:["As everyone knows, in ",(0,o.jsx)(n.code,{children:"Golang"}),", types like ",(0,o.jsx)(n.code,{children:"map/slice"}),' are actually "reference types" (also called "pointer types"). Therefore, when you modify a key-value pair/index item of this type, it will also modify the corresponding underlying data. From the perspective of efficiency, when some ',(0,o.jsx)(n.code,{children:"gcfg"})," retrieval methods return data types as ",(0,o.jsx)(n.code,{children:"map/slice"}),", they do not perform a value copy. Therefore, when you modify the returned data, it will also modify the corresponding underlying data of ",(0,o.jsx)(n.code,{children:"gcfg"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.p,{children:"Configuration file:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// config.json:\n`{"map":{"key":"value"}, "slice":[59,90]}`\n'})}),"\n",(0,o.jsx)(n.p,{children:"Example code:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'var ctx = gctx.New()\n\nm := g.Cfg().MustGet(ctx, "map").Map()\nfmt.Println(m)\n\n// Change the key-value pair.\nm["key"] = "john"\n\n// It changes the underlying key-value pair.\nfmt.Println(g.Cfg().MustGet(ctx, "map").Map())\n\ns := g.Cfg().MustGet(ctx, "slice").Slice()\nfmt.Println(s)\n\n// Change the value of specified index.\ns[0] = 100\n\n// It changes the underlying slice.\nfmt.Println(g.Cfg().MustGet(ctx, "slice").Slice())\n\n// output:\n// map[key:value]\n// map[key:john]\n// [59 90]\n// [100 90]\n'})}),"\n",(0,o.jsx)(n.h2,{id:"detecting-updates",children:"Detecting Updates"}),"\n",(0,o.jsxs)(n.p,{children:["The configuration manager uses a ",(0,o.jsx)(n.strong,{children:"caching mechanism"}),". When a configuration file is read for the first time, it is cached in memory. The next read will directly fetch it from the cache to improve performance. Meanwhile, the configuration manager provides an ",(0,o.jsx)(n.strong,{children:"auto-detect update mechanism"}),". When the configuration file is modified externally, the configuration manager can immediately refresh the cached content of the configuration file."]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return c},a:function(){return a}});var t=i(667294);let o={},r=t.createContext(o);function a(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);