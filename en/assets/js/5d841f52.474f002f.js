"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["45621"],{846832(e,t,n){n.r(t),n.d(t,{metadata:()=>s,default:()=>u,frontMatter:()=>c,contentTitle:()=>l,toc:()=>d,assets:()=>a});var s=JSON.parse('{"id":"docs/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u5B9A\u65F6\u5668-gtimer/\u5B9A\u65F6\u5668-gtimer","title":"Timer","description":"gtimer is a concurrent safe and high-performance timer suitable for scenarios with a large number of scheduled tasks and delayed tasks. It supports timeout control and frequency control. gtimer provides various task management methods, including adding singleton and run-once tasks, and allows customization of timer parameters.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u5B9A\u65F6\u5668-gtimer/\u5B9A\u65F6\u5668-gtimer.md","sourceDirName":"docs/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u5B9A\u65F6\u5668-gtimer","slug":"/docs/components/os-gtimer","permalink":"/en/docs/components/os-gtimer","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u5B9A\u65F6\u5668-gtimer/\u5B9A\u65F6\u5668-gtimer.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732716970000,"sidebarPosition":1,"frontMatter":{"slug":"/docs/components/os-gtimer","title":"Timer","sidebar_position":1,"hide_title":true,"keywords":["Timer","Concurrent Safe","High Performance","GoFrame","Task Scheduling","Delayed Tasks","Timeout Control","Frequency Control","Task Management","Singleton Mode"],"description":"gtimer is a concurrent safe and high-performance timer suitable for scenarios with a large number of scheduled tasks and delayed tasks. It supports timeout control and frequency control. gtimer provides various task management methods, including adding singleton and run-once tasks, and allows customization of timer parameters."},"sidebar":"mainSidebar","previous":{"title":"Time - Methods","permalink":"/en/docs/components/os-gtime-funcs"},"next":{"title":"Timer - Usage","permalink":"/en/docs/components/os-gtimer-example"}}'),i=n(474848),r=n(28453),o=n(711654);let c={slug:"/docs/components/os-gtimer",title:"Timer",sidebar_position:1,hide_title:!0,keywords:["Timer","Concurrent Safe","High Performance","GoFrame","Task Scheduling","Delayed Tasks","Timeout Control","Frequency Control","Task Management","Singleton Mode"],description:"gtimer is a concurrent safe and high-performance timer suitable for scenarios with a large number of scheduled tasks and delayed tasks. It supports timeout control and frequency control. gtimer provides various task management methods, including adding singleton and run-once tasks, and allows customization of timer parameters."},l,a={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Default Timer",id:"default-timer",level:2},{value:"Precautions\u{1F525}",id:"precautions",level:2},{value:"Difference Between Timer and <code>gcron</code>",id:"difference-between-timer-and-gcron",level:2},{value:"Documentation",id:"documentation",level:2}];function h(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"gtimer"})," is a concurrent safe and high-performance timer, similar to ",(0,i.jsx)(t.code,{children:"Java"}),"'s ",(0,i.jsx)(t.code,{children:"Timer"}),". ",(0,i.jsx)(t.code,{children:"gtimer"})," uses a ",(0,i.jsx)(t.strong,{children:"Priority Queue"})," to implement its core functionality."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsx)(t.p,{children:"Any scenario involving scheduled tasks, scenarios with a large number of scheduled/delayed tasks, business scenarios that require timeout control/frequency control, or scenarios where the accuracy of the scheduled time is not strictly critical."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"How to Use:"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'import "github.com/gogf/gf/v2/os/gtimer"\n'})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"API Documentation"}),":"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://pkg.go.dev/github.com/gogf/gf/v2/os/gtimer",children:"https://pkg.go.dev/github.com/gogf/gf/v2/os/gtimer"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Brief Explanation:"})}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"New"})," method is used to create a custom task timer object and can accept ",(0,i.jsx)(t.code,{children:"TimerOptions"})," parameters upon creation, including:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"Interval"})," to specify the minimum ",(0,i.jsx)(t.code,{children:"tick"})," time interval for the timer."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"Quick"})," to specify whether the timer should execute once upon start (default is ",(0,i.jsx)(t.code,{children:"false"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"Add"})," method is used to add scheduled tasks, where:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"interval"})," parameter specifies the execution time interval of the method."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"job"})," parameter is the task method that needs to be executed."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"AddEntry"})," method adds scheduled tasks, supporting more parameter controls."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"AddSingleton"})," method is used to add ",(0,i.jsx)(t.strong,{children:"singleton"})," scheduled tasks, meaning ",(0,i.jsx)(t.strong,{children:"only one task can be running at the same time"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"AddOnce"})," method is used to add a task that runs only once and is automatically destroyed after running once."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"AddTimes"})," method is used to add a task that runs a specified number of times and is automatically destroyed after running ",(0,i.jsx)(t.code,{children:"times"})," times."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"Search"})," method is used to search for scheduled tasks by name (returns the ",(0,i.jsx)(t.code,{children:"*Entry"})," object pointer of the task)."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"Start"})," method is used to start the timer (the timer is automatically started when created using ",(0,i.jsx)(t.code,{children:"New"}),")."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"Stop"})," method is used to stop the timer."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"Close"})," method is used to close the timer."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"default-timer",children:"Default Timer"}),"\n",(0,i.jsxs)(t.p,{children:["In most scenarios, the default timer can be used. When using the default timer of ",(0,i.jsx)(t.code,{children:"gtimer"}),", the default detection interval is ",(0,i.jsx)(t.code,{children:"100ms"}),", so the theoretical time interval error range is ",(0,i.jsx)(t.code,{children:"0~100ms"}),". You can modify the parameters of the default timer using the following two methods:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Use startup parameters","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"gf.gtimer.interval=50"}),": Change the default time scale to ",(0,i.jsx)(t.code,{children:"50ms"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Use environment variables","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"GF_GTIMER_INTERVAL=50"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"It should be noted that the shorter the default detection interval of the timer, the greater the CPU usage."})}),"\n",(0,i.jsx)(t.h2,{id:"precautions",children:"Precautions\u{1F525}"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Since modern computers use software-implemented timers, ",(0,i.jsx)(t.strong,{children:"all timers have inaccuracies"}),". They will not be completely precise and may delay or even execute ahead of time, but they will not fail to execute. This is particularly noticeable in systems with large time intervals or high concurrency/high load. See the reference link: ",(0,i.jsx)(t.a,{href:"https://github.com/golang/go/issues/14410",children:"https://github.com/golang/go/issues/14410"})]}),"\n",(0,i.jsxs)(t.li,{children:["Since inaccuracies are inevitable, any timer implementation (not just framework timers, but also standard library timers) ",(0,i.jsx)(t.strong,{children:"will not use system time"}),". Instead, it uses a fixed ",(0,i.jsx)(t.code,{children:"tick"})," interval. Do not use system time to judge intervals in the logic of timer tasks, as this judgment is meaningless."]}),"\n",(0,i.jsxs)(t.li,{children:["Assuming no inaccuracies, the time interval does not consider the execution time of the task. For example, if a job takes ",(0,i.jsx)(t.code,{children:"3"})," minutes to complete and is scheduled to run every ",(0,i.jsx)(t.code,{children:"5"})," minutes, there will be only ",(0,i.jsx)(t.code,{children:"2"})," minutes of idle time between each task."]}),"\n",(0,i.jsxs)(t.li,{children:["It should be noted that ",(0,i.jsx)(t.strong,{children:"the execution time of singleton mode"})," scheduled tasks will affect the ",(0,i.jsx)(t.strong,{children:"start time"})," of the task's next execution. For example, if a task runs every ",(0,i.jsx)(t.code,{children:"1"})," second and takes ",(0,i.jsx)(t.code,{children:"1"})," second to execute, then after starting at ",(0,i.jsx)(t.strong,{children:"second 1"}),", the next task will start executing at ",(0,i.jsx)(t.strong,{children:"second 3"})," since a running check in between found the current task still running and thus exited waiting for the next execution check."]}),"\n"]}),"\n",(0,i.jsxs)(t.h2,{id:"difference-between-timer-and-gcron",children:["Difference Between Timer and ",(0,i.jsx)(t.code,{children:"gcron"})]}),"\n",(0,i.jsxs)(t.p,{children:["Please refer to the section ",(0,i.jsx)(t.a,{href:"/en/docs/components/os-gcron-differ-with-gtimer",children:"Cron Job"})]}),"\n",(0,i.jsx)(t.h2,{id:"documentation",children:"Documentation"}),"\n","\n",(0,i.jsx)(o.A,{})]})}function u(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},711654(e,t,n){n.d(t,{A:()=>p});var s=n(474848);n(296540);var i=n(634164),r=n(259829),o=n(525863),c=n(484792),l=n(433605),a=n(233553),d=n(761190);function h({href:e,children:t}){return(0,s.jsx)(o.A,{href:e,className:(0,i.A)("card padding--lg","cardContainer_fWXF"),children:t})}function u({href:e,icon:t,title:n,description:r}){return(0,s.jsxs)(h,{href:e,children:[(0,s.jsxs)(d.A,{as:"h2",className:(0,i.A)("text--truncate","cardTitle_rnsV"),title:n,children:[t," ",n]}),r&&(0,s.jsx)("p",{className:(0,i.A)("text--truncate","cardDescription_PWke"),title:r,children:r})]})}function m({item:e}){let t=(0,r.Nr)(e),n=function(){let{selectMessage:e}=(0,c.W)();return t=>e(t,(0,a.T)({message:"1 item|{count} items",id:"theme.docs.DocCard.categoryDescription.plurals",description:"The default description for a category card in the generated index about how many items this category includes"},{count:t}))}();return t?(0,s.jsx)(u,{href:t,icon:"\u{1F5C3}\uFE0F",title:e.label,description:e.description??n(e.items.length)}):null}function g({item:e}){let t=(0,l.A)(e.href)?"\u{1F4C4}\uFE0F":"\u{1F517}",n=(0,r.cC)(e.docId??void 0);return(0,s.jsx)(u,{href:e.href,icon:t,title:e.label,description:e.description??n?.description})}function f({item:e}){switch(e.type){case"link":return(0,s.jsx)(g,{item:e});case"category":return(0,s.jsx)(m,{item:e});default:throw Error(`unknown item type ${JSON.stringify(e)}`)}}function x({className:e}){let t=(0,r.$S)();return(0,s.jsx)(p,{items:t.items,className:e})}function p(e){let{items:t,className:n}=e;if(!t)return(0,s.jsx)(x,{...e});let o=(0,r.d1)(t);return(0,s.jsx)("section",{className:(0,i.A)("row",n),children:o.map((e,t)=>(0,s.jsx)("article",{className:"col col--6 margin-bottom--lg",children:(0,s.jsx)(f,{item:e})},t))})}},484792(e,t,n){n.d(t,{W:()=>l});var s=n(296540),i=n(719087);let r=["zero","one","two","few","many","other"];function o(e){return r.filter(t=>e.includes(t))}let c={locale:"en",pluralForms:o(["one","other"]),select:e=>1===e?"one":"other"};function l(){let e=function(){let{i18n:{currentLocale:e}}=(0,i.A)();return(0,s.useMemo)(()=>{try{let t;return t=new Intl.PluralRules(e),{locale:e,pluralForms:o(t.resolvedOptions().pluralCategories),select:e=>t.select(e)}}catch(t){return console.error(`Failed to use Intl.PluralRules for locale "${e}".
Docusaurus will fallback to the default (English) implementation.
Error: ${t.message}
`),c}},[e])}();return{selectMessage:(t,n)=>(function(e,t,n){let s=e.split("|");if(1===s.length)return s[0];s.length>n.pluralForms.length&&console.error(`For locale=${n.locale}, a maximum of ${n.pluralForms.length} plural forms are expected (${n.pluralForms.join(",")}), but the message contains ${s.length}: ${e}`);let i=n.select(t);return s[Math.min(n.pluralForms.indexOf(i),s.length-1)]})(n,t,e)}}},28453(e,t,n){n.d(t,{R:()=>o,x:()=>c});var s=n(296540);let i={},r=s.createContext(i);function o(e){let t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);