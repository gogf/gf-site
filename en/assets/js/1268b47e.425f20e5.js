"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["70709"],{721158:function(n,e,t){t.r(e),t.d(e,{metadata:()=>i,contentTitle:()=>g,default:()=>d,assets:()=>r,toc:()=>l,frontMatter:()=>s});var i=JSON.parse('{"id":"\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u6587\u4EF6\u76D1\u63A7-gfsnotify","title":"\u6587\u4EF6\u76D1\u63A7-gfsnotify","description":"gfsnotify \u80FD\u76D1\u63A7\u6307\u5B9A\u6587\u4EF6/\u76EE\u5F55\u7684\u6539\u53D8\uFF0C\u5982\u6587\u4EF6\u7684\u589E\u52A0\u3001\u5220\u9664\u3001\u4FEE\u6539\u3001\u91CD\u547D\u540D\u7B49\u64CD\u4F5C\u3002","source":"@site/versioned_docs/version-2.2.x/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u6587\u4EF6\u76D1\u63A7-gfsnotify.md","sourceDirName":"\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173","slug":"/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u6587\u4EF6\u76D1\u63A7-gfsnotify","permalink":"/en/2.2.x/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u6587\u4EF6\u76D1\u63A7-gfsnotify","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-2.2.x/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u6587\u4EF6\u76D1\u63A7-gfsnotify.md","tags":[],"version":"2.2.x","lastUpdatedBy":"John","lastUpdatedAt":1730365530000,"sidebarPosition":12,"frontMatter":{"title":"\u6587\u4EF6\u76D1\u63A7-gfsnotify","sidebar_position":12,"hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"\u73AF\u5883\u53D8\u91CF-genv","permalink":"/en/2.2.x/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u73AF\u5883\u53D8\u91CF-genv"},"next":{"title":"\u8FDB\u7A0B\u7BA1\u7406-gproc","permalink":"/en/2.2.x/\u7EC4\u4EF6\u5217\u8868/\u7CFB\u7EDF\u76F8\u5173/\u8FDB\u7A0B\u7BA1\u7406-gproc/"}}'),o=t("785893"),c=t("250065");let s={title:"\u6587\u4EF6\u76D1\u63A7-gfsnotify",sidebar_position:12,hide_title:!0},g=void 0,r={},l=[{value:"\u6DFB\u52A0\u76D1\u542C",id:"\u6DFB\u52A0\u76D1\u542C",level:2},{value:"\u79FB\u9664\u76D1\u542C",id:"\u79FB\u9664\u76D1\u542C",level:2},{value:"fs.inotify.max_user_instances\u4E0Efs.inotify.max_user_watches",id:"fsinotifymax_user_instances\u4E0Efsinotifymax_user_watches",level:2}];function f(n){let e={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.a)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"gfsnotify"})," \u80FD\u76D1\u63A7\u6307\u5B9A\u6587\u4EF6/\u76EE\u5F55\u7684\u6539\u53D8\uFF0C\u5982\u6587\u4EF6\u7684\u589E\u52A0\u3001\u5220\u9664\u3001\u4FEE\u6539\u3001\u91CD\u547D\u540D\u7B49\u64CD\u4F5C\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"\u4F7F\u7528\u65B9\u5F0F"}),"\uFF1A"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'import "github.com/gogf/gf/v2/os/gfsnotify"\n'})}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"\u63A5\u53E3\u6587\u6863"}),"\uFF1A"]}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pkg.go.dev/github.com/gogf/gf/v2/os/gfsnotify",children:"https://pkg.go.dev/github.com/gogf/gf/v2/os/gfsnotify"})}),"\n",(0,o.jsxs)(e.p,{children:["\u63A8\u8350\u4F7F\u7528 ",(0,o.jsx)(e.code,{children:"gfsnotify"})," \u6A21\u5757\u63D0\u4F9B\u7684 ",(0,o.jsx)(e.code,{children:"Add"})," \u548C ",(0,o.jsx)(e.code,{children:"Remove"})," \u6A21\u5757\u65B9\u6CD5\uFF0C\u7528\u4E8E\u6DFB\u52A0\u76D1\u63A7\u548C\u53D6\u6D88\u76D1\u63A7\u3002\u63A8\u8350\u539F\u56E0\u89C1\u968F\u540E\u7AE0\u8282\u8BF4\u660E\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u6B64\u5916\u4E5F\u53EF\u80FD\u901A\u8FC7 ",(0,o.jsx)(e.code,{children:"New"})," \u65B9\u6CD5\u521B\u5EFA\u4E00\u4E2A\u76D1\u63A7\u7BA1\u7406\u5BF9\u8C61\u4E4B\u540E\u518D\u8FDB\u884C\u76D1\u63A7\u7BA1\u7406\u3002\u5176\u4E2D\uFF0C\u6DFB\u52A0\u76D1\u63A7\u7684\u65F6\u5019\u9700\u8981\u7ED9\u5B9A\u89E6\u53D1\u76D1\u63A7\u65F6\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u53C2\u6570\u7C7B\u578B\u4E3A ",(0,o.jsx)(e.code,{children:"*gfsnotify.Event"})," \u5BF9\u8C61\u6307\u9488\u3002"]}),"\n",(0,o.jsx)(e.h2,{id:"\u6DFB\u52A0\u76D1\u542C",children:"\u6DFB\u52A0\u76D1\u542C"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/v2/os/gctx"\n    "github.com/gogf/gf/v2/os/gfsnotify"\n    "github.com/gogf/gf/v2/os/glog"\n)\n\nfunc main() {\n    // /home/john/temp \u662F\u4E00\u4E2A\u76EE\u5F55\uFF0C\u5F53\u7136\u4E5F\u53EF\u4EE5\u6307\u5B9A\u6587\u4EF6\n    path := "/home/john/temp"\n    ctx := gctx.New()\n    _, err := gfsnotify.Add(path, func(event *gfsnotify.Event) {\n        if event.IsCreate() {\n            glog.Debug(ctx, "\u521B\u5EFA\u6587\u4EF6 : ", event.Path)\n        }\n        if event.IsWrite() {\n            glog.Debug(ctx, "\u5199\u5165\u6587\u4EF6 : ", event.Path)\n        }\n        if event.IsRemove() {\n            glog.Debug(ctx, "\u5220\u9664\u6587\u4EF6 : ", event.Path)\n        }\n        if event.IsRename() {\n            glog.Debug(ctx, "\u91CD\u547D\u540D\u6587\u4EF6 : ", event.Path)\n        }\n        if event.IsChmod() {\n            glog.Debug(ctx, "\u4FEE\u6539\u6743\u9650 : ", event.Path)\n        }\n        glog.Debug(ctx, event)\n    }, true)\n\n      // \u79FB\u9664\u5BF9\u8BE5path\u7684\u76D1\u542C\n    // gfsnotify.Remove(path)\n\n    if err != nil {\n        glog.Fatal(ctx, err)\n    } else {\n        select {}\n    }\n}\n'})}),"\n",(0,o.jsxs)(e.p,{children:["\u5176\u4E2D ",(0,o.jsx)(e.code,{children:"/home/john"})," \u53C2\u6570\u4E3A\u4E00\u4E2A\u76EE\u5F55\uFF0C ",(0,o.jsx)(e.code,{children:"gfsnotify.Add"})," \u65B9\u6CD5\u9ED8\u8BA4\u4E3A ",(0,o.jsx)(e.strong,{children:"\u9012\u5F52\u76D1\u63A7"}),"\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5F53\u76EE\u5F55\u4E0B\u7684\u6587\u4EF6(\u5305\u62EC\u5B50\u76EE\u5F55\u4E0B\u7684\u6587\u4EF6)\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u4E5F\u4F1A\u6536\u5230\u6587\u4EF6\u76D1\u63A7\u4FE1\u606F\u56DE\u8C03\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u5F53\u6211\u4EEC\u5728 ",(0,o.jsx)(e.code,{children:"/home/john"})," \u76EE\u5F55\u4E0B\u521B\u5EFA/\u5220\u9664/\u4FEE\u6539\u6587\u4EF6\u65F6\uFF0C\u53EF\u4EE5\u770B\u5230 ",(0,o.jsx)(e.code,{children:"gfsnotify"})," \u76D1\u63A7\u5230\u4E86\u6587\u4EF6\u7684\u4FEE\u6539\u5E76\u8F93\u51FA\u4E86\u5BF9\u5E94\u7684\u4E8B\u4EF6\u4FE1\u606F\u3002"]}),"\n",(0,o.jsx)(e.h2,{id:"\u79FB\u9664\u76D1\u542C",children:"\u79FB\u9664\u76D1\u542C"}),"\n",(0,o.jsxs)(e.p,{children:["\u79FB\u9664\u76D1\u542C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 ",(0,o.jsx)(e.code,{children:"Remove"})," \u65B9\u6CD5\uFF0C\u4F1A\u79FB\u9664\u5BF9\u6574\u4E2A\u6587\u4EF6/\u76EE\u5F55\u7684\u76D1\u542C\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u5F53\u5BF9\u540C\u4E00\u4E2A\u6587\u4EF6/\u76EE\u5F55\u5B58\u5728\u591A\u4E2A\u76D1\u542C\u56DE\u8C03\u65F6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 ",(0,o.jsx)(e.code,{children:"RemoveCallback"})," \u65B9\u6CD5\u79FB\u9664\u6307\u5B9A\u7684\u56DE\u8C03\u3002\u65B9\u6CD5\u53C2\u6570 ",(0,o.jsx)(e.code,{children:"callbackId"})," \u662F\u5728\u6DFB\u52A0\u76D1\u542C\u65F6\u8FD4\u56DE\u7684 ",(0,o.jsx)(e.code,{children:"Callback"})," \u5BF9\u8C61\u7684\u552F\u4E00ID\u3002"]}),"\n",(0,o.jsx)(e.p,{children:"\u4F7F\u7528\u793A\u4F8B1\uFF1A"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/v2/os/gctx"\n    "github.com/gogf/gf/v2/os/gfsnotify"\n    "github.com/gogf/gf/v2/os/glog"\n    "github.com/gogf/gf/v2/os/gtimer"\n    "time"\n)\n\nfunc main() {\n    ctx := gctx.New()\n    c1, err := gfsnotify.Add("/home/john/temp/log", func(event *gfsnotify.Event) {\n        glog.Debug(ctx, "callback1")\n    })\n    if err != nil {\n        panic(err)\n    }\n    c2, err := gfsnotify.Add("/home/john/temp/log", func(event *gfsnotify.Event) {\n        glog.Debug(ctx, "callback2")\n    })\n    if err != nil {\n        panic(err)\n    }\n    // 5\u79D2\u540E\u79FB\u9664c1\u7684\u56DE\u8C03\u51FD\u6570\u6CE8\u518C\uFF0C\u4EC5\u5269c2\n    gtimer.SetTimeout(5*time.Second, func() {\n        gfsnotify.RemoveCallback(c1.Id)\n        glog.Debug(ctx, "remove callback c1")\n    })\n    // 10\u79D2\u540E\u79FB\u9664c2\u7684\u56DE\u8C03\u51FD\u6570\u6CE8\u518C\uFF0C\u6240\u6709\u7684\u56DE\u8C03\u90FD\u79FB\u9664\uFF0C\u4E0D\u518D\u6709\u4EFB\u4F55\u6253\u5370\u4FE1\u606F\u8F93\u51FA\n    gtimer.SetTimeout(10*time.Second, func() {\n        gfsnotify.RemoveCallback(c2.Id)\n        glog.Debug(ctx, "remove callback c2")\n    })\n\n    select {}\n}\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u4F7F\u7528\u793A\u4F8B2\uFF1A"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/v2/os/gctx"\n    "github.com/gogf/gf/v2/os/gfsnotify"\n    "github.com/gogf/gf/v2/os/glog"\n    "github.com/gogf/gf/v2/os/gtimer"\n    "time"\n)\n\nfunc main() {\n     ctx := gctx.New()\n    callback, err := gfsnotify.Add("/home/john/temp", func(event *gfsnotify.Event) {\n        glog.Debug(ctx, "callback")\n    })\n    if err != nil {\n        panic(err)\n    }\n\n    // \u5728\u6B64\u671F\u95F4\u521B\u5EFA\u6587\u4EF6\u3001\u76EE\u5F55\u3001\u4FEE\u6539\u6587\u4EF6\u3001\u5220\u9664\u6587\u4EF6\n\n    // 20\u79D2\u540E\u79FB\u9664\u56DE\u8C03\u51FD\u6570\u6CE8\u518C\uFF0C\u6240\u6709\u7684\u56DE\u8C03\u90FD\u79FB\u9664\uFF0C\u4E0D\u518D\u6709\u4EFB\u4F55\u6253\u5370\u4FE1\u606F\u8F93\u51FA\n    gtimer.SetTimeout(20*time.Second, func() {\n        gfsnotify.RemoveCallback(callback.Id)\n        glog.Debug(ctx, "remove callback")\n    })\n\n    select {}\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"fsinotifymax_user_instances\u4E0Efsinotifymax_user_watches",children:"fs.inotify.max_user_instances\u4E0Efs.inotify.max_user_watches"}),"\n",(0,o.jsxs)(e.p,{children:["\u5728 ",(0,o.jsx)(e.code,{children:"*nix"})," \u7CFB\u7EDF\u4E0B\uFF0C ",(0,o.jsx)(e.code,{children:"gfsnotify"})," \u6A21\u5757\u4F7F\u7528\u7684\u662F\u7CFB\u7EDF\u7684 ",(0,o.jsx)(e.code,{children:"inotify"})," \u7279\u6027\u6765\u5B9E\u73B0\u7684\u6587\u4EF6/\u76EE\u5F55\u76D1\u63A7\uFF0C\u56E0\u6B64\u8BE5\u529F\u80FD\u5728\u4F7F\u7528\u65F6\u4F1A\u53D7\u5230\u7CFB\u7EDF\u7684\u4E24\u4E2A\u5185\u6838\u51FD\u6570\u9650\u5236\uFF1A"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"fs.inotify.max_user_instances"}),"\uFF1A\u8868\u793A\u5F53\u524D\u7528\u6237\u53EF\u521B\u5EFA\u7684 ",(0,o.jsx)(e.code,{children:"inotify"})," \u76D1\u63A7\u5B9E\u4F8B\u6570\u91CF\uFF0C\u5373 ",(0,o.jsx)(e.code,{children:"gfsnotify.New"})," \u65B9\u6CD5\u521B\u5EFA\u7684 ",(0,o.jsx)(e.code,{children:"Watcher"})," \u5BF9\u8C61\u6570\u91CF\uFF0C\u4E00\u4E2A ",(0,o.jsx)(e.code,{children:"Watcher"})," \u5BF9\u8C61\u5BF9\u5E94\u7CFB\u7EDF\u7684\u4E00\u4E2A ",(0,o.jsx)(e.code,{children:"inotify"})," \u5B9E\u4F8B\uFF0C\u7CFB\u7EDF\u9ED8\u8BA4\u6570\u91CF\u4E3A\uFF1A ",(0,o.jsx)(e.code,{children:"128"}),"\uFF1B"]}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"fs.inotify.max_user_watches"}),"\uFF1A\u8868\u793A\u4E00\u4E2A ",(0,o.jsx)(e.code,{children:"inotify"})," \u5B9E\u4F8B\u53EF\u6DFB\u52A0\u7684\u76D1\u63A7\u6587\u4EF6\u961F\u5217\u5927\u5C0F\uFF0C\u5F80\u540C\u4E00\u4E2A ",(0,o.jsx)(e.code,{children:"inotify"})," \u6DFB\u52A0\u7684\u76D1\u63A7\u6587\u4EF6\u8D85\u8FC7\u8BE5\u6570\u91CF\u9650\u5236\u5219\u4F1A\u5931\u8D25\uFF0C\u5E76\u4E14\u4F1A\u6709\u7CFB\u7EDF\u9519\u8BEF\u65E5\u5FD7\uFF0C\u7CFB\u7EDF\u9ED8\u8BA4\u6570\u91CF\u5F80\u5F80\u4E3A\uFF1A ",(0,o.jsx)(e.code,{children:"8192"}),"(\u6709\u7684\u7CFB\u7EDF\u8BE5\u6570\u503C\u4F1A\u6BD4\u8F83\u5927\u4E00\u4E9B)\uFF1B"]}),"\n"]}),"\n"]})]})}function d(n={}){let{wrapper:e}={...(0,c.a)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(f,{...n})}):f(n)}},250065:function(n,e,t){t.d(e,{Z:function(){return g},a:function(){return s}});var i=t(667294);let o={},c=i.createContext(o);function s(n){let e=i.useContext(c);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function g(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),i.createElement(c.Provider,{value:e},n.children)}}}]);