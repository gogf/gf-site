"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["26570"],{556685:function(e,n,r){r.r(n),r.d(n,{metadata:()=>i,contentTitle:()=>a,default:()=>u,assets:()=>d,toc:()=>c,frontMatter:()=>s});var i=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5/\u67E5\u8BE2\u65F6\u907F\u514D\u8FD4\u56DE\u5BF9\u8C61\u521D\u59CB\u5316\u53CAsql.ErrNoRows\u5224\u65AD","title":"Avoid Object Initialization and sql.ErrNoRows Judgment in Queries","description":"When using the GoFrame framework for SQL queries, avoid object initialization and sql.ErrNoRows error judgment issues. By not initializing query result objects and using nil pointer judgment, unify the logic for handling empty query results across the project, thus reducing the complexity of error handling in the code.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5/\u67E5\u8BE2\u65F6\u907F\u514D\u8FD4\u56DE\u5BF9\u8C61\u521D\u59CB\u5316\u53CAsql.ErrNoRows\u5224\u65AD.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5","slug":"/docs/core/gdb-practice-avoid-object-initialization-and-sql-errnorows-error","permalink":"/en/docs/core/gdb-practice-avoid-object-initialization-and-sql-errnorows-error","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5/\u67E5\u8BE2\u65F6\u907F\u514D\u8FD4\u56DE\u5BF9\u8C61\u521D\u59CB\u5316\u53CAsql.ErrNoRows\u5224\u65AD.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732541616000,"sidebarPosition":2,"frontMatter":{"slug":"/docs/core/gdb-practice-avoid-object-initialization-and-sql-errnorows-error","title":"Avoid Object Initialization and sql.ErrNoRows Judgment in Queries","sidebar_position":2,"hide_title":true,"keywords":["GoFrame","GoFrame Framework","SQL Queries","Object Initialization","sql.ErrNoRows","Error Handling","Pointer Judgment","ORM Result Handling","Object Memory","Code Complexity"],"description":"When using the GoFrame framework for SQL queries, avoid object initialization and sql.ErrNoRows error judgment issues. By not initializing query result objects and using nil pointer judgment, unify the logic for handling empty query results across the project, thus reducing the complexity of error handling in the code."},"sidebar":"mainSidebar","previous":{"title":"Try to use JSON for complex types for storage, facilitating automatic conversion to objects upon scanning, avoiding custom parsing","permalink":"/en/docs/core/gdb-practice-using-json-for-complicated-field"},"next":{"title":"ORM - FAQ","permalink":"/en/docs/core/gdb-faq"}}'),o=r("785893"),t=r("250065");let s={slug:"/docs/core/gdb-practice-avoid-object-initialization-and-sql-errnorows-error",title:"Avoid Object Initialization and sql.ErrNoRows Judgment in Queries",sidebar_position:2,hide_title:!0,keywords:["GoFrame","GoFrame Framework","SQL Queries","Object Initialization","sql.ErrNoRows","Error Handling","Pointer Judgment","ORM Result Handling","Object Memory","Code Complexity"],description:"When using the GoFrame framework for SQL queries, avoid object initialization and sql.ErrNoRows error judgment issues. By not initializing query result objects and using nil pointer judgment, unify the logic for handling empty query results across the project, thus reducing the complexity of error handling in the code."},a=void 0,d={},c=[{value:"Avoid Object Initialization and <code>sql.ErrNoRows</code> Judgment in Queries",id:"avoid-object-initialization-and-sqlerrnorows-judgment-in-queries",level:2}];function l(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.h2,{id:"avoid-object-initialization-and-sqlerrnorows-judgment-in-queries",children:["Avoid Object Initialization and ",(0,o.jsx)(n.code,{children:"sql.ErrNoRows"})," Judgment in Queries"]}),"\n",(0,o.jsxs)(n.p,{children:["When executing SQL queries, avoid initializing query results in advance to prevent the influence of default values in the struct objects and unnecessary object memory creation. By judging a return object pointer as ",(0,o.jsx)(n.code,{children:"nil"}),", avoid using ",(0,o.jsx)(n.code,{children:"sql.ErrNoRows"}),", thereby reducing the code's complexity in handling ",(0,o.jsx)(n.code,{children:"error"})," and unifying the project\u2019s logic for handling empty query results."]}),"\n",(0,o.jsx)(n.p,{children:"A counterexample:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'func (s *sTask) GetOne(ctx context.Context, id uint64) (out *entity.ResourceTask, err error) {\n    out = new(model.TaskDetail)\n    err = dao.ResourceTask.Ctx(ctx).WherePri(id).Scan(out)\n    if err != nil {\n        if err == sql.ErrNoRows {\n            err = gerror.Newf(`record not found for "%d"`, id)\n        }\n        return\n    }\n    return\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the returned ",(0,o.jsx)(n.code,{children:"out"})," object actually has default values due to object initialization (regardless of whether the SQL query retrieves data), and the judgment of ",(0,o.jsx)(n.code,{children:"sql.ErrNoRows"})," adds complexity to ",(0,o.jsx)(n.code,{children:"error"})," handling logic in the code."]}),"\n",(0,o.jsx)(n.p,{children:"Recommended improvement:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'func (s *sTask) GetOne(ctx context.Context, id uint64) (out *entity.ResourceTask, err error) {\n    err = dao.ResourceTask.Ctx(ctx).WherePri(id).Scan(&out)\n    if err != nil {\n        return\n    }\n    if out == nil {\n        err = gerror.Newf(`record not found for "%d"`, id)\n    }\n    return\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["Note the use of ",(0,o.jsx)(n.code,{children:"&out"})," in the code."]})}),"\n",(0,o.jsxs)(n.p,{children:["For more information, please refer to: ",(0,o.jsx)(n.a,{href:"/en/docs/core/gdb-result-empty-check",children:"ORM Result - Empty Check"})]})]})}function u(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},250065:function(e,n,r){r.d(n,{Z:function(){return a},a:function(){return s}});var i=r(667294);let o={},t=i.createContext(o);function s(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);