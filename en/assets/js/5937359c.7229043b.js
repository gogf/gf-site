"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["5006"],{338450:function(e,t,n){n.r(t),n.d(t,{metadata:()=>r,contentTitle:()=>s,default:()=>h,assets:()=>d,toc:()=>a,frontMatter:()=>l});var r=JSON.parse('{"id":"course/starbook/\u7B2C\u4E94\u7AE0-\u5B66\u4E60\u5355\u8BCD/5.3.\u8BBE\u7F6E\u638C\u63E1\u7A0B\u5EA6","title":"5.3 Set Proficiency Level","description":"Implement the function to set the word proficiency level using the GoFrame framework. Use the PATCH method to modify the ProficiencyLevel field and introduce parameter validation to ensure the level is between 1 and 5. The designed API route style follows the resource hierarchy relationship, and it is recommended to use the form words/{id}/level. Complete the level setting through database updates, providing an interface test example to verify the correctness of the function.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/course/starbook/\u7B2C\u4E94\u7AE0-\u5B66\u4E60\u5355\u8BCD/5.3.\u8BBE\u7F6E\u638C\u63E1\u7A0B\u5EA6.md","sourceDirName":"course/starbook/\u7B2C\u4E94\u7AE0-\u5B66\u4E60\u5355\u8BCD","slug":"/course/starbook/learn-word-set-level","permalink":"/en/course/starbook/learn-word-set-level","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/course/starbook/\u7B2C\u4E94\u7AE0-\u5B66\u4E60\u5355\u8BCD/5.3.\u8BBE\u7F6E\u638C\u63E1\u7A0B\u5EA6.md","tags":[],"version":"current","lastUpdatedBy":"oldme","lastUpdatedAt":1735822233000,"frontMatter":{"title":"5.3 Set Proficiency Level","hide_title":true,"slug":"/course/starbook/learn-word-set-level","keywords":["GoFrame","ProficiencyLevel","PATCH Method","API Design","Route Style","Data Validation","Interface Testing","Database Update","Go Language","Level Setting"],"description":"Implement the function to set the word proficiency level using the GoFrame framework. Use the PATCH method to modify the ProficiencyLevel field and introduce parameter validation to ensure the level is between 1 and 5. The designed API route style follows the resource hierarchy relationship, and it is recommended to use the form words/{id}/level. Complete the level setting through database updates, providing an interface test example to verify the correctness of the function."},"sidebar":"courseStarBookSidebar","previous":{"title":"5.2 Randomly Retrieve Words","permalink":"/en/course/starbook/learn-word-rand"},"next":{"title":"5.4 Summary","permalink":"/en/course/starbook/learn-word-summary"}}'),o=n("785893"),i=n("250065");let l={title:"5.3 Set Proficiency Level",hide_title:!0,slug:"/course/starbook/learn-word-set-level",keywords:["GoFrame","ProficiencyLevel","PATCH Method","API Design","Route Style","Data Validation","Interface Testing","Database Update","Go Language","Level Setting"],description:"Implement the function to set the word proficiency level using the GoFrame framework. Use the PATCH method to modify the ProficiencyLevel field and introduce parameter validation to ensure the level is between 1 and 5. The designed API route style follows the resource hierarchy relationship, and it is recommended to use the form words/{id}/level. Complete the level setting through database updates, providing an interface test example to verify the correctness of the function."},s=void 0,d={},a=[{value:"Add Api",id:"add-api",level:2},{value:"Write Logic",id:"write-logic",level:2},{value:"Controller calls Logic",id:"controller-calls-logic",level:2},{value:"Interface Testing",id:"interface-testing",level:2}];function c(e){let t={code:"code",em:"em",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["The function of setting the proficiency level is essentially an edit that only changes one field, ",(0,o.jsx)(t.code,{children:"ProficiencyLevel"}),", so using the ",(0,o.jsx)(t.code,{children:"PATCH"})," method is more suitable than ",(0,o.jsx)(t.code,{children:"PUT"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"add-api",children:"Add Api"}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"api/words/v1/learn_words.go"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'...\n\ntype SetLevelReq struct {  \n    g.Meta `path:"words/{id}/level" method:"patch"`  \n    Id     uint                   `json:"id" v:"required"`  \n    Level  model.ProficiencyLevel `json:"level" v:"required|between:1,5"`  \n}  \n  \ntype SetLevelRes struct {  \n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Both ",(0,o.jsx)(t.code,{children:"words/{id}/level"})," and ",(0,o.jsx)(t.code,{children:"words/level/{id}"})," route styles are acceptable, but the former is more in line with the resource hierarchy, and it is recommended to use it."]}),"\n",(0,o.jsx)(t.h2,{id:"write-logic",children:"Write Logic"}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"internal/logic/words/learn_words.go"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'...\n\n// SetLevel sets the word proficiency level  \nfunc (w *Words) SetLevel(ctx context.Context, uid, id uint, level model.ProficiencyLevel) error {  \n    if level < 0 || level > 5 {  \n       return gerror.New("Invalid proficiency level value")  \n    }  \n  \n    db := dao.Words.Ctx(ctx)  \n    if uid > 0 {  \n       db = db.Where("uid", uid)  \n    }  \n  \n    _, err := db.Data("proficiency_level", level).Where("id", id).Update()  \n    return err  \n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["To prevent data anomalies, we need to check if the level is between ",(0,o.jsx)(t.code,{children:"1-5"})," before entering the database."]}),"\n",(0,o.jsx)(t.h2,{id:"controller-calls-logic",children:"Controller calls Logic"}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"internal/controller/words/words_v1_set_level.go"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'package words  \n  \nimport (  \n    "context"  \n  \n    "star/api/words/v1"\n)  \n  \nfunc (c *ControllerV1) SetLevel(ctx context.Context, req *v1.SetLevelReq) (res *v1.SetLevelRes, err error) {  \n    uid, err := c.users.GetUid(ctx)  \n    if err != nil {  \n       return nil, err  \n    }  \n  \n    err = c.words.SetLevel(ctx, uid, req.Id, req.Level)  \n    return nil, err  \n}\n'})}),"\n",(0,o.jsx)(t.h2,{id:"interface-testing",children:"Interface Testing"}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'$ curl -X PATCH http://127.0.0.1:8000/v1/words/1/level \\\n     -H "Authorization: eyJhbGci...5U" \\\n     -H "Content-Type: application/json" \\\n     -d \'{\n           "proficiency_level": 5\n         }\'\n\n{\n\xa0 \xa0 "code": 0,\n\xa0 \xa0 "message": "",\n\xa0 \xa0 "data": null\n}\n'})})]})}function h(e={}){let{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return s},a:function(){return l}});var r=n(667294);let o={},i=r.createContext(o);function l(e){let t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);