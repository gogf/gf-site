"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["74811"],{4861:function(e,n,t){t.r(n),t.d(n,{metadata:()=>o,contentTitle:()=>c,default:()=>h,assets:()=>d,toc:()=>l,frontMatter:()=>s});var o=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/\u6570\u636E\u5E93ORM","title":"Database ORM\uD83D\uDD25","description":"In the GoFrame framework, the gdb module is used to implement ORM functionality for databases, emphasizing the design of connection pools, preprocessing SQL parameters, and automatic recognition of Map/Struct. The GoFrame ORM component supports nested transactions, interface-based design, is compatible with mainstream database drivers, and has strong configuration management and debugging features.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/\u6570\u636E\u5E93ORM.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM","slug":"/docs/core/gdb","permalink":"/en/docs/core/gdb","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/\u6570\u636E\u5E93ORM.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732538474000,"sidebarPosition":8,"frontMatter":{"slug":"/docs/core/gdb","title":"Database ORM\uD83D\uDD25","sidebar_position":8,"hide_title":true,"keywords":["GoFrame","GoFrame Framework","Database ORM","gdb Module","Database Driver","Connection Pool","Preprocessing","Automation","Observability","DAO Design"],"description":"In the GoFrame framework, the gdb module is used to implement ORM functionality for databases, emphasizing the design of connection pools, preprocessing SQL parameters, and automatic recognition of Map/Struct. The GoFrame ORM component supports nested transactions, interface-based design, is compatible with mainstream database drivers, and has strong configuration management and debugging features."},"sidebar":"mainSidebar","previous":{"title":"Type Conversion - Performance","permalink":"/en/docs/core/gconv-benchmark"},"next":{"title":"ORM - Configuration","permalink":"/en/docs/core/gdb-config"}}'),i=t("785893"),r=t("250065"),a=t("203105");let s={slug:"/docs/core/gdb",title:"Database ORM\uD83D\uDD25",sidebar_position:8,hide_title:!0,keywords:["GoFrame","GoFrame Framework","Database ORM","gdb Module","Database Driver","Connection Pool","Preprocessing","Automation","Observability","DAO Design"],description:"In the GoFrame framework, the gdb module is used to implement ORM functionality for databases, emphasizing the design of connection pools, preprocessing SQL parameters, and automatic recognition of Map/Struct. The GoFrame ORM component supports nested transactions, interface-based design, is compatible with mainstream database drivers, and has strong configuration management and debugging features."},c=void 0,d={},l=[{value:"Driver Introduction\uD83D\uDD25",id:"driver-introduction",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Features",id:"features",level:2},{value:"Component Association",id:"component-association",level:2},{value:"<code>g.DB</code> vs <code>gdb.New</code> &amp; <code>gdb.Instance</code>",id:"gdb-vs-gdbnew--gdbinstance",level:2},{value:"Creating a Database Object with <code>New</code>",id:"creating-a-database-object-with-new",level:3},{value:"Obtaining the Database Object Singleton",id:"obtaining-the-database-object-singleton",level:3},{value:"Documents",id:"documents",level:2}];function u(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"driver-introduction",children:"Driver Introduction\uD83D\uDD25"}),"\n",(0,i.jsxs)(n.p,{children:["To decouple the database drivers from the main framework library, starting from version ",(0,i.jsx)(n.code,{children:"v2.1"}),", all database drivers need to be introduced manually through community packages."]}),"\n",(0,i.jsxs)(n.p,{children:["For database driver installation and introduction, please refer to: ",(0,i.jsx)(n.a,{href:"https://github.com/gogf/gf/tree/master/contrib/drivers",children:"https://github.com/gogf/gf/tree/master/contrib/drivers"})]}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ORM"})," functionality of the ",(0,i.jsx)(n.code,{children:"GoFrame"})," framework is implemented by the ",(0,i.jsx)(n.code,{children:"gdb"})," module, used for ",(0,i.jsx)(n.code,{children:"ORM"})," operations of common relational databases."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"gdb"})," database engine uses a ",(0,i.jsx)(n.strong,{children:"connection pool design"})," at the bottom layer, and connections will automatically close when not in use, so there is no need to explicitly use the ",(0,i.jsx)(n.code,{children:"Close"})," method to close the database connection when the connection object is no longer needed."]})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Note: To improve the security of database operations, it is not recommended to directly concatenate parameters into an ",(0,i.jsx)(n.code,{children:"SQL"})," string for execution in ",(0,i.jsx)(n.code,{children:"ORM"})," operations. It is recommended to use preprocessing (utilizing ",(0,i.jsx)(n.code,{children:"?"})," placeholders extensively) to pass ",(0,i.jsx)(n.code,{children:"SQL"})," parameters. The bottom layer of ",(0,i.jsx)(n.code,{children:"gdb"})," is implemented using preprocessing to handle the parameters passed by developers, ensuring the safety of database operations."]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Interface Documentation:"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://pkg.go.dev/github.com/gogf/gf/v2/database/gdb",children:"https://pkg.go.dev/github.com/gogf/gf/v2/database/gdb"})}),"\n",(0,i.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"GoFrame ORM"})," component has the following notable features:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Fully automated support for nested transactions."}),"\n",(0,i.jsx)(n.li,{children:"Interface-oriented design, easy to use and extend."}),"\n",(0,i.jsx)(n.li,{children:"Built-in support for mainstream database types and drivers, and easy to extend."}),"\n",(0,i.jsx)(n.li,{children:"Powerful configuration management using the framework's unified configuration component."}),"\n",(0,i.jsx)(n.li,{children:"Supports singleton mode to obtain database objects of the same configuration group."}),"\n",(0,i.jsx)(n.li,{children:"Supports two operation methods: native SQL method operations and ORM chain operations."}),"\n",(0,i.jsxs)(n.li,{children:["Supports ",(0,i.jsx)(n.code,{children:"OpenTelemetry"})," observability: trace tracing, logging, and metric reporting."]}),"\n",(0,i.jsxs)(n.li,{children:["Automatically recognizes ",(0,i.jsx)(n.code,{children:"Map/Struct"})," to receive query results through the ",(0,i.jsx)(n.code,{children:"Scan"})," method, automating query result initialization and struct type conversion."]}),"\n",(0,i.jsxs)(n.li,{children:["Recognizes empty results by returning ",(0,i.jsx)(n.code,{children:"nil"}),", without the need for ",(0,i.jsx)(n.code,{children:"sql.ErrNoRows"})," to identify empty query results."]}),"\n",(0,i.jsx)(n.li,{children:"Fully automated struct property-field mapping, without needing to explicitly define struct tags to maintain property-field mapping relationships."}),"\n",(0,i.jsxs)(n.li,{children:["Automates field recognition and filtering of given ",(0,i.jsx)(n.code,{children:"Map/Struct/Slice"})," parameter types, greatly enhancing query condition input and result reception."]}),"\n",(0,i.jsxs)(n.li,{children:["Perfectly supports ",(0,i.jsx)(n.code,{children:"DAO"})," design at the ",(0,i.jsx)(n.code,{children:"GoFrame"})," framework layer, fully automated ",(0,i.jsx)(n.code,{children:"Model/DAO"})," code generation, significantly improving development efficiency."]}),"\n",(0,i.jsxs)(n.li,{children:["Supports debugging modes, log output, ",(0,i.jsx)(n.code,{children:"DryRun"}),", custom ",(0,i.jsx)(n.code,{children:"Handler"}),", automatic type conversion, custom interface conversion, and other advanced features."]}),"\n",(0,i.jsx)(n.li,{children:"Supports query caching, soft delete, automatic time updates, model associations, database cluster configurations (software master-slave mode), and other practical features."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"component-association",children:"Component Association"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(994459).Z+"",width:"2310",height:"940"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"GoFrame ORM Dependencies"})}),"\n",(0,i.jsxs)(n.h2,{id:"gdb-vs-gdbnew--gdbinstance",children:[(0,i.jsx)(n.code,{children:"g.DB"})," vs ",(0,i.jsx)(n.code,{children:"gdb.New"})," & ",(0,i.jsx)(n.code,{children:"gdb.Instance"})]}),"\n",(0,i.jsxs)(n.p,{children:["There are three ways to obtain database operation objects: using the ",(0,i.jsx)(n.code,{children:"g.DB"})," method (recommended), using the native ",(0,i.jsx)(n.code,{children:"gdb.New"})," method, and using the package's native singleton method ",(0,i.jsx)(n.code,{children:"gdb.Instance"}),", with the first being the recommended usage. The differences between these three methods are as follows:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"g.DB"})," object management method obtains a singleton object, integrating the management features of the configuration file and supporting hot updates of configuration files."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gdb.New"})," creates a new database object (not a singleton) based on the given database node configuration and cannot use configuration files."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gdb.Instance"})," is the package's native singleton management method, which needs to be used together with the configuration method to obtain the database singleton object for the corresponding configuration by group name (not required)."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["There are so many ways to obtain objects because ",(0,i.jsx)(n.code,{children:"GoFrame"})," is a modular design framework, and each module can be used independently."]})}),"\n",(0,i.jsxs)(n.h3,{id:"creating-a-database-object-with-new",children:["Creating a Database Object with ",(0,i.jsx)(n.code,{children:"New"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'db, err := gdb.New(gdb.ConfigNode{\n    Link: "mysql:root:12345678@tcp(127.0.0.1:3306)/test",\n})\n'})}),"\n",(0,i.jsx)(n.h3,{id:"obtaining-the-database-object-singleton",children:"Obtaining the Database Object Singleton"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// Obtain the database object with default configuration (configuration name "default")\ndb := g.DB()\n\n// Obtain the database object of the configuration group named "user"\ndb := g.DB("user")\n\n// Obtain the database object singleton using the native singleton management method\ndb, err := gdb.Instance()\ndb, err := gdb.Instance("user")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"documents",children:"Documents"}),"\n","\n",(0,i.jsx)(a.Z,{})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},994459:function(e,n,t){t.d(n,{Z:function(){return o}});let o=t.p+"assets/images/cf10ab2ff4d4b341190d5e5a47692061-5d61b04fbaf4be85bc886c8cbf8dc51a.png"},203105:function(e,n,t){t.d(n,{Z:()=>j});var o=t("785893");t("667294");var i=t("467026"),r=t("698404"),a=t("531183"),s=t("633876"),c=t("266026"),d=t("434751"),l=t("58608");let u={cardContainer:"cardContainer_fWXF",cardTitle:"cardTitle_rnsV",cardDescription:"cardDescription_PWke"};function h(e){let{href:n,children:t}=e;return(0,o.jsx)(a.Z,{href:n,className:(0,i.Z)("card padding--lg",u.cardContainer),children:t})}function g(e){let{href:n,icon:t,title:r,description:a}=e;return(0,o.jsxs)(h,{href:n,children:[(0,o.jsxs)(l.Z,{as:"h2",className:(0,i.Z)("text--truncate",u.cardTitle),title:r,children:[t," ",r]}),a&&(0,o.jsx)("p",{className:(0,i.Z)("text--truncate",u.cardDescription),title:a,children:a})]})}function m(e){let{item:n}=e,t=(0,r.LM)(n),i=function(){let{selectMessage:e}=(0,s.c)();return n=>e(n,(0,d.I)({message:"1 item|{count} items",id:"theme.docs.DocCard.categoryDescription.plurals",description:"The default description for a category card in the generated index about how many items this category includes"},{count:n}))}();return t?(0,o.jsx)(g,{href:t,icon:"\uD83D\uDDC3\uFE0F",title:n.label,description:n.description??i(n.items.length)}):null}function p(e){let{item:n}=e,t=(0,c.Z)(n.href)?"\uD83D\uDCC4\uFE0F":"\uD83D\uDD17",i=(0,r.xz)(n.docId??void 0);return(0,o.jsx)(g,{href:n.href,icon:t,title:n.label,description:n.description??i?.description})}function f(e){let{item:n}=e;switch(n.type){case"link":return(0,o.jsx)(p,{item:n});case"category":return(0,o.jsx)(m,{item:n});default:throw Error(`unknown item type ${JSON.stringify(n)}`)}}function b(e){let{className:n}=e,t=(0,r.jA)();return(0,o.jsx)(j,{items:t.items,className:n})}function j(e){let{items:n,className:t}=e;if(!n)return(0,o.jsx)(b,{...e});let a=(0,r.MN)(n);return(0,o.jsx)("section",{className:(0,i.Z)("row",t),children:a.map((e,n)=>(0,o.jsx)("article",{className:"col col--6 margin-bottom--lg",children:(0,o.jsx)(f,{item:e})},n))})}},633876:function(e,n,t){t.d(n,{c:function(){return c}});var o=t(667294),i=t(49931);let r=["zero","one","two","few","many","other"];function a(e){return r.filter(n=>e.includes(n))}let s={locale:"en",pluralForms:a(["one","other"]),select:e=>1===e?"one":"other"};function c(){let e=function(){let{i18n:{currentLocale:e}}=(0,i.Z)();return(0,o.useMemo)(()=>{try{return function(e){let n=new Intl.PluralRules(e);return{locale:e,pluralForms:a(n.resolvedOptions().pluralCategories),select:e=>n.select(e)}}(e)}catch(n){return console.error(`Failed to use Intl.PluralRules for locale "${e}".
Docusaurus will fallback to the default (English) implementation.
Error: ${n.message}
`),s}},[e])}();return{selectMessage:(n,t)=>(function(e,n,t){let o=e.split("|");if(1===o.length)return o[0];o.length>t.pluralForms.length&&console.error(`For locale=${t.locale}, a maximum of ${t.pluralForms.length} plural forms are expected (${t.pluralForms.join(",")}), but the message contains ${o.length}: ${e}`);let i=t.select(n);return o[Math.min(t.pluralForms.indexOf(i),o.length-1)]})(t,n,e)}}},250065:function(e,n,t){t.d(n,{Z:function(){return s},a:function(){return a}});var o=t(667294);let i={},r=o.createContext(i);function a(e){let n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);