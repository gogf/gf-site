"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["62579"],{545496:function(e,o,r){r.r(o),r.d(o,{metadata:()=>t,contentTitle:()=>g,default:()=>l,assets:()=>a,toc:()=>c,frontMatter:()=>s});var t=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u9519\u8BEF\u5904\u7406/\u9519\u8BEF\u5904\u7406-\u5176\u4ED6\u7279\u6027","title":"Error Handling - Other Features","description":"In GoFrame framework, error handling other features include how to use NewOption to customize error object creation, print complete stack information through fmt formatting, and powerful support for log output. Additionally, from version v2.6.0, the error component offers different printing modes for stack information, meeting development needs in different scenarios.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u9519\u8BEF\u5904\u7406/\u9519\u8BEF\u5904\u7406-\u5176\u4ED6\u7279\u6027.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u9519\u8BEF\u5904\u7406","slug":"/docs/core/gerror-other","permalink":"/en/docs/core/gerror-other","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u9519\u8BEF\u5904\u7406/\u9519\u8BEF\u5904\u7406-\u5176\u4ED6\u7279\u6027.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732414090000,"sidebarPosition":4,"frontMatter":{"slug":"/docs/core/gerror-other","title":"Error Handling - Other Features","sidebar_position":4,"hide_title":true,"keywords":["GoFrame","Error Handling","NewOption","fmt formatting","Log Output","Stack Printing","Error Component","Code Call Chain","Stack Information","Environment Variable"],"description":"In GoFrame framework, error handling other features include how to use NewOption to customize error object creation, print complete stack information through fmt formatting, and powerful support for log output. Additionally, from version v2.6.0, the error component offers different printing modes for stack information, meeting development needs in different scenarios."},"sidebar":"mainSidebar","previous":{"title":"Error Handling - Comparison","permalink":"/en/docs/core/gerror-comparison"},"next":{"title":"Error Handling - Best Practices","permalink":"/en/docs/core/gerror-practice"}}'),n=r("785893"),i=r("250065");let s={slug:"/docs/core/gerror-other",title:"Error Handling - Other Features",sidebar_position:4,hide_title:!0,keywords:["GoFrame","Error Handling","NewOption","fmt formatting","Log Output","Stack Printing","Error Component","Code Call Chain","Stack Information","Environment Variable"],description:"In GoFrame framework, error handling other features include how to use NewOption to customize error object creation, print complete stack information through fmt formatting, and powerful support for log output. Additionally, from version v2.6.0, the error component offers different printing modes for stack information, meeting development needs in different scenarios."},g=void 0,a={},c=[{value:"<code>NewWithOption</code> Custom Error Creation",id:"newwithoption-custom-error-creation",level:2},{value:"<code>fmt</code> Formatting",id:"fmt-formatting",level:2},{value:"Log Component Support",id:"log-component-support",level:2},{value:"Stack Printing Mode",id:"stack-printing-mode",level:2}];function d(e){let o={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.h2,{id:"newwithoption-custom-error-creation",children:[(0,n.jsx)(o.code,{children:"NewWithOption"})," Custom Error Creation"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:"Description: Used for creating custom-configured error objects."}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:"Format:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-go",children:"// NewWithOption creates and returns a custom error with Option.\n// It is the senior usage for creating error, which is often used internally in framework.\nNewWithOption(option Option) error\n"})}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsx)(o.p,{children:"Example:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-go",children:'func ExampleNewWithOption() {\n     err := gerror.NewWithOption(gerror.Option{\n          Text: "this feature is disabled in this storage",\n          Code: gcode.CodeNotSupported,\n     })\n}\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Where ",(0,n.jsx)(o.code,{children:"Option"})," is defined as:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-go",children:"// Option is option for creating error.\ntype Option struct {\n     Error error      // Wrapped error if any.\n     Stack bool       // Whether recording stack information into error.\n     Text  string     // Error text, which is created by New* functions.\n     Code  gcode.Code // Error code if necessary.\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(o.h2,{id:"fmt-formatting",children:[(0,n.jsx)(o.code,{children:"fmt"})," Formatting"]}),"\n",(0,n.jsxs)(o.p,{children:["As shown in previous examples, using the ",(0,n.jsx)(o.code,{children:"%+v"})," print format can print out complete stack information. Of course, the ",(0,n.jsx)(o.code,{children:"gerror.Error"})," object supports multiple ",(0,n.jsx)(o.code,{children:"fmt"})," formats:"]}),"\n",(0,n.jsxs)(o.table,{children:[(0,n.jsx)(o.thead,{children:(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.th,{children:"Format Specifier"}),(0,n.jsx)(o.th,{children:"Output Content"})]})}),(0,n.jsxs)(o.tbody,{children:[(0,n.jsxs)(o.tr,{children:[(0,n.jsxs)(o.td,{children:[(0,n.jsx)(o.code,{children:"%v"}),", ",(0,n.jsx)(o.code,{children:"%s"})]}),(0,n.jsxs)(o.td,{children:["Prints all hierarchical error information, returning a complete string, with multiple levels concatenated by ",(0,n.jsx)(o.code,{children:":"}),"."]})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsxs)(o.td,{children:[(0,n.jsx)(o.code,{children:"%-v"}),", ",(0,n.jsx)(o.code,{children:"%-s"})]}),(0,n.jsx)(o.td,{children:"Prints the current level of error information, returning a string."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:(0,n.jsx)(o.code,{children:"%+s"})}),(0,n.jsx)(o.td,{children:"Prints a complete list of stack information."})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:(0,n.jsx)(o.code,{children:"%+v"})}),(0,n.jsxs)(o.td,{children:["Prints all hierarchical error information strings, along with complete stack information, equivalent to ",(0,n.jsx)(o.code,{children:"%s\\n%+s"}),"."]})]})]})]}),"\n",(0,n.jsx)(o.p,{children:"Usage example:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-go",children:'package main\n\nimport (\n    "errors"\n    "fmt"\n    "github.com/gogf/gf/v2/errors/gerror"\n)\n\nfunc main() {\n    var err error\n    err = errors.New("sql error")\n    err = gerror.Wrap(err, "adding failed")\n    err = gerror.Wrap(err, "api calling failed")\n    fmt.Printf(" %%s: %s\\n", err)\n    fmt.Printf("%%-s: %-s\\n", err)\n    fmt.Println("%+s: ")\n    fmt.Printf("%+s\\n", err)\n}\n'})}),"\n",(0,n.jsx)(o.p,{children:"After execution, the output example:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-text",children:" %s: api calling failed: adding failed: sql error\n%-s: api calling failed\n%+s:\n1. api calling failed\n    1).  main.main\n        /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.example/other/test.go:14\n2. adding failed\n    1).  main.main\n        /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.example/other/test.go:13\n3. sql error\n"})}),"\n",(0,n.jsx)(o.h2,{id:"log-component-support",children:"Log Component Support"}),"\n",(0,n.jsxs)(o.p,{children:["The ",(0,n.jsx)(o.code,{children:"glog"})," log component naturally supports stack printing for ",(0,n.jsx)(o.code,{children:"gerror"})," errors. This support is not strongly coupled but is supported through the ",(0,n.jsx)(o.code,{children:"fmt"})," formatting print interface."]}),"\n",(0,n.jsx)(o.p,{children:"Usage example:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-go",children:'package main\n\nimport (\n    "errors"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/errors/gerror"\n)\n\nfunc main() {\n    var err error\n    err = errors.New("sql error")\n    err = gerror.Wrap(err, "adding failed")\n    err = gerror.Wrap(err, "api calling failed")\n    g.Log().Printf("%+v", err)\n}\n'})}),"\n",(0,n.jsx)(o.p,{children:"After execution, the output example:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-text",children:"2020-10-17 15:22:26.793 api calling failed: adding failed: sql error\n1. api calling failed\n    1).  main.main\n        /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.example/other/test.go:14\n2. adding failed\n    1).  main.main\n        /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.example/other/test.go:13\n3. sql error\n"})}),"\n",(0,n.jsx)(o.h2,{id:"stack-printing-mode",children:"Stack Printing Mode"}),"\n",(0,n.jsxs)(o.p,{children:["This feature is provided from version ",(0,n.jsx)(o.code,{children:"v2.6.0"})," of the framework."]}),"\n",(0,n.jsxs)(o.p,{children:["When printing stack information, the error component supports users specifying stack printing information mode via an environment variable (",(0,n.jsx)(o.code,{children:"GF_GERROR_STACK_MODE"}),") or a command line argument (",(0,n.jsx)(o.code,{children:"gf.gerror.stack.mode"}),"):"]}),"\n",(0,n.jsxs)(o.table,{children:[(0,n.jsx)(o.thead,{children:(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.th,{children:"Stack Mode"}),(0,n.jsx)(o.th,{children:"Default"}),(0,n.jsx)(o.th,{children:"Description"})]})}),(0,n.jsxs)(o.tbody,{children:[(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:(0,n.jsx)(o.code,{children:"brief"})}),(0,n.jsx)(o.td,{children:"Yes"}),(0,n.jsxs)(o.td,{children:[(0,n.jsx)(o.strong,{children:"Brief Mode"}),". When printing error stacks, framework-related stacks will not be printed."]})]}),(0,n.jsxs)(o.tr,{children:[(0,n.jsx)(o.td,{children:(0,n.jsx)(o.code,{children:"detail"})}),(0,n.jsx)(o.td,{}),(0,n.jsxs)(o.td,{children:[(0,n.jsx)(o.strong,{children:"Detailed Mode"}),". When printing error stacks, the complete framework component code call chain will be printed."]})]})]})]}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsxs)(o.strong,{children:["In detailed mode (",(0,n.jsx)(o.code,{children:"detail"}),"), the complete framework stack information will be printed in the error object."]})," For instance, in the following stack error example, you can see that most of the framework stack information is not very meaningful for error localization, and as a developer, more concern is given to the stack information at their own code level."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-text",children:'2022-10-08 21:07:00.751 [ERRO] {328d1204e2191c179a09086890c857b8} request done, cost: 3 ms, code: -1, message: "", detail: <nil>, error: GetParams failed: {ResourceId:tdxxxx-a2c378bd Component: Version:0}: rpc error: code = NotFound desc = cluster.khaos.tencent.com "tdxxxx-a2c378bd" not found\n1. GetParams failed: {ResourceId:tdxxxx-a2c378bd Component: Version:0}\n   1).  github.com/khaos/eros/app/khaos-oss/internal/logic/params.(*sParams).doGetParamsJson\n        /root/workspace/khaos/eros/app/khaos-oss/internal/logic/params/params.go:66\n   2).  github.com/khaos/eros/app/khaos-oss/internal/logic/params.(*sParams).GetParams\n        /root/workspace/khaos/eros/app/khaos-oss/internal/logic/params/params.go:36\n   3).  github.com/khaos/eros/app/khaos-oss/internal/controller.(*cParams).GetOne\n        /root/workspace/khaos/eros/app/khaos-oss/internal/controller/params.go:21\n   4).  github.com/gogf/gf/v2/net/ghttp.(*middleware).callHandlerFunc.func1\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:152\n   5).  github.com/gogf/gf/v2/net/ghttp.niceCallFunc\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_func.go:55\n   6).  github.com/gogf/gf/v2/net/ghttp.(*middleware).callHandlerFunc\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:129\n   7).  github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:75\n   8).  github.com/gogf/gf/v2/util/gutil.TryCatch\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/util/gutil/gutil.go:56\n   9).  github.com/gogf/gf/v2/net/ghttp.(*middleware).Next\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:49\n   10). github.com/khaos/eros/app/khaos-oss/internal/logic/middleware.(*sMiddleware).CheckLimit\n        /root/workspace/khaos/eros/app/khaos-oss/internal/logic/middleware/middleware.go:27\n   11). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1.5\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:96\n   12). github.com/gogf/gf/v2/net/ghttp.niceCallFunc\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_func.go:55\n   13). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:95\n   14). github.com/gogf/gf/v2/util/gutil.TryCatch\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/util/gutil/gutil.go:56\n   15). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:49\n   16). github.com/khaos/eros/utility/server.MiddlewareCommonResponse\n        /root/workspace/khaos/eros/utility/server/server_common.go:14\n   17). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1.5\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:96\n   18). github.com/gogf/gf/v2/net/ghttp.niceCallFunc\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_func.go:55\n   19). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:95\n   20). github.com/gogf/gf/v2/util/gutil.TryCatch\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/util/gutil/gutil.go:56\n   21). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:49\n   22). github.com/khaos/eros/utility/server.MiddlewareLogging\n        /root/workspace/khaos/eros/utility/server/server.go:46\n   23). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1.5\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:96\n   24). github.com/gogf/gf/v2/net/ghttp.niceCallFunc\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_func.go:55\n   25). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:95\n   26). github.com/gogf/gf/v2/util/gutil.TryCatch\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/util/gutil/gutil.go:56\n   27). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:49\n   28). github.com/gogf/gf/v2/net/ghttp.MiddlewareCORS\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_middleware_cors.go:12\n   29). github.com/gogf/gf/v2/net/ghttp.(*middleware).Next.func1.5\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_request_middleware.go:96\n   30). github.com/gogf/gf/v2/net/ghttp.niceCallFunc\n        /root/go/pkg/mod/github.com/gogf/gf/v2@v2.1.4/net/ghttp/ghttp_func.go:55\n2. rpc error: code = NotFound desc = cluster.khaos.tencent.com "tdxxxx-a2c378bd" not found\n'})}),"\n",(0,n.jsxs)(o.p,{children:["While ",(0,n.jsxs)(o.strong,{children:["in brief mode (",(0,n.jsx)(o.code,{children:"brief"}),"), the stack information will not print the framework stack information"]}),". For example:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-text",children:'2022-10-08 21:07:00.751 [ERRO] {328d1204e2191c179a09086890c857b8} request done, cost: 3 ms, code: -1, message: "", detail: <nil>, error: GetParams failed: {ResourceId:tdxxxx-a2c378bd Component: Version:0}: rpc error: code = NotFound desc = cluster.khaos.tencent.com "tdxxxx-a2c378bd" not found\n1. GetParams failed: {ResourceId:tdxxxx-a2c378bd Component: Version:0}\n   1).  github.com/khaos/eros/app/khaos-oss/internal/logic/params.(*sParams).doGetParamsJson\n        /root/workspace/khaos/eros/app/khaos-oss/internal/logic/params/params.go:66\n   2).  github.com/khaos/eros/app/khaos-oss/internal/logic/params.(*sParams).GetParams\n        /root/workspace/khaos/eros/app/khaos-oss/internal/logic/params/params.go:36\n   3).  github.com/khaos/eros/app/khaos-oss/internal/controller.(*cParams).GetOne\n        /root/workspace/khaos/eros/app/khaos-oss/internal/controller/params.go:21\n2. rpc error: code = NotFound desc = cluster.khaos.tencent.com "tdxxxx-a2c378bd" not found\n'})})]})}function l(e={}){let{wrapper:o}={...(0,i.a)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},250065:function(e,o,r){r.d(o,{Z:function(){return g},a:function(){return s}});var t=r(667294);let n={},i=t.createContext(n);function s(e){let o=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function g(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);