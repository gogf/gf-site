"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["49887"],{574802:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,contentTitle:()=>o,default:()=>m,assets:()=>c,toc:()=>d,frontMatter:()=>a});var t=JSON.parse('{"id":"docs/WEB\u670D\u52A1\u5F00\u53D1/\u6570\u636E\u8FD4\u56DE/\u6570\u636E\u8FD4\u56DE-Stream\u8FD4\u56DE","title":"Response - Streaming","description":"Implement HTTP streaming data returns using the GoFrame framework, suitable for framework versions less than v2.4 and above. Achieve efficient streaming data transmission with simplified code, applicable for scenarios requiring long connections and continuous data updates, and provides notices and references.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/WEB\u670D\u52A1\u5F00\u53D1/\u6570\u636E\u8FD4\u56DE/\u6570\u636E\u8FD4\u56DE-Stream\u8FD4\u56DE.md","sourceDirName":"docs/WEB\u670D\u52A1\u5F00\u53D1/\u6570\u636E\u8FD4\u56DE","slug":"/docs/web/response-stream","permalink":"/en/docs/web/response-stream","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/WEB\u670D\u52A1\u5F00\u53D1/\u6570\u636E\u8FD4\u56DE/\u6570\u636E\u8FD4\u56DE-Stream\u8FD4\u56DE.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732451468000,"sidebarPosition":6,"frontMatter":{"slug":"/docs/web/response-stream","title":"Response - Streaming","sidebar_position":6,"hide_title":true,"keywords":["GoFrame","GoFrame Framework","HTTP Streaming Data Return","Streaming Data","v2.4","SSE","Data Return","Stream Processing","Event Stream","Go Language"],"description":"Implement HTTP streaming data returns using the GoFrame framework, suitable for framework versions less than v2.4 and above. Achieve efficient streaming data transmission with simplified code, applicable for scenarios requiring long connections and continuous data updates, and provides notices and references."},"sidebar":"mainSidebar","previous":{"title":"Response - Template Parsing","permalink":"/en/docs/web/response-template"},"next":{"title":"Configuration","permalink":"/en/docs/web/server-config"}}'),s=r("785893"),i=r("250065");let a={slug:"/docs/web/response-stream",title:"Response - Streaming",sidebar_position:6,hide_title:!0,keywords:["GoFrame","GoFrame Framework","HTTP Streaming Data Return","Streaming Data","v2.4","SSE","Data Return","Stream Processing","Event Stream","Go Language"],description:"Implement HTTP streaming data returns using the GoFrame framework, suitable for framework versions less than v2.4 and above. Achieve efficient streaming data transmission with simplified code, applicable for scenarios requiring long connections and continuous data updates, and provides notices and references."},o=void 0,c={},d=[{value:"Framework version &lt; <code>v2.4</code>",id:"framework-version--v24",level:2},{value:"Framework version &gt;= <code>v2.4</code>",id:"framework-version--v24-1",level:2},{value:"Example Result",id:"example-result",level:2},{value:"Precautions",id:"precautions",level:2},{value:"References",id:"references",level:2}];function l(e){let n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"We can easily implement HTTP streaming data return."}),"\n",(0,s.jsxs)(n.h2,{id:"framework-version--v24",children:["Framework version < ",(0,s.jsx)(n.code,{children:"v2.4"})]}),"\n",(0,s.jsxs)(n.p,{children:["If the current framework version is less than ",(0,s.jsx)(n.code,{children:"v2.4"})," final version (not ",(0,s.jsx)(n.code,{children:"beta"})," version), use the following method to return (native standard library writing)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "net/http"\n    "time"\n\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/net/ghttp"\n)\n\nfunc main() {\n    s := g.Server()\n    s.BindHandler("/", func(r *ghttp.Request) {\n        rw := r.Response.RawWriter()\n        flusher, ok := rw.(http.Flusher)\n        if !ok {\n            http.Error(rw, "Streaming unsupported!", http.StatusInternalServerError)\n            return\n        }\n        r.Response.Header().Set("Content-Type", "text/event-stream")\n        r.Response.Header().Set("Cache-Control", "no-cache")\n        r.Response.Header().Set("Connection", "keep-alive")\n\n        for i := 0; i < 100; i++ {\n            _, err := fmt.Fprintf(rw, "data: %d\\n", i)\n            if err != nil {\n                panic(err)\n            }\n            flusher.Flush()\n            time.Sleep(time.Millisecond * 200)\n        }\n    })\n    s.SetPort(8999)\n    s.Run()\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"framework-version--v24-1",children:["Framework version >= ",(0,s.jsx)(n.code,{children:"v2.4"})]}),"\n",(0,s.jsxs)(n.p,{children:["Because the above operation is somewhat cumbersome, operational improvements were made in this version and above. If the current framework version is ",(0,s.jsx)(n.code,{children:"v2.4"})," final version (not ",(0,s.jsx)(n.code,{children:"beta"})," version) or later, you can quickly implement streaming data return using the following method."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "time"\n\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/net/ghttp"\n)\n\nfunc main() {\n    s := g.Server()\n    s.BindHandler("/", func(r *ghttp.Request) {\n        r.Response.Header().Set("Content-Type", "text/event-stream")\n        r.Response.Header().Set("Cache-Control", "no-cache")\n        r.Response.Header().Set("Connection", "keep-alive")\n\n        for i := 0; i < 100; i++ {\n            r.Response.Writefln("data: %d", i)\n            r.Response.Flush()\n            time.Sleep(time.Millisecond * 200)\n        }\n    })\n    s.SetPort(8999)\n    s.Run()\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"example-result",children:"Example Result"}),"\n",(0,s.jsxs)(n.p,{children:["After execution, visiting ",(0,s.jsx)(n.a,{href:"http://127.0.0.1:8999/",children:"http://127.0.0.1:8999/"})," shows data continuously returned to the caller in a streaming manner."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:r(697038).Z+"",width:"1084",height:"720"})}),"\n",(0,s.jsx)(n.h2,{id:"precautions",children:"Precautions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["If used in a controller, the ",(0,s.jsx)(n.code,{children:"Request"})," object can be acquired through the ",(0,s.jsx)(n.code,{children:"g.RequestFromCtx(ctx)"})," method."]}),"\n",(0,s.jsxs)(n.li,{children:["If there is a middleware for pre-unified input and output processing, please place this method outside the middleware scope or use the ",(0,s.jsx)(n.code,{children:"r.ExitAll()"})," method to exit middleware control."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html",children:"Server-Sent Events (SSE)"})})]})}function m(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},697038:function(e,n,r){r.d(n,{Z:function(){return t}});let t=r.p+"assets/images/1a8b7fecfb331ebe454633ac06b27592-6bcae2482acc3ad8fd6d6d0a71d1816b.png"},250065:function(e,n,r){r.d(n,{Z:function(){return o},a:function(){return a}});var t=r(667294);let s={},i=t.createContext(s);function a(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);