"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["67588"],{84185:function(e,n,t){t.r(n),t.d(n,{metadata:()=>o,contentTitle:()=>a,default:()=>d,assets:()=>s,toc:()=>g,frontMatter:()=>i});var o=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6-Handler","title":"Logging - Handler","description":"This article introduces the new customizable log processing Handler feature of the glog component in the GoFrame framework starting from version v2.0. Developers can implement custom log output through the Handler, such as converting logs to Json format or outputting them to third-party services like Graylog. Detailed examples demonstrate how to use Handler for log processing in the GoFrame framework.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6-Handler.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6","slug":"/docs/core/glog-handler","permalink":"/en/docs/core/glog-handler","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6-Handler.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732440306000,"sidebarPosition":6,"frontMatter":{"slug":"/docs/core/glog-handler","title":"Logging - Handler","sidebar_position":6,"hide_title":true,"keywords":["GoFrame","log component","Handler feature","log processing","custom output","Json format","Graylog service","log collection","glog","middleware design"],"description":"This article introduces the new customizable log processing Handler feature of the glog component in the GoFrame framework starting from version v2.0. Developers can implement custom log output through the Handler, such as converting logs to Json format or outputting them to third-party services like Graylog. Detailed examples demonstrate how to use Handler for log processing in the GoFrame framework."},"sidebar":"mainSidebar","previous":{"title":"Logging - Context","permalink":"/en/docs/core/glog-context"},"next":{"title":"Logging - JSON Format","permalink":"/en/docs/core/glog-json"}}'),r=t("785893"),l=t("250065");let i={slug:"/docs/core/glog-handler",title:"Logging - Handler",sidebar_position:6,hide_title:!0,keywords:["GoFrame","log component","Handler feature","log processing","custom output","Json format","Graylog service","log collection","glog","middleware design"],description:"This article introduces the new customizable log processing Handler feature of the glog component in the GoFrame framework starting from version v2.0. Developers can implement custom log output through the Handler, such as converting logs to Json format or outputting them to third-party services like Graylog. Detailed examples demonstrate how to use Handler for log processing in the GoFrame framework."},a=void 0,s={},g=[{value:"Related Definitions",id:"related-definitions",level:2},{value:"<code>Handler</code> Method Definition",id:"handler-method-definition",level:3},{value:"<code>Handler</code> Parameter Definition",id:"handler-parameter-definition",level:3},{value:"Registering <code>Handler</code> to <code>Logger</code> Method",id:"registering-handler-to-logger-method",level:3},{value:"Usage Example",id:"usage-example",level:2},{value:"Example 1: Convert Log Output to <code>Json</code> Format",id:"example-1-convert-log-output-to-json-format",level:3},{value:"Example 2: Output Content to a Third-party Log Collection Service",id:"example-2-output-content-to-a-third-party-log-collection-service",level:3},{value:"Global Default <code>Handler</code>",id:"global-default-handler",level:2},{value:"General Component <code>Handler</code>",id:"general-component-handler",level:2},{value:"<code>HandlerJson</code>",id:"handlerjson",level:3},{value:"<code>HandlerStructure</code>",id:"handlerstructure",level:3}];function c(e){let n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Starting from version ",(0,r.jsx)(n.code,{children:"v2.0"}),", the ",(0,r.jsx)(n.code,{children:"glog"})," component provides a super powerful, customizable log processing ",(0,r.jsx)(n.code,{children:"Handler"})," feature. ",(0,r.jsx)(n.code,{children:"Handler"})," adopts a middleware design approach, allowing developers to register multiple processing ",(0,r.jsx)(n.code,{children:"Handlers"})," for the log object, and also to override the default log component processing logic within the ",(0,r.jsx)(n.code,{children:"Handler"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"related-definitions",children:"Related Definitions"}),"\n",(0,r.jsxs)(n.h3,{id:"handler-method-definition",children:[(0,r.jsx)(n.code,{children:"Handler"})," Method Definition"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"// Handler is function handler for custom logging content outputs.\ntype Handler func(ctx context.Context, in *HandlerInput)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["As you can see, the second parameter is the log information to be processed by the log and is of pointer type, meaning that any attribute information of this parameter can be modified within the ",(0,r.jsx)(n.code,{children:"Handler"}),", and the modified content will be passed to the next ",(0,r.jsx)(n.code,{children:"Handler"}),"."]}),"\n",(0,r.jsxs)(n.h3,{id:"handler-parameter-definition",children:[(0,r.jsx)(n.code,{children:"Handler"})," Parameter Definition"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'// HandlerInput is the input parameter struct for logging Handler.\ntype HandlerInput struct {\n    Logger      *Logger       // Current Logger object.\n    Buffer      *bytes.Buffer // Buffer for logging content outputs.\n    Time        time.Time     // Logging time, which is the time that logging triggers.\n    TimeFormat  string        // Formatted time string, like "2016-01-09 12:00:00".\n    Color       int           // Using color, like COLOR_RED, COLOR_BLUE, etc. Eg: 34\n    Level       int           // Using level, like LEVEL_INFO, LEVEL_ERRO, etc. Eg: 256\n    LevelFormat string        // Formatted level string, like "DEBU", "ERRO", etc. Eg: ERRO\n    CallerFunc  string        // The source function name that calls logging, only available if F_CALLER_FN set.\n    CallerPath  string        // The source file path and its line number that calls logging, only available if F_FILE_SHORT or F_FILE_LONG set.\n    CtxStr      string        // The retrieved context value string from context, only available if Config.CtxKeys configured.\n    TraceId     string        // Trace id, only available if OpenTelemetry is enabled.\n    Prefix      string        // Custom prefix string for logging content.\n    Content     string        // Content is the main logging content without error stack string produced by logger.\n    Values      []any         // The passed un-formatted values array to logger.\n    Stack       string        // Stack string produced by logger, only available if Config.StStatus configured.\n    IsAsync     bool          // IsAsync marks it is in asynchronous logging.\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Developers have ",(0,r.jsx)(n.strong,{children:"two ways"})," to customize log output content through ",(0,r.jsx)(n.code,{children:"Handler"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["One way is to directly modify the attribute information in ",(0,r.jsx)(n.code,{children:"HandlerInput"})," and then continue to execute ",(0,r.jsx)(n.code,{children:"in.Next(ctx)"}),". The default log output logic will print the attributes in ",(0,r.jsx)(n.code,{children:"HandlerInput"})," as a string output."]}),"\n",(0,r.jsxs)(n.li,{children:["Another way is to write log content into the ",(0,r.jsx)(n.code,{children:"Buffer"})," buffer object. If the default log output logic finds that ",(0,r.jsx)(n.code,{children:"Buffer"})," already contains log content, it will ignore the default log output logic."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"registering-handler-to-logger-method",children:["Registering ",(0,r.jsx)(n.code,{children:"Handler"})," to ",(0,r.jsx)(n.code,{children:"Logger"})," Method"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"// SetHandlers sets the logging handlers for current logger.\nfunc (l *Logger) SetHandlers(handlers ...Handler)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,r.jsxs)(n.p,{children:["Let's look at two examples to better understand how to use ",(0,r.jsx)(n.code,{children:"Handler"}),"."]}),"\n",(0,r.jsxs)(n.h3,{id:"example-1-convert-log-output-to-json-format",children:["Example 1: Convert Log Output to ",(0,r.jsx)(n.code,{children:"Json"})," Format"]}),"\n",(0,r.jsxs)(n.p,{children:["In this example, we use a pre-middleware design to modify the log output format to ",(0,r.jsx)(n.code,{children:"JSON"})," format through a custom ",(0,r.jsx)(n.code,{children:"Handler"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n    "encoding/json"\n    "os"\n\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/glog"\n    "github.com/gogf/gf/v2/text/gstr"\n)\n\n// JsonOutputsForLogger is for JSON marshaling in sequence.\ntype JsonOutputsForLogger struct {\n    Time    string `json:"time"`\n    Level   string `json:"level"`\n    Content string `json:"content"`\n}\n\n// LoggingJsonHandler is a example handler for logging JSON format content.\nvar LoggingJsonHandler glog.Handler = func(ctx context.Context, in *glog.HandlerInput) {\n    jsonForLogger := JsonOutputsForLogger{\n        Time:    in.TimeFormat,\n        Level:   gstr.Trim(in.LevelFormat, "[]"),\n        Content: gstr.Trim(in.Content), // For version 2.7 and above, use in.ValuesContent()\n    }\n    jsonBytes, err := json.Marshal(jsonForLogger)\n    if err != nil {\n        _, _ = os.Stderr.WriteString(err.Error())\n        return\n    }\n    in.Buffer.Write(jsonBytes)\n    in.Buffer.WriteString("\\n")\n    in.Next(ctx)\n}\n\nfunc main() {\n    g.Log().SetHandlers(LoggingJsonHandler)\n    ctx := context.TODO()\n    g.Log().Debug(ctx, "Debugging...")\n    g.Log().Warning(ctx, "It is warning info")\n    g.Log().Error(ctx, "Error occurs, please have a check")\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["As you can see, we can control the output log content through the ",(0,r.jsx)(n.code,{children:"Buffer"})," attribute in the ",(0,r.jsx)(n.code,{children:"Handler"}),". If the ",(0,r.jsx)(n.code,{children:"Buffer"})," content is empty after all pre-middleware ",(0,r.jsx)(n.code,{children:"Handlers"})," process, continuing to execute ",(0,r.jsx)(n.code,{children:"Next"})," will execute the default ",(0,r.jsx)(n.code,{children:"Handler"})," logic of the log middleware. After executing the code of this example, the terminal output:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:'{"time":"2021-12-31 11:03:25.438","level":"DEBU","content":"Debugging..."}\n{"time":"2021-12-31 11:03:25.438","level":"WARN","content":"It is warning info"}\n{"time":"2021-12-31 11:03:25.438","level":"ERRO","content":"Error occurs, please have a check \\nStack:\\n1.  main.main\\n    C:/hailaz/test/main.go:42"}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"example-2-output-content-to-a-third-party-log-collection-service",children:"Example 2: Output Content to a Third-party Log Collection Service"}),"\n",(0,r.jsxs)(n.p,{children:["In this example, we use a post-middleware design to output a copy of the log content to a third-party ",(0,r.jsx)(n.code,{children:"graylog"})," log collection service through a custom ",(0,r.jsx)(n.code,{children:"Handler"})," without affecting the original log output processing."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Graylog"})," is comparable to ",(0,r.jsx)(n.code,{children:"ELK"})," and is a centralized log management solution that supports data collection, retrieval, and visualization dashboards. In this example, a simple third-party ",(0,r.jsx)(n.code,{children:"graylog"})," client component is used."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/glog"\n    gelf "github.com/robertkowalski/graylog-golang"\n)\n\nvar grayLogClient = gelf.New(gelf.Config{\n    GraylogPort:     80,\n    GraylogHostname: "graylog-host.com",\n    Connection:      "wan",\n    MaxChunkSizeWan: 42,\n    MaxChunkSizeLan: 1337,\n})\n\n// LoggingGrayLogHandler is an example handler for logging content to remote GrayLog service.\nvar LoggingGrayLogHandler glog.Handler = func(ctx context.Context, in *glog.HandlerInput) {\n    in.Next(ctx)\n    grayLogClient.Log(in.Buffer.String())\n}\n\nfunc main() {\n    g.Log().SetHandlers(LoggingGrayLogHandler)\n    ctx := context.TODO()\n    g.Log().Debug(ctx, "Debugging...")\n    g.Log().Warning(ctx, "It is warning info")\n    g.Log().Error(ctx, "Error occurs, please have a check")\n    glog.Print(ctx, "test log")\n}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"global-default-handler",children:["Global Default ",(0,r.jsx)(n.code,{children:"Handler"})]}),"\n",(0,r.jsxs)(n.p,{children:["By default, the log object does not have any ",(0,r.jsx)(n.code,{children:"Handlers"})," set. From version ",(0,r.jsx)(n.code,{children:"v2.1"}),", the framework provides a feature to set a global default ",(0,r.jsx)(n.code,{children:"Handler"}),". The global default ",(0,r.jsx)(n.code,{children:"Handler"})," will be effective for all log printing functions that use this log component and do not have custom ",(0,r.jsx)(n.code,{children:"Handlers"}),". At the same time, the global default ",(0,r.jsx)(n.code,{children:"Handler"})," will affect the log printing behavior of the log package methods."]}),"\n",(0,r.jsxs)(n.p,{children:["Developers can use the following two methods to set and get the global default ",(0,r.jsx)(n.code,{children:"Handler"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"// SetDefaultHandler sets default handler for package.\nfunc SetDefaultHandler(handler Handler)\n\n// GetDefaultHandler returns the default handler of package.\nfunc GetDefaultHandler() Handler\n"})}),"\n",(0,r.jsx)(n.p,{children:"It should be noted that this method of global package configuration is not thread-safe and often needs to be executed at the very top of the project startup logic."}),"\n",(0,r.jsxs)(n.p,{children:["Usage example, where we use ",(0,r.jsx)(n.code,{children:"JSON"})," format for all project log outputs to ensure log content is structured and each log output is single-line for easy log collection during log collection period:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n    "encoding/json"\n    "os"\n\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/glog"\n    "github.com/gogf/gf/v2/text/gstr"\n)\n\n// JsonOutputsForLogger is for JSON marshaling in sequence.\ntype JsonOutputsForLogger struct {\n    Time    string `json:"time"`\n    Level   string `json:"level"`\n    Content string `json:"content"`\n}\n\n// LoggingJsonHandler is an example handler for logging JSON format content.\nvar LoggingJsonHandler glog.Handler = func(ctx context.Context, in *glog.HandlerInput) {\n    jsonForLogger := JsonOutputsForLogger{\n        Time:    in.TimeFormat,\n        Level:   gstr.Trim(in.LevelFormat, "[]"),\n        Content: gstr.Trim(in.Content), // For version 2.7 and above, use in.ValuesContent()\n    }\n    jsonBytes, err := json.Marshal(jsonForLogger)\n    if err != nil {\n        _, _ = os.Stderr.WriteString(err.Error())\n        return\n    }\n    in.Buffer.Write(jsonBytes)\n    in.Buffer.WriteString("\\n")\n    in.Next(ctx)\n}\n\nfunc main() {\n    ctx := context.TODO()\n    glog.SetDefaultHandler(LoggingJsonHandler)\n\n    g.Log().Debug(ctx, "Debugging...")\n    glog.Warning(ctx, "It is warning info")\n    glog.Error(ctx, "Error occurs, please have a check")\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"After execution, the terminal output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:'{"time":"2022-06-20 10:51:50.235","level":"DEBU","content":"Debugging..."}\n{"time":"2022-06-20 10:51:50.235","level":"WARN","content":"It is warning info"}\n{"time":"2022-06-20 10:51:50.235","level":"ERRO","content":"Error occurs, please have a check"}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"general-component-handler",children:["General Component ",(0,r.jsx)(n.code,{children:"Handler"})]}),"\n",(0,r.jsxs)(n.p,{children:["The component provides a number of general-purpose log ",(0,r.jsx)(n.code,{children:"Handlers"})," to facilitate developer use and improve development efficiency."]}),"\n",(0,r.jsx)(n.h3,{id:"handlerjson",children:(0,r.jsx)(n.code,{children:"HandlerJson"})}),"\n",(0,r.jsxs)(n.p,{children:["This ",(0,r.jsx)(n.code,{children:"Handler"})," can convert log content to ",(0,r.jsx)(n.code,{children:"Json"})," format for printing. Usage example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/glog"\n)\n\nfunc main() {\n    ctx := context.TODO()\n    glog.SetDefaultHandler(glog.HandlerJson)\n\n    g.Log().Debug(ctx, "Debugging...")\n    glog.Warning(ctx, "It is warning info")\n    glog.Error(ctx, "Error occurs, please have a check")\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"After execution, the terminal output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:'{"Time":"2022-06-20 20:04:04.725","Level":"DEBU","Content":"Debugging..."}\n{"Time":"2022-06-20 20:04:04.725","Level":"WARN","Content":"It is warning info"}\n{"Time":"2022-06-20 20:04:04.725","Level":"ERRO","Content":"Error occurs, please have a check","Stack":"1.  main.main\\n    /Users/john/Workspace/Go/GOPATH/src/github.com/gogf/gf/.test/main.go:16\\n"}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"handlerstructure",children:(0,r.jsx)(n.code,{children:"HandlerStructure"})}),"\n",(0,r.jsxs)(n.p,{children:["This ",(0,r.jsx)(n.code,{children:"Handler"})," prints log content in a structured format, primarily to keep the log output content consistent with the ",(0,r.jsx)(n.code,{children:"slog"})," format of the newer versions of ",(0,r.jsx)(n.code,{children:"Golang"}),". It is important to note that the structured log printing feature needs to ensure that all log records use structured output for greater significance. Usage example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n    "net"\n\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/glog"\n)\n\nfunc main() {\n    ctx := context.TODO()\n    glog.SetDefaultHandler(glog.HandlerStructure)\n\n    g.Log().Info(ctx, "caution", "name", "admin")\n    glog.Error(ctx, "oops", net.ErrClosed, "status", 500)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"After execution, the terminal output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:'Time="2023-11-23 21:00:08.671" Level=INFO Content=caution name=admin\nTime="2023-11-23 21:00:08.671" Level=ERRO oops="use of closed network connection" status=500 Stack="1.  main.main\\n    /Users/txqiangguo/Workspace/gogf/gf/example/.test/main.go:16\\n"\n'})})]})}function d(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return a},a:function(){return i}});var o=t(667294);let r={},l=o.createContext(r);function i(e){let n=o.useContext(l);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(l.Provider,{value:n},e.children)}}}]);