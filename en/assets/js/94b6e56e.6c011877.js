"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["83092"],{818009:function(e,n,t){t.r(n),t.d(n,{metadata:()=>i,contentTitle:()=>o,default:()=>h,assets:()=>s,toc:()=>d,frontMatter:()=>a});var i=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406/\u914D\u7F6E\u7BA1\u7406-\u914D\u7F6E\u76D1\u542C\u56DE\u8C03","title":"Configuration - Watcher Callback","description":"WatcherAdapter is an interface in the gcfg package for implementing configuration file change monitoring functionality. When configuration files are modified, created, deleted, or have permission changes, registered watchers will be notified.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406/\u914D\u7F6E\u7BA1\u7406-\u914D\u7F6E\u76D1\u542C\u56DE\u8C03.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406","slug":"/docs/core/gcfg-watcher","permalink":"/en/docs/core/gcfg-watcher","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u914D\u7F6E\u7BA1\u7406/\u914D\u7F6E\u7BA1\u7406-\u914D\u7F6E\u76D1\u542C\u56DE\u8C03.md","tags":[],"version":"current","lastUpdatedBy":"hailaz","lastUpdatedAt":1764683635000,"sidebarPosition":6,"frontMatter":{"slug":"/docs/core/gcfg-watcher","title":"Configuration - Watcher Callback","sidebar_position":6,"hide_title":true,"keywords":["GoFrame","GoFrame Framework","Configuration Management","Interface Design","High Extensibility","Configuration Watcher","Custom Callback","Watcher"],"description":"WatcherAdapter is an interface in the gcfg package for implementing configuration file change monitoring functionality. When configuration files are modified, created, deleted, or have permission changes, registered watchers will be notified."},"sidebar":"mainSidebar","previous":{"title":"Configuration - TOML","permalink":"/en/docs/core/gcfg-toml"},"next":{"title":"Logging","permalink":"/en/docs/core/glog"}}'),r=t("785893"),c=t("250065");let a={slug:"/docs/core/gcfg-watcher",title:"Configuration - Watcher Callback",sidebar_position:6,hide_title:!0,keywords:["GoFrame","GoFrame Framework","Configuration Management","Interface Design","High Extensibility","Configuration Watcher","Custom Callback","Watcher"],description:"WatcherAdapter is an interface in the gcfg package for implementing configuration file change monitoring functionality. When configuration files are modified, created, deleted, or have permission changes, registered watchers will be notified."},o=void 0,s={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Interface Definition",id:"interface-definition",level:2},{value:"Adapter Support Status:",id:"adapter-support-status",level:3},{value:"Core Concepts",id:"core-concepts",level:3},{value:"Main Features",id:"main-features",level:3},{value:"Usage",id:"usage",level:2},{value:"1. Using Watcher with File Adapter",id:"1-using-watcher-with-file-adapter",level:3},{value:"2. Using Watcher with Content Adapter",id:"2-using-watcher-with-content-adapter",level:3},{value:"3. Using with gcfg.Config Instance",id:"3-using-with-gcfgconfig-instance",level:3},{value:"Watcher Context Information",id:"watcher-context-information",level:2},{value:"Practical Application Scenarios",id:"practical-application-scenarios",level:2}];function l(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(n.p,{children:["Starting from version ",(0,r.jsx)(n.code,{children:"v2.9.5"}),", the ",(0,r.jsx)(n.code,{children:"gcfg"})," component introduces the ",(0,r.jsx)(n.code,{children:"WatcherAdapter"})," interface. ",(0,r.jsx)(n.code,{children:"WatcherAdapter"})," is an interface in the ",(0,r.jsx)(n.code,{children:"gcfg"})," package for implementing configuration file change monitoring functionality. When configuration files are modified, created, deleted, or have permission changes, registered watchers will be notified."]}),"\n",(0,r.jsxs)(n.p,{children:["The configuration watching feature of ",(0,r.jsx)(n.code,{children:"GoFrame"})," provides applications with the ability to dynamically respond to configuration changes, allowing the system to adjust its behavior in real-time without restarting. Through the flexible watcher mechanism and rich context information, developers can easily build adaptive applications."]}),"\n",(0,r.jsx)(n.h2,{id:"interface-definition",children:"Interface Definition"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/gogf/gf/blob/master/os/gcfg/gcfg_adaper.go",children:"https://github.com/gogf/gf/blob/master/os/gcfg/gcfg_adaper.go"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"// WatcherAdapter is the interface for configuration watcher.\ntype WatcherAdapter interface {\n	// AddWatcher adds a watcher function for specified `pattern` and `resource`.\n	AddWatcher(name string, fn func(ctx context.Context))\n	// RemoveWatcher removes the watcher function for specified `pattern` and `resource`.\n	RemoveWatcher(name string)\n	// GetWatcherNames returns all watcher names.\n	GetWatcherNames() []string\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"adapter-support-status",children:"Adapter Support Status:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Adapter Name"}),(0,r.jsx)(n.th,{children:"Supports Watcher Callback"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AdapterFile"})}),(0,r.jsx)(n.td,{children:"Supported"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AdapterContent"})}),(0,r.jsx)(n.td,{children:"Supported"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"polaris"})}),(0,r.jsx)(n.td,{children:"Supported"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nacos"})}),(0,r.jsx)(n.td,{children:"Supported"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"apollo"})}),(0,r.jsx)(n.td,{children:"Supported"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"consul"})}),(0,r.jsx)(n.td,{children:"Supported"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"kubecm"})}),(0,r.jsx)(n.td,{children:"Supported"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WatcherAdapter"})," interface: Defines methods for adding, removing, and retrieving watchers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WatcherRegistry"}),": Watcher registration manager that provides a unified watcher management implementation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"context"})," passing: Passes detailed configuration change information through ",(0,r.jsx)(n.code,{children:"context"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"main-features",children:"Main Features"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"File Monitoring"}),": Automatically monitors configuration file changes (write, create, delete, rename, permission change)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Manual Trigger"}),": Supports manually triggering watcher callbacks (such as ",(0,r.jsx)(n.code,{children:"Set"})," operations)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Concurrency Safe"}),": All operations are concurrency safe"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Panic Protection"}),": Each watcher execution runs in an independent ",(0,r.jsx)(n.code,{children:"goroutine"})," with panic recovery mechanism"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsxs)(n.p,{children:["Let me demonstrate how to use the ",(0,r.jsx)(n.code,{children:"WatcherAdapter"})," functionality through example code:"]}),"\n",(0,r.jsx)(n.h3,{id:"1-using-watcher-with-file-adapter",children:"1. Using Watcher with File Adapter"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'// Create configuration adapter\nc, err := gcfg.NewAdapterFile("config.toml")\nif err != nil {\n    panic(err)\n}\n\n// Add watcher\nc.AddWatcher("my-watcher", func(ctx context.Context) {\n    // Get file operation context information\n    fileCtx := gcfg.GetAdapterFileCtx(ctx)\n    \n    fmt.Printf("Operation Type: %s\\n", fileCtx.GetOperation())\n    fmt.Printf("File Name: %s\\n", fileCtx.GetFileName())\n    fmt.Printf("File Path: %s\\n", fileCtx.GetFilePath())\n    \n    // Handle different operation types\n    switch fileCtx.GetOperation() {\n    case gcfg.OperationWrite:\n        fmt.Println("Configuration file was modified")\n    case gcfg.OperationSet:\n        fmt.Printf("Configuration key %s was set to %v\\n", fileCtx.GetKey(), fileCtx.GetValue())\n    }\n})\n\n// Modifying configuration will trigger the watcher\nc.Set("key", "new-value")\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-using-watcher-with-content-adapter",children:"2. Using Watcher with Content Adapter"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'// Create content adapter\ncontent := `{"key": "value"}`\nadapter, err := gcfg.NewAdapterContent(content)\nif err != nil {\n    panic(err)\n}\n\n// Add watcher\nadapter.AddWatcher("content-watcher", func(ctx context.Context) {\n    contentCtx := gcfg.GetAdapterContentCtx(ctx)\n    fmt.Printf("Content Operation: %s\\n", contentCtx.GetOperation())\n})\n\n// Setting new content will trigger the watcher\nadapter.SetContent(`{"key": "new-value"}`)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-using-with-gcfgconfig-instance",children:"3. Using with gcfg.Config Instance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'// Create configuration instance\nconfig := g.Cfg()\n\n// Add watcher to the configuration instance\'s adapter\nif adapter, ok := config.GetAdapter().(gcfg.WatcherAdapter); ok {\n    adapter.AddWatcher("config-watcher", func(ctx context.Context) {\n        fmt.Println("Configuration has changed")\n    })\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"watcher-context-information",children:"Watcher Context Information"}),"\n",(0,r.jsxs)(n.p,{children:["Depending on the adapter type, different information can be obtained through the corresponding context. Please refer to the ",(0,r.jsx)(n.code,{children:"xxxAdapterCtx"})," implementation of different adapter types for details."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, with ",(0,r.jsx)(n.code,{children:"nacos"}),", you can get ",(0,r.jsx)(n.code,{children:"*NacosAdapterCtx"})," through ",(0,r.jsx)(n.code,{children:"adapterCtx := nacos.GetAdapterCtx(ctx)"})]}),"\n",(0,r.jsxs)(n.p,{children:["Located at: ",(0,r.jsx)(n.code,{children:"contrib/config/nacos/nacos_adapter_ctx.go"})]}),"\n",(0,r.jsx)(n.p,{children:"Context key constants:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ContextKeyNamespace"}),": Namespace"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ContextKeyGroup"}),": Group"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ContextKeyDataId"}),": Data ID"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"gcfg.ContextKeyOperation"}),": Operation type (inherited from gcfg)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"gcfg.ContextKeyContent"}),": Content being set (inherited from gcfg)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Methods:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WithOperation()"}),": Set operation type"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WithNamespace()"}),": Set namespace"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WithGroup()"}),": Set group"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WithDataId()"}),": Set data ID"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WithContent()"}),": Set content"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GetNamespace()"}),": Get namespace"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GetGroup()"}),": Get group"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GetDataId()"}),": Get data ID"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GetContent()"}),": Get content"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GetOperation()"}),": Get operation type"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"practical-application-scenarios",children:"Practical Application Scenarios"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Dynamic Configuration Updates"}),": When configuration files are modified, applications can automatically reload configurations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Logging"}),": Record configuration change history"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Notification Mechanism"}),": Notify other components when configuration changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Cache Clearing"}),": Clear related caches when configuration changes"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return o},a:function(){return a}});var i=t(667294);let r={},c=i.createContext(r);function a(e){let n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);