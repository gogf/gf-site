"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["60529"],{120772:function(e,n,o){o.r(n),o.d(n,{metadata:()=>i,contentTitle:()=>d,default:()=>h,assets:()=>r,toc:()=>c,frontMatter:()=>a});var i=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C/ORM\u94FE\u5F0F\u64CD\u4F5C-\u6A21\u578B\u521B\u5EFA","title":"ORM Model - Model","description":"Using the ORM tool in the GoFrame framework for chaining operations, focusing on model creation, the use of Model objects, and ways to ensure chaining safety. By using the Model and Raw methods, model objects can be created on default and switched database configurations. It also explores the implementation of chaining safety, including default non-chaining safety, Clone method cloning, Safe method setting for chaining safety, and more operational techniques.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C/ORM\u94FE\u5F0F\u64CD\u4F5C-\u6A21\u578B\u521B\u5EFA.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C","slug":"/docs/core/gdb-chaining-model","permalink":"/en/docs/core/gdb-chaining-model","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u94FE\u5F0F\u64CD\u4F5C/ORM\u94FE\u5F0F\u64CD\u4F5C-\u6A21\u578B\u521B\u5EFA.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732440306000,"sidebarPosition":0,"frontMatter":{"slug":"/docs/core/gdb-chaining-model","title":"ORM Model - Model","sidebar_position":0,"hide_title":true,"keywords":["GoFrame","GoFrame Framework","Chaining Operations","Model Creation","Model Object","g.Model","Raw Method","Chaining Safety","Clone Method","Safe Method"],"description":"Using the ORM tool in the GoFrame framework for chaining operations, focusing on model creation, the use of Model objects, and ways to ensure chaining safety. By using the Model and Raw methods, model objects can be created on default and switched database configurations. It also explores the implementation of chaining safety, including default non-chaining safety, Clone method cloning, Safe method setting for chaining safety, and more operational techniques."},"sidebar":"mainSidebar","previous":{"title":"ORM - Model \uD83D\uDD25","permalink":"/en/docs/core/gdb-chaining"},"next":{"title":"ORM Model - Insert/Save","permalink":"/en/docs/core/gdb-chaining-insert-save"}}'),t=o("785893"),s=o("250065");let a={slug:"/docs/core/gdb-chaining-model",title:"ORM Model - Model",sidebar_position:0,hide_title:!0,keywords:["GoFrame","GoFrame Framework","Chaining Operations","Model Creation","Model Object","g.Model","Raw Method","Chaining Safety","Clone Method","Safe Method"],description:"Using the ORM tool in the GoFrame framework for chaining operations, focusing on model creation, the use of Model objects, and ways to ensure chaining safety. By using the Model and Raw methods, model objects can be created on default and switched database configurations. It also explores the implementation of chaining safety, including default non-chaining safety, Clone method cloning, Safe method setting for chaining safety, and more operational techniques."},d=void 0,r={},c=[{value:"Model Creation",id:"model-creation",level:2},{value:"<code>Model</code>",id:"model",level:3},{value:"<code>Raw</code>",id:"raw",level:3},{value:"Chaining Safety",id:"chaining-safety",level:2},{value:"Default Situation",id:"default-situation",level:3},{value:"<code>Clone</code> Method",id:"clone-method",level:3},{value:"<code>Safe</code> Method",id:"safe-method",level:3}];function l(e){let n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"model-creation",children:"Model Creation"}),"\n",(0,t.jsx)(n.h3,{id:"model",children:(0,t.jsx)(n.code,{children:"Model"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"Model"})," method is used to create a ",(0,t.jsx)(n.code,{children:"Model"})," object based on a data table. Commonly, you can also use the ",(0,t.jsx)(n.code,{children:"Model"})," method in the ",(0,t.jsx)(n.code,{children:"g"})," object management module to create a ",(0,t.jsx)(n.code,{children:"Model"})," object on the default database configuration."]}),"\n",(0,t.jsx)(n.p,{children:"Usage example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'g.Model("user")\n// Or\ng.DB().Model("user")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Additionally, in certain scenarios, you can switch the database object of the current model through the ",(0,t.jsx)(n.code,{children:"DB"})," method, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'m := g.Model("user")\nm  = m.DB(g.DB("order"))\n'})}),"\n",(0,t.jsx)(n.p,{children:"This is equivalent to the following operation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'m := g.DB("user").Model("user")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"raw",children:(0,t.jsx)(n.code,{children:"Raw"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"Raw"})," method is used to create a ",(0,t.jsx)(n.code,{children:"Model"})," object based on a raw ",(0,t.jsx)(n.code,{children:"SQL"})," statement. You can also use the ",(0,t.jsx)(n.code,{children:"ModelRaw"})," method in the ",(0,t.jsx)(n.code,{children:"g"})," object management module to create a ",(0,t.jsx)(n.code,{children:"Model"})," object on the default database configuration given an ",(0,t.jsx)(n.code,{children:"SQL"})," statement."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'s := "SELECT * FROM `user`"\nm, _ := g.ModelRaw(s).WhereLT("age", 18).Limit(10).OrderAsc("id").All()\n// SELECT * FROM `user` WHERE `age`<18 ORDER BY `id` ASC LIMIT 10\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'s := "SELECT * FROM `user` WHERE `status` IN(?)"\nm, _ := g.ModelRaw(s, g.Slice{1,2,3}).WhereLT("age", 18).Limit(10).OrderAsc("id").All()\n// SELECT * FROM `user` WHERE `status` IN(1,2,3) AND `age`<18 ORDER BY `id` ASC LIMIT 10\n'})}),"\n",(0,t.jsx)(n.h2,{id:"chaining-safety",children:"Chaining Safety"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Chaining Safety"})," is simply the distinction between two ways of model operations: one modifies the current ",(0,t.jsx)(n.code,{children:"model"})," object (unsafe, default), and one does not (safe) but requires using assignment operations for model property modification/condition stacking, that's all."]}),"\n",(0,t.jsx)(n.h3,{id:"default-situation",children:"Default Situation"}),"\n",(0,t.jsxs)(n.p,{children:["By default, ",(0,t.jsx)(n.code,{children:"gdb"})," is ",(0,t.jsx)(n.code,{children:"non-chaining safe"}),", meaning each method of the chaining operation will modify the ",(0,t.jsx)(n.code,{children:"Model"})," properties of the current operation. Hence, the ",(0,t.jsx)(n.code,{children:"Model"})," object ",(0,t.jsx)(n.strong,{children:"cannot be reused"}),". For instance, when there are separate query conditions, we can use the ",(0,t.jsx)(n.code,{children:"Model"})," object as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'user := g.Model("user")\nuser.Where("status", g.Slice{1,2,3})\nif vip {\n    // Automatically stack query conditions, modifying the current model\n    user.Where("money>=?", 1000000)\n} else {\n    // Automatically stack query conditions, modifying the current model\n    user.Where("money<?",  1000000)\n}\n//  vip: SELECT * FROM user WHERE status IN(1,2,3) AND money >= 1000000\n// !vip: SELECT * FROM user WHERE status IN(1,2,3) AND money < 1000000\nr, err := user.All()\n//  vip: SELECT COUNT(1) FROM user WHERE status IN(1,2,3) AND money >= 1000000\n// !vip: SELECT COUNT(1) FROM user WHERE status IN(1,2,3) AND money < 1000000\nn, err := user.Count()\n'})}),"\n",(0,t.jsxs)(n.p,{children:["As observed, if chaining operations are executed separately, each operation in the chain will modify the existing ",(0,t.jsx)(n.code,{children:"Model"})," object, and the query conditions will automatically stack, so the ",(0,t.jsx)(n.code,{children:"user"})," object cannot be reused; otherwise, conditions will keep stacking. Also, in this usage mode, whenever we need to operate on the ",(0,t.jsx)(n.code,{children:"user"})," table, we must use syntax like ",(0,t.jsx)(n.code,{children:'g.DB().Table("user")'})," to create a new ",(0,t.jsx)(n.code,{children:"user"})," model object, which can be quite cumbersome."]}),"\n",(0,t.jsxs)(n.p,{children:["By default, considering performance and GC optimization, model objects are ",(0,t.jsx)(n.code,{children:"non-chaining safe"})," to prevent creating too many temporary model objects. ",(0,t.jsx)(n.img,{alt:"(Smile)",src:o(490553).Z+"",width:"16",height:"16"})]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["However, it should be noted that if you are using ",(0,t.jsx)(n.code,{children:"dao"})," generated by the cli tool ",(0,t.jsx)(n.code,{children:"gen dao"}),", like ",(0,t.jsx)(n.code,{children:"user := dao.User.Ctx(ctx)"}),", the obtained ",(0,t.jsx)(n.code,{children:"user"})," ",(0,t.jsx)(n.code,{children:"Model"})," object is chaining safe by default (automatically called ",(0,t.jsx)(n.code,{children:".Safe()"}),")."]})}),"\n",(0,t.jsxs)(n.h3,{id:"clone-method",children:[(0,t.jsx)(n.code,{children:"Clone"})," Method"]}),"\n",(0,t.jsxs)(n.p,{children:["Additionally, you can manually invoke the ",(0,t.jsx)(n.code,{children:"Clone"})," method to clone the current model, creating a new model to achieve chaining safety. Since it is a new model object, there is no concern about modifying the existing model object, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// Define a user model singleton\nuser := g.Model("user")\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// Clone a new user model\nm := user.Clone()\nm.Where("status", g.Slice{1,2,3})\nif vip {\n    m.Where("money>=?", 1000000)\n} else {\n    m.Where("money<?",  1000000)\n}\n//  vip: SELECT * FROM user WHERE status IN(1,2,3) AND money >= 1000000\n// !vip: SELECT * FROM user WHERE status IN(1,2,3) AND money < 1000000\nr, err := m.All()\n//  vip: SELECT COUNT(1) FROM user WHERE status IN(1,2,3) AND money >= 1000000\n// !vip: SELECT COUNT(1) FROM user WHERE status IN(1,2,3) AND money < 1000000\nn, err := m.Count()\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"safe-method",children:[(0,t.jsx)(n.code,{children:"Safe"})," Method"]}),"\n",(0,t.jsxs)(n.p,{children:["Of course, you can set the current model to be ",(0,t.jsx)(n.code,{children:"chaining safe"})," through the ",(0,t.jsx)(n.code,{children:"Safe"})," method, and each subsequent chaining operation will return a new ",(0,t.jsx)(n.code,{children:"Model"})," object that can be reused. However, it is important to note that modifications to model properties or stacking of operation conditions need to be achieved through variable assignments (",(0,t.jsx)(n.code,{children:"m = m.xxx"}),") to overwrite the original model object, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// Define a user model singleton\nuser := g.Model("user").Safe()\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'m := user.Where("status", g.Slice{1,2,3})\nif vip {\n    // Query conditions stacked through assignment\n    m = m.Where("money>=?", 1000000)\n} else {\n    // Query conditions stacked through assignment\n    m = m.Where("money<?",  1000000)\n}\n//  vip: SELECT * FROM user WHERE status IN(1,2,3) AND money >= 1000000\n// !vip: SELECT * FROM user WHERE status IN(1,2,3) AND money < 1000000\nr, err := m.All()\n//  vip: SELECT COUNT(1) FROM user WHERE status IN(1,2,3) AND money >= 1000000\n// !vip: SELECT COUNT(1) FROM user WHERE status IN(1,2,3) AND money < 1000000\nn, err := m.Count()\n'})}),"\n",(0,t.jsxs)(n.p,{children:["As seen, the user model singleton object ",(0,t.jsx)(n.code,{children:"user"}),' in the example can be reused without worrying about being "polluted". Under this chaining safety approach, we can create a user singleton object ',(0,t.jsx)(n.code,{children:"user"})," and reuse it in various subsequent queries. However, when there are multiple query conditions, condition stacking needs to be achieved through model assignment operations (",(0,t.jsx)(n.code,{children:"m = m.xxx"}),")."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["After using the ",(0,t.jsx)(n.code,{children:"Safe"})," method, each chaining operation will create a new temporary model object (using ",(0,t.jsx)(n.code,{children:"Clone"})," internally to achieve model cloning), thereby achieving chaining safety. This usage is quite common in model operations."]})})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},490553:function(e,n,o){o.d(n,{Z:function(){return i}});let i="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJNMCAxNmgxNlYwSDB6Ii8+PC9kZWZzPjxnIHRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIC0xIDAgMTYpIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxtYXNrIGlkPSJiIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNhIi8+PC9tYXNrPjxnIG1hc2s9InVybCgjYikiIGZpbGwtcnVsZT0ibm9uemVybyI+PHBhdGggZD0iTTE2IDhBOCA4IDAgMSAwIDAgOGE4IDggMCAwIDAgMTYgMCIgZmlsbD0iI0ZGQ0M0RCIvPjxwYXRoIGQ9Ik00LjY3MyA1LjUwMmMuMDItLjA4LjUyLTEuOTQ2IDMuMzI3LTEuOTQ2IDIuODA4IDAgMy4zMDcgMS44NjYgMy4zMjYgMS45NDZhLjIyMi4yMjIgMCAwIDEtLjM3MS4yMTJjLS4wMDktLjAwOS0uODY5LS44MjUtMi45NTUtLjgyNS0yLjA4NiAwLTIuOTQ3LjgxNi0yLjk1NS44MjVhLjIyNC4yMjQgMCAwIDEtLjI2Ni4wMzUuMjIyLjIyMiAwIDAgMS0uMTA2LS4yNDdNNi40NDQgMTBjMC0uODYtLjQ5Ny0xLjU1Ni0xLjExLTEuNTU2LS42MTQgMC0xLjExMi42OTYtMS4xMTIgMS41NTYgMCAuODYuNDk4IDEuNTU2IDEuMTExIDEuNTU2LjYxNCAwIDEuMTExLS42OTcgMS4xMTEtMS41NTZNMTEuNzc4IDEwYzAtLjg2LS40OTgtMS41NTYtMS4xMTEtMS41NTYtLjYxNCAwLTEuMTExLjY5Ni0xLjExMSAxLjU1NiAwIC44Ni40OTcgMS41NTYgMS4xMSAxLjU1Ni42MTQgMCAxLjExMi0uNjk3IDEuMTEyLTEuNTU2IiBmaWxsPSIjNjY0NTAwIi8+PC9nPjwvZz48L3N2Zz4="},250065:function(e,n,o){o.d(n,{Z:function(){return d},a:function(){return a}});var i=o(667294);let t={},s=i.createContext(t);function a(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);