"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["90830"],{410520:function(e,t,n){n.r(t),n.d(t,{metadata:()=>o,contentTitle:()=>r,default:()=>u,assets:()=>l,toc:()=>d,frontMatter:()=>s});var o=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u4F7F\u7528\u914D\u7F6E/ORM\u4F7F\u7528\u914D\u7F6E-\u914D\u7F6E\u6587\u4EF6","title":"ORM Configuration - File","description":"Manage database configurations using GoFrame framework\'s configuration component, including the recommended yaml format configuration file. Easily obtain singleton objects for database operations through the g object. Supports configurations in multiple data formats and simplified connection methods, enabling cluster mode and log output functionality.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u4F7F\u7528\u914D\u7F6E/ORM\u4F7F\u7528\u914D\u7F6E-\u914D\u7F6E\u6587\u4EF6.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u4F7F\u7528\u914D\u7F6E","slug":"/docs/core/gdb-config-file","permalink":"/en/docs/core/gdb-config-file","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u4F7F\u7528\u914D\u7F6E/ORM\u4F7F\u7528\u914D\u7F6E-\u914D\u7F6E\u6587\u4EF6.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732541616000,"sidebarPosition":0,"frontMatter":{"slug":"/docs/core/gdb-config-file","title":"ORM Configuration - File","sidebar_position":0,"hide_title":true,"keywords":["GoFrame","GoFrame Framework","Database Configuration","Configuration File","ORM","Database Management","yaml Configuration","Data Format","Cluster Mode","Log Configuration"],"description":"Manage database configurations using GoFrame framework\'s configuration component, including the recommended yaml format configuration file. Easily obtain singleton objects for database operations through the g object. Supports configurations in multiple data formats and simplified connection methods, enabling cluster mode and log output functionality."},"sidebar":"mainSidebar","previous":{"title":"ORM - Configuration","permalink":"/en/docs/core/gdb-config"},"next":{"title":"ORM Configuration - Methods","permalink":"/en/docs/core/gdb-config-funcs"}}'),i=n("785893"),a=n("250065");let s={slug:"/docs/core/gdb-config-file",title:"ORM Configuration - File",sidebar_position:0,hide_title:!0,keywords:["GoFrame","GoFrame Framework","Database Configuration","Configuration File","ORM","Database Management","yaml Configuration","Data Format","Cluster Mode","Log Configuration"],description:"Manage database configurations using GoFrame framework's configuration component, including the recommended yaml format configuration file. Easily obtain singleton objects for database operations through the g object. Supports configurations in multiple data formats and simplified connection methods, enabling cluster mode and log output functionality."},r=void 0,l={},d=[{value:"Simple Configuration",id:"simple-configuration",level:2},{value:"Complete Configuration",id:"complete-configuration",level:2},{value:"Cluster Mode",id:"cluster-mode",level:2},{value:"Log Configuration",id:"log-configuration",level:2}];function c(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["We recommend using the configuration component to manage database configurations and the ",(0,i.jsx)(t.code,{children:'g.DB("database group name")'})," method in the g object management module to obtain database operation objects. The database object will automatically read the corresponding configuration items from the configuration component and automatically initialize the singleton object for that database operation. The database configuration management functionality is implemented using a configuration management component (the configuration component adopts an interface design and uses a file system implementation by default), and also supports various data formats like ",(0,i.jsx)(t.code,{children:"toml/yaml/json/xml/ini/properties"}),". The default and recommended configuration file data format is ",(0,i.jsx)(t.code,{children:"yaml"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"simple-configuration",children:"Simple Configuration"}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["From version ",(0,i.jsx)(t.code,{children:"v2.2.0"}),", when using ",(0,i.jsx)(t.code,{children:"link"})," for database configuration, the database component unifies the configuration formats for different database types to simplify configuration management."]})}),"\n",(0,i.jsxs)(t.p,{children:["The simplified configuration is specified through the ",(0,i.jsx)(t.code,{children:"link"})," configuration item, with the format as follows:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"type:username:password@protocol(address)[/dbname][?param1=value1&...&paramN=valueN]\n"})}),"\n",(0,i.jsx)(t.p,{children:"That is:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"Type:Account:Password@Protocol(Address)/DatabaseName?FeatureConfiguration\n"})}),"\n",(0,i.jsx)(t.p,{children:"Where:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"DatabaseName"})," and ",(0,i.jsx)(t.strong,{children:"FeatureConfiguration"})," are optional parameters; other parameters are required."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Protocol"})," optional configurations are: ",(0,i.jsx)(t.code,{children:"tcp/udp/unix/file"}),", commonly ",(0,i.jsx)(t.code,{children:"tcp"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"FeatureConfiguration"})," is defined by the third-party driver implemented by the database type, check the third-party driver's official website for specifics. For example, for the ",(0,i.jsx)(t.code,{children:"mysql"})," driver, the third-party driver used is: ",(0,i.jsx)(t.a,{href:"https://github.com/go-sql-driver/mysql",children:"https://github.com/go-sql-driver/mysql"})," supporting features like ",(0,i.jsx)(t.code,{children:"multiStatements"})," and ",(0,i.jsx)(t.code,{children:"loc"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'database:\n  default:\n    link:  "mysql:root:12345678@tcp(127.0.0.1:3306)/test"\n  user:\n    link:  "sqlite::@file(/var/data/db.sqlite3)"\n  local:\n    link:  "mysql:username:password@unix(/tmp/mysql.sock)/dbname"\n'})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"link"})," examples for different data types are as follows:"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Type"}),(0,i.jsx)(t.th,{children:"link Example"}),(0,i.jsx)(t.th,{children:"extra parameters"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"mysql"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"mysql:root:12345678@tcp(127.0.0.1:3306)/test?loc=Local&parseTime=true"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/go-sql-driver/mysql",children:"mysql"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"mariadb"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"mariadb:root:12345678@tcp(127.0.0.1:3306)/test?loc=Local&parseTime=true"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/go-sql-driver/mysql",children:"mysql"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"tidb"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"tidb:root:12345678@tcp(127.0.0.1:3306)/test?loc=Local&parseTime=true"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/go-sql-driver/mysql",children:"mysql"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"pgsql"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"pgsql:root:12345678@tcp(127.0.0.1:5432)/test"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/lib/pq",children:"pq"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"mssql"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"mssql:root:12345678@tcp(127.0.0.1:1433)/test?encrypt=disable"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/microsoft/go-mssqldb",children:"go-mssqldb"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"sqlite"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"sqlite::@file(/var/data/db.sqlite3)"})}),(0,i.jsxs)(t.td,{children:["pure go:",(0,i.jsx)(t.a,{href:"https://github.com/glebarez/go-sqlite",children:"go-sqlite"})," ",(0,i.jsx)("br",{})," 32bit-cgo:",(0,i.jsx)(t.a,{href:"https://github.com/mattn/go-sqlite3",children:"go-sqlite3"})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"oracle"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"oracle:root:12345678@tcp(127.0.0.1:5432)/test"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/sijms/go-ora",children:"go-ora"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"clickhouse"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"clickhouse:root:12345678@tcp(127.0.0.1:9000)/test"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/ClickHouse/clickhouse-go",children:"clickhouse-go"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"dm"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"dm:root:12345678@tcp(127.0.0.1:5236)/test"})}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://gitee.com/chunanyong/dm",children:"dm"})})]})]})]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["For more database types supported by the framework, please refer to: ",(0,i.jsx)(t.a,{href:"https://github.com/gogf/gf/tree/master/contrib/drivers",children:"https://github.com/gogf/gf/tree/master/contrib/drivers"})]})}),"\n",(0,i.jsx)(t.h2,{id:"complete-configuration",children:"Complete Configuration"}),"\n",(0,i.jsxs)(t.p,{children:["The data format of the complete ",(0,i.jsx)(t.code,{children:"config.yaml"})," database configuration item is as follows:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'database:\n  default:                      # Group Name, customizable, default is default\n    host: "127.0.0.1"           # Address\n    port: "3306"                # Port\n    user: "root"                # Username\n    pass: "your_password"       # Password\n    name: "your_database"       # Database Name\n    type: "mysql"               # Database Type (e.g., mariadb/tidb/mysql/pgsql/mssql/sqlite/oracle/clickhouse/dm)\n    link: ""                    # (Optional) Custom database link information, if this field is set, the above link fields (Host, Port, User, Pass, Name, Type) will be invalid\n    extra: ""                   # (Optional) Additional feature configurations for different databases, defined by the underlying database driver, please see the specific database driver overview for what configurations are available\n    role: "master"              # (Optional) Database master-slave role (master/slave), default is master. If not using application master-slave mechanism please do not configure or leave empty.\n    debug: false                # (Optional) Enable debug mode\n    prefix: "gf_"               # (Optional) Table name prefix\n    dryRun: false               # (Optional) ORM Dry Run (read-only, no writing)\n    charset: "utf8"             # (Optional) Database encoding (e.g., utf8mb4/utf8/gbk/gb2312), usually set to utf8mb4. Default is utf8.\n    protocol: "tcp"             # (Optional) Database connection protocol, default is TCP\n    weight: 100                 # (Optional) Load balancing weight, used for load balancing control, not using application layer load balancing mechanism please leave empty\n    timezone: "Local"           # (Optional) Time zone configuration, e.g., Local\n    namespace: ""               # (Optional) To support the catalog & schema distinction problem of some database services, the original schema represents the database name, while the NameSpace represents the schema of some database services\n    maxIdle: 10                 # (Optional) Maximum number of idle connections in the connection pool (default 10)\n    maxOpen: 100                # (Optional) Maximum number of open connections in the connection pool (default unlimited)\n    maxLifetime: "30s"          # (Optional) Duration of reuse for connection objects (default 30 seconds)\n    queryTimeout: "0"           # (Optional) Query statement timeout duration (default unlimited, also affected by ctx timeout). The value is in time.Parse supported formats, such as 30s, 1m.\n    execTimeout: "0"            # (Optional) Write statement timeout duration (default unlimited, also affected by ctx timeout). The value is in time.Parse supported formats, such as 30s, 1m.\n    tranTimeout: "0"            # (Optional) Transaction processing timeout duration (default unlimited, also affected by ctx timeout). The value is in time.Parse supported formats, such as 30s, 1m.\n    prepareTimeout: "0"         # (Optional) Prepared SQL statement execution timeout duration (default unlimited, also affected by ctx timeout). The value is in time.Parse supported formats, such as 30s, 1m.\n    createdAt: "created_at"     # (Optional) Field name for automatic creation time\n    updatedAt: "updated_at"     # (Optional) Field name for automatic update time\n    deletedAt: "deleted_at"     # (Optional) Field name for soft delete time\n    timeMaintainDisabled: false # (Optional) Whether to completely disable the time update feature, when true CreatedAt/UpdatedAt/DeletedAt will all be invalid\n'})}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["When using this configuration method, ",(0,i.jsxs)(t.strong,{children:["to ensure database security, the underlying by default does not support multi-line ",(0,i.jsx)(t.code,{children:"SQL"})," statement execution"]}),". For more configuration control, refer to the recommended simplified ",(0,i.jsx)(t.code,{children:"link"})," configuration, and understand the function of each connection parameter in the simplified configuration, as well as the official additional configuration parameters for the corresponding driver."]})}),"\n",(0,i.jsx)(t.h2,{id:"cluster-mode",children:"Cluster Mode"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"gdb"})," supports cluster mode configuration; each configuration item group in database configurations can be multiple nodes, supporting load balancing weight strategies, for example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'database:\n  default:\n  - link: "mysql:root:12345678@tcp(127.0.0.1:3306)/test"\n    role: "master"\n  - link: "mysql:root:12345678@tcp(127.0.0.1:3306)/test"\n    role: "slave"\n\n  user:\n  - link: "mysql:root:12345678@tcp(127.0.0.1:3306)/user"\n    role: "master"\n  - link: "mysql:root:12345678@tcp(127.0.0.1:3306)/user"\n    role: "slave"\n  - link: "mysql:root:12345678@tcp(127.0.0.1:3306)/user"\n    role: "slave"\n'})}),"\n",(0,i.jsxs)(t.p,{children:["The database configuration example above includes two database groups ",(0,i.jsx)(t.code,{children:"default"})," and ",(0,i.jsx)(t.code,{children:"user"}),", where the ",(0,i.jsx)(t.code,{children:"default"})," group contains one master and one slave, and the ",(0,i.jsx)(t.code,{children:"user"})," group contains one master and two slaves. In the code, you can use ",(0,i.jsx)(t.code,{children:"g.DB()"})," and ",(0,i.jsx)(t.code,{children:'g.DB("user")'})," to get the corresponding database connection object."]}),"\n",(0,i.jsx)(t.h2,{id:"log-configuration",children:"Log Configuration"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"gdb"})," supports log output, using the ",(0,i.jsx)(t.code,{children:"glog.Logger"})," object internally for log management, and it can be configured through configuration files. By default, ",(0,i.jsx)(t.code,{children:"gdb"})," disables the ",(0,i.jsx)(t.code,{children:"DEBUG"})," log output; to enable ",(0,i.jsx)(t.code,{children:"DEBUG"})," messages, set the database's ",(0,i.jsx)(t.code,{children:"debug"})," parameter to ",(0,i.jsx)(t.code,{children:"true"}),". Below is a configuration file example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'database:\n  logger:\n    path:    "/var/log/gf-app/sql"\n    level:   "all"\n    stdout:  true\n  default:\n    link:    "mysql:root:12345678@tcp(127.0.0.1:3306)/user_center"\n    debug:   true\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Where ",(0,i.jsx)(t.code,{children:"database.logger"})," is the log configuration for ",(0,i.jsx)(t.code,{children:"gdb"}),", which is a special configuration item. When this configuration does not exist, the default configuration of the logging component will be used.\nFor more details, refer to the ",(0,i.jsx)(t.a,{href:"/en/docs/core/glog-config",children:"Logging - Configuration"})," section."]}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:["Please note: since the ",(0,i.jsx)(t.code,{children:"ORM"})," uses a secure preprocessing execution method at the lower layer, the submitted ",(0,i.jsx)(t.code,{children:"SQL"})," and parameters are actually separate. Therefore, the complete ",(0,i.jsx)(t.code,{children:"SQL"})," recorded in logs is for reference and convenient manual reading only and is not the actual ",(0,i.jsx)(t.code,{children:"SQL"})," submitted to the lower layer."]})})]})}function u(e={}){let{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return r},a:function(){return s}});var o=n(667294);let i={},a=o.createContext(i);function s(e){let t=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);