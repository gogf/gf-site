"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["92161"],{506779:function(e,o,i){i.r(o),i.d(o,{metadata:()=>t,contentTitle:()=>l,default:()=>g,assets:()=>a,toc:()=>c,frontMatter:()=>s});var t=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6-Rotate\u7279\u6027","title":"Logging - Rotatation","description":"Log rolling rotation feature of the glog component in GoFrame framework, including setting log file names to output by date, rolling rotation with RotateSize and RotateExpire, support for log file compression and backup, configuration examples, considerations, and more. Provides detailed configuration options and example code to help developers better manage log files.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6-Rotate\u7279\u6027.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6","slug":"/docs/core/glog-rotate","permalink":"/en/docs/core/glog-rotate","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6/\u65E5\u5FD7\u7EC4\u4EF6-Rotate\u7279\u6027.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732440306000,"sidebarPosition":13,"frontMatter":{"slug":"/docs/core/glog-rotate","title":"Logging - Rotatation","sidebar_position":13,"hide_title":true,"keywords":["GoFrame","GoFrame framework","glog","log component","log rotation","log rolling","log compression","log configuration","file format","log backup"],"description":"Log rolling rotation feature of the glog component in GoFrame framework, including setting log file names to output by date, rolling rotation with RotateSize and RotateExpire, support for log file compression and backup, configuration examples, considerations, and more. Provides detailed configuration options and example code to help developers better manage log files."},"sidebar":"mainSidebar","previous":{"title":"Logging - Flags","permalink":"/en/docs/core/glog-flags"},"next":{"title":"Logging - FAQ","permalink":"/en/docs/core/glog-faq"}}'),n=i("785893"),r=i("250065");let s={slug:"/docs/core/glog-rotate",title:"Logging - Rotatation",sidebar_position:13,hide_title:!0,keywords:["GoFrame","GoFrame framework","glog","log component","log rotation","log rolling","log compression","log configuration","file format","log backup"],description:"Log rolling rotation feature of the glog component in GoFrame framework, including setting log file names to output by date, rolling rotation with RotateSize and RotateExpire, support for log file compression and backup, configuration examples, considerations, and more. Provides detailed configuration options and example code to help developers better manage log files."},l=void 0,a={},c=[{value:"Feature Activation",id:"feature-activation",level:3},{value:"File Format",id:"file-format",level:3},{value:"Configuration Examples",id:"configuration-examples",level:3},{value:"Considerations",id:"considerations",level:3}];function d(e){let o={admonition:"admonition",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.admonition,{type:"warning",children:(0,n.jsx)(o.p,{children:"The rolling rotation is currently an experimental feature; feel free to provide feedback if you encounter issues."})}),"\n",(0,n.jsxs)(o.p,{children:["In previous sections, we learned that the ",(0,n.jsx)(o.code,{children:"glog"})," component supports setting log file names to output logs by date. Starting from ",(0,n.jsx)(o.code,{children:"GoFrame v1.12"}),", the ",(0,n.jsx)(o.code,{children:"glog"})," component also supports the rolling rotation feature for log files, which involves the following configuration options in the log object configuration properties:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-go",children:"RotateSize           int64          // Rotate the logging file if its size > 0 in bytes.\nRotateExpire         time.Duration  // Rotate the logging file if its mtime exceeds this duration.\nRotateBackupLimit    int            // Max backup for rotated files, default is 0, means no backups.\nRotateBackupExpire   time.Duration  // Max expire for rotated files, which is 0 in default, means no expiration.\nRotateBackupCompress int            // Compress level for rotated files using gzip algorithm. It's 0 in default, means no compression.\nRotateCheckInterval  time.Duration  // Asynchronously checks the backups and expiration at intervals. It's 1 hour by default.\n"})}),"\n",(0,n.jsx)(o.p,{children:"Brief Explanation:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"RotateSize"})," is used to specify the size-based rotation trigger. This property is in bytes, and the rotation will only be activated when it is greater than 0."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"RotateExpire"})," sets the duration trigger for rotation based on file modification times. The feature is activated only if this property is greater than 0."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"RotateBackupLimit"})," sets the number of backup files kept after rotation, defaulting to 0, which means no backups. It usually should be set greater than 0. Files exceeding this backup number will be deleted from oldest to newest."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"RotateBackupExpire"})," configures the deletion of rotated files based on their age."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"RotateBackupCompress"})," indicates the compression level for rotated files, default is 0, meaning no compression. The range for compression levels is ",(0,n.jsx)(o.code,{children:"1-9"}),", where ",(0,n.jsx)(o.code,{children:"9"})," denotes the maximum compression level."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"RotateCheckInterval"})," sets the interval for asynchronous backup and expiration checks, with a default of 1 hour, which typically does not need configuration."]}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"feature-activation",children:"Feature Activation"}),"\n",(0,n.jsxs)(o.p,{children:["The rolling rotation feature, as indicated by the above configuration options, will only be active if ",(0,n.jsx)(o.code,{children:"RotateSize"})," or ",(0,n.jsx)(o.code,{children:"RotateExpire"})," is configured, and is off by default."]}),"\n",(0,n.jsx)(o.h3,{id:"file-format",children:"File Format"}),"\n",(0,n.jsxs)(o.p,{children:["The ",(0,n.jsx)(o.code,{children:"glog"})," component outputs logs in a fixed file format ",(0,n.jsx)(o.code,{children:"*.log"}),", using ",(0,n.jsx)(o.code,{children:".log"}),' as the log file name suffix. To standardize and manage easily, the format of rotated files is fixed and not customizable by developers. When files are rotated, they are renamed in the format " ',(0,n.jsx)(o.code,{children:"*.rotation_time.log"}),'", where ',(0,n.jsx)(o.code,{children:"rotation_time"})," is formatted as: ",(0,n.jsx)(o.code,{children:"YYYYMMDDHHMMSSmmmuuu"}),", for example:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-html",children:"access.log          -> access.20200326101301899002.log\naccess.20200326.log -> access.20200326.20200326101301899002.log\n"})}),"\n",(0,n.jsx)(o.h3,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"Example 1, rotating based on log file size:"}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-yaml",children:'logger:\n     Path:                  "/var/log"\n     Level:                 "all"\n     Stdout:                false\n     RotateSize:            "100M"\n     RotateBackupLimit:     2\n     RotateBackupExpire:    "7d"\n     RotateBackupCompress:  9\n'})}),"\n",(0,n.jsx)(o.p,{children:"Brief Explanation:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["The ",(0,n.jsx)(o.code,{children:"RotateSize"})," option can be set as a string in the config file, e.g., ",(0,n.jsx)(o.code,{children:"100M"}),", ",(0,n.jsx)(o.code,{children:"200MB"}),", ",(0,n.jsx)(o.code,{children:"500KB"}),", ",(0,n.jsx)(o.code,{children:"1Gib"}),", etc. In this example, we rotate when the log file size exceeds ",(0,n.jsx)(o.code,{children:"100M"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:["Similarly, ",(0,n.jsx)(o.code,{children:"RotateBackupExpire"})," can be string-configured with values like ",(0,n.jsx)(o.code,{children:"1h"}),", ",(0,n.jsx)(o.code,{children:"30m"}),", ",(0,n.jsx)(o.code,{children:"1d6h"}),", ",(0,n.jsx)(o.code,{children:"7d"}),", etc. Here, set to ",(0,n.jsx)(o.code,{children:"7d"})," to automatically delete rotated files after seven days."]}),"\n",(0,n.jsxs)(o.li,{children:["Setting ",(0,n.jsx)(o.code,{children:"RotateBackupCompress"})," to ",(0,n.jsx)(o.code,{children:"9"})," indicates using the highest compression level for minimized storage of rotated files. Note that rotation and compression are separate actions; file compression is asynchronous, and after auto-rotation, the scheduler periodically compresses the files to ",(0,n.jsx)(o.code,{children:"*.gz"}),". Higher compression levels will consume more CPU resources."]}),"\n"]}),"\n",(0,n.jsxs)(o.ol,{start:"2",children:["\n",(0,n.jsx)(o.li,{children:"Example 2, rotating based on file modification expiration:"}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-yaml",children:'logger:\n     Path:                  "/var/log"\n     Level:                 "all"\n     Stdout:                false\n     RotateExpire:          "1d"\n     RotateBackupLimit:     1\n     RotateBackupExpire:    "7d"\n     RotateBackupCompress:  9\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Here, ",(0,n.jsx)(o.code,{children:"RotateExpire"})," is set to ",(0,n.jsx)(o.code,{children:"1d"})," meaning if a log file hasn't been modified or written to within a day, the ",(0,n.jsx)(o.code,{children:"glog"})," module will automatically rotate it, compressing it for storage."]}),"\n",(0,n.jsx)(o.h3,{id:"considerations",children:"Considerations"}),"\n",(0,n.jsx)(o.p,{children:"Due to differing rolling rotation configurations among log objects, if multiple log objects share the same directory and have rotation enabled, there might be conflicts leading to unexpected outcomes. Thus, we recommend you consider two strategies:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Use the global default logging singleton object ( ",(0,n.jsx)(o.code,{children:"g.Log()"}),"), specifying different directories or file names using the ",(0,n.jsx)(o.code,{children:"Cat"})," or ",(0,n.jsx)(o.code,{children:"File"})," methods."]}),"\n",(0,n.jsxs)(o.li,{children:["Set different output directories ( ",(0,n.jsx)(o.code,{children:"Path"})," configuration) for different log objects ( ",(0,n.jsx)(o.code,{children:"g.Log(name)"}),") ensuring no hierarchical overlap among them."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["For example, with two types of business log files ",(0,n.jsx)(o.code,{children:"order"})," and ",(0,n.jsx)(o.code,{children:"promo"})," for order and promotion business respectively, within the same service program:"]}),"\n",(0,n.jsxs)(o.p,{children:["If the log path is ",(0,n.jsx)(o.code,{children:"/var/log"}),", you could:"]}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Output order logs via ",(0,n.jsx)(o.code,{children:'g.Log().Cat("order").Print(xxx)'}),", resulting in log files like: ",(0,n.jsx)(o.code,{children:"/var/log/order/2020-03-26.log"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:["Output promotion logs via ",(0,n.jsx)(o.code,{children:'g.Log().Cat("promo").Print(xxx)'}),", resulting in log files like: ",(0,n.jsx)(o.code,{children:"/var/log/promo/2020-03-26.log"}),"."]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Alternatively:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Use ",(0,n.jsx)(o.code,{children:'g.Log("order").Print(xxx)'})," for order logs, creating files like: ",(0,n.jsx)(o.code,{children:"/var/log/order.log"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:["Use ",(0,n.jsx)(o.code,{children:'g.Log("promo").Print(xxx)'})," for promotion logs, creating files like: ",(0,n.jsx)(o.code,{children:"/var/log/promo.log"}),"."]}),"\n"]})]})}function g(e={}){let{wrapper:o}={...(0,r.a)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},250065:function(e,o,i){i.d(o,{Z:function(){return l},a:function(){return s}});var t=i(667294);let n={},r=t.createContext(n);function s(e){let o=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),t.createElement(r.Provider,{value:o},e.children)}}}]);