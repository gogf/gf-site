"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["6893"],{691837:function(e,n,i){i.r(n),i.d(n,{metadata:()=>t,contentTitle:()=>r,default:()=>u,assets:()=>d,toc:()=>c,frontMatter:()=>a});var t=JSON.parse('{"id":"docs/\u6846\u67B6\u8BBE\u8BA1/\u5DE5\u7A0B\u5F00\u53D1\u8BBE\u8BA1/DAO\u5C01\u88C5\u8BBE\u8BA1/DAO-\u7EC4\u4EF6\u75DB\u70B9\u53CA\u6539\u8FDB","title":"Pain Points and Improvements In ORM Component","description":"The advantages of using DAO design in the GoFrame framework, and the pain points and solutions in using existing ORM components. Through DAO design, it greatly improves development and maintenance efficiency, reduces code coupling, and increases observability support. The article details how to overcome common issues when using ORM, such as field mapping, hardcoding, and data structure inconsistencies. Additionally, the improvement design includes the encapsulation of DAO objects and support for SQL logging functionality.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6846\u67B6\u8BBE\u8BA1/\u5DE5\u7A0B\u5F00\u53D1\u8BBE\u8BA1/DAO\u5C01\u88C5\u8BBE\u8BA1/DAO-\u7EC4\u4EF6\u75DB\u70B9\u53CA\u6539\u8FDB.md","sourceDirName":"docs/\u6846\u67B6\u8BBE\u8BA1/\u5DE5\u7A0B\u5F00\u53D1\u8BBE\u8BA1/DAO\u5C01\u88C5\u8BBE\u8BA1","slug":"/docs/design/project-dao-pain","permalink":"/en/docs/design/project-dao-pain","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6846\u67B6\u8BBE\u8BA1/\u5DE5\u7A0B\u5F00\u53D1\u8BBE\u8BA1/DAO\u5C01\u88C5\u8BBE\u8BA1/DAO-\u7EC4\u4EF6\u75DB\u70B9\u53CA\u6539\u8FDB.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1733708461000,"sidebarPosition":0,"frontMatter":{"slug":"/docs/design/project-dao-pain","title":"Pain Points and Improvements In ORM Component","sidebar_position":0,"hide_title":true,"keywords":["DAO","GoFrame","Data Access Object","ORM","GRPC","Database Optimization","Code Encapsulation","Automatic Mapping","SQL Logs","Code Generation"],"description":"The advantages of using DAO design in the GoFrame framework, and the pain points and solutions in using existing ORM components. Through DAO design, it greatly improves development and maintenance efficiency, reduces code coupling, and increases observability support. The article details how to overcome common issues when using ORM, such as field mapping, hardcoding, and data structure inconsistencies. Additionally, the improvement design includes the encapsulation of DAO objects and support for SQL logging functionality."},"sidebar":"mainSidebar","previous":{"title":"DAO Encapsulation","permalink":"/en/docs/design/project-dao"},"next":{"title":"Pain Points and Improvements In Business Project","permalink":"/en/docs/design/project-dao-improvement"}}'),s=i("785893"),o=i("250065");let a={slug:"/docs/design/project-dao-pain",title:"Pain Points and Improvements In ORM Component",sidebar_position:0,hide_title:!0,keywords:["DAO","GoFrame","Data Access Object","ORM","GRPC","Database Optimization","Code Encapsulation","Automatic Mapping","SQL Logs","Code Generation"],description:"The advantages of using DAO design in the GoFrame framework, and the pain points and solutions in using existing ORM components. Through DAO design, it greatly improves development and maintenance efficiency, reduces code coupling, and increases observability support. The article details how to overcome common issues when using ORM, such as field mapping, hardcoding, and data structure inconsistencies. Additionally, the improvement design includes the encapsulation of DAO objects and support for SQL logging functionality."},r=void 0,d={},c=[{value:"1. Current <code>ORM</code> Usage Example",id:"1-current-orm-usage-example",level:2},{value:"1. Need to Define Models",id:"1-need-to-define-models",level:3},{value:"2. <code>GRPC</code> Interface Implementation Example",id:"2-grpc-interface-implementation-example",level:3},{value:"2. Description of Current Pain Points",id:"2-description-of-current-pain-points",level:2},{value:"1. Must Define <code>tag</code> to Associate Table Structure with <code>struct</code> Properties, Cannot Achieve Automatic Mapping",id:"1-must-define-tag-to-associate-table-structure-with-struct-properties-cannot-achieve-automatic-mapping",level:3},{value:"2. Does Not Support Specifying Fields to Query via the Return Object",id:"2-does-not-support-specifying-fields-to-query-via-the-return-object",level:3},{value:"3. Unable to Automatically Filter Field Names of Input Object Properties",id:"3-unable-to-automatically-filter-field-names-of-input-object-properties",level:3},{value:"4. Need to Create Intermediate Query Result Objects for Assignment and Conversion",id:"4-need-to-create-intermediate-query-result-objects-for-assignment-and-conversion",level:3},{value:"5. Need to Pre-initialize Return Objects Regardless of Whether Data is Queried",id:"5-need-to-pre-initialize-return-objects-regardless-of-whether-data-is-queried",level:3},{value:"6. Entire Project Uses Low-Level Bare <code>DB</code> Object Operations Without Object Encapsulation",id:"6-entire-project-uses-low-level-bare-db-object-operations-without-object-encapsulation",level:3},{value:"7. Ubiquitous String Hardcoding, such as Table Names and Field Hardcoding",id:"7-ubiquitous-string-hardcoding-such-as-table-names-and-field-hardcoding",level:3},{value:"8. Too Many Pointer Property Definitions Caused by the Underlying ORM",id:"8-too-many-pointer-property-definitions-caused-by-the-underlying-orm",level:3},{value:"9. Support for Observability: Tracing, Metrics, Logging",id:"9-support-for-observability-tracing-metrics-logging",level:3},{value:"10. Data Set and Code Data Entity Structure Mismatch",id:"10-data-set-and-code-data-entity-structure-mismatch",level:3},{value:"3. Improvement Design",id:"3-improvement-design",level:2}];function l(e){let n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The design of ",(0,s.jsx)(n.code,{children:"DAO"})," (Data Access Object) is actually a significant part of the engineering practices in the ",(0,s.jsx)(n.code,{children:"GoFrame"})," framework."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"DAO"})," design, combined with the ",(0,s.jsx)(n.code,{children:"ORM"})," component of ",(0,s.jsx)(n.code,{children:"GoFrame"}),", offers strong performance and ease of use, which can greatly enhance development and maintenance efficiency. After reading this chapter, individuals should be able to understand and appreciate the advantages of using DAO database access object design."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"I review this article every year to see if any parts can be removed. However, I am always disappointed because this article still applies to the current situation. I have even added new content this year."})}),"\n",(0,s.jsxs)(n.h2,{id:"1-current-orm-usage-example",children:["1. Current ",(0,s.jsx)(n.code,{children:"ORM"})," Usage Example"]}),"\n",(0,s.jsx)(n.h3,{id:"1-need-to-define-models",children:"1. Need to Define Models"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{src:i(351892).Z+"",width:"1065",height:"432"})," Basic User Table (for demonstration purposes only, real table has dozens of fields)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{src:i(508799).Z+"",width:"1160",height:"646"})," Doctor Information Table (for demonstration purposes only, real table has hundreds of fields)"]}),"\n",(0,s.jsxs)(n.h3,{id:"2-grpc-interface-implementation-example",children:["2. ",(0,s.jsx)(n.code,{children:"GRPC"})," Interface Implementation Example"]}),"\n",(0,s.jsxs)(n.p,{children:["A simple ",(0,s.jsx)(n.code,{children:"GRPC"})," information query interface."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{src:i(718841).Z+"",width:"1154",height:"894"})," A simple ",(0,s.jsx)(n.code,{children:"GRPC"})," data query interface"]}),"\n",(0,s.jsx)(n.h2,{id:"2-description-of-current-pain-points",children:"2. Description of Current Pain Points"}),"\n",(0,s.jsxs)(n.h3,{id:"1-must-define-tag-to-associate-table-structure-with-struct-properties-cannot-achieve-automatic-mapping",children:["1. Must Define ",(0,s.jsx)(n.code,{children:"tag"})," to Associate Table Structure with ",(0,s.jsx)(n.code,{children:"struct"})," Properties, Cannot Achieve Automatic Mapping"]}),"\n",(0,s.jsxs)(n.p,{children:["There is already a certain correlation rule between table fields and entity object property names, making it unnecessary to define and maintain a large number of ",(0,s.jsx)(n.code,{children:"tags"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(994130).Z+"",width:"769",height:"644"})}),"\n",(0,s.jsxs)(n.p,{children:["A large number of unnecessary ",(0,s.jsx)(n.code,{children:"tag"})," definitions used to map database table fields to entity object properties"]}),"\n",(0,s.jsx)(n.h3,{id:"2-does-not-support-specifying-fields-to-query-via-the-return-object",children:"2. Does Not Support Specifying Fields to Query via the Return Object"}),"\n",(0,s.jsxs)(n.p,{children:["You cannot specify query fields via the structure of the returned object. Either you can only ",(0,s.jsx)(n.code,{children:"SELECT *"})," or manually input query fields through additional methods, which is inefficient."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(825597).Z+"",width:"912",height:"657"})}),"\n",(0,s.jsxs)(n.p,{children:["Common ",(0,s.jsx)(n.code,{children:"SELECT *"})," operation, unable to specify query fields based on the interface object"]}),"\n",(0,s.jsx)(n.h3,{id:"3-unable-to-automatically-filter-field-names-of-input-object-properties",children:"3. Unable to Automatically Filter Field Names of Input Object Properties"}),"\n",(0,s.jsx)(n.p,{children:"Once the input and output data structures are defined, the output data structure already contains the field names we need to query. Developers define a return object with the expectation that only the fields needed will be queried, automatically filtering out unnecessary properties."}),"\n",(0,s.jsx)(n.h3,{id:"4-need-to-create-intermediate-query-result-objects-for-assignment-and-conversion",children:"4. Need to Create Intermediate Query Result Objects for Assignment and Conversion"}),"\n",(0,s.jsxs)(n.p,{children:["Query results do not support intelligent ",(0,s.jsx)(n.code,{children:"struct"})," conversion, requiring an additional intermediate ",(0,s.jsx)(n.code,{children:"model"})," model and using other tools to copy, which is inefficient."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(796355).Z+"",width:"2252",height:"1294"})}),"\n",(0,s.jsx)(n.p,{children:"Existence of an intermediate temporary model object for taking query results and assigning values to the return structure object"}),"\n",(0,s.jsx)(n.h3,{id:"5-need-to-pre-initialize-return-objects-regardless-of-whether-data-is-queried",children:"5. Need to Pre-initialize Return Objects Regardless of Whether Data is Queried"}),"\n",(0,s.jsxs)(n.p,{children:["This approach is inelegant, impacts performance, and is not ",(0,s.jsx)(n.code,{children:"GC"})," friendly. Expectation is to auto-create return objects only when data is queried and do nothing if no data is found."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(470692).Z+"",width:"935",height:"640"})}),"\n",(0,s.jsx)(n.p,{children:"Need to pre-initialize return objects regardless of whether data is queried"}),"\n",(0,s.jsxs)(n.h3,{id:"6-entire-project-uses-low-level-bare-db-object-operations-without-object-encapsulation",children:["6. Entire Project Uses Low-Level Bare ",(0,s.jsx)(n.code,{children:"DB"})," Object Operations Without Object Encapsulation"]}),"\n",(0,s.jsxs)(n.p,{children:["Most ",(0,s.jsx)(n.code,{children:"Golang"})," beginners seem to prefer using a global ",(0,s.jsx)(n.code,{children:"DB"})," object to create a specific table ",(0,s.jsx)(n.code,{children:"Model"})," object for ",(0,s.jsx)(n.code,{children:"CRUD"})," operations. This approach lacks a layered code design, ",(0,s.jsx)(n.strong,{children:"resulting in high coupling between data operations and business logic"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(658702).Z+"",width:"1133",height:"668"})}),"\n",(0,s.jsxs)(n.p,{children:["Primitive database object operation without ",(0,s.jsx)(n.code,{children:"DAO"})," encapsulation"]}),"\n",(0,s.jsx)(n.h3,{id:"7-ubiquitous-string-hardcoding-such-as-table-names-and-field-hardcoding",children:"7. Ubiquitous String Hardcoding, such as Table Names and Field Hardcoding"}),"\n",(0,s.jsxs)(n.p,{children:["For instance, if the field ",(0,s.jsx)(n.code,{children:"userId"})," is accidentally written as ",(0,s.jsx)(n.code,{children:"UserId"})," or ",(0,s.jsx)(n.code,{children:"userid"}),", and tests do not fully cover this, it could lead to a new accident under certain circumstances."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(416653).Z+"",width:"2402",height:"1304"})}),"\n",(0,s.jsx)(n.p,{children:"\u5927\u91CF\u7684\u5B57\u7B26\u4E32\u786C\u7F16\u7801"}),"\n",(0,s.jsx)(n.h3,{id:"8-too-many-pointer-property-definitions-caused-by-the-underlying-orm",children:"8. Too Many Pointer Property Definitions Caused by the Underlying ORM"}),"\n",(0,s.jsxs)(n.p,{children:["Pointer property objects lay hidden risks for business logic processing, requiring developers to switch between pointers and properties in the code logic, especially since basic types often need to pass parameters by re-evaluation. If the input parameter is of ",(0,s.jsx)(n.code,{children:"interface{}"})," type, it is easier to cause ",(0,s.jsx)(n.code,{children:"BUG"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(336465).Z+"",width:"2464",height:"1730"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"BUG"})," example, inappropriate use of pointer properties causing logical errors in address comparison."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(650138).Z+"",width:"2264",height:"1716"})}),"\n",(0,s.jsx)(n.p,{children:"This also affects the design of business model structure definitions, leading developers to form incorrect habits (upper business model pointer properties often cater to the lower-level data table entity objects for convenient data transmission)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(599349).Z+"",width:"2432",height:"1730"})}),"\n",(0,s.jsx)(n.p,{children:"Notably, a common mistake is using the lower-level data entity model as the top-leve business model. This issue is particularly evident when pointer properties are used in the lower-level data entity objects."}),"\n",(0,s.jsx)(n.h3,{id:"9-support-for-observability-tracing-metrics-logging",children:"9. Support for Observability: Tracing, Metrics, Logging"}),"\n",(0,s.jsx)(n.p,{children:"As the most critical core component of business projects, supporting observability is crucial."}),"\n",(0,s.jsx)(n.h3,{id:"10-data-set-and-code-data-entity-structure-mismatch",children:"10. Data Set and Code Data Entity Structure Mismatch"}),"\n",(0,s.jsx)(n.p,{children:"When data entity structures are manually maintained, there is often a risk of inconsistency between data sets and code data entity structures, resulting in high development and maintenance costs."}),"\n",(0,s.jsx)(n.h2,{id:"3-improvement-design",children:"3. Improvement Design"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"No special tag definitions needed for query result objects, fully automatic association mapping"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Support automatic identification of query fields based on the specified object instead of all ",(0,s.jsx)(n.code,{children:"SELECT *"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Support automatic filtering of non-existent field contents based on the specified object"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"DAO"})," object encapsulation code design, operating data tables via object methods"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"DAO"})," objects encapsulate associated table and field names to avoid string hardcoding"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"No need to predefine entity objects for receiving results, nor create intermediate entities for interface return object assignment and conversion"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Query result objects are not pre-initialized, automatically created only when data is queried"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Built-in support for ",(0,s.jsx)(n.code,{children:"OpenTelemetry"})," standards, achieving observability, greatly improving maintenance efficiency, reducing costs"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Support for ",(0,s.jsx)(n.code,{children:"SQL"})," log output capabilities, with on/off switch functionality"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Decoupling of data models, data operations, and business logic, supporting automated generation of ",(0,s.jsx)(n.code,{children:"Dao"})," and ",(0,s.jsx)(n.code,{children:"Model"})," code tools, ensuring consistency of data sets and code data structure, improving development efficiency, and facilitating the implementation of standards"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Etc."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(867645).Z+"",width:"2464",height:"650"})}),"\n",(0,s.jsxs)(n.p,{children:["Code example after improvement using ",(0,s.jsx)(n.code,{children:"DAO"})," design"]})]})}function u(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},796355:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/05bf7722da09a27e7ca82bf6e0f89271-c1fa3d038052e85f8ac34728e8852f44.png"},470692:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/239f4b75b4b77e85bca523371a7dd1b4-9c664ceb37f7b1fda957f96d5864811b.png"},416653:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/46d8aae38995327c6ce26832d21f628b-aab20cf6cfc3aeb8b4bd9d12e9e87b3d.png"},336465:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/620c8a9a4a47de0243748d588aa0bb51-7d237ccc764b58b03cb7d9c1e0e49d53.png"},825597:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/70e01c869632543b846b04a1696e9737-cd7d25aa20a2d730369db62469f90510.png"},351892:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/77daf5d299eabade856d950ab3161f94-b50361a3a6232ba6d81f0d79e67df4c5.png"},867645:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/90537635dc3b5623060fa9edfc49948a-6e0517950a26ea1562c25067f1c811ec.png"},718841:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/b45b3af0a0bdc9ad30f739e31d0039ae-88e9e808d4ffdf213440b3e3bdc4770b.png"},599349:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/bba716ea66e03727826ae6401ce01b2d-d3b19578993ec7e5f59cc5025a0e5fb1.png"},658702:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/d73fdaa5b76b831db0a2c1069742c218-105f68f458e290a2d03dc0a450c4f6fe.png"},650138:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/daa08ad1e9102f4ac964a8176a80e061-867ac37ef33fa994f2f6af27c3fcc2c7.png"},994130:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/f1bb2d203d4fe4f2c44bbc7e14b7832a-f3782e20453de0d57c8efeb5e5f2238a.png"},508799:function(e,n,i){i.d(n,{Z:function(){return t}});let t=i.p+"assets/images/f4e8c70ee25ec329f2b64bb3a53ff503-1d32e08995f781aa0ffe379eba54a94d.png"},250065:function(e,n,i){i.d(n,{Z:function(){return r},a:function(){return a}});var t=i(667294);let s={},o=t.createContext(s);function a(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);