"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["22936"],{540168:function(e,t,i){i.r(t),i.d(t,{metadata:()=>n,contentTitle:()=>r,default:()=>u,assets:()=>d,toc:()=>c,frontMatter:()=>s});var n=JSON.parse('{"id":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5/\u5229\u7528\u6307\u9488\u5C5E\u6027\u548Cdo\u5BF9\u8C61\u5B9E\u73B0\u7075\u6D3B\u7684\u4FEE\u6539\u63A5\u53E3","title":"Utilizing Pointer Properties and Do Objects for Flexible Modification Interfaces","description":"Utilizing pointer and do objects in the GoFrame framework to implement flexible modification interface APIs. By using attributes with pointer types and do objects, developers can easily perform user information modification operations, including updates to fields like password, nickname, and status, effectively simplifying the complexity of database updates.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5/\u5229\u7528\u6307\u9488\u5C5E\u6027\u548Cdo\u5BF9\u8C61\u5B9E\u73B0\u7075\u6D3B\u7684\u4FEE\u6539\u63A5\u53E3.md","sourceDirName":"docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5","slug":"/docs/core/gdb-practice-using-pointer-and-do-for-update-api","permalink":"/en/docs/core/gdb-practice-using-pointer-and-do-for-update-api","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/docs/\u6838\u5FC3\u7EC4\u4EF6/\u6570\u636E\u5E93ORM/ORM\u6700\u4F73\u5B9E\u8DF5/\u5229\u7528\u6307\u9488\u5C5E\u6027\u548Cdo\u5BF9\u8C61\u5B9E\u73B0\u7075\u6D3B\u7684\u4FEE\u6539\u63A5\u53E3.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1733833866000,"sidebarPosition":0,"frontMatter":{"slug":"/docs/core/gdb-practice-using-pointer-and-do-for-update-api","title":"Utilizing Pointer Properties and Do Objects for Flexible Modification Interfaces","sidebar_position":0,"hide_title":true,"keywords":["GoFrame","GoFrame framework","do objects","pointer","API","user information modification","database update","request parameters","business logic","automatic filtering"],"description":"Utilizing pointer and do objects in the GoFrame framework to implement flexible modification interface APIs. By using attributes with pointer types and do objects, developers can easily perform user information modification operations, including updates to fields like password, nickname, and status, effectively simplifying the complexity of database updates."},"sidebar":"mainSidebar","previous":{"title":"ORM - Best Practices","permalink":"/en/docs/core/gdb-practice"},"next":{"title":"Try to use JSON for complex types for storage, facilitating automatic conversion to objects upon scanning, avoiding custom parsing","permalink":"/en/docs/core/gdb-practice-using-json-for-complicated-field"}}'),o=i("785893"),a=i("250065");let s={slug:"/docs/core/gdb-practice-using-pointer-and-do-for-update-api",title:"Utilizing Pointer Properties and Do Objects for Flexible Modification Interfaces",sidebar_position:0,hide_title:!0,keywords:["GoFrame","GoFrame framework","do objects","pointer","API","user information modification","database update","request parameters","business logic","automatic filtering"],description:"Utilizing pointer and do objects in the GoFrame framework to implement flexible modification interface APIs. By using attributes with pointer types and do objects, developers can easily perform user information modification operations, including updates to fields like password, nickname, and status, effectively simplifying the complexity of database updates."},r=void 0,d={},c=[{value:"Data Structure",id:"data-structure",level:2},{value:"Request API Definition",id:"request-api-definition",level:2},{value:"Business Logic Implementation",id:"business-logic-implementation",level:2}];function l(e){let t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["It is well known that the framework's built-in development tools can generate ",(0,o.jsx)(t.code,{children:"do"})," object code, primarily used for operations such as query, modification, and writing that automatically filter ",(0,o.jsx)(t.code,{children:"nil"})," operation fields."]}),"\n",(0,o.jsxs)(t.p,{children:["Today, I will teach you a new way to quickly implement flexible and convenient modification operations ",(0,o.jsx)(t.code,{children:"API"})," implementation using pointers in combination with ",(0,o.jsx)(t.code,{children:"do"})," objects."]}),"\n",(0,o.jsx)(t.h2,{id:"data-structure",children:"Data Structure"}),"\n",(0,o.jsx)(t.p,{children:"Here is the data structure of the user table we are using:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sql",children:"CREATE TABLE `user` (\n    `id`        int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'User ID',\n    `passport`  varchar(32) NOT NULL COMMENT 'Account',\n    `password`  varchar(32) NOT NULL COMMENT 'Password',\n    `nickname`  varchar(32) NOT NULL COMMENT 'Nickname',\n    `status`    varchar(32) NOT NULL COMMENT 'Status',\n    `brief`     varchar(512) NOT NULL COMMENT 'Remarks',\n    `create_at` datetime DEFAULT NULL COMMENT 'Creation Time',\n    `update_at` datetime DEFAULT NULL COMMENT 'Modification Time',\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uniq_passport` (`passport`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n"})}),"\n",(0,o.jsx)(t.p,{children:"For the user status, we use a separate type definition to implement enumeration values:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'type Status string\n\nconst (\n    StatusEnabled  Status = "enabled"\n    StatusDisabled Status = "disabled"\n)\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Using the ",(0,o.jsx)(t.code,{children:"gf gen dao"})," command, the automatically generated ",(0,o.jsx)(t.code,{children:"do"})," objects are as follows:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'type User struct {\n    g.Meta    `table:"user" orm:"do:true"`\n    Id        interface{}\n    Passport  interface{}\n    Password  interface{}\n    Nickname  interface{}\n    Status    interface{}\n    Brief     interface{}\n    CreatedAt interface{}\n    UpdatedAt interface{}\n}\n'})}),"\n",(0,o.jsx)(t.h2,{id:"request-api-definition",children:"Request API Definition"}),"\n",(0,o.jsxs)(t.p,{children:["Let's implement an API interface for modifying user information, which is a maintenance management interface that can modify user information through the user account name. The definition of this ",(0,o.jsx)(t.code,{children:"API"})," is as follows:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'type UpdateReq struct {\n    g.Meta   `path:"/user/{Id}" method:"post" summary:"Modify user information"`\n    Passport string  `v:"required" dc:"User account"`\n    Password *string `dc:"Modify user password"`\n    Nickname *string `dc:"Modify user nickname"`\n    Status   *Status `dc:"Modify user status"`\n    Brief    *string `dc:"Modify user description"`\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"Here, the user's modifiable information includes password, nickname, status, and description, which may be modified individually or in combination. Pointer-type attribute parameters are used here to implement: execute modification when the parameter is passed, do not modify when it is not passed."}),"\n",(0,o.jsx)(t.h2,{id:"business-logic-implementation",children:"Business Logic Implementation"}),"\n",(0,o.jsxs)(t.p,{children:["For simplicity, we directly pass pointer parameters to the ",(0,o.jsx)(t.code,{children:"do"})," object within the controller. We know that when the parameter is not passed by the caller, the parameter is ",(0,o.jsx)(t.code,{children:"nil"}),". Therefore, when the field is passed to the ",(0,o.jsx)(t.code,{children:"do"})," object, it is still ",(0,o.jsx)(t.code,{children:"nil"}),", and during the database update operation, the ",(0,o.jsx)(t.code,{children:"nil"})," field in the ",(0,o.jsx)(t.code,{children:"do"})," object will be automatically filtered out."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"func (c *Controller) Update(ctx context.Context, req *v1.UpdateReq) (res *v1.UpdateRes, err error) {\n    _, err = dao.User.Ctx(ctx).Data(do.User{\n        Password: req.Password,\n        Nickname: req.Nickname,\n        Status:   req.Status,\n        Brief:    req.Brief,\n    }).Where(do.User{\n        Passport: req.Passport,\n    }).Update()\n    return\n}\n"})})]})}function u(e={}){let{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},250065:function(e,t,i){i.d(t,{Z:function(){return r},a:function(){return s}});var n=i(667294);let o={},a=n.createContext(o);function s(e){let t=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);