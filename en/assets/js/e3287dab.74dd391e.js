"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["11313"],{713480:function(e,r,t){t.r(r),t.d(r,{metadata:()=>n,contentTitle:()=>c,default:()=>a,assets:()=>d,toc:()=>m,frontMatter:()=>s});var n=JSON.parse('{"id":"docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66/\u76D1\u63A7\u544A\u8B66-\u540C\u6B65\u6307\u6807","title":"\u76D1\u63A7\u544A\u8B66-\u540C\u6B65\u6307\u6807","description":"\u5728GoFrame\u6846\u67B6\u4E2D\u4F7F\u7528\u540C\u6B65\u6307\u6807\uFF0C\u901A\u8FC7gmetric\u63D0\u4F9B\u7684Counter\u3001UpDownCounter\u548CHistogram\u7B49\u7C7B\u578B\u5FEB\u901F\u66B4\u9732\u548C\u8BB0\u5F55HTTP\u8BF7\u6C42\u7684\u76F8\u5173\u6570\u636E\u3002\u5229\u7528Prometheus\u534F\u8BAE\u5B9E\u73B0\u6307\u6807\u8F93\u51FA\uFF0C\u4EE5\u4F9B\u5916\u90E8\u76D1\u63A7\u5DE5\u5177\u6293\u53D6\u548C\u5206\u6790\uFF0C\u8FBE\u5230\u6709\u6548\u7684\u6027\u80FD\u76D1\u63A7\u548C\u7BA1\u7406\u3002","source":"@site/versioned_docs/version-2.7.x/docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66/\u76D1\u63A7\u544A\u8B66-\u540C\u6B65\u6307\u6807.md","sourceDirName":"docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66","slug":"/docs/obs/metrics-sync","permalink":"/en/2.7.x/docs/obs/metrics-sync","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-2.7.x/docs/\u670D\u52A1\u53EF\u89C2\u6D4B\u6027/\u670D\u52A1\u76D1\u63A7\u544A\u8B66/\u76D1\u63A7\u544A\u8B66-\u540C\u6B65\u6307\u6807.md","tags":[],"version":"2.7.x","lastUpdatedBy":"John","lastUpdatedAt":1731504210000,"sidebarPosition":2,"frontMatter":{"slug":"/docs/obs/metrics-sync","title":"\u76D1\u63A7\u544A\u8B66-\u540C\u6B65\u6307\u6807","sidebar_position":2,"hide_title":true,"keywords":["GoFrame","\u76D1\u63A7","\u540C\u6B65\u6307\u6807","Counter","UpDownCounter","Histogram","Prometheus","OpenTelemetry","\u6307\u6807\u5BFC\u51FA","\u6027\u80FD\u76D1\u63A7"],"description":"\u5728GoFrame\u6846\u67B6\u4E2D\u4F7F\u7528\u540C\u6B65\u6307\u6807\uFF0C\u901A\u8FC7gmetric\u63D0\u4F9B\u7684Counter\u3001UpDownCounter\u548CHistogram\u7B49\u7C7B\u578B\u5FEB\u901F\u66B4\u9732\u548C\u8BB0\u5F55HTTP\u8BF7\u6C42\u7684\u76F8\u5173\u6570\u636E\u3002\u5229\u7528Prometheus\u534F\u8BAE\u5B9E\u73B0\u6307\u6807\u8F93\u51FA\uFF0C\u4EE5\u4F9B\u5916\u90E8\u76D1\u63A7\u5DE5\u5177\u6293\u53D6\u548C\u5206\u6790\uFF0C\u8FBE\u5230\u6709\u6548\u7684\u6027\u80FD\u76D1\u63A7\u548C\u7BA1\u7406\u3002"},"sidebar":"mainSidebar","previous":{"title":"\u76D1\u63A7\u544A\u8B66-\u57FA\u672C\u4F7F\u7528","permalink":"/en/2.7.x/docs/obs/metrics-example"},"next":{"title":"\u76D1\u63A7\u544A\u8B66-\u5F02\u6B65\u6307\u6807","permalink":"/en/2.7.x/docs/obs/metrics-async"}}'),o=t("785893"),i=t("250065");let s={slug:"/docs/obs/metrics-sync",title:"\u76D1\u63A7\u544A\u8B66-\u540C\u6B65\u6307\u6807",sidebar_position:2,hide_title:!0,keywords:["GoFrame","\u76D1\u63A7","\u540C\u6B65\u6307\u6807","Counter","UpDownCounter","Histogram","Prometheus","OpenTelemetry","\u6307\u6807\u5BFC\u51FA","\u6027\u80FD\u76D1\u63A7"],description:"\u5728GoFrame\u6846\u67B6\u4E2D\u4F7F\u7528\u540C\u6B65\u6307\u6807\uFF0C\u901A\u8FC7gmetric\u63D0\u4F9B\u7684Counter\u3001UpDownCounter\u548CHistogram\u7B49\u7C7B\u578B\u5FEB\u901F\u66B4\u9732\u548C\u8BB0\u5F55HTTP\u8BF7\u6C42\u7684\u76F8\u5173\u6570\u636E\u3002\u5229\u7528Prometheus\u534F\u8BAE\u5B9E\u73B0\u6307\u6807\u8F93\u51FA\uFF0C\u4EE5\u4F9B\u5916\u90E8\u76D1\u63A7\u5DE5\u5177\u6293\u53D6\u548C\u5206\u6790\uFF0C\u8FBE\u5230\u6709\u6548\u7684\u6027\u80FD\u76D1\u63A7\u548C\u7BA1\u7406\u3002"},c=void 0,d={},m=[{value:"\u57FA\u672C\u4ECB\u7ECD",id:"\u57FA\u672C\u4ECB\u7ECD",level:2},{value:"Counter&amp;UpDownCounter",id:"counterupdowncounter",level:2},{value:"Histogram",id:"histogram",level:2},{value:"Primetheus Exporter",id:"primetheus-exporter",level:2}];function u(e){let r={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.h2,{id:"\u57FA\u672C\u4ECB\u7ECD",children:"\u57FA\u672C\u4ECB\u7ECD"}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.strong,{children:"\u540C\u6B65\u7C7B\u578B"})," \u7528\u4E8E\u5FEB\u901F\u66B4\u9732\u76D1\u63A7\u6307\u6807\uFF0C\u65E0\u8BBA ",(0,o.jsx)(r.code,{children:"metrics reader"})," \u662F\u5426\u4F7F\u7528\u8BE5\u76D1\u63A7\u6307\u6807\uFF0C\u6307\u6807\u7684\u8BA1\u7B97\u7ED3\u679C\u5DF2\u5B8C\u6210\uFF0C\u5F85\u8BFB\u53D6\u4F7F\u7528\u3002\u4F8B\u5982\uFF0CHTTP\u7684\u8BF7\u6C42\u603B\u6570\u3001\u8BF7\u6C42\u5927\u5C0F\uFF0C\u8FD9\u4E9B\u6570\u503C\u5FC5\u987B\u5728\u8BF7\u6C42\u6267\u884C\u6D41\u7A0B\u4E2D\u8BB0\u5F55\u5230\u5BF9\u5E94\u7684\u76D1\u63A7\u6307\u6807\u6570\u503C\u4E2D\uFF0C\u9002\u5408\u4F5C\u4E3A\u540C\u6B65\u6307\u6807\u6765\u7BA1\u7406\u3002"]}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.code,{children:"gmetric"})," \u63D0\u4F9B\u7684\u540C\u6B65\u7C7B\u578B\u6307\u6807\u5305\u542B\uFF1A ",(0,o.jsx)(r.code,{children:"Counter, UpDownCounter, Histogram"}),"\u3002"]}),"\n",(0,o.jsx)(r.p,{children:"\u6211\u4EEC\u7528\u4E00\u4E2A\u7B80\u5355\u7684\u793A\u4F8B\u6765\u6F14\u793A\u540C\u6B65\u6307\u6807\u7684\u57FA\u672C\u4F7F\u7528\u3002"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-go",children:'package main\n\nimport (\n    "go.opentelemetry.io/otel/exporters/prometheus"\n\n    "github.com/gogf/gf/contrib/metric/otelmetric/v2"\n    "github.com/gogf/gf/v2/frame/g"\n    "github.com/gogf/gf/v2/os/gctx"\n    "github.com/gogf/gf/v2/os/gmetric"\n)\n\nvar (\n    meter = gmetric.GetGlobalProvider().Meter(gmetric.MeterOption{\n        Instrument:        "github.com/gogf/gf/example/metric/basic",\n        InstrumentVersion: "v1.0",\n    })\n    counter = meter.MustCounter(\n        "goframe.metric.demo.counter",\n        gmetric.MetricOption{\n            Help: "This is a simple demo for Counter usage",\n            Unit: "bytes",\n        },\n    )\n    upDownCounter = meter.MustUpDownCounter(\n        "goframe.metric.demo.updown_counter",\n        gmetric.MetricOption{\n            Help: "This is a simple demo for UpDownCounter usage",\n            Unit: "%",\n        },\n    )\n    histogram = meter.MustHistogram(\n        "goframe.metric.demo.histogram",\n        gmetric.MetricOption{\n            Help:    "This is a simple demo for histogram usage",\n            Unit:    "ms",\n            Buckets: []float64{0, 10, 20, 50, 100, 500, 1000, 2000, 5000, 10000},\n        },\n    )\n)\n\nfunc main() {\n    var ctx = gctx.New()\n\n    // Prometheus exporter to export metrics as Prometheus format.\n    exporter, err := prometheus.New(\n        prometheus.WithoutCounterSuffixes(),\n        prometheus.WithoutUnits(),\n    )\n    if err != nil {\n        g.Log().Fatal(ctx, err)\n    }\n\n    // OpenTelemetry provider.\n    provider := otelmetric.MustProvider(otelmetric.WithReader(exporter))\n    provider.SetAsGlobal()\n    defer provider.Shutdown(ctx)\n\n    // Counter.\n    counter.Inc(ctx)\n    counter.Add(ctx, 10)\n\n    // UpDownCounter.\n    upDownCounter.Inc(ctx)\n    upDownCounter.Add(ctx, 10)\n    upDownCounter.Dec(ctx)\n\n    // Record values for histogram.\n    histogram.Record(1)\n    histogram.Record(20)\n    histogram.Record(30)\n    histogram.Record(101)\n    histogram.Record(2000)\n    histogram.Record(9000)\n    histogram.Record(20000)\n\n    // HTTP Server for metrics exporting.\n    otelmetric.StartPrometheusMetricsServer(8000, "/metrics")\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"counterupdowncounter",children:"Counter&UpDownCounter"}),"\n",(0,o.jsxs)(r.p,{children:["\u5176\u4E2D\u7684 ",(0,o.jsx)(r.code,{children:"Counter"})," \u548C ",(0,o.jsx)(r.code,{children:"UpDownCounter"})," \u6BD4\u8F83\u7B80\u5355\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F ",(0,o.jsx)(r.code,{children:"Counter"})," \u548C ",(0,o.jsx)(r.code,{children:"UpDownCounter"})," \u867D\u7136\u770B\u8D77\u6765\u5DEE\u4E0D\u591A\uFF0C\u5B9E\u9645\u4E0A\u4E5F\u662F\u5982\u6B64\uFF0C\u53EA\u662F\u4E3A\u4E86\u66F4\u4E25\u8C28\u548C\u7CBE\u7EC6\u5316\u533A\u5206\u4F7F\u7528\u573A\u666F\u3002\u5982\u679C\u5C06\u8FD9\u4E24\u79CD\u6570\u636E\u7C7B\u578B\u6620\u5C04\u5230\u7ECF\u5178\u7684 ",(0,o.jsx)(r.code,{children:"Prometheus"})," \u6307\u6807\u7C7B\u578B\u4E2D\uFF0C ",(0,o.jsx)(r.code,{children:"Counter"})," \u5BF9\u5E94\u7684\u5C31\u662F ",(0,o.jsx)(r.code,{children:"Prometheus"})," \u7684 ",(0,o.jsx)(r.code,{children:"Counter"})," \u6307\u6807\u7C7B\u578B\uFF0C\u800C ",(0,o.jsx)(r.code,{children:"UpDownCounter"})," \u5BF9\u5E94\u7684\u662F ",(0,o.jsx)(r.code,{children:"Prometheus"})," \u7684 ",(0,o.jsx)(r.code,{children:"Gauge"})," \u6307\u6807\u7C7B\u578B\u3002"]}),"\n",(0,o.jsx)(r.h2,{id:"histogram",children:"Histogram"}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.code,{children:"Histogram"})," \u662F\u4E00\u79CD\u7EDF\u8BA1\u7C7B\u578B\uFF0C\u901A\u8FC7\u8BE5\u6307\u6807\u53EF\u4EE5\u5FEB\u901F\u7EDF\u8BA1\u51FA\u6307\u6807\u7684 ",(0,o.jsx)(r.code,{children:"p95, p99"})," \u7B49\u767E\u5206\u4F4D\u7EDF\u8BA1\u7ED3\u679C\u76F4\u65B9\u56FE\uFF0C\u4F8B\u5982\u65F6\u95F4\u5F00\u9500\u3001\u6210\u529F/\u5931\u8D25\u7387\u7B49\u6307\u6807\u3002\u4F46\u9700\u8981\u6CE8\u610F\u8BE5\u6307\u6807\u6BD4\u8F83\u5360\u5185\u5B58\u548C\u7A7A\u95F4\uFF0C\u4E0D\u80FD\u4E3A\u5176\u6DFB\u52A0\u8FC7\u591A\u7684 ",(0,o.jsx)(r.strong,{children:"\u52A8\u6001\u5C5E\u6027"}),"\uFF0C\u56E0\u4E3A\u4E0D\u540C\u7684\u5C5E\u6027\u4F1A\u884D\u751F\u51FA\u540C\u4E00\u79CD ",(0,o.jsx)(r.code,{children:"Histogram"})," \u6307\u6807\u4E0D\u540C\u7684\u5B58\u50A8\u6570\u503C\u3002"]}),"\n",(0,o.jsx)(r.h2,{id:"primetheus-exporter",children:"Primetheus Exporter"}),"\n",(0,o.jsxs)(r.p,{children:["\u5728\u8BE5\u793A\u4F8B\u4E2D\uFF0C\u6211\u4EEC\u4F7F\u7528\u4E86\u6BD4\u8F83\u5E38\u7528\u7684 ",(0,o.jsx)(r.code,{children:"Prometheus"})," \u534F\u8BAE\u8F93\u51FA\u6307\u6807\u5185\u5BB9\uFF0C\u901A\u5E38\u7528\u4E8E\u5BF9\u5916\u66B4\u9732\u6307\u6807\u4F9B\u5916\u90E8\u7EC4\u4EF6\u6293\u53D6\u3002\u901A\u8FC7\u4EE5\u4E0B\u8DEF\u7531\u5C06\u6307\u6807\u901A\u8FC7 ",(0,o.jsx)(r.code,{children:"Prometheus"})," \u534F\u8BAE\u66B4\u9732\uFF1A"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:'otelmetric.StartPrometheusMetricsServer(8000, "/metrics")\n'})}),"\n",(0,o.jsxs)(r.p,{children:["\u6267\u884C\u540E\uFF0C\u8BBF\u95EE ",(0,o.jsx)(r.a,{href:"http://127.0.0.1:8000/metrics",children:"http://127.0.0.1:8000/metrics"})," \u67E5\u770B\u66B4\u9732\u7684\u6307\u6807\uFF1A"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:t(215442).Z+"",width:"2160",height:"2014"})}),"\n",(0,o.jsx)(r.p,{children:"\u6211\u4EEC\u8FD9\u91CC\u53EA\u5173\u6CE8\u672C\u6B21\u793A\u4F8B\u4E2D\u7684\u6307\u6807\uFF0C\u5176\u4ED6\u81EA\u52A8\u66B4\u9732\u7684\u6307\u6807\u5728\u540E\u7EED\u7AE0\u8282\u4ECB\u7ECD\u3002"})]})}function a(e={}){let{wrapper:r}={...(0,i.a)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},215442:function(e,r,t){t.d(r,{Z:function(){return n}});let n=t.p+"assets/images/50c5c45e521aa19633873aa9f9186ac3-97921be064a668013024a15faaeae91d.png"},250065:function(e,r,t){t.d(r,{Z:function(){return c},a:function(){return s}});var n=t(667294);let o={},i=n.createContext(o);function s(e){let r=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);